<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Golf Handicap Tracker - Cloud Edition</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- PWA Requirements -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <!-- Chart.js for Handicap Trend -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- SheetJS for Excel Bulk Import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>

<body>

    <!-- Authentication Overlay -->
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-card card">
            <h2>Welcome to Golf Tracker</h2>
            <p>Please log in to access your databases.</p>
            <div id="auth-error" class="error-text hidden"></div>

            <form id="auth-form" class="round-form">
                <div class="form-group">
                    <label for="auth-email">Email</label>
                    <input type="email" id="auth-email" required>
                </div>
                <div class="form-group">
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" required minlength="6">
                </div>

                <div id="register-fields" class="hidden">
                    <div class="form-group">
                        <label for="auth-name">Display Name</label>
                        <input type="text" id="auth-name">
                    </div>
                </div>

                <div class="auth-buttons">
                    <button type="submit" id="btn-login" class="btn btn-primary">Login</button>
                    <button type="button" id="btn-register" class="btn btn-secondary">Register New Account</button>
                </div>
                <div style="text-align:center;margin-top:10px;">
                    <a href="#" id="link-forgot-password" style="font-size:0.85rem;color:var(--secondary-color);">Forgot
                        password?</a>
                </div>
            </form>

            <div id="forgot-password-section" class="hidden"
                style="margin-top:15px;padding:15px;background:#f8f9fa;border-radius:8px;">
                <form id="forgot-password-form">
                    <div class="form-group" style="margin-bottom:10px;">
                        <label for="forgot-email">Enter your email address</label>
                        <input type="email" id="forgot-email" placeholder="you@example.com" required>
                    </div>
                    <button type="submit" class="btn btn-secondary" style="width:100%;">Send Reset Link</button>
                </form>
                <div id="forgot-password-msg" class="hidden" style="margin-top:8px;font-size:0.9rem;"></div>
            </div>
            <div class="auth-switch hidden" id="auth-switch-back">
                <a href="#" id="link-back-login">Back to Login</a>
            </div>
        </div>
    </div>

    <!-- Account Pending Overlay -->
    <div id="auth-pending" class="auth-overlay hidden">
        <div class="auth-card card">
            <h2>Account Pending</h2>
            <p style="margin-bottom: 20px;">Your account has been successfully created, but it is currently waiting for
                admin approval.</p>
            <p>Please contact the administrator to grant you access.</p>
            <button id="btn-pending-logout" class="btn btn-secondary"
                style="margin-top: 30px; width: 100%;">Logout</button>
        </div>
    </div>


    <div class="app-container hidden" id="main-app">

        <!-- Top Status Bar -->
        <div class="player-management-bar"
            style="border-bottom-left-radius: 0; border-bottom-right-radius: 0; margin-bottom: 0; border-bottom: none;">
            <div class="user-controls" style="width: 100%; justify-content: space-between;">
                <span>Logged in as: <strong id="logged-in-user-name">...</strong></span>
                <button id="btn-logout" class="btn btn-secondary btn-sm" style="margin-left: 10px;">Logout</button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs-container">
            <button class="tab-btn active" data-target="tab-whs">WHS Handicap Database</button>
            <button class="tab-btn" data-target="tab-comp">Custom Competitions</button>
            <button class="tab-btn" data-target="tab-practice">Practice Drills</button>
            <button class="tab-btn" data-target="tab-oncourse">On Course</button>
            <button class="tab-btn hidden" id="tab-btn-feed" data-target="tab-feed">üë• Feed</button>
            <button class="tab-btn hidden" id="tab-btn-coach" data-target="tab-coach"
                style="background-color: #d1d8e0; color: #3867d6;">Coach Portal</button>
            <button class="tab-btn hidden" id="tab-btn-admin" data-target="tab-admin"
                style="background-color: #ffeaa7; color: #d35400;">Admin Dashboard</button>
            <button class="tab-btn" id="tab-btn-settings" data-target="tab-settings" style="margin-left:auto;">‚öôÔ∏è
                Settings</button>
        </div>

        <!-- ========================================== -->
        <!-- WHS HANDICAP TAB                           -->
        <!-- ========================================== -->
        <div id="tab-whs" class="tab-content active">

            <div class="player-management-bar" style="margin-top: 20px;">
                <div class="player-selector">
                    <label for="player-select">Viewing Dashboard Of:</label>
                    <select id="player-select"></select>
                </div>
                <button type="button" id="btn-manage-coaches" class="btn btn-secondary btn-sm"
                    style="margin-top: 10px;">Manage My Coaches</button>
            </div>

            <!-- Manage Coaches (Hidden by Default) -->
            <div id="manage-coaches-container" class="card hidden"
                style="margin-bottom: 20px; border: 2px solid var(--secondary-color);">
                <h2>Manage Coach Access</h2>
                <p class="section-desc">Grant coaches access to your dashboard and logs by entering their registered
                    email address.</p>
                <form id="add-coach-form" class="round-form"
                    style="display: flex; gap: 10px; align-items: flex-end; margin-bottom: 15px;">
                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label for="coach-email">Coach's Email Address</label>
                        <input type="email" id="coach-email" required placeholder="coach@example.com">
                    </div>
                    <button type="submit" class="btn btn-primary" style="height: 42px;">Grant Access</button>
                </form>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
                    <ul id="my-coaches-list" style="list-style: none; padding: 0; margin: 0;">
                        <!-- Dynamically populated -->
                    </ul>
                </div>
                <button type="button" id="btn-close-coaches" class="btn btn-secondary btn-sm"
                    style="margin-top: 10px;">Close Manage</button>
            </div>

            <!-- Header / Index Display -->
            <header class="header">
                <div class="header-content">
                    <div class="branding">
                        <h1>Handicap Tracker <span
                                style="font-size:0.5em; color:#94a3b8; font-weight:normal; vertical-align:middle; margin-left:8px;">v4.5.0</span>
                        </h1>
                        <p>World Handicap System (WHS)</p>
                    </div>
                    <div class="index-display">
                        <span class="index-label">Handicap Index¬Æ</span>
                        <span class="index-value" id="handicap-index">--</span>
                        <span class="index-subtext" id="index-subtext">Submit 54 counting holes to establish</span>
                        <button id="btn-export-whs" class="btn btn-secondary btn-sm"
                            style="margin-top: 15px; border-color: white; color: white; background: rgba(0,0,0,0.1);">Email
                            / Export Report</button>
                    </div>
                </div>
            </header>

            <div class="dashboard-grid">

                <!-- Daily Handicap Calculator -->
                <section class="card calculator-section">
                    <h2>Daily Playing Handicap</h2>
                    <p class="section-desc">Calculate the viewing player's daily handicap.</p>
                    <form id="calculator-form" class="round-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="calc-scratch">Scratch Rating</label>
                                <input type="number" id="calc-scratch" step="0.1" min="50" max="90" required>
                            </div>
                            <div class="form-group">
                                <label for="calc-slope">Slope Rating</label>
                                <input type="number" id="calc-slope" min="55" max="155" required>
                            </div>
                            <div class="form-group">
                                <label for="calc-par">Course Par</label>
                                <input type="number" id="calc-par" min="50" max="80" required>
                            </div>
                        </div>
                        <div class="form-row" style="justify-content: flex-end; margin-bottom: 0;">
                            <button type="button" id="btn-calculate-daily" class="btn btn-secondary btn-sm"
                                style="width: auto;">Calculate</button>
                        </div>
                        <div id="daily-handicap-result" class="result-box hidden">
                            <span class="result-label">Daily Handicap for <span id="dh-player-name"></span>:</span>
                            <span class="result-value" id="dh-value">--</span>
                        </div>
                    </form>
                </section>

                <!-- Add Round Form (Only visible if viewing own dashboard) -->
                <section class="card add-round-section" id="add-round-container">
                    <h2>Log a New Round</h2>
                    <p class="section-desc">You are logging this round to your official WHS profile.</p>
                    <form id="add-round-form" class="round-form">
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label for="course-select">Course</label>
                                <select id="course-select" required>
                                    <option value="" disabled selected>Select Course...</option>
                                    <!-- Injected by JS -->
                                </select>
                            </div>
                            <div class="form-group flex-2 hidden" id="course-name-custom-group">
                                <label for="course-name">Course Name</label>
                                <input type="text" id="course-name" placeholder="e.g. Royal Melbourne">
                            </div>
                            <div class="form-group">
                                <label for="date">Date Played</label>
                                <input type="date" id="date" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="course-rating">Course Rating (CR)</label>
                                <input type="number" id="course-rating" step="0.1" min="50" max="90" required>
                            </div>
                            <div class="form-group">
                                <label for="slope-rating">Slope Rating (SR)</label>
                                <input type="number" id="slope-rating" min="55" max="155" required>
                            </div>
                            <div class="form-group">
                                <label for="course-par">Course Par</label>
                                <input type="number" id="course-par" min="50" max="80" required>
                            </div>
                        </div>

                        <div class="form-row" style="margin-top: 15px; margin-bottom: 15px;">
                            <div class="form-group" style="width: 100%;">
                                <label>Score Entry Mode</label>
                                <div
                                    style="display: flex; flex-wrap: wrap; gap: 15px; background: #e9ecef; padding: 10px; border-radius: 6px;">
                                    <label
                                        style="display: flex; align-items: center; gap: 5px; margin: 0; cursor:pointer;">
                                        <input type="radio" name="entry-mode" value="hole-by-hole" checked> Hole-by-Hole
                                        (Auto Stableford)
                                    </label>
                                    <label
                                        style="display: flex; align-items: center; gap: 5px; margin: 0; cursor:pointer;">
                                        <input type="radio" name="entry-mode" value="total-stableford"> Total Stableford
                                        (Quick)
                                    </label>
                                    <label
                                        style="display: flex; align-items: center; gap: 5px; margin: 0; cursor:pointer;">
                                        <input type="radio" name="entry-mode" value="manual-ags"> Manual AGS (Legacy)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div id="mode-hole-by-hole" class="mode-container">
                            <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">Enter your gross
                                strokes. Daily Handicap and Stroke Index applies.</p>
                            <div id="hole-grid-container"
                                style="display: grid; grid-template-columns: repeat(9, 1fr); gap: 5px; margin-bottom: 15px;">
                                <!-- Hole inputs injected by JS -->
                            </div>
                            <div
                                style="background: #f8fafc; padding: 10px; border-radius: 6px; text-align: center; border: 1px solid #e2e8f0; margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Estimated Stableford: <span
                                        id="calc-stableford-pts">0</span> pts</strong>
                            </div>
                        </div>

                        <div id="mode-total-stableford" class="mode-container hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="total-stableford-pts">Total Stableford Points</label>
                                    <input type="number" id="total-stableford-pts" min="0" max="60">
                                </div>
                            </div>
                        </div>

                        <div id="mode-manual-ags" class="mode-container hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="score">Adjusted Gross Score</label>
                                    <input type="number" id="score" min="50" max="200" required>
                                    <small>Manual entry or calculated from above</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-row" style="margin-top: 10px;">
                            <div class="form-group checkbox-group"
                                style="flex-direction: row; align-items: center; gap: 8px;">
                                <input type="checkbox" id="is-counting" checked style="width: 20px; height: 20px;">
                                <label for="is-counting" style="margin: 0;">Mark as Counting Round (Affects
                                    Handicap)</label>
                            </div>
                        </div>

                        <!-- Optional Advanced Stats -->
                        <details style="margin-top:12px;">
                            <summary
                                style="cursor:pointer;font-weight:600;color:var(--secondary-color);font-size:0.9rem;">üìä
                                Optional: Add Advanced Stats</summary>
                            <div class="form-row" style="margin-top:10px;">
                                <div class="form-group">
                                    <label for="stat-putts">Total Putts</label>
                                    <input type="number" id="stat-putts" min="10" max="60" placeholder="e.g. 32">
                                </div>
                                <div class="form-group">
                                    <label for="stat-fwy">Fairways Hit (of 14)</label>
                                    <input type="number" id="stat-fwy" min="0" max="14" placeholder="e.g. 8">
                                </div>
                                <div class="form-group">
                                    <label for="stat-gir">Greens in Reg. (of 18)</label>
                                    <input type="number" id="stat-gir" min="0" max="18" placeholder="e.g. 6">
                                </div>
                            </div>
                        </details>
                        <button type="submit" class="btn btn-primary" style="margin-top: 15px;">Save Round to
                            Profile</button>
                    </form>
                </section>

                <!-- Read Only Warning -->
                <section class="card add-round-section hidden" id="readonly-warning-container"
                    style="display: flex; align-items: center; justify-content: center; text-align: center;">
                    <div>
                        <h2>View Only Mode</h2>
                        <p style="color: var(--text-light); margin-top: 10px;">You are viewing someone else's WHS
                            dashboard.<br>You can only add rounds to your own profile.</p>
                    </div>
                </section>
            </div>

            <section class="card history-section">
                <div class="history-header">
                    <h2>WHS Scoring Record (<span id="record-player-name"></span>)</h2>
                </div>
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Course</th>
                                <th>Holes</th>
                                <th>Score</th>
                                <th>CR / SR</th>
                                <th>Diff.</th>
                                <th>Status</th>
                                <th class="col-action">Action</th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody">
                            <!-- Rounds injected here via JS -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-state" class="empty-state">
                    <p>No rounds logged yet.</p>
                </div>
                <div id="loading-state" class="empty-state">
                    <p>Loading WHS data...</p>
                </div>
            </section>

            <!-- Handicap Trend Chart -->
            <section class="card" id="handicap-chart-section" style="padding:20px;">
                <h2 style="margin-bottom:8px;">üìà Handicap Index Trend</h2>
                <p class="section-desc" style="margin-bottom:16px;">Your handicap index over time ‚Äî lower is better.</p>
                <div style="position:relative;height:220px;">
                    <canvas id="handicap-chart"></canvas>
                </div>
                <div id="chart-no-data" class="empty-state hidden">
                    <p>Log at least 3 rounds to see your trend chart.</p>
                </div>
            </section>
        </div> <!-- End WHS Tab -->

        <!-- ========================================== -->
        <!-- CUSTOM COMPETITIONS TAB                    -->
        <!-- ========================================== -->
        <div id="tab-comp" class="tab-content hidden">

            <!-- Competition Selection Bar -->
            <div class="player-management-bar" style="margin-top: 20px;">
                <div class="player-selector">
                    <label for="comp-select">Active Competition:</label>
                    <select id="comp-select">
                        <option value="">-- Select a Competition --</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button id="btn-toggle-archived" class="btn btn-secondary btn-sm"
                        style="margin: 0; width: auto; font-size: 0.8rem;">üì¶ Show Archived</button>
                    <button id="btn-show-create-comp" class="btn btn-primary btn-sm" style="margin: 0; width: auto;">+
                        New
                        Competition</button>
                </div>
            </div>

            <!-- Create New Competition Form (Hidden by Default) -->
            <div id="create-comp-container" class="card hidden"
                style="margin-bottom: 20px; border: 2px solid var(--accent-color);">
                <h2>Create Custom Competition</h2>
                <form id="create-comp-form" class="round-form">
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label>Competition Name</label>
                            <input type="text" id="comp-name" required placeholder="e.g. Summer League 2026">
                        </div>
                    </div>

                    <div class="form-row" style="background: #e9ecef; padding: 10px; border-radius: 6px;">
                        <div class="form-group flex-2">
                            <label>Visibility</label>
                            <div style="display: flex; gap: 20px; align-items: center;">
                                <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="comp-visibility" value="public" checked> Public (Anyone
                                    can join)
                                </label>
                                <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="comp-visibility" value="private"> Private (Invite Only)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="comp-invite-container" class="form-row hidden"
                        style="background: #fff; border: 1px solid var(--border-color); padding: 10px; border-radius: 6px; flex-direction: column;">
                        <label style="margin-bottom: 5px; color: var(--primary-color);">Select Invited Players:</label>
                        <div id="comp-invite-list"
                            style="max-height: 150px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;">
                            <!-- Checkboxes injected here via JS -->
                        </div>
                    </div>

                    <h3 style="margin: 15px 0 10px; font-size: 1.1rem; color: var(--secondary-color);">Configuration
                        Template</h3>
                    <div class="form-row"
                        style="background: #e9ecef; padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                        <div class="form-group flex-2">
                            <label>Use Previous Competition's Template (Optional)</label>
                            <select id="comp-template-select">
                                <option value="">-- Build From Scratch --</option>
                            </select>
                        </div>
                    </div>

                    <h3 style="margin: 15px 0 10px; font-size: 1.1rem; color: var(--secondary-color);">Automated
                        Starting Points</h3>
                    <p class="section-desc">Configure baseline points awarded at the start of the round or on every
                        hole.</p>

                    <div
                        style="background: #f8f9fa; padding: 15px; border-radius: 6px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                        <!-- Per Round Config -->
                        <div style="margin-bottom: 15px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px;">
                            <label
                                style="font-weight: 600; display: flex; align-items: center; gap: 8px; color: var(--primary-color);">
                                <input type="checkbox" id="sp-round-enable"> Enable Per-Round Baseline
                            </label>

                            <div id="sp-round-config" class="hidden" style="margin-top: 10px; padding-left: 24px;">
                                <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 10px;">
                                    <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="sp-round-type" value="fixed" checked> Fixed Points
                                    </label>
                                    <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="sp-round-type" value="handicap_calculated"> Math:
                                        (Base - Handicap)
                                    </label>
                                </div>
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label id="sp-round-val-label">Points per Player</label>
                                    <input type="number" id="sp-round-value" style="max-width: 200px;">
                                </div>
                            </div>
                        </div>

                        <!-- Per Hole Config -->
                        <div>
                            <label
                                style="font-weight: 600; display: flex; align-items: center; gap: 8px; color: var(--primary-color);">
                                <input type="checkbox" id="sp-hole-enable"> Enable Per-Hole Baseline
                            </label>

                            <div id="sp-hole-config" class="hidden" style="margin-top: 10px; padding-left: 24px;">
                                <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 10px;">
                                    <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="sp-hole-type" value="fixed" checked> Fixed Points
                                    </label>
                                    <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="sp-hole-type" value="handicap_calculated"> Math: (Base
                                        - Handicap)
                                    </label>
                                </div>
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label id="sp-hole-val-label">Points per Hole</label>
                                    <input type="number" id="sp-hole-value" style="max-width: 200px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin: 15px 0 10px; font-size: 1.1rem; color: var(--secondary-color);">Stat Tracking &
                        Points Rules</h3>
                    <p class="section-desc">Add custom rules on the fly for tracking events on the course.</p>

                    <div
                        style="background: #f8f9fa; padding: 15px; border-radius: 6px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                        <div class="form-row" style="align-items: flex-end;">
                            <div class="form-group" style="flex: 2;">
                                <label>Rule Name (e.g. Fairways, Sand Saves)</label>
                                <input type="text" id="new-rule-name" placeholder="Rule Name">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Points per Occurrence</label>
                                <input type="number" id="new-rule-points" value="1" step="0.5">
                            </div>
                            <div class="form-group" style="flex: none; padding-bottom: 5px;">
                                <button type="button" id="btn-add-rule" class="btn btn-secondary"
                                    style="padding: 10px;">+ Add Rule</button>
                            </div>
                        </div>

                        <div id="comp-rules-list"
                            style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                            <div class="empty-state" style="padding: 10px; font-size: 0.9rem;">No custom rules added
                                yet.</div>
                        </div>
                    </div>

                    <div class="auth-buttons" style="flex-direction: row;">
                        <button type="submit" class="btn btn-primary" style="width: auto;">Create Competition</button>
                        <button type="button" id="btn-cancel-comp" class="btn btn-secondary"
                            style="margin-top: 10px;">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Active Competition View -->
            <div id="active-comp-view" class="hidden">
                <header class="header" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
                    <div class="header-content">
                        <div class="branding">
                            <h1 id="active-comp-name">Competition Name</h1>
                            <p id="active-comp-rules-summary">Rules: ...</p>
                        </div>
                        <div id="comp-creator-actions" class="hidden"
                            style="display: flex; gap: 10px; align-items: center;">
                            <button id="btn-archive-comp" class="btn btn-secondary btn-sm"
                                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.4); color: white; margin: 0;">üì¶
                                Archive Competition</button>
                            <button id="btn-delete-comp" class="btn btn-secondary btn-sm hidden"
                                style="background: rgba(220,53,69,0.4); border: 1px solid rgba(220,53,69,0.7); color: white; margin: 0;">üóëÔ∏è
                                Delete Forever</button>
                        </div>
                    </div>
                </header>

                <div class="dashboard-grid">

                    <!-- Log Comp Round Component -->
                    <section class="card add-round-section">
                        <h2>Log Competition Round</h2>
                        <form id="log-comp-round-form" class="round-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Player</label>
                                    <select id="comp-player-select" required></select>
                                </div>
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="comp-date" required>
                                </div>
                            </div>

                            <hr style="border: 1px solid var(--border-color); margin: 15px 0;">

                            <div id="comp-starting-points-display" class="hidden form-row"
                                style="background: #e9ecef; padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                                <div style="flex: 1; text-align: center;">
                                    <label style="font-size: 0.85rem; margin-bottom: 2px;">Round Baseline</label>
                                    <div id="comp-sp-round-calc"
                                        style="font-weight: bold; color: var(--primary-color);">0 pts</div>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <label style="font-size: 0.85rem; margin-bottom: 2px;">Hole Baseline (x18)</label>
                                    <div id="comp-sp-hole-calc" style="font-weight: bold; color: var(--primary-color);">
                                        0 pts</div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Gross Score</label>
                                    <input type="number" id="comp-score" required>
                                </div>
                                <div id="comp-dynamic-inputs"
                                    style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                                    <!-- Dynamically injected rule inputs go here -->
                                </div>

                                <button type="submit" class="btn btn-primary" style="background-color: #1e3c72;">Log
                                    Round &
                                    Calculate Points</button>
                        </form>
                    </section>

                    <!-- Latest Activity Widget -->
                    <section class="card history-section">
                        <h2>Recent Rounds</h2>
                        <div class="table-responsive" style="max-height: 350px;">
                            <table class="history-table" style="font-size: 0.85rem;">
                                <thead>
                                    <tr>
                                        <th>Player</th>
                                        <th>Score</th>
                                        <th>Points</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="comp-recent-rounds-tbody"></tbody>
                            </table>
                        </div>
                        <div id="comp-empty-state" class="empty-state" style="padding: 20px;">
                            <p>No rounds logged yet.</p>
                        </div>
                    </section>
                </div>

                <!-- Leaderboard Section -->
                <section class="card history-section" style="margin-top: 30px;">
                    <div class="history-header">
                        <h2>Competition Leaderboard</h2>
                    </div>
                    <div class="table-responsive">
                        <table class="history-table">
                            <thead>
                                <tr id="comp-leaderboard-head">
                                    <!-- Dynamically built based on tracked stats -->
                                    <th>Rank</th>
                                    <th>Player</th>
                                    <th>Rounds</th>
                                    <th>Avg Score</th>
                                    <th>Total Points</th>
                                </tr>
                            </thead>
                            <tbody id="comp-leaderboard-tbody">
                                <!-- Aggregated leaderboard here -->
                            </tbody>
                        </table>
                    </div>
                </section>

            </div> <!-- End Active Comp View -->

            <div id="no-comp-empty" class="empty-state" style="margin-top: 40px;">
                <div class="empty-icon">üèÜ</div>
                <p>Select a competition from the dropdown above, or create a new one to start tracking stats and points!
                </p>
            </div>

        </div> <!-- End Comp Tab -->

        <!-- ========================================== -->
        <!-- PRACTICE DRILLS TAB START                  -->
        <!-- ========================================== -->
        <div id="tab-practice" class="tab-content hidden">

            <div class="header" style="margin-bottom: 20px;">
                <h1>Practice Drills</h1>
                <p>Track your private training sessions and monitor your progress over time.</p>
            </div>

            <div class="dashboard-grid" style="grid-template-columns: 1fr; gap: 20px; align-items: start;">

                <!-- Drill Selection & Form -->
                <div class="card bg-white" style="grid-column: 1;">
                    <h2 class="section-title">Log a Practice Session</h2>

                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label>Select Drill Template</label>
                            <select id="drill-select">
                                <option value="bunker_game">The Bunker Game</option>
                                <option value="inside_30">Inside 30</option>
                                <option value="putting_9_holes">Putting (9 Holes)</option>
                                <option value="up_down">Up/Down</option>
                                <option value="strokes_gained_putting">Strokes Gained Putting</option>
                            </select>
                        </div>
                        <div class="form-group flex-1">
                            <label>Date</label>
                            <input type="date" id="drill-date" required>
                        </div>
                    </div>

                    <!-- DYNAMIC DRILL CONTAINER -->
                    <div id="practice-form-container" class="drill-template-container"
                        style="margin-top: 15px; padding: 15px; background: #f8f9fa; border: 1px solid var(--border-color); border-radius: 6px;">
                        <h3 id="pf-title"
                            style="margin-top: 0; margin-bottom: 10px; font-size: 1.05rem; color: var(--primary-color);">
                            The Bunker Game</h3>
                        <p id="pf-desc" style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">Hit
                            balls from a greenside bunker. Score your outcome based on how close you finish to the hole.
                            Goal is to get the lowest score possible.</p>

                        <form id="form-log-practice">
                            <div id="practice-dynamic-inputs">
                                <!-- Dynamically generated fields per drill -->
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save
                                Drill Score</button>
                        </form>
                    </div>
                </div>

                <!-- Personal Analytics Dashboard -->
                <div class="card bg-white" style="grid-column: 1; border-top: 4px solid var(--primary-color);">
                    <h2 class="section-title">My Performance Metrics</h2>

                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <div
                            style="flex: 1; background: #f8f9fa; border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; text-align: center;">
                            <div
                                style="color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; font-weight: 600; margin-bottom: 5px;">
                                Best Score</div>
                            <div id="practice-best-score"
                                style="font-size: 2rem; font-weight: 800; color: var(--primary-color);">-</div>
                        </div>
                        <div
                            style="flex: 1; background: #f8f9fa; border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; text-align: center;">
                            <div
                                style="color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; font-weight: 600; margin-bottom: 5px;">
                                Avg Score</div>
                            <div id="practice-avg-score" style="font-size: 2rem; font-weight: 800; color: #475569;">-
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                        <button id="btn-export-practice" class="btn btn-secondary btn-sm" style="width: 100%;">Email
                            Coach / Export Drills</button>
                        <button id="btn-ask-ai" class="btn btn-primary btn-sm"
                            style="width: 100%; margin-top: 0; background-color: #8b5cf6; border-color: #8b5cf6;">‚ú® Ask
                            AI Coach</button>
                    </div>

                    <h3
                        style="font-size: 1rem; color: var(--secondary-color); margin-bottom: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">
                        Past Sessions</h3>

                    <div id="practice-empty-state" class="empty-state" style="padding: 15px;">
                        No practice sessions recorded yet. Start grinding!
                    </div>

                    <div class="table-responsive" style="margin-top: 0; display: none;" id="practice-table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Total Points</th>
                                    <th style="width: 60px;">Action</th>
                                </tr>
                            </thead>
                            <tbody id="practice-history-tbody">
                                <!-- JS injected -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
        <!-- PRACTICE DRILLS TAB END -->

        <!-- ========================================== -->
        <!-- ON COURSE TRACKER TAB                      -->
        <!-- ========================================== -->
        <div id="tab-oncourse" class="tab-content hidden">

            <!-- Exit Round Button (shown during a round) -->
            <div id="oc-exit-bar" class="hidden"
                style="position:sticky; top:0; z-index:100; display:flex; justify-content:space-between; align-items:center; background:#1e3c72; color:white; padding:10px 16px;">
                <span id="oc-exit-course-label" style="font-size:0.9rem; font-weight:600;">Round In Progress</span>
                <button type="button" id="btn-oc-exit"
                    style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:white; padding:6px 14px; border-radius:6px; font-size:0.85rem; cursor:pointer;">‚úï
                    Exit Round</button>
            </div>

            <!-- Hole Progress Dots -->
            <div id="oc-progress-bar" class="hidden"
                style="display:flex; gap:4px; padding:10px 16px; background:#f8fafc; border-bottom:1px solid #e2e8f0; flex-wrap:wrap; justify-content:center;">
                <!-- dots injected by JS -->
            </div>

            <!-- Setup Screen -->
            <div id="oncourse-setup" class="card">
                <h2 style="margin-bottom:20px;">‚õ≥ Start New Round</h2>

                <!-- Tracking Mode Toggle -->
                <div
                    style="display:flex; gap:8px; margin-bottom:20px; background:#f1f5f9; border-radius:10px; padding:4px;">
                    <button type="button" id="btn-mode-simple" class="oc-mode-btn active"
                        style="flex:1; padding:10px; border:none; border-radius:8px; background:white; font-weight:600; cursor:pointer; box-shadow:0 1px 4px rgba(0,0,0,0.1);">üìã
                        Simple</button>
                    <button type="button" id="btn-mode-detailed" class="oc-mode-btn"
                        style="flex:1; padding:10px; border:none; border-radius:8px; background:transparent; font-weight:600; cursor:pointer; color:#64748b;">üéØ
                        Detailed</button>
                </div>
                <p id="oc-mode-desc" style="font-size:0.82rem; color:#64748b; margin:-12px 0 18px; text-align:center;">
                    Simple: fairway, GIR, putts per hole</p>

                <!-- Round Type (9h / 18h) -->
                <div style="display:flex; gap:8px; margin-bottom:20px;">
                    <button type="button" id="btn-round-9" class="oc-roundtype-btn active"
                        style="flex:1; padding:12px; border:2px solid var(--primary-color); border-radius:8px; background:var(--primary-color); color:white; font-weight:700; cursor:pointer;">9
                        Holes</button>
                    <button type="button" id="btn-round-18" class="oc-roundtype-btn"
                        style="flex:1; padding:12px; border:2px solid #cbd5e1; border-radius:8px; background:white; font-weight:700; cursor:pointer; color:#64748b;">18
                        Holes</button>
                </div>

                <!-- Course Selector -->
                <div class="form-group">
                    <label>Course</label>
                    <select id="oc-course-select">
                        <option value="">-- Select Course --</option>
                        <optgroup label="Keperra Country Golf Club">
                            <option value="Keperra ‚Äì Old Course (9 holes)">Keperra ‚Äì Old Course (9 holes)</option>
                            <option value="Keperra ‚Äì North Course (9 holes)">Keperra ‚Äì North Course (9 holes)</option>
                            <option value="Keperra ‚Äì West Course (9 holes)">Keperra ‚Äì West Course (9 holes)</option>
                        </optgroup>
                        <optgroup label="Keperra ‚Äì 18 Hole Combinations" id="oc-keperra-18h-group" class="hidden">
                            <option value="Keperra ‚Äì Old + North (Par 72)">Keperra ‚Äì Old + North (Par 72)</option>
                            <option value="Keperra ‚Äì North + West (Par 71)">Keperra ‚Äì North + West (Par 71)</option>
                            <option value="Keperra ‚Äì West + Old (Par 71)">Keperra ‚Äì West + Old (Par 71)</option>
                        </optgroup>
                        <option value="Ashgrove GC">Ashgrove GC</option>
                        <option value="McLeod GC">McLeod GC</option>
                        <option value="Bulimba Course">Bulimba Course</option>
                        <option value="Custom Course">Custom Course‚Ä¶</option>
                    </select>
                </div>

                <!-- Custom course name (only shown for "custom" or non-Keperra) -->
                <div class="form-group hidden" id="oc-custom-course-group">
                    <label>Course Name</label>
                    <input type="text" id="oc-custom-course-name" placeholder="Enter course name">
                </div>

                <!-- Tee Selector -->
                <div class="form-group" id="oc-tee-group">
                    <label>Tee</label>
                    <select id="oc-tee-select">
                        <option value="">-- Select Course First --</option>
                    </select>
                </div>

                <!-- Course Stats Display -->
                <div id="oc-course-stats" class="hidden"
                    style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; background:#f8fafc; border-radius:10px; padding:14px; margin-bottom:16px; text-align:center;">
                    <div>
                        <div style="font-size:0.75rem; color:#64748b; font-weight:600; text-transform:uppercase;">Par
                        </div>
                        <div id="oc-stat-par" style="font-size:1.6rem; font-weight:800; color:#1e3c72;">-</div>
                    </div>
                    <div>
                        <div style="font-size:0.75rem; color:#64748b; font-weight:600; text-transform:uppercase;">CR
                        </div>
                        <input type="number" id="oc-stat-cr" step="0.1"
                            style="font-size:1.4rem; font-weight:800; color:#1e3c72; border:none; background:transparent; text-align:center; width:100%; padding:0;">
                    </div>
                    <div>
                        <div style="font-size:0.75rem; color:#64748b; font-weight:600; text-transform:uppercase;">SR
                        </div>
                        <input type="number" id="oc-stat-sr"
                            style="font-size:1.4rem; font-weight:800; color:#1e3c72; border:none; background:transparent; text-align:center; width:100%; padding:0;">
                    </div>
                </div>

                <!-- Daily Handicap -->
                <div id="oc-dh-display" class="hidden"
                    style="background:linear-gradient(135deg,#1e3c72,#2a5298); color:white; border-radius:10px; padding:14px 18px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-size:0.8rem; opacity:0.8; font-weight:600;">Daily Handicap</div>
                        <div id="oc-dh-value" style="font-size:2rem; font-weight:800;">--</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:0.75rem; opacity:0.7;">Override</div>
                        <input type="number" id="oc-dh-override"
                            style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:white; border-radius:6px; padding:4px 8px; width:70px; text-align:center; font-size:1rem;">
                    </div>
                </div>

                <!-- Players -->
                <div class="form-group">
                    <label>Add Players to Group</label>
                    <div style="display:flex; gap:10px;">
                        <select id="oc-player-select" style="flex:1;">
                            <option value="">-- Select Player --</option>
                        </select>
                        <button type="button" id="btn-oc-add-player" class="btn btn-secondary"
                            style="margin:0; padding:10px 20px;">Add</button>
                    </div>
                </div>
                <ul id="oc-players-list" style="list-style:none; padding:0; margin-bottom:15px;"></ul>

                <div class="form-group"
                    style="margin-top:10px; border-top: 1px solid var(--border-color); padding-top:15px;">
                    <label>Link Custom Competition (Optional)</label>
                    <select id="oc-link-comp">
                        <option value="">-- No Competition Linked --</option>
                    </select>
                </div>

                <button type="button" id="btn-oc-start" class="btn btn-primary"
                    style="width:100%; font-size:1.2rem; padding:15px; margin-top:10px;">Start Round &rarr;</button>
            </div>

            <!-- Hub Screen -->
            <div id="oncourse-hub" class="card hidden" style="text-align:center; position:relative;">
                <h1 id="oc-hole-display" style="font-size: 3rem; margin: 0 0 4px; color: var(--primary-color);">Hole 1
                </h1>
                <div id="oc-hole-par-display"
                    style="font-size:1.1rem; color:#64748b; margin-bottom:16px; font-weight:600;">Par 4</div>

                <div
                    style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <label style="margin:0; font-size: 1.1rem; color: var(--text-muted); font-weight:bold;">Par:</label>
                    <select id="oc-par-select"
                        style="width: auto; padding: 5px 10px; font-size:1.1rem; border-radius: 6px;">
                        <option value="3">3</option>
                        <option value="4" selected>4</option>
                        <option value="5">5</option>
                    </select>
                </div>

                <div id="oc-starting-points-container" class="hidden"
                    style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); display: flex; gap: 10px; flex-direction: column;">
                    <!-- Dynamically populated starting points info -->
                </div>

                <!-- Simple Mode Per-Hole Stats -->
                <div id="oc-simple-stats" class="hidden"
                    style="background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; padding:14px; margin-bottom:16px; text-align:left;">
                    <div
                        style="font-size:0.8rem; font-weight:700; color:#64748b; text-transform:uppercase; margin-bottom:10px;">
                        Hole Stats</div>
                    <div id="oc-simple-fairway-row"
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span style="font-weight:600;">üåø Fairway Hit</span>
                        <div style="display:flex; gap:6px;">
                            <button type="button" class="oc-toggle-btn" id="oc-fairway-yes" data-stat="fairway"
                                data-val="yes"
                                style="padding:6px 14px; border-radius:6px; border:1px solid #cbd5e1; background:white; font-weight:600; cursor:pointer;">‚úÖ</button>
                            <button type="button" class="oc-toggle-btn" id="oc-fairway-no" data-stat="fairway"
                                data-val="no"
                                style="padding:6px 14px; border-radius:6px; border:1px solid #cbd5e1; background:white; font-weight:600; cursor:pointer;">‚ùå</button>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span style="font-weight:600;">üü¢ GIR</span>
                        <div style="display:flex; gap:6px;">
                            <button type="button" class="oc-toggle-btn" id="oc-gir-yes" data-stat="gir" data-val="yes"
                                style="padding:6px 14px; border-radius:6px; border:1px solid #cbd5e1; background:white; font-weight:600; cursor:pointer;">‚úÖ</button>
                            <button type="button" class="oc-toggle-btn" id="oc-gir-no" data-stat="gir" data-val="no"
                                style="padding:6px 14px; border-radius:6px; border:1px solid #cbd5e1; background:white; font-weight:600; cursor:pointer;">‚ùå</button>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:600;">‚õ≥ Putts</span>
                        <div style="display:flex; align-items:center; gap:12px;">
                            <button type="button" onclick="adjustSimpleStat('putts',-1)"
                                style="width:34px; height:34px; border-radius:50%; border:1px solid #cbd5e1; background:white; font-size:1.2rem; cursor:pointer;">‚àí</button>
                            <span id="oc-putts-display"
                                style="font-size:1.4rem; font-weight:800; min-width:24px;">2</span>
                            <button type="button" onclick="adjustSimpleStat('putts',1)"
                                style="width:34px; height:34px; border-radius:50%; border:1px solid #cbd5e1; background:white; font-size:1.2rem; cursor:pointer;">+</button>
                        </div>
                    </div>
                </div>

                <div id="oc-group-scores"
                    style="margin-bottom: 30px; border-top: 1px solid var(--border-color); padding-top: 15px;">
                    <!-- Dynamically populated rows for each player -> JS injects minus/plus block -->
                </div>

                <button type="button" id="btn-oc-track-shot" class="btn btn-primary"
                    style="background-color: #10b981; width:100%; height:80px; font-size:1.5rem; border-radius:12px; margin-bottom:20px; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.4);">
                    üéØ Track My Shot
                </button>

                <div style="display: flex; gap: 10px; margin-bottom:10px;">
                    <button type="button" id="btn-oc-prev-hole" class="btn btn-secondary"
                        style="flex:1; padding:18px; font-weight:bold; font-size:1.1rem;">&larr; Prev</button>
                    <button type="button" id="btn-oc-next-hole" class="btn btn-secondary"
                        style="flex:2; padding:18px; background-color: var(--primary-color); color: white; border:none; font-weight:bold; font-size:1.1rem;">Next
                        Hole &rarr;</button>
                </div>

                <div style="margin-top: 20px;">
                    <button type="button" id="btn-oc-finish" class="btn-text"
                        style="color: #ef4444; font-weight:bold;">End Round / Save Options</button>
                </div>
            </div>

            <!-- Shot Wizard Screen -->
            <div id="oncourse-wizard" class="card hidden">
                <div id="wizard-header"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <button type="button" id="btn-wizard-prev" class="btn btn-secondary btn-sm"
                            style="padding:4px 8px;">&larr;</button>
                        <h3 id="wizard-title" style="margin:0;">Select Club</h3>
                        <button type="button" id="btn-wizard-next" class="btn btn-secondary btn-sm"
                            style="padding:4px 8px;">&rarr;</button>
                        <button type="button" id="btn-wizard-delete" class="btn btn-secondary btn-sm hidden"
                            style="padding:4px 8px; color: #ef4444; border-color: #ef4444; background: #fee2e2;">üóëÔ∏è</button>
                    </div>
                    <button type="button" id="btn-wizard-cancel" class="btn-text"
                        style="color: #ef4444; padding:0; font-weight:bold;">Cancel</button>
                </div>

                <div id="wizard-step-club" class="wizard-step">
                    <div class="mobile-grid">
                        <button class="btn-grid" data-val="Driver">Driver</button>
                        <button class="btn-grid" data-val="Wood/Hybrid">Wood/Hybrid</button>
                        <button class="btn-grid" data-val="Long Iron">Long Iron</button>
                        <button class="btn-grid" data-val="Mid Iron">Mid Iron</button>
                        <button class="btn-grid" data-val="Short Iron">Short Iron</button>
                        <button class="btn-grid" data-val="Wedge">Wedge</button>
                        <button class="btn-grid putt-btn" data-val="Putter">Putter</button>
                    </div>
                </div>

                <!-- Screen A2: Trajectory (Detailed mode only) -->
                <div id="wizard-step-trajectory" class="wizard-step hidden">
                    <p class="wizard-instruction">Ball Flight</p>
                    <div class="mobile-grid three-cols">
                        <button class="btn-grid" data-traj="Low">üîΩ Low</button>
                        <button class="btn-grid btn-good" data-traj="Medium">‚û°Ô∏è Medium</button>
                        <button class="btn-grid" data-traj="High">üîº High</button>
                    </div>
                    <button type="button" class="btn btn-secondary wiz-skip" data-target="wizard-step-line"
                        style="width:100%; margin-top:20px;">Skip &rarr;</button>
                </div>

                <!-- Screen B: Line & Curve (for non-putts) -->
                <div id="wizard-step-line" class="wizard-step hidden">
                    <p class="wizard-instruction">Start Line</p>
                    <div class="mobile-grid three-cols" style="margin-bottom: 20px;">
                        <button class="btn-grid btn-bad" data-line="Left">Left</button>
                        <button class="btn-grid btn-good" data-line="Straight">Straight</button>
                        <button class="btn-grid btn-bad" data-line="Right">Right</button>
                    </div>
                    <p class="wizard-instruction">Curve</p>
                    <div class="mobile-grid three-cols">
                        <button class="btn-grid" data-curve="Draw">Draw</button>
                        <button class="btn-grid" data-curve="Straight">Straight</button>
                        <button class="btn-grid" data-curve="Fade">Fade</button>
                    </div>
                    <button type="button" class="btn btn-secondary wiz-skip" data-target="wizard-step-outcome"
                        style="width:100%; margin-top:20px;">Skip to Outcome &rarr;</button>
                </div>

                <!-- Screen C: Outcome (for non-putts) -->
                <div id="wizard-step-outcome" class="wizard-step hidden">
                    <p class="wizard-instruction">Distance</p>
                    <div class="mobile-grid three-cols" style="margin-bottom: 20px;">
                        <button class="btn-grid" data-dist="Short">Short</button>
                        <button class="btn-grid btn-good" data-dist="On Target">On Target</button>
                        <button class="btn-grid" data-dist="Long">Long</button>
                    </div>
                    <p class="wizard-instruction">Result / Lie</p>
                    <div class="mobile-grid two-cols">
                        <button class="btn-grid btn-good two-span" data-out="Fairway">Fairway</button>
                        <button class="btn-grid btn-great two-span" data-out="Green">Green</button>
                        <button class="btn-grid btn-warn" data-out="Rough-Playable">Rough (Good)</button>
                        <button class="btn-grid btn-bad" data-out="Rough-Blocked">Rough (Bad)</button>
                        <button class="btn-grid btn-terrible two-span" data-out="Hazard/OB">Hazard/OB</button>
                    </div>
                </div>

                <!-- Screen D: Putting -->
                <div id="wizard-step-putt" class="wizard-step hidden">
                    <p class="wizard-instruction">Putt Start Line</p>
                    <div class="mobile-grid three-cols" style="margin-bottom: 20px;">
                        <button class="btn-grid btn-bad" data-pline="Pulled">Pulled</button>
                        <button class="btn-grid btn-good" data-pline="On Line">On Line</button>
                        <button class="btn-grid btn-bad" data-pline="Pushed">Pushed</button>
                    </div>
                    <p class="wizard-instruction">Distance Control</p>
                    <div class="mobile-grid three-cols">
                        <button class="btn-grid" data-pdist="Short">Short</button>
                        <button class="btn-grid btn-great" data-pdist="Holed">Holed!</button>
                        <button class="btn-grid" data-pdist="Past">Past</button>
                    </div>
                </div>

                <!-- Screen E: Mental Routine (Detailed mode only) -->
                <div id="wizard-step-routine" class="wizard-step hidden">
                    <p class="wizard-instruction">Pre-Shot Routine</p>
                    <div class="mobile-grid two-cols" style="margin-bottom: 15px;">
                        <button class="btn-grid" data-routine="pre" data-val="Pass">‚úÖ Pass</button>
                        <button class="btn-grid" data-routine="pre" data-val="Fail">‚ùå Fail</button>
                    </div>

                    <p class="wizard-instruction">Shot Execution</p>
                    <div class="mobile-grid two-cols" style="margin-bottom: 15px;">
                        <button class="btn-grid" data-routine="shot" data-val="Pass">‚úÖ Pass</button>
                        <button class="btn-grid" data-routine="shot" data-val="Fail">‚ùå Fail</button>
                    </div>

                    <p class="wizard-instruction">Post-Shot Routine</p>
                    <div class="mobile-grid two-cols" style="margin-bottom: 20px;">
                        <button class="btn-grid" data-routine="post" data-val="Pass">‚úÖ Pass</button>
                        <button class="btn-grid" data-routine="post" data-val="Fail">‚ùå Fail</button>
                    </div>

                    <button type="button" id="btn-save-shot-routine" class="btn btn-primary"
                        style="width:100%; height:60px; font-size:1.2rem; margin-top:10px; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.4); background-color: #10b981;">Save
                        Shot Data</button>
                </div>
            </div>

            <!-- Finish Round Modal -->
            <div id="oc-finish-modal" class="card hidden" style="border: 2px solid var(--primary-color);">
                <h2>Round Complete?</h2>
                <p>Do you want to save this round's scores to the WHS database for all players? Your shot data will
                    be
                    saved securely regardless.</p>
                <div class="form-group" style="margin-top:20px;">
                    <label>Confirm Holes Played</label>
                    <select id="oc-finish-holes">
                        <option value="9">9 Holes</option>
                        <option value="18">18 Holes</option>
                    </select>
                </div>
                <div style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
                    <button type="button" id="btn-oc-review-round" class="btn btn-secondary"
                        style="padding:15px; background-color: #f1f5f9; color: #1e3c72; border-color: #cbd5e1;">Review
                        Round
                        Summary</button>
                    <button type="button" id="btn-oc-save-whs" class="btn btn-primary"
                        style="padding:15px; font-size:1.1rem;">Save to WHS Database</button>
                    <button type="button" id="btn-oc-discard" class="btn btn-secondary"
                        style="padding:15px; color:#ef4444; border-color:#ef4444;">Discard Scores (Keep
                        Shots)</button>
                    <button type="button" id="btn-oc-cancel-finish" class="btn-text"
                        style="font-weight:bold; margin-top:10px;">Back to Round</button>
                </div>
            </div>

        </div>
        <!-- ON COURSE TRACKER TAB END -->

        <!-- ========================================== -->
        <!-- COACH DASHBOARD TAB (Redesigned)           -->
        <!-- ========================================== -->
        <div id="tab-coach" class="tab-content hidden">
            <header class="header" style="background:linear-gradient(135deg,#3867d6 0%,#4b7bec 100%);">
                <div class="header-content">
                    <div class="branding">
                        <h1>Coach Dashboard</h1>
                        <p>Your athlete roster and performance overview.</p>
                    </div>
                </div>
            </header>

            <!-- Player Roster -->
            <section class="card" style="margin-top:20px;">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
                    <h2 style="margin:0;">Your Athletes</h2>
                    <span id="coach-roster-count" style="font-size:0.85rem;color:#64748b;"></span>
                </div>
                <div id="coach-roster-list" style="display:flex;flex-direction:column;gap:10px;">
                    <p style="color:#94a3b8;">Loading athlete roster...</p>
                </div>
            </section>

            <!-- Per-Player Coaching View -->
            <div id="coach-player-view" class="hidden" style="margin-top:20px;">
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
                    <button id="btn-coach-back" class="btn btn-secondary btn-sm" style="width:auto;">‚Üê Back to
                        Roster</button>
                    <h2 id="coach-view-name" style="margin:0;color:#3867d6;"></h2>
                    <button id="btn-coach-ai-plan" class="btn btn-primary btn-sm"
                        style="width:auto;background:#8b5cf6;border-color:#8b5cf6;margin:0;">‚ú® AI Lesson
                        Plan</button>
                </div>

                <div class="dashboard-grid">
                    <!-- HI Summary Card -->
                    <section class="card" style="text-align:center;">
                        <p style="color:#64748b;font-size:0.85rem;margin-bottom:4px;">Handicap Index</p>
                        <div id="coach-view-hi" style="font-size:2.5rem;font-weight:800;color:#3867d6;">--</div>
                        <div id="coach-view-trend" style="font-size:0.85rem;margin-top:4px;"></div>
                    </section>

                    <!-- Stats Card -->
                    <section class="card">
                        <h3 style="margin-bottom:12px;font-size:0.95rem;">Season Averages</h3>
                        <div id="coach-view-stats"
                            style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;text-align:center;">
                            <div>
                                <div style="font-size:1.4rem;font-weight:700;" id="coach-stat-putts">--</div>
                                <div style="font-size:0.75rem;color:#64748b;">Putts</div>
                            </div>
                            <div>
                                <div style="font-size:1.4rem;font-weight:700;" id="coach-stat-fwy">--</div>
                                <div style="font-size:0.75rem;color:#64748b;">FIR</div>
                            </div>
                            <div>
                                <div style="font-size:1.4rem;font-weight:700;" id="coach-stat-gir">--</div>
                                <div style="font-size:0.75rem;color:#64748b;">GIR</div>
                            </div>
                        </div>
                    </section>

                    <!-- Rounds Table -->
                    <section class="card two-span">
                        <h3>Recent Rounds</h3>
                        <div style="overflow-x:auto;">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Course</th>
                                        <th>Score</th>
                                        <th>Diff.</th>
                                        <th>Putts</th>
                                        <th>FIR</th>
                                        <th>GIR</th>
                                    </tr>
                                </thead>
                                <tbody id="coach-whs-tbody"></tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Practice Drills -->
                    <section class="card two-span">
                        <h3>Practice Drill History</h3>
                        <div style="overflow-x:auto;">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Drill</th>
                                        <th>Score</th>
                                    </tr>
                                </thead>
                                <tbody id="coach-practice-tbody"></tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Coach Notes -->
                    <section class="card">
                        <h3>Coach Notes</h3>
                        <div id="coach-notes-list"
                            style="max-height:200px;overflow-y:auto;margin-bottom:12px;font-size:0.88rem;"></div>
                        <div class="form-group" style="margin-bottom:8px;">
                            <textarea id="coach-note-input" placeholder="Add a note for this athlete..." rows="3"
                                style="width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;font-size:0.9rem;resize:vertical;"></textarea>
                        </div>
                        <button id="btn-save-coach-note" class="btn btn-primary btn-sm" style="width:auto;">Save
                            Note</button>
                    </section>

                    <!-- Drill Assignment -->
                    <section class="card">
                        <h3>Assign Drill</h3>
                        <p class="section-desc">Assign a specific drill for this athlete to focus on next session.
                        </p>
                        <div class="form-group" style="margin-bottom:8px;">
                            <input type="text" id="coach-drill-assign-name" placeholder="Drill name..."
                                style="width:100%;">
                        </div>
                        <div class="form-group" style="margin-bottom:12px;">
                            <textarea id="coach-drill-assign-notes" rows="2"
                                placeholder="Instructions / target score..."
                                style="width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;font-size:0.9rem;resize:vertical;"></textarea>
                        </div>
                        <button id="btn-assign-drill" class="btn btn-primary btn-sm" style="width:auto;">üìå Assign
                            Drill</button>
                        <div id="assign-drill-msg" style="margin-top:8px;font-size:0.85rem;"></div>
                    </section>
                </div>
            </div>
        </div>
        <!-- COACH DASHBOARD TAB END -->

        <!-- ========================================== -->
        <!-- FRIENDS / FEED TAB                         -->
        <!-- ========================================== -->
        <div id="tab-feed" class="tab-content hidden">
            <header class="header" style="background:linear-gradient(135deg,#0f766e,#14b8a6);">
                <div class="header-content">
                    <div class="branding">
                        <h1>Activity Feed</h1>
                        <p>See recent rounds from players you follow.</p>
                    </div>
                </div>
            </header>
            <div class="dashboard-grid" style="margin-top:20px;">
                <!-- Find Players -->
                <section class="card">
                    <h2>Find &amp; Follow Players</h2>
                    <div style="display:flex;gap:10px;margin-bottom:12px;">
                        <input type="text" id="feed-search-input" placeholder="Search by display name..."
                            style="flex:1;">
                        <button id="btn-feed-search" class="btn btn-primary btn-sm"
                            style="width:auto;margin:0;">Search</button>
                    </div>
                    <div id="feed-search-results" style="font-size:0.875rem;"></div>
                </section>

                <!-- Following List -->
                <section class="card">
                    <h2>People You Follow</h2>
                    <ul id="feed-following-list" style="list-style:none;padding:0;margin:0;font-size:0.875rem;">
                        <p style="color:#94a3b8;">Loading...</p>
                    </ul>
                </section>

                <!-- Activity Feed -->
                <section class="card two-span">
                    <h2>Recent Activity</h2>
                    <div id="feed-activity-list" style="display:flex;flex-direction:column;gap:12px;">
                        <p style="color:#94a3b8;">Follow some players to see their recent rounds here.</p>
                    </div>
                </section>
            </div>
        </div>
        <!-- FEED TAB END -->

        <!-- ========================================== -->
        <!-- SETTINGS TAB                               -->
        <!-- ========================================== -->
        <div id="tab-settings" class="tab-content hidden">
            <header class="header" style="background:linear-gradient(135deg,#475569,#64748b);">
                <div class="header-content">
                    <div class="branding">
                        <h1>Settings</h1>
                        <p>Notifications &amp; account preferences.</p>
                    </div>
                </div>
            </header>
            <div class="dashboard-grid" style="margin-top:20px;">
                <!-- Notification Preferences -->
                <section class="card two-span">
                    <h2>üîî Notification Preferences</h2>
                    <p class="section-desc">Choose which events you'd like to be notified about. Requires browser
                        notification permission.</p>
                    <div id="notif-permission-banner" class="hidden"
                        style="background:#fef3c7;border:1px solid #f59e0b;border-radius:8px;padding:12px;margin-bottom:16px;font-size:0.88rem;">
                        ‚ö†Ô∏è Browser notifications are <strong>not enabled</strong>. <button id="btn-enable-notifs"
                            class="btn btn-secondary btn-sm" style="width:auto;margin:0 0 0 8px;">Enable
                            Notifications</button>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:16px;">
                        <label style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;">
                            <div>
                                <strong>Handicap Index Change</strong>
                                <p style="font-size:0.82rem;color:#64748b;margin:2px 0 0;">Get notified when your HI
                                    changes after a new round.</p>
                            </div>
                            <label class="toggle-switch"><input type="checkbox" id="notif-hi-change" checked><span
                                    class="toggle-slider"></span></label>
                        </label>
                        <label style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;">
                            <div>
                                <strong>Friend Posts a Round</strong>
                                <p style="font-size:0.82rem;color:#64748b;margin:2px 0 0;">When someone you follow
                                    logs
                                    a new round.</p>
                            </div>
                            <label class="toggle-switch"><input type="checkbox" id="notif-friend-round"><span
                                    class="toggle-slider"></span></label>
                        </label>
                        <label style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;">
                            <div>
                                <strong>Coach Leaves a Note</strong>
                                <p style="font-size:0.82rem;color:#64748b;margin:2px 0 0;">When your coach adds
                                    feedback
                                    to your profile.</p>
                            </div>
                            <label class="toggle-switch"><input type="checkbox" id="notif-coach-note" checked><span
                                    class="toggle-slider"></span></label>
                        </label>
                        <label style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;">
                            <div>
                                <strong>Drill Assigned by Coach</strong>
                                <p style="font-size:0.82rem;color:#64748b;margin:2px 0 0;">When a coach assigns a
                                    practice drill to you.</p>
                            </div>
                            <label class="toggle-switch"><input type="checkbox" id="notif-drill-assign" checked><span
                                    class="toggle-slider"></span></label>
                        </label>
                    </div>
                    <button id="btn-save-notif-prefs" class="btn btn-primary" style="margin-top:20px;width:auto;">Save
                        Preferences</button>
                    <div id="notif-prefs-msg" class="hidden" style="margin-top:8px;font-size:0.88rem;"></div>
                </section>

                <!-- Account Info -->
                <section class="card">
                    <h2>üë§ Account</h2>
                    <p class="section-desc">Your account details.</p>
                    <div id="settings-account-info" style="font-size:0.9rem;line-height:1.8;"></div>
                    <button id="btn-change-password" class="btn btn-secondary" style="margin-top:16px;width:auto;">Send
                        Password Reset Email</button>
                    <div id="settings-pw-msg" class="hidden" style="margin-top:8px;font-size:0.88rem;"></div>
                </section>
            </div>
        </div>
        <!-- SETTINGS TAB END -->


        <!-- ========================================== -->
        <!-- ADMIN DASHBOARD TAB (Dynamic)              -->
        <!-- ========================================== -->
        <div id="tab-admin" class="tab-content hidden"></div>
        <!-- ADMIN DASHBOARD TAB END -->

    </div>

    <!-- Delete Competition Confirmation Modal -->
    <div id="delete-comp-modal"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:9999; align-items:center; justify-content:center;">
        <div
            style="background:#fff; border-radius:12px; padding:32px; max-width:440px; width:90%; box-shadow:0 20px 60px rgba(0,0,0,0.3);">
            <div style="text-align:center; margin-bottom:20px;">
                <div style="font-size:2.5rem; margin-bottom:8px;">üóëÔ∏è</div>
                <h2 style="color:#dc3545; margin:0 0 8px;">Permanently Delete?</h2>
                <p style="color:#666; font-size:0.9rem; margin:0;">This cannot be undone. All competition data will
                    be
                    removed.</p>
            </div>
            <div
                style="background:#fff3cd; border:1px solid #ffc107; border-radius:6px; padding:12px; margin-bottom:20px; font-size:0.85rem; color:#856404;">
                ‚ö†Ô∏è Competition: <strong id="delete-comp-modal-name"></strong>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-size:0.85rem; color:#666; display:block; margin-bottom:6px;">Type the competition
                    name to confirm:</label>
                <input type="text" id="delete-comp-confirm-input" placeholder="Type name here..."
                    style="width:100%; padding:10px; border:2px solid #dee2e6; border-radius:6px; font-size:0.95rem; box-sizing:border-box;">
            </div>
            <div style="display:flex; gap:10px;">
                <button id="delete-comp-cancel-btn" class="btn btn-secondary" style="flex:1; margin:0;">Cancel</button>
                <button id="delete-comp-confirm-btn" class="btn btn-danger"
                    style="flex:1; margin:0; background:#dc3545; border-color:#dc3545; color:white;" disabled>Delete
                    Forever</button>
            </div>
        </div>
    </div>
    <!-- Review Round Modal -->
    <div id="review-round-modal" class="auth-overlay hidden" style="z-index: 10001; background: rgba(0,0,0,0.85);">
        <div class="card" style="width: 95%; max-width: 600px; max-height: 90vh; overflow-y: auto; padding: 20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                <h2 style="margin:0;">Round Review</h2>
                <button id="btn-close-review" class="btn-text" style="font-size: 1.5rem;">‚úï</button>
            </div>
            <div id="review-content" style="display: flex; flex-direction: column; gap: 15px;">
                <!-- Dynamically populated -->
            </div>
            <div style="margin-top: 20px;">
                <button id="btn-review-finished" class="btn btn-primary" style="width:100%;">Done Reviewing</button>
            </div>
        </div>
    </div>
    <!-- Global Version Footer -->
    <div
        style="position: fixed; bottom: 0; left: 0; width: 100%; text-align: center; padding: 10px; color: var(--text-muted); font-size: 0.85rem; z-index: 1000; background-color: rgba(244, 247, 246, 0.9);">
        Golf Handicap Tracker v4.5.0
    </div>
    <script type="module" src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then((registration) => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, (error) => {
                    console.log('ServiceWorker registration failed: ', error);
                });
            });
        }
    </script>
</body>

</html>