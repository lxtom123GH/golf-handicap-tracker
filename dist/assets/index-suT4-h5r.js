(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const _A={currentUser:null,profileUsersMap:{},allUsersCache:null,viewingPlayerId:null,currentRounds:[],handicapIndex:"N/A",usedIds:[],activeCompId:null,currentCompData:null,currentCompRounds:[],currentPracticeRounds:[],currentTrackingMode:"simple",currentRoundHoles:9,currentRoundCourseName:"",currentCoursePars:[],liveRoundGroups:[],currentHole:1,currentShotData:{},currentLiveCompId:null,currentLiveCompRules:[],currentHoleShots:[],activeRoundId:null},H=new Proxy(_A,{set(n,e,t){const r=n[e];if(n[e]=t,r!==t){const i=new CustomEvent("stateChange",{detail:{property:e,oldValue:r,newValue:t}});window.dispatchEvent(i),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&console.log(`[State] ${String(e)} changed:`,t)}return!0}});function Xl(n){return n+.5|0}const Zi=(n,e,t)=>Math.max(Math.min(n,t),e);function kc(n){return Zi(Xl(n*2.55),0,255)}function as(n){return Zi(Xl(n*255),0,255)}function ai(n){return Zi(Xl(n/2.55)/100,0,1)}function l1(n){return Zi(Xl(n*100),0,100)}const ir={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},E0=[..."0123456789ABCDEF"],xA=n=>E0[n&15],yA=n=>E0[(n&240)>>4]+E0[n&15],Lu=n=>(n&240)>>4===(n&15),vA=n=>Lu(n.r)&&Lu(n.g)&&Lu(n.b)&&Lu(n.a);function EA(n){var e=n.length,t;return n[0]==="#"&&(e===4||e===5?t={r:255&ir[n[1]]*17,g:255&ir[n[2]]*17,b:255&ir[n[3]]*17,a:e===5?ir[n[4]]*17:255}:(e===7||e===9)&&(t={r:ir[n[1]]<<4|ir[n[2]],g:ir[n[3]]<<4|ir[n[4]],b:ir[n[5]]<<4|ir[n[6]],a:e===9?ir[n[7]]<<4|ir[n[8]]:255})),t}const wA=(n,e)=>n<255?e(n):"";function TA(n){var e=vA(n)?xA:yA;return n?"#"+e(n.r)+e(n.g)+e(n.b)+wA(n.a,e):void 0}const bA=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Kv(n,e,t){const r=e*Math.min(t,1-t),i=(s,a=(s+n/30)%12)=>t-r*Math.max(Math.min(a-3,9-a,1),-1);return[i(0),i(8),i(4)]}function IA(n,e,t){const r=(i,s=(i+n/60)%6)=>t-t*e*Math.max(Math.min(s,4-s,1),0);return[r(5),r(3),r(1)]}function AA(n,e,t){const r=Kv(n,1,.5);let i;for(e+t>1&&(i=1/(e+t),e*=i,t*=i),i=0;i<3;i++)r[i]*=1-e-t,r[i]+=e;return r}function SA(n,e,t,r,i){return n===i?(e-t)/r+(e<t?6:0):e===i?(t-n)/r+2:(n-e)/r+4}function Rp(n){const t=n.r/255,r=n.g/255,i=n.b/255,s=Math.max(t,r,i),a=Math.min(t,r,i),o=(s+a)/2;let c,l,u;return s!==a&&(u=s-a,l=o>.5?u/(2-s-a):u/(s+a),c=SA(t,r,i,u,s),c=c*60+.5),[c|0,l||0,o]}function Pp(n,e,t,r){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,r)).map(as)}function Dp(n,e,t){return Pp(Kv,n,e,t)}function kA(n,e,t){return Pp(AA,n,e,t)}function CA(n,e,t){return Pp(IA,n,e,t)}function Yv(n){return(n%360+360)%360}function RA(n){const e=bA.exec(n);let t=255,r;if(!e)return;e[5]!==r&&(t=e[6]?kc(+e[5]):as(+e[5]));const i=Yv(+e[2]),s=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?r=kA(i,s,a):e[1]==="hsv"?r=CA(i,s,a):r=Dp(i,s,a),{r:r[0],g:r[1],b:r[2],a:t}}function PA(n,e){var t=Rp(n);t[0]=Yv(t[0]+e),t=Dp(t),n.r=t[0],n.g=t[1],n.b=t[2]}function DA(n){if(!n)return;const e=Rp(n),t=e[0],r=l1(e[1]),i=l1(e[2]);return n.a<255?`hsla(${t}, ${r}%, ${i}%, ${ai(n.a)})`:`hsl(${t}, ${r}%, ${i}%)`}const u1={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},h1={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function FA(){const n={},e=Object.keys(h1),t=Object.keys(u1);let r,i,s,a,o;for(r=0;r<e.length;r++){for(a=o=e[r],i=0;i<t.length;i++)s=t[i],o=o.replace(s,u1[s]);s=parseInt(h1[a],16),n[o]=[s>>16&255,s>>8&255,s&255]}return n}let Nu;function OA(n){Nu||(Nu=FA(),Nu.transparent=[0,0,0,0]);const e=Nu[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const MA=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function LA(n){const e=MA.exec(n);let t=255,r,i,s;if(e){if(e[7]!==r){const a=+e[7];t=e[8]?kc(a):Zi(a*255,0,255)}return r=+e[1],i=+e[3],s=+e[5],r=255&(e[2]?kc(r):Zi(r,0,255)),i=255&(e[4]?kc(i):Zi(i,0,255)),s=255&(e[6]?kc(s):Zi(s,0,255)),{r,g:i,b:s,a:t}}}function NA(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${ai(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const kd=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,Wa=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function VA(n,e,t){const r=Wa(ai(n.r)),i=Wa(ai(n.g)),s=Wa(ai(n.b));return{r:as(kd(r+t*(Wa(ai(e.r))-r))),g:as(kd(i+t*(Wa(ai(e.g))-i))),b:as(kd(s+t*(Wa(ai(e.b))-s))),a:n.a+t*(e.a-n.a)}}function Vu(n,e,t){if(n){let r=Rp(n);r[e]=Math.max(0,Math.min(r[e]+r[e]*t,e===0?360:1)),r=Dp(r),n.r=r[0],n.g=r[1],n.b=r[2]}}function Xv(n,e){return n&&Object.assign(e||{},n)}function f1(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=as(n[3]))):(e=Xv(n,{r:0,g:0,b:0,a:1}),e.a=as(e.a)),e}function BA(n){return n.charAt(0)==="r"?LA(n):RA(n)}class _l{constructor(e){if(e instanceof _l)return e;const t=typeof e;let r;t==="object"?r=f1(e):t==="string"&&(r=EA(e)||OA(e)||BA(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=Xv(this._rgb);return e&&(e.a=ai(e.a)),e}set rgb(e){this._rgb=f1(e)}rgbString(){return this._valid?NA(this._rgb):void 0}hexString(){return this._valid?TA(this._rgb):void 0}hslString(){return this._valid?DA(this._rgb):void 0}mix(e,t){if(e){const r=this.rgb,i=e.rgb;let s;const a=t===s?.5:t,o=2*a-1,c=r.a-i.a,l=((o*c===-1?o:(o+c)/(1+o*c))+1)/2;s=1-l,r.r=255&l*r.r+s*i.r+.5,r.g=255&l*r.g+s*i.g+.5,r.b=255&l*r.b+s*i.b+.5,r.a=a*r.a+(1-a)*i.a,this.rgb=r}return this}interpolate(e,t){return e&&(this._rgb=VA(this._rgb,e._rgb,t)),this}clone(){return new _l(this.rgb)}alpha(e){return this._rgb.a=as(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=Xl(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Vu(this._rgb,2,e),this}darken(e){return Vu(this._rgb,2,-e),this}saturate(e){return Vu(this._rgb,1,e),this}desaturate(e){return Vu(this._rgb,1,-e),this}rotate(e){return PA(this._rgb,e),this}}function ni(){}const UA=(()=>{let n=0;return()=>n++})();function ze(n){return n==null}function It(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function We(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Dt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Kn(n,e){return Dt(n)?n:e}function Le(n,e){return typeof n>"u"?e:n}const HA=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/e,Qv=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*e:+n;function ft(n,e,t){if(n&&typeof n.call=="function")return n.apply(t,e)}function it(n,e,t,r){let i,s,a;if(It(n))for(s=n.length,i=0;i<s;i++)e.call(t,n[i],i);else if(We(n))for(a=Object.keys(n),s=a.length,i=0;i<s;i++)e.call(t,n[a[i]],a[i])}function Fh(n,e){let t,r,i,s;if(!n||!e||n.length!==e.length)return!1;for(t=0,r=n.length;t<r;++t)if(i=n[t],s=e[t],i.datasetIndex!==s.datasetIndex||i.index!==s.index)return!1;return!0}function Oh(n){if(It(n))return n.map(Oh);if(We(n)){const e=Object.create(null),t=Object.keys(n),r=t.length;let i=0;for(;i<r;++i)e[t[i]]=Oh(n[t[i]]);return e}return n}function Jv(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function zA(n,e,t,r){if(!Jv(n))return;const i=e[n],s=t[n];We(i)&&We(s)?xl(i,s,r):e[n]=Oh(s)}function xl(n,e,t){const r=It(e)?e:[e],i=r.length;if(!We(n))return n;t=t||{};const s=t.merger||zA;let a;for(let o=0;o<i;++o){if(a=r[o],!We(a))continue;const c=Object.keys(a);for(let l=0,u=c.length;l<u;++l)s(c[l],n,a,t)}return n}function Wc(n,e){return xl(n,e,{merger:$A})}function $A(n,e,t){if(!Jv(n))return;const r=e[n],i=t[n];We(r)&&We(i)?Wc(r,i):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=Oh(i))}const d1={"":n=>n,x:n=>n.x,y:n=>n.y};function WA(n){const e=n.split("."),t=[];let r="";for(const i of e)r+=i,r.endsWith("\\")?r=r.slice(0,-1)+".":(t.push(r),r="");return t}function jA(n){const e=WA(n);return t=>{for(const r of e){if(r==="")break;t=t&&t[r]}return t}}function ds(n,e){return(d1[e]||(d1[e]=jA(e)))(n)}function Fp(n){return n.charAt(0).toUpperCase()+n.slice(1)}const yl=n=>typeof n<"u",ps=n=>typeof n=="function",p1=(n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0};function GA(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const et=Math.PI,yt=2*et,qA=yt+et,Mh=Number.POSITIVE_INFINITY,KA=et/180,Lt=et/2,Us=et/4,g1=et*2/3,es=Math.log10,Ur=Math.sign;function jc(n,e,t){return Math.abs(n-e)<t}function m1(n){const e=Math.round(n);n=jc(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(es(n))),r=n/t;return(r<=1?1:r<=2?2:r<=5?5:10)*t}function YA(n){const e=[],t=Math.sqrt(n);let r;for(r=1;r<t;r++)n%r===0&&(e.push(r),e.push(n/r));return t===(t|0)&&e.push(t),e.sort((i,s)=>i-s).pop(),e}function XA(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function xo(n){return!XA(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function QA(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}function Zv(n,e,t){let r,i,s;for(r=0,i=n.length;r<i;r++)s=n[r][t],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function Er(n){return n*(et/180)}function Op(n){return n*(180/et)}function _1(n){if(!Dt(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function eE(n,e){const t=e.x-n.x,r=e.y-n.y,i=Math.sqrt(t*t+r*r);let s=Math.atan2(r,t);return s<-.5*et&&(s+=yt),{angle:s,distance:i}}function w0(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function JA(n,e){return(n-e+qA)%yt-et}function xn(n){return(n%yt+yt)%yt}function vl(n,e,t,r){const i=xn(n),s=xn(e),a=xn(t),o=xn(s-i),c=xn(a-i),l=xn(i-s),u=xn(i-a);return i===s||i===a||r&&s===a||o>c&&l<u}function sn(n,e,t){return Math.max(e,Math.min(t,n))}function ZA(n){return sn(n,-32768,32767)}function ci(n,e,t,r=1e-6){return n>=Math.min(e,t)-r&&n<=Math.max(e,t)+r}function Mp(n,e,t){t=t||(a=>n[a]<e);let r=n.length-1,i=0,s;for(;r-i>1;)s=i+r>>1,t(s)?i=s:r=s;return{lo:i,hi:r}}const li=(n,e,t,r)=>Mp(n,t,r?i=>{const s=n[i][e];return s<t||s===t&&n[i+1][e]===t}:i=>n[i][e]<t),eS=(n,e,t)=>Mp(n,t,r=>n[r][e]>=t);function tS(n,e,t){let r=0,i=n.length;for(;r<i&&n[r]<e;)r++;for(;i>r&&n[i-1]>t;)i--;return r>0||i<n.length?n.slice(r,i):n}const tE=["push","pop","shift","splice","unshift"];function nS(n,e){if(n._chartjs){n._chartjs.listeners.push(e);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),tE.forEach(t=>{const r="_onData"+Fp(t),i=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...s){const a=i.apply(this,s);return n._chartjs.listeners.forEach(o=>{typeof o[r]=="function"&&o[r](...s)}),a}})})}function x1(n,e){const t=n._chartjs;if(!t)return;const r=t.listeners,i=r.indexOf(e);i!==-1&&r.splice(i,1),!(r.length>0)&&(tE.forEach(s=>{delete n[s]}),delete n._chartjs)}function nE(n){const e=new Set(n);return e.size===n.length?n:Array.from(e)}const rE=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function iE(n,e){let t=[],r=!1;return function(...i){t=i,r||(r=!0,rE.call(window,()=>{r=!1,n.apply(e,t)}))}}function rS(n,e){let t;return function(...r){return e?(clearTimeout(t),t=setTimeout(n,e,r)):n.apply(this,r),e}}const Lp=n=>n==="start"?"left":n==="end"?"right":"center",gn=(n,e,t)=>n==="start"?e:n==="end"?t:(e+t)/2,iS=(n,e,t,r)=>n===(r?"left":"right")?t:n==="center"?(e+t)/2:e;function sE(n,e,t){const r=e.length;let i=0,s=r;if(n._sorted){const{iScale:a,vScale:o,_parsed:c}=n,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,u=a.axis,{min:h,max:d,minDefined:p,maxDefined:g}=a.getUserBounds();if(p){if(i=Math.min(li(c,u,h).lo,t?r:li(e,u,a.getPixelForValue(h)).lo),l){const m=c.slice(0,i+1).reverse().findIndex(_=>!ze(_[o.axis]));i-=Math.max(0,m)}i=sn(i,0,r-1)}if(g){let m=Math.max(li(c,a.axis,d,!0).hi+1,t?0:li(e,u,a.getPixelForValue(d),!0).hi+1);if(l){const _=c.slice(m-1).findIndex(E=>!ze(E[o.axis]));m+=Math.max(0,_)}s=sn(m,i,r)-i}else s=r-i}return{start:i,count:s}}function aE(n){const{xScale:e,yScale:t,_scaleRanges:r}=n,i={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!r)return n._scaleRanges=i,!0;const s=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==t.min||r.ymax!==t.max;return Object.assign(r,i),s}const Bu=n=>n===0||n===1,y1=(n,e,t)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-e)*yt/t)),v1=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*yt/t)+1,Gc={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Lt)+1,easeOutSine:n=>Math.sin(n*Lt),easeInOutSine:n=>-.5*(Math.cos(et*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Bu(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Bu(n)?n:y1(n,.075,.3),easeOutElastic:n=>Bu(n)?n:v1(n,.075,.3),easeInOutElastic(n){return Bu(n)?n:n<.5?.5*y1(n*2,.1125,.45):.5+.5*v1(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?.5*(n*n*(((e*=1.525)+1)*n-e)):.5*((n-=2)*n*(((e*=1.525)+1)*n+e)+2)},easeInBounce:n=>1-Gc.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Gc.easeInBounce(n*2)*.5:Gc.easeOutBounce(n*2-1)*.5+.5};function Np(n){if(n&&typeof n=="object"){const e=n.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function E1(n){return Np(n)?n:new _l(n)}function Cd(n){return Np(n)?n:new _l(n).saturate(.5).darken(.1).hexString()}const sS=["x","y","borderWidth","radius","tension"],aS=["color","borderColor","backgroundColor"];function oS(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),n.set("animations",{colors:{type:"color",properties:aS},numbers:{type:"number",properties:sS}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function cS(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const w1=new Map;function lS(n,e){e=e||{};const t=n+JSON.stringify(e);let r=w1.get(t);return r||(r=new Intl.NumberFormat(n,e),w1.set(t,r)),r}function Ql(n,e,t){return lS(e,t).format(n)}const oE={values(n){return It(n)?n:""+n},numeric(n,e,t){if(n===0)return"0";const r=this.chart.options.locale;let i,s=n;if(t.length>1){const l=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(l<1e-4||l>1e15)&&(i="scientific"),s=uS(n,t)}const a=es(Math.abs(s)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),c={notation:i,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(c,this.options.ticks.format),Ql(n,r,c)},logarithmic(n,e,t){if(n===0)return"0";const r=t[e].significand||n/Math.pow(10,Math.floor(es(n)));return[1,2,3,5,10,15].includes(r)||e>.8*t.length?oE.numeric.call(this,n,e,t):""}};function uS(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}var Df={formatters:oE};function hS(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Df.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const fa=Object.create(null),T0=Object.create(null);function qc(n,e){if(!e)return n;const t=e.split(".");for(let r=0,i=t.length;r<i;++r){const s=t[r];n=n[s]||(n[s]=Object.create(null))}return n}function Rd(n,e,t){return typeof e=="string"?xl(qc(n,e),t):xl(qc(n,""),e)}class fS{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,i)=>Cd(i.backgroundColor),this.hoverBorderColor=(r,i)=>Cd(i.borderColor),this.hoverColor=(r,i)=>Cd(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return Rd(this,e,t)}get(e){return qc(this,e)}describe(e,t){return Rd(T0,e,t)}override(e,t){return Rd(fa,e,t)}route(e,t,r,i){const s=qc(this,e),a=qc(this,r),o="_"+t;Object.defineProperties(s,{[o]:{value:s[t],writable:!0},[t]:{enumerable:!0,get(){const c=this[o],l=a[i];return We(c)?Object.assign({},l,c):Le(c,l)},set(c){this[o]=c}}})}apply(e){e.forEach(t=>t(this))}}var At=new fS({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[oS,cS,hS]);function dS(n){return!n||ze(n.size)||ze(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function Lh(n,e,t,r,i){let s=e[i];return s||(s=e[i]=n.measureText(i).width,t.push(i)),s>r&&(r=s),r}function pS(n,e,t,r){r=r||{};let i=r.data=r.data||{},s=r.garbageCollect=r.garbageCollect||[];r.font!==e&&(i=r.data={},s=r.garbageCollect=[],r.font=e),n.save(),n.font=e;let a=0;const o=t.length;let c,l,u,h,d;for(c=0;c<o;c++)if(h=t[c],h!=null&&!It(h))a=Lh(n,i,s,a,h);else if(It(h))for(l=0,u=h.length;l<u;l++)d=h[l],d!=null&&!It(d)&&(a=Lh(n,i,s,a,d));n.restore();const p=s.length/2;if(p>t.length){for(c=0;c<p;c++)delete i[s[c]];s.splice(0,p)}return a}function Hs(n,e,t){const r=n.currentDevicePixelRatio,i=t!==0?Math.max(t/2,.5):0;return Math.round((e-i)*r)/r+i}function T1(n,e){!e&&!n||(e=e||n.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore())}function b0(n,e,t,r){cE(n,e,t,r,null)}function cE(n,e,t,r,i){let s,a,o,c,l,u,h,d;const p=e.pointStyle,g=e.rotation,m=e.radius;let _=(g||0)*KA;if(p&&typeof p=="object"&&(s=p.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){n.save(),n.translate(t,r),n.rotate(_),n.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),n.restore();return}if(!(isNaN(m)||m<=0)){switch(n.beginPath(),p){default:i?n.ellipse(t,r,i/2,m,0,0,yt):n.arc(t,r,m,0,yt),n.closePath();break;case"triangle":u=i?i/2:m,n.moveTo(t+Math.sin(_)*u,r-Math.cos(_)*m),_+=g1,n.lineTo(t+Math.sin(_)*u,r-Math.cos(_)*m),_+=g1,n.lineTo(t+Math.sin(_)*u,r-Math.cos(_)*m),n.closePath();break;case"rectRounded":l=m*.516,c=m-l,a=Math.cos(_+Us)*c,h=Math.cos(_+Us)*(i?i/2-l:c),o=Math.sin(_+Us)*c,d=Math.sin(_+Us)*(i?i/2-l:c),n.arc(t-h,r-o,l,_-et,_-Lt),n.arc(t+d,r-a,l,_-Lt,_),n.arc(t+h,r+o,l,_,_+Lt),n.arc(t-d,r+a,l,_+Lt,_+et),n.closePath();break;case"rect":if(!g){c=Math.SQRT1_2*m,u=i?i/2:c,n.rect(t-u,r-c,2*u,2*c);break}_+=Us;case"rectRot":h=Math.cos(_)*(i?i/2:m),a=Math.cos(_)*m,o=Math.sin(_)*m,d=Math.sin(_)*(i?i/2:m),n.moveTo(t-h,r-o),n.lineTo(t+d,r-a),n.lineTo(t+h,r+o),n.lineTo(t-d,r+a),n.closePath();break;case"crossRot":_+=Us;case"cross":h=Math.cos(_)*(i?i/2:m),a=Math.cos(_)*m,o=Math.sin(_)*m,d=Math.sin(_)*(i?i/2:m),n.moveTo(t-h,r-o),n.lineTo(t+h,r+o),n.moveTo(t+d,r-a),n.lineTo(t-d,r+a);break;case"star":h=Math.cos(_)*(i?i/2:m),a=Math.cos(_)*m,o=Math.sin(_)*m,d=Math.sin(_)*(i?i/2:m),n.moveTo(t-h,r-o),n.lineTo(t+h,r+o),n.moveTo(t+d,r-a),n.lineTo(t-d,r+a),_+=Us,h=Math.cos(_)*(i?i/2:m),a=Math.cos(_)*m,o=Math.sin(_)*m,d=Math.sin(_)*(i?i/2:m),n.moveTo(t-h,r-o),n.lineTo(t+h,r+o),n.moveTo(t+d,r-a),n.lineTo(t-d,r+a);break;case"line":a=i?i/2:Math.cos(_)*m,o=Math.sin(_)*m,n.moveTo(t-a,r-o),n.lineTo(t+a,r+o);break;case"dash":n.moveTo(t,r),n.lineTo(t+Math.cos(_)*(i?i/2:m),r+Math.sin(_)*m);break;case!1:n.closePath();break}n.fill(),e.borderWidth>0&&n.stroke()}}function ui(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function Ff(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function Of(n){n.restore()}function gS(n,e,t,r,i){if(!e)return n.lineTo(t.x,t.y);if(i==="middle"){const s=(e.x+t.x)/2;n.lineTo(s,e.y),n.lineTo(s,t.y)}else i==="after"!=!!r?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function mS(n,e,t,r){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?t.cp2x:t.cp1x,r?t.cp2y:t.cp1y,t.x,t.y)}function _S(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),ze(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}function xS(n,e,t,r,i){if(i.strikethrough||i.underline){const s=n.measureText(r),a=e-s.actualBoundingBoxLeft,o=e+s.actualBoundingBoxRight,c=t-s.actualBoundingBoxAscent,l=t+s.actualBoundingBoxDescent,u=i.strikethrough?(c+l)/2:l;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(a,u),n.lineTo(o,u),n.stroke()}}function yS(n,e){const t=n.fillStyle;n.fillStyle=e.color,n.fillRect(e.left,e.top,e.width,e.height),n.fillStyle=t}function da(n,e,t,r,i,s={}){const a=It(e)?e:[e],o=s.strokeWidth>0&&s.strokeColor!=="";let c,l;for(n.save(),n.font=i.string,_S(n,s),c=0;c<a.length;++c)l=a[c],s.backdrop&&yS(n,s.backdrop),o&&(s.strokeColor&&(n.strokeStyle=s.strokeColor),ze(s.strokeWidth)||(n.lineWidth=s.strokeWidth),n.strokeText(l,t,r,s.maxWidth)),n.fillText(l,t,r,s.maxWidth),xS(n,t,r,l,s),r+=Number(i.lineHeight);n.restore()}function El(n,e){const{x:t,y:r,w:i,h:s,radius:a}=e;n.arc(t+a.topLeft,r+a.topLeft,a.topLeft,1.5*et,et,!0),n.lineTo(t,r+s-a.bottomLeft),n.arc(t+a.bottomLeft,r+s-a.bottomLeft,a.bottomLeft,et,Lt,!0),n.lineTo(t+i-a.bottomRight,r+s),n.arc(t+i-a.bottomRight,r+s-a.bottomRight,a.bottomRight,Lt,0,!0),n.lineTo(t+i,r+a.topRight),n.arc(t+i-a.topRight,r+a.topRight,a.topRight,0,-Lt,!0),n.lineTo(t+a.topLeft,r)}const vS=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,ES=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function wS(n,e){const t=(""+n).match(vS);if(!t||t[1]==="normal")return e*1.2;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100;break}return e*n}const TS=n=>+n||0;function Vp(n,e){const t={},r=We(e),i=r?Object.keys(e):e,s=We(n)?r?a=>Le(n[a],n[e[a]]):a=>n[a]:()=>n;for(const a of i)t[a]=TS(s(a));return t}function lE(n){return Vp(n,{top:"y",right:"x",bottom:"y",left:"x"})}function ra(n){return Vp(n,["topLeft","topRight","bottomLeft","bottomRight"])}function kn(n){const e=lE(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Kt(n,e){n=n||{},e=e||At.font;let t=Le(n.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let r=Le(n.style,e.style);r&&!(""+r).match(ES)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const i={family:Le(n.family,e.family),lineHeight:wS(Le(n.lineHeight,e.lineHeight),t),size:t,style:r,weight:Le(n.weight,e.weight),string:""};return i.string=dS(i),i}function Cc(n,e,t,r){let i,s,a;for(i=0,s=n.length;i<s;++i)if(a=n[i],a!==void 0&&a!==void 0)return a}function bS(n,e,t){const{min:r,max:i}=n,s=Qv(e,(i-r)/2),a=(o,c)=>t&&o===0?0:o+c;return{min:a(r,-Math.abs(s)),max:a(i,s)}}function ws(n,e){return Object.assign(Object.create(n),e)}function Bp(n,e=[""],t,r,i=()=>n[0]){const s=t||n;typeof r>"u"&&(r=dE("_fallback",n));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:s,_fallback:r,_getTarget:i,override:o=>Bp([o,...n],e,s,r)};return new Proxy(a,{deleteProperty(o,c){return delete o[c],delete o._keys,delete n[0][c],!0},get(o,c){return hE(o,c,()=>DS(c,e,n,o))},getOwnPropertyDescriptor(o,c){return Reflect.getOwnPropertyDescriptor(o._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(o,c){return I1(o).includes(c)},ownKeys(o){return I1(o)},set(o,c,l){const u=o._storage||(o._storage=i());return o[c]=u[c]=l,delete o._keys,!0}})}function yo(n,e,t,r){const i={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:uE(n,r),setContext:s=>yo(n,s,t,r),override:s=>yo(n.override(s),e,t,r)};return new Proxy(i,{deleteProperty(s,a){return delete s[a],delete n[a],!0},get(s,a,o){return hE(s,a,()=>AS(s,a,o))},getOwnPropertyDescriptor(s,a){return s._descriptors.allKeys?Reflect.has(n,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,a)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(s,a){return Reflect.has(n,a)},ownKeys(){return Reflect.ownKeys(n)},set(s,a,o){return n[a]=o,delete s[a],!0}})}function uE(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=n;return{allKeys:i,scriptable:t,indexable:r,isScriptable:ps(t)?t:()=>t,isIndexable:ps(r)?r:()=>r}}const IS=(n,e)=>n?n+Fp(e):e,Up=(n,e)=>We(e)&&n!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function hE(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e)||e==="constructor")return n[e];const r=t();return n[e]=r,r}function AS(n,e,t){const{_proxy:r,_context:i,_subProxy:s,_descriptors:a}=n;let o=r[e];return ps(o)&&a.isScriptable(e)&&(o=SS(e,o,n,t)),It(o)&&o.length&&(o=kS(e,o,n,a.isIndexable)),Up(e,o)&&(o=yo(o,i,s&&s[e],a)),o}function SS(n,e,t,r){const{_proxy:i,_context:s,_subProxy:a,_stack:o}=t;if(o.has(n))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+n);o.add(n);let c=e(s,a||r);return o.delete(n),Up(n,c)&&(c=Hp(i._scopes,i,n,c)),c}function kS(n,e,t,r){const{_proxy:i,_context:s,_subProxy:a,_descriptors:o}=t;if(typeof s.index<"u"&&r(n))return e[s.index%e.length];if(We(e[0])){const c=e,l=i._scopes.filter(u=>u!==c);e=[];for(const u of c){const h=Hp(l,i,n,u);e.push(yo(h,s,a&&a[n],o))}}return e}function fE(n,e,t){return ps(n)?n(e,t):n}const CS=(n,e)=>n===!0?e:typeof n=="string"?ds(e,n):void 0;function RS(n,e,t,r,i){for(const s of e){const a=CS(t,s);if(a){n.add(a);const o=fE(a._fallback,t,i);if(typeof o<"u"&&o!==t&&o!==r)return o}else if(a===!1&&typeof r<"u"&&t!==r)return null}return!1}function Hp(n,e,t,r){const i=e._rootScopes,s=fE(e._fallback,t,r),a=[...n,...i],o=new Set;o.add(r);let c=b1(o,a,t,s||t,r);return c===null||typeof s<"u"&&s!==t&&(c=b1(o,a,s,c,r),c===null)?!1:Bp(Array.from(o),[""],i,s,()=>PS(e,t,r))}function b1(n,e,t,r,i){for(;t;)t=RS(n,e,t,r,i);return t}function PS(n,e,t){const r=n._getTarget();e in r||(r[e]={});const i=r[e];return It(i)&&We(t)?t:i||{}}function DS(n,e,t,r){let i;for(const s of e)if(i=dE(IS(s,n),t),typeof i<"u")return Up(n,i)?Hp(t,r,n,i):i}function dE(n,e){for(const t of e){if(!t)continue;const r=t[n];if(typeof r<"u")return r}}function I1(n){let e=n._keys;return e||(e=n._keys=FS(n._scopes)),e}function FS(n){const e=new Set;for(const t of n)for(const r of Object.keys(t).filter(i=>!i.startsWith("_")))e.add(r);return Array.from(e)}function pE(n,e,t,r){const{iScale:i}=n,{key:s="r"}=this._parsing,a=new Array(r);let o,c,l,u;for(o=0,c=r;o<c;++o)l=o+t,u=e[l],a[o]={r:i.parse(ds(u,s),l)};return a}const OS=Number.EPSILON||1e-14,vo=(n,e)=>e<n.length&&!n[e].skip&&n[e],gE=n=>n==="x"?"y":"x";function MS(n,e,t,r){const i=n.skip?e:n,s=e,a=t.skip?e:t,o=w0(s,i),c=w0(a,s);let l=o/(o+c),u=c/(o+c);l=isNaN(l)?0:l,u=isNaN(u)?0:u;const h=r*l,d=r*u;return{previous:{x:s.x-h*(a.x-i.x),y:s.y-h*(a.y-i.y)},next:{x:s.x+d*(a.x-i.x),y:s.y+d*(a.y-i.y)}}}function LS(n,e,t){const r=n.length;let i,s,a,o,c,l=vo(n,0);for(let u=0;u<r-1;++u)if(c=l,l=vo(n,u+1),!(!c||!l)){if(jc(e[u],0,OS)){t[u]=t[u+1]=0;continue}i=t[u]/e[u],s=t[u+1]/e[u],o=Math.pow(i,2)+Math.pow(s,2),!(o<=9)&&(a=3/Math.sqrt(o),t[u]=i*a*e[u],t[u+1]=s*a*e[u])}}function NS(n,e,t="x"){const r=gE(t),i=n.length;let s,a,o,c=vo(n,0);for(let l=0;l<i;++l){if(a=o,o=c,c=vo(n,l+1),!o)continue;const u=o[t],h=o[r];a&&(s=(u-a[t])/3,o[`cp1${t}`]=u-s,o[`cp1${r}`]=h-s*e[l]),c&&(s=(c[t]-u)/3,o[`cp2${t}`]=u+s,o[`cp2${r}`]=h+s*e[l])}}function VS(n,e="x"){const t=gE(e),r=n.length,i=Array(r).fill(0),s=Array(r);let a,o,c,l=vo(n,0);for(a=0;a<r;++a)if(o=c,c=l,l=vo(n,a+1),!!c){if(l){const u=l[e]-c[e];i[a]=u!==0?(l[t]-c[t])/u:0}s[a]=o?l?Ur(i[a-1])!==Ur(i[a])?0:(i[a-1]+i[a])/2:i[a-1]:i[a]}LS(n,i,s),NS(n,s,e)}function Uu(n,e,t){return Math.max(Math.min(n,t),e)}function BS(n,e){let t,r,i,s,a,o=ui(n[0],e);for(t=0,r=n.length;t<r;++t)a=s,s=o,o=t<r-1&&ui(n[t+1],e),s&&(i=n[t],a&&(i.cp1x=Uu(i.cp1x,e.left,e.right),i.cp1y=Uu(i.cp1y,e.top,e.bottom)),o&&(i.cp2x=Uu(i.cp2x,e.left,e.right),i.cp2y=Uu(i.cp2y,e.top,e.bottom)))}function US(n,e,t,r,i){let s,a,o,c;if(e.spanGaps&&(n=n.filter(l=>!l.skip)),e.cubicInterpolationMode==="monotone")VS(n,i);else{let l=r?n[n.length-1]:n[0];for(s=0,a=n.length;s<a;++s)o=n[s],c=MS(l,o,n[Math.min(s+1,a-(r?0:1))%a],e.tension),o.cp1x=c.previous.x,o.cp1y=c.previous.y,o.cp2x=c.next.x,o.cp2y=c.next.y,l=o}e.capBezierPoints&&BS(n,t)}function zp(){return typeof window<"u"&&typeof document<"u"}function $p(n){let e=n.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Nh(n,e,t){let r;return typeof n=="string"?(r=parseInt(n,10),n.indexOf("%")!==-1&&(r=r/100*e.parentNode[t])):r=n,r}const Mf=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function HS(n,e){return Mf(n).getPropertyValue(e)}const zS=["top","right","bottom","left"];function ia(n,e,t){const r={};t=t?"-"+t:"";for(let i=0;i<4;i++){const s=zS[i];r[s]=parseFloat(n[e+"-"+s+t])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const $S=(n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot);function WS(n,e){const t=n.touches,r=t&&t.length?t[0]:n,{offsetX:i,offsetY:s}=r;let a=!1,o,c;if($S(i,s,n.target))o=i,c=s;else{const l=e.getBoundingClientRect();o=r.clientX-l.left,c=r.clientY-l.top,a=!0}return{x:o,y:c,box:a}}function js(n,e){if("native"in n)return n;const{canvas:t,currentDevicePixelRatio:r}=e,i=Mf(t),s=i.boxSizing==="border-box",a=ia(i,"padding"),o=ia(i,"border","width"),{x:c,y:l,box:u}=WS(n,t),h=a.left+(u&&o.left),d=a.top+(u&&o.top);let{width:p,height:g}=e;return s&&(p-=a.width+o.width,g-=a.height+o.height),{x:Math.round((c-h)/p*t.width/r),y:Math.round((l-d)/g*t.height/r)}}function jS(n,e,t){let r,i;if(e===void 0||t===void 0){const s=n&&$p(n);if(!s)e=n.clientWidth,t=n.clientHeight;else{const a=s.getBoundingClientRect(),o=Mf(s),c=ia(o,"border","width"),l=ia(o,"padding");e=a.width-l.width-c.width,t=a.height-l.height-c.height,r=Nh(o.maxWidth,s,"clientWidth"),i=Nh(o.maxHeight,s,"clientHeight")}}return{width:e,height:t,maxWidth:r||Mh,maxHeight:i||Mh}}const ts=n=>Math.round(n*10)/10;function GS(n,e,t,r){const i=Mf(n),s=ia(i,"margin"),a=Nh(i.maxWidth,n,"clientWidth")||Mh,o=Nh(i.maxHeight,n,"clientHeight")||Mh,c=jS(n,e,t);let{width:l,height:u}=c;if(i.boxSizing==="content-box"){const d=ia(i,"border","width"),p=ia(i,"padding");l-=p.width+d.width,u-=p.height+d.height}return l=Math.max(0,l-s.width),u=Math.max(0,r?l/r:u-s.height),l=ts(Math.min(l,a,c.maxWidth)),u=ts(Math.min(u,o,c.maxHeight)),l&&!u&&(u=ts(l/2)),(e!==void 0||t!==void 0)&&r&&c.height&&u>c.height&&(u=c.height,l=ts(Math.floor(u*r))),{width:l,height:u}}function A1(n,e,t){const r=e||1,i=ts(n.height*r),s=ts(n.width*r);n.height=ts(n.height),n.width=ts(n.width);const a=n.canvas;return a.style&&(t||!a.style.height&&!a.style.width)&&(a.style.height=`${n.height}px`,a.style.width=`${n.width}px`),n.currentDevicePixelRatio!==r||a.height!==i||a.width!==s?(n.currentDevicePixelRatio=r,a.height=i,a.width=s,n.ctx.setTransform(r,0,0,r,0,0),!0):!1}const qS=(function(){let n=!1;try{const e={get passive(){return n=!0,!1}};zp()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return n})();function S1(n,e){const t=HS(n,e),r=t&&t.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Gs(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function KS(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:r==="middle"?t<.5?n.y:e.y:r==="after"?t<1?n.y:e.y:t>0?e.y:n.y}}function YS(n,e,t,r){const i={x:n.cp2x,y:n.cp2y},s={x:e.cp1x,y:e.cp1y},a=Gs(n,i,t),o=Gs(i,s,t),c=Gs(s,e,t),l=Gs(a,o,t),u=Gs(o,c,t);return Gs(l,u,t)}const XS=function(n,e){return{x(t){return n+n+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,r){return t-r},leftForLtr(t,r){return t-r}}},QS=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,e){return n+e},leftForLtr(n,e){return n}}};function co(n,e,t){return n?XS(e,t):QS()}function mE(n,e){let t,r;(e==="ltr"||e==="rtl")&&(t=n.canvas.style,r=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=r)}function _E(n,e){e!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function xE(n){return n==="angle"?{between:vl,compare:JA,normalize:xn}:{between:ci,compare:(e,t)=>e-t,normalize:e=>e}}function k1({start:n,end:e,count:t,loop:r,style:i}){return{start:n%t,end:e%t,loop:r&&(e-n+1)%t===0,style:i}}function JS(n,e,t){const{property:r,start:i,end:s}=t,{between:a,normalize:o}=xE(r),c=e.length;let{start:l,end:u,loop:h}=n,d,p;if(h){for(l+=c,u+=c,d=0,p=c;d<p&&a(o(e[l%c][r]),i,s);++d)l--,u--;l%=c,u%=c}return u<l&&(u+=c),{start:l,end:u,loop:h,style:n.style}}function yE(n,e,t){if(!t)return[n];const{property:r,start:i,end:s}=t,a=e.length,{compare:o,between:c,normalize:l}=xE(r),{start:u,end:h,loop:d,style:p}=JS(n,e,t),g=[];let m=!1,_=null,E,I,v;const R=()=>c(i,v,E)&&o(i,v)!==0,F=()=>o(s,E)===0||c(s,v,E),O=()=>m||R(),y=()=>!m||F();for(let w=u,T=u;w<=h;++w)I=e[w%a],!I.skip&&(E=l(I[r]),E!==v&&(m=c(E,i,s),_===null&&O()&&(_=o(E,i)===0?w:T),_!==null&&y()&&(g.push(k1({start:_,end:w,loop:d,count:a,style:p})),_=null),T=w,v=E));return _!==null&&g.push(k1({start:_,end:h,loop:d,count:a,style:p})),g}function vE(n,e){const t=[],r=n.segments;for(let i=0;i<r.length;i++){const s=yE(r[i],n.points,e);s.length&&t.push(...s)}return t}function ZS(n,e,t,r){let i=0,s=e-1;if(t&&!r)for(;i<e&&!n[i].skip;)i++;for(;i<e&&n[i].skip;)i++;for(i%=e,t&&(s+=i);s>i&&n[s%e].skip;)s--;return s%=e,{start:i,end:s}}function ek(n,e,t,r){const i=n.length,s=[];let a=e,o=n[e],c;for(c=e+1;c<=t;++c){const l=n[c%i];l.skip||l.stop?o.skip||(r=!1,s.push({start:e%i,end:(c-1)%i,loop:r}),e=a=l.stop?c:null):(a=c,o.skip&&(e=c)),o=l}return a!==null&&s.push({start:e%i,end:a%i,loop:r}),s}function tk(n,e){const t=n.points,r=n.options.spanGaps,i=t.length;if(!i)return[];const s=!!n._loop,{start:a,end:o}=ZS(t,i,s,r);if(r===!0)return C1(n,[{start:a,end:o,loop:s}],t,e);const c=o<a?o+i:o,l=!!n._fullLoop&&a===0&&o===i-1;return C1(n,ek(t,a,c,l),t,e)}function C1(n,e,t,r){return!r||!r.setContext||!t?e:nk(n,e,t,r)}function nk(n,e,t,r){const i=n._chart.getContext(),s=R1(n.options),{_datasetIndex:a,options:{spanGaps:o}}=n,c=t.length,l=[];let u=s,h=e[0].start,d=h;function p(g,m,_,E){const I=o?-1:1;if(g!==m){for(g+=c;t[g%c].skip;)g-=I;for(;t[m%c].skip;)m+=I;g%c!==m%c&&(l.push({start:g%c,end:m%c,loop:_,style:E}),u=E,h=m%c)}}for(const g of e){h=o?h:g.start;let m=t[h%c],_;for(d=h+1;d<=g.end;d++){const E=t[d%c];_=R1(r.setContext(ws(i,{type:"segment",p0:m,p1:E,p0DataIndex:(d-1)%c,p1DataIndex:d%c,datasetIndex:a}))),rk(_,u)&&p(h,d-1,g.loop,u),m=E,u=_}h<d-1&&p(h,d-1,g.loop,u)}return l}function R1(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function rk(n,e){if(!e)return!1;const t=[],r=function(i,s){return Np(s)?(t.includes(s)||t.push(s),t.indexOf(s)):s};return JSON.stringify(n,r)!==JSON.stringify(e,r)}function Hu(n,e,t){return n.options.clip?n[t]:e[t]}function ik(n,e){const{xScale:t,yScale:r}=n;return t&&r?{left:Hu(t,e,"left"),right:Hu(t,e,"right"),top:Hu(r,e,"top"),bottom:Hu(r,e,"bottom")}:e}function EE(n,e){const t=e._clip;if(t.disabled)return!1;const r=ik(e,n.chartArea);return{left:t.left===!1?0:r.left-(t.left===!0?0:t.left),right:t.right===!1?n.width:r.right+(t.right===!0?0:t.right),top:t.top===!1?0:r.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?n.height:r.bottom+(t.bottom===!0?0:t.bottom)}}class sk{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,r,i){const s=t.listeners[i],a=t.duration;s.forEach(o=>o({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(r-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=rE.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((r,i)=>{if(!r.running||!r.items.length)return;const s=r.items;let a=s.length-1,o=!1,c;for(;a>=0;--a)c=s[a],c._active?(c._total>r.duration&&(r.duration=c._total),c.tick(e),o=!0):(s[a]=s[s.length-1],s.pop());o&&(i.draw(),this._notify(i,r,e,"progress")),s.length||(r.running=!1,this._notify(i,r,e,"complete"),r.initial=!1),t+=s.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let r=t.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,r)),r}listen(e,t,r){this._getAnims(e).listeners[t].push(r)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((r,i)=>Math.max(r,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const r=t.items;let i=r.length-1;for(;i>=0;--i)r[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var ii=new sk;const P1="transparent",ak={boolean(n,e,t){return t>.5?e:n},color(n,e,t){const r=E1(n||P1),i=r.valid&&E1(e||P1);return i&&i.valid?i.mix(r,t).hexString():e},number(n,e,t){return n+(e-n)*t}};class ok{constructor(e,t,r,i){const s=t[r];i=Cc([e.to,i,s,e.from]);const a=Cc([e.from,s,i]);this._active=!0,this._fn=e.fn||ak[e.type||typeof a],this._easing=Gc[e.easing]||Gc.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=r,this._from=a,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,r){if(this._active){this._notify(!1);const i=this._target[this._prop],s=r-this._start,a=this._duration-s;this._start=r,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=Cc([e.to,t,i,e.from]),this._from=Cc([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,r=this._duration,i=this._prop,s=this._from,a=this._loop,o=this._to;let c;if(this._active=s!==o&&(a||t<r),!this._active){this._target[i]=o,this._notify(!0);return}if(t<0){this._target[i]=s;return}c=t/r%2,c=a&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[i]=this._fn(s,o,c)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,r)=>{e.push({res:t,rej:r})})}_notify(e){const t=e?"res":"rej",r=this._promises||[];for(let i=0;i<r.length;i++)r[i][t]()}}class wE{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!We(e))return;const t=Object.keys(At.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const s=e[i];if(!We(s))return;const a={};for(const o of t)a[o]=s[o];(It(s.properties)&&s.properties||[i]).forEach(o=>{(o===i||!r.has(o))&&r.set(o,a)})})}_animateOptions(e,t){const r=t.options,i=lk(e,r);if(!i)return[];const s=this._createAnimations(i,r);return r.$shared&&ck(e.options.$animations,r).then(()=>{e.options=r},()=>{}),s}_createAnimations(e,t){const r=this._properties,i=[],s=e.$animations||(e.$animations={}),a=Object.keys(t),o=Date.now();let c;for(c=a.length-1;c>=0;--c){const l=a[c];if(l.charAt(0)==="$")continue;if(l==="options"){i.push(...this._animateOptions(e,t));continue}const u=t[l];let h=s[l];const d=r.get(l);if(h)if(d&&h.active()){h.update(d,u,o);continue}else h.cancel();if(!d||!d.duration){e[l]=u;continue}s[l]=h=new ok(d,e,l,u),i.push(h)}return i}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const r=this._createAnimations(e,t);if(r.length)return ii.add(this._chart,r),!0}}function ck(n,e){const t=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const s=n[r[i]];s&&s.active()&&t.push(s.wait())}return Promise.all(t)}function lk(n,e){if(!e)return;let t=n.options;if(!t){n.options=e;return}return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function D1(n,e){const t=n&&n.options||{},r=t.reverse,i=t.min===void 0?e:0,s=t.max===void 0?e:0;return{start:r?s:i,end:r?i:s}}function uk(n,e,t){if(t===!1)return!1;const r=D1(n,t),i=D1(e,t);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}function hk(n){let e,t,r,i;return We(n)?(e=n.top,t=n.right,r=n.bottom,i=n.left):e=t=r=i=n,{top:e,right:t,bottom:r,left:i,disabled:n===!1}}function TE(n,e){const t=[],r=n._getSortedDatasetMetas(e);let i,s;for(i=0,s=r.length;i<s;++i)t.push(r[i].index);return t}function F1(n,e,t,r={}){const i=n.keys,s=r.mode==="single";let a,o,c,l;if(e===null)return;let u=!1;for(a=0,o=i.length;a<o;++a){if(c=+i[a],c===t){if(u=!0,r.all)continue;break}l=n.values[c],Dt(l)&&(s||e===0||Ur(e)===Ur(l))&&(e+=l)}return!u&&!r.all?0:e}function fk(n,e){const{iScale:t,vScale:r}=e,i=t.axis==="x"?"x":"y",s=r.axis==="x"?"x":"y",a=Object.keys(n),o=new Array(a.length);let c,l,u;for(c=0,l=a.length;c<l;++c)u=a[c],o[c]={[i]:u,[s]:n[u]};return o}function Pd(n,e){const t=n&&n.options.stacked;return t||t===void 0&&e.stack!==void 0}function dk(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}function pk(n){const{min:e,max:t,minDefined:r,maxDefined:i}=n.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?t:Number.POSITIVE_INFINITY}}function gk(n,e,t){const r=n[e]||(n[e]={});return r[t]||(r[t]={})}function O1(n,e,t,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const s=n[i.index];if(t&&s>0||!t&&s<0)return i.index}return null}function M1(n,e){const{chart:t,_cachedMeta:r}=n,i=t._stacks||(t._stacks={}),{iScale:s,vScale:a,index:o}=r,c=s.axis,l=a.axis,u=dk(s,a,r),h=e.length;let d;for(let p=0;p<h;++p){const g=e[p],{[c]:m,[l]:_}=g,E=g._stacks||(g._stacks={});d=E[l]=gk(i,u,m),d[o]=_,d._top=O1(d,a,!0,r.type),d._bottom=O1(d,a,!1,r.type);const I=d._visualValues||(d._visualValues={});I[o]=_}}function Dd(n,e){const t=n.scales;return Object.keys(t).filter(r=>t[r].axis===e).shift()}function mk(n,e){return ws(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function _k(n,e,t){return ws(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function gc(n,e){const t=n.controller.index,r=n.vScale&&n.vScale.axis;if(r){e=e||n._parsed;for(const i of e){const s=i._stacks;if(!s||s[r]===void 0||s[r][t]===void 0)return;delete s[r][t],s[r]._visualValues!==void 0&&s[r]._visualValues[t]!==void 0&&delete s[r]._visualValues[t]}}}const Fd=n=>n==="reset"||n==="none",L1=(n,e)=>e?n:Object.assign({},n),xk=(n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:TE(t,!0),values:null};class Ts{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Pd(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&gc(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,r=this.getDataset(),i=(h,d,p,g)=>h==="x"?d:h==="r"?g:p,s=t.xAxisID=Le(r.xAxisID,Dd(e,"x")),a=t.yAxisID=Le(r.yAxisID,Dd(e,"y")),o=t.rAxisID=Le(r.rAxisID,Dd(e,"r")),c=t.indexAxis,l=t.iAxisID=i(c,s,a,o),u=t.vAxisID=i(c,a,s,o);t.xScale=this.getScaleForId(s),t.yScale=this.getScaleForId(a),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&x1(this._data,this),e._stacked&&gc(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),r=this._data;if(We(t)){const i=this._cachedMeta;this._data=fk(t,i)}else if(r!==t){if(r){x1(r,this);const i=this._cachedMeta;gc(i),i._parsed=[]}t&&Object.isExtensible(t)&&nS(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,r=this.getDataset();let i=!1;this._dataCheck();const s=t._stacked;t._stacked=Pd(t.vScale,t),t.stack!==r.stack&&(i=!0,gc(t),t.stack=r.stack),this._resyncElements(e),(i||s!==t._stacked)&&(M1(this,t._parsed),t._stacked=Pd(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:r,_data:i}=this,{iScale:s,_stacked:a}=r,o=s.axis;let c=e===0&&t===i.length?!0:r._sorted,l=e>0&&r._parsed[e-1],u,h,d;if(this._parsing===!1)r._parsed=i,r._sorted=!0,d=i;else{It(i[e])?d=this.parseArrayData(r,i,e,t):We(i[e])?d=this.parseObjectData(r,i,e,t):d=this.parsePrimitiveData(r,i,e,t);const p=()=>h[o]===null||l&&h[o]<l[o];for(u=0;u<t;++u)r._parsed[u+e]=h=d[u],c&&(p()&&(c=!1),l=h);r._sorted=c}a&&M1(this,d)}parsePrimitiveData(e,t,r,i){const{iScale:s,vScale:a}=e,o=s.axis,c=a.axis,l=s.getLabels(),u=s===a,h=new Array(i);let d,p,g;for(d=0,p=i;d<p;++d)g=d+r,h[d]={[o]:u||s.parse(l[g],g),[c]:a.parse(t[g],g)};return h}parseArrayData(e,t,r,i){const{xScale:s,yScale:a}=e,o=new Array(i);let c,l,u,h;for(c=0,l=i;c<l;++c)u=c+r,h=t[u],o[c]={x:s.parse(h[0],u),y:a.parse(h[1],u)};return o}parseObjectData(e,t,r,i){const{xScale:s,yScale:a}=e,{xAxisKey:o="x",yAxisKey:c="y"}=this._parsing,l=new Array(i);let u,h,d,p;for(u=0,h=i;u<h;++u)d=u+r,p=t[d],l[u]={x:s.parse(ds(p,o),d),y:a.parse(ds(p,c),d)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,r){const i=this.chart,s=this._cachedMeta,a=t[e.axis],o={keys:TE(i,!0),values:t._stacks[e.axis]._visualValues};return F1(o,a,s.index,{mode:r})}updateRangeFromParsed(e,t,r,i){const s=r[t.axis];let a=s===null?NaN:s;const o=i&&r._stacks[t.axis];i&&o&&(i.values=o,a=F1(i,s,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,t){const r=this._cachedMeta,i=r._parsed,s=r._sorted&&e===r.iScale,a=i.length,o=this._getOtherScale(e),c=xk(t,r,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:h}=pk(o);let d,p;function g(){p=i[d];const m=p[o.axis];return!Dt(p[e.axis])||u>m||h<m}for(d=0;d<a&&!(!g()&&(this.updateRangeFromParsed(l,e,p,c),s));++d);if(s){for(d=a-1;d>=0;--d)if(!g()){this.updateRangeFromParsed(l,e,p,c);break}}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,r=[];let i,s,a;for(i=0,s=t.length;i<s;++i)a=t[i][e.axis],Dt(a)&&r.push(a);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,r=t.iScale,i=t.vScale,s=this.getParsed(e);return{label:r?""+r.getLabelForValue(s[r.axis]):"",value:i?""+i.getLabelForValue(s[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=hk(Le(this.options.clip,uk(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,r=this._cachedMeta,i=r.data||[],s=t.chartArea,a=[],o=this._drawStart||0,c=this._drawCount||i.length-o,l=this.options.drawActiveElementsOnTop;let u;for(r.dataset&&r.dataset.draw(e,s,o,c),u=o;u<o+c;++u){const h=i[u];h.hidden||(h.active&&l?a.push(h):h.draw(e,s))}for(u=0;u<a.length;++u)a[u].draw(e,s)}getStyle(e,t){const r=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,t,r){const i=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];s=a.$context||(a.$context=_k(this.getContext(),e,a)),s.parsed=this.getParsed(e),s.raw=i.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=mk(this.chart.getContext(),this.index)),s.dataset=i,s.index=s.datasetIndex=this.index;return s.active=!!t,s.mode=r,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",r){const i=t==="active",s=this._cachedDataOpts,a=e+"-"+t,o=s[a],c=this.enableOptionSharing&&yl(r);if(o)return L1(o,c);const l=this.chart.config,u=l.datasetElementScopeKeys(this._type,e),h=i?[`${e}Hover`,"hover",e,""]:[e,""],d=l.getOptionScopes(this.getDataset(),u),p=Object.keys(At.elements[e]),g=()=>this.getContext(r,i,t),m=l.resolveNamedOptions(d,p,g,h);return m.$shared&&(m.$shared=c,s[a]=Object.freeze(L1(m,c))),m}_resolveAnimations(e,t,r){const i=this.chart,s=this._cachedDataOpts,a=`animation-${t}`,o=s[a];if(o)return o;let c;if(i.options.animation!==!1){const u=this.chart.config,h=u.datasetAnimationScopeKeys(this._type,t),d=u.getOptionScopes(this.getDataset(),h);c=u.createResolver(d,this.getContext(e,r,t))}const l=new wE(i,c&&c.animations);return c&&c._cacheable&&(s[a]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||Fd(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const r=this.resolveDataElementOptions(e,t),i=this._sharedOptions,s=this.getSharedOptions(r),a=this.includeOptions(t,s)||s!==i;return this.updateSharedOptions(s,t,r),{sharedOptions:s,includeOptions:a}}updateElement(e,t,r,i){Fd(i)?Object.assign(e,r):this._resolveAnimations(t,i).update(e,r)}updateSharedOptions(e,t,r){e&&!Fd(t)&&this._resolveAnimations(void 0,t).update(e,r)}_setStyle(e,t,r,i){e.active=i;const s=this.getStyle(t,i);this._resolveAnimations(t,r,i).update(e,{options:!i&&this.getSharedOptions(s)||s})}removeHoverStyle(e,t,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,t,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,r=this._cachedMeta.data;for(const[o,c,l]of this._syncList)this[o](c,l);this._syncList=[];const i=r.length,s=t.length,a=Math.min(s,i);a&&this.parse(0,a),s>i?this._insertElements(i,s-i,e):s<i&&this._removeElements(s,i-s)}_insertElements(e,t,r=!0){const i=this._cachedMeta,s=i.data,a=e+t;let o;const c=l=>{for(l.length+=t,o=l.length-1;o>=a;o--)l[o]=l[o-t]};for(c(s),o=e;o<a;++o)s[o]=new this.dataElementType;this._parsing&&c(i._parsed),this.parse(e,t),r&&this.updateElements(s,e,t,"reset")}updateElements(e,t,r,i){}_removeElements(e,t){const r=this._cachedMeta;if(this._parsing){const i=r._parsed.splice(e,t);r._stacked&&gc(r,i)}r.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,r,i]=e;this[t](r,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function yk(n,e){if(!n._cache.$bar){const t=n.getMatchingVisibleMetas(e);let r=[];for(let i=0,s=t.length;i<s;i++)r=r.concat(t[i].controller.getAllParsedValues(n));n._cache.$bar=nE(r.sort((i,s)=>i-s))}return n._cache.$bar}function vk(n){const e=n.iScale,t=yk(e,n.type);let r=e._length,i,s,a,o;const c=()=>{a===32767||a===-32768||(yl(o)&&(r=Math.min(r,Math.abs(a-o)||r)),o=a)};for(i=0,s=t.length;i<s;++i)a=e.getPixelForValue(t[i]),c();for(o=void 0,i=0,s=e.ticks.length;i<s;++i)a=e.getPixelForTick(i),c();return r}function Ek(n,e,t,r){const i=t.barThickness;let s,a;return ze(i)?(s=e.min*t.categoryPercentage,a=t.barPercentage):(s=i*r,a=1),{chunk:s/r,ratio:a,start:e.pixels[n]-s/2}}function wk(n,e,t,r){const i=e.pixels,s=i[n];let a=n>0?i[n-1]:null,o=n<i.length-1?i[n+1]:null;const c=t.categoryPercentage;a===null&&(a=s-(o===null?e.end-e.start:o-s)),o===null&&(o=s+s-a);const l=s-(s-Math.min(a,o))/2*c;return{chunk:Math.abs(o-a)/2*c/r,ratio:t.barPercentage,start:l}}function Tk(n,e,t,r){const i=t.parse(n[0],r),s=t.parse(n[1],r),a=Math.min(i,s),o=Math.max(i,s);let c=a,l=o;Math.abs(a)>Math.abs(o)&&(c=o,l=a),e[t.axis]=l,e._custom={barStart:c,barEnd:l,start:i,end:s,min:a,max:o}}function bE(n,e,t,r){return It(n)?Tk(n,e,t,r):e[t.axis]=t.parse(n,r),e}function N1(n,e,t,r){const i=n.iScale,s=n.vScale,a=i.getLabels(),o=i===s,c=[];let l,u,h,d;for(l=t,u=t+r;l<u;++l)d=e[l],h={},h[i.axis]=o||i.parse(a[l],l),c.push(bE(d,h,s,l));return c}function Od(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function bk(n,e,t){return n!==0?Ur(n):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function Ik(n){let e,t,r,i,s;return n.horizontal?(e=n.base>n.x,t="left",r="right"):(e=n.base<n.y,t="bottom",r="top"),e?(i="end",s="start"):(i="start",s="end"),{start:t,end:r,reverse:e,top:i,bottom:s}}function Ak(n,e,t,r){let i=e.borderSkipped;const s={};if(!i){n.borderSkipped=s;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:a,end:o,reverse:c,top:l,bottom:u}=Ik(n);i==="middle"&&t&&(n.enableBorderRadius=!0,(t._top||0)===r?i=l:(t._bottom||0)===r?i=u:(s[V1(u,a,o,c)]=!0,i=l)),s[V1(i,a,o,c)]=!0,n.borderSkipped=s}function V1(n,e,t,r){return r?(n=Sk(n,e,t),n=B1(n,t,e)):n=B1(n,e,t),n}function Sk(n,e,t){return n===e?t:n===t?e:n}function B1(n,e,t){return n==="start"?e:n==="end"?t:n}function kk(n,{inflateAmount:e},t){n.inflateAmount=e==="auto"?t===1?.33:0:e}class Ck extends Ts{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,r,i){return N1(e,t,r,i)}parseArrayData(e,t,r,i){return N1(e,t,r,i)}parseObjectData(e,t,r,i){const{iScale:s,vScale:a}=e,{xAxisKey:o="x",yAxisKey:c="y"}=this._parsing,l=s.axis==="x"?o:c,u=a.axis==="x"?o:c,h=[];let d,p,g,m;for(d=r,p=r+i;d<p;++d)m=t[d],g={},g[s.axis]=s.parse(ds(m,l),d),h.push(bE(ds(m,u),g,a,d));return h}updateRangeFromParsed(e,t,r,i){super.updateRangeFromParsed(e,t,r,i);const s=r._custom;s&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,s.min),e.max=Math.max(e.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:r,vScale:i}=t,s=this.getParsed(e),a=s._custom,o=Od(a)?"["+a.start+", "+a.end+"]":""+i.getLabelForValue(s[i.axis]);return{label:""+r.getLabelForValue(s[r.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,r,i){const s=i==="reset",{index:a,_cachedMeta:{vScale:o}}=this,c=o.getBasePixel(),l=o.isHorizontal(),u=this._getRuler(),{sharedOptions:h,includeOptions:d}=this._getSharedOptions(t,i);for(let p=t;p<t+r;p++){const g=this.getParsed(p),m=s||ze(g[o.axis])?{base:c,head:c}:this._calculateBarValuePixels(p),_=this._calculateBarIndexPixels(p,u),E=(g._stacks||{})[o.axis],I={horizontal:l,base:m.base,enableBorderRadius:!E||Od(g._custom)||a===E._top||a===E._bottom,x:l?m.head:_.center,y:l?_.center:m.head,height:l?_.size:Math.abs(m.size),width:l?Math.abs(m.size):_.size};d&&(I.options=h||this.resolveDataElementOptions(p,e[p].active?"active":i));const v=I.options||e[p].options;Ak(I,v,E,a),kk(I,v,u.ratio),this.updateElement(e[p],p,I,i)}}_getStacks(e,t){const{iScale:r}=this._cachedMeta,i=r.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),s=r.options.stacked,a=[],o=this._cachedMeta.controller.getParsed(t),c=o&&o[r.axis],l=u=>{const h=u._parsed.find(p=>p[r.axis]===c),d=h&&h[u.vScale.axis];if(ze(d)||isNaN(d))return!0};for(const u of i)if(!(t!==void 0&&l(u))&&((s===!1||a.indexOf(u.stack)===-1||s===void 0&&u.stack===void 0)&&a.push(u.stack),u.index===e))break;return a.length||a.push(void 0),a}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(r=>e[r].axis===t).shift()}_getAxis(){const e={},t=this.getFirstScaleIdForIndexAxis();for(const r of this.chart.data.datasets)e[Le(this.chart.options.indexAxis==="x"?r.xAxisID:r.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,r){const i=this._getStacks(e,r),s=t!==void 0?i.indexOf(t):-1;return s===-1?i.length-1:s}_getRuler(){const e=this.options,t=this._cachedMeta,r=t.iScale,i=[];let s,a;for(s=0,a=t.data.length;s<a;++s)i.push(r.getPixelForValue(this.getParsed(s)[r.axis],s));const o=e.barThickness;return{min:o||vk(t),pixels:i,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:r,index:i},options:{base:s,minBarLength:a}}=this,o=s||0,c=this.getParsed(e),l=c._custom,u=Od(l);let h=c[t.axis],d=0,p=r?this.applyStack(t,c,r):h,g,m;p!==h&&(d=p-h,p=h),u&&(h=l.barStart,p=l.barEnd-l.barStart,h!==0&&Ur(h)!==Ur(l.barEnd)&&(d=0),d+=h);const _=!ze(s)&&!u?s:d;let E=t.getPixelForValue(_);if(this.chart.getDataVisibility(e)?g=t.getPixelForValue(d+p):g=E,m=g-E,Math.abs(m)<a){m=bk(m,t,o)*a,h===o&&(E-=m/2);const I=t.getPixelForDecimal(0),v=t.getPixelForDecimal(1),R=Math.min(I,v),F=Math.max(I,v);E=Math.max(Math.min(E,F),R),g=E+m,r&&!u&&(c._stacks[t.axis]._visualValues[i]=t.getValueForPixel(g)-t.getValueForPixel(E))}if(E===t.getPixelForValue(o)){const I=Ur(m)*t.getLineWidthForValue(o)/2;E+=I,m-=I}return{size:m,base:E,head:g,center:g+m/2}}_calculateBarIndexPixels(e,t){const r=t.scale,i=this.options,s=i.skipNull,a=Le(i.maxBarThickness,1/0);let o,c;const l=this._getAxisCount();if(t.grouped){const u=s?this._getStackCount(e):t.stackCount,h=i.barThickness==="flex"?wk(e,t,i,u*l):Ek(e,t,i,u*l),d=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,p=this._getAxis().indexOf(Le(d,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,s?e:void 0)+p;o=h.start+h.chunk*g+h.chunk/2,c=Math.min(a,h.chunk*h.ratio)}else o=r.getPixelForValue(this.getParsed(e)[r.axis],e),c=Math.min(a,t.min*t.ratio);return{base:o-c/2,head:o+c/2,center:o,size:c}}draw(){const e=this._cachedMeta,t=e.vScale,r=e.data,i=r.length;let s=0;for(;s<i;++s)this.getParsed(s)[t.axis]!==null&&!r[s].hidden&&r[s].draw(this._ctx)}}class Rk extends Ts{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,r,i){const s=super.parsePrimitiveData(e,t,r,i);for(let a=0;a<s.length;a++)s[a]._custom=this.resolveDataElementOptions(a+r).radius;return s}parseArrayData(e,t,r,i){const s=super.parseArrayData(e,t,r,i);for(let a=0;a<s.length;a++){const o=t[r+a];s[a]._custom=Le(o[2],this.resolveDataElementOptions(a+r).radius)}return s}parseObjectData(e,t,r,i){const s=super.parseObjectData(e,t,r,i);for(let a=0;a<s.length;a++){const o=t[r+a];s[a]._custom=Le(o&&o.r&&+o.r,this.resolveDataElementOptions(a+r).radius)}return s}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let r=e.length-1;r>=0;--r)t=Math.max(t,e[r].size(this.resolveDataElementOptions(r))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart.data.labels||[],{xScale:i,yScale:s}=t,a=this.getParsed(e),o=i.getLabelForValue(a.x),c=s.getLabelForValue(a.y),l=a._custom;return{label:r[e]||"",value:"("+o+", "+c+(l?", "+l:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,r,i){const s=i==="reset",{iScale:a,vScale:o}=this._cachedMeta,{sharedOptions:c,includeOptions:l}=this._getSharedOptions(t,i),u=a.axis,h=o.axis;for(let d=t;d<t+r;d++){const p=e[d],g=!s&&this.getParsed(d),m={},_=m[u]=s?a.getPixelForDecimal(.5):a.getPixelForValue(g[u]),E=m[h]=s?o.getBasePixel():o.getPixelForValue(g[h]);m.skip=isNaN(_)||isNaN(E),l&&(m.options=c||this.resolveDataElementOptions(d,p.active?"active":i),s&&(m.options.radius=0)),this.updateElement(p,d,m,i)}}resolveDataElementOptions(e,t){const r=this.getParsed(e);let i=super.resolveDataElementOptions(e,t);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const s=i.radius;return t!=="active"&&(i.radius=0),i.radius+=Le(r&&r._custom,s),i}}function Pk(n,e,t){let r=1,i=1,s=0,a=0;if(e<yt){const o=n,c=o+e,l=Math.cos(o),u=Math.sin(o),h=Math.cos(c),d=Math.sin(c),p=(v,R,F)=>vl(v,o,c,!0)?1:Math.max(R,R*t,F,F*t),g=(v,R,F)=>vl(v,o,c,!0)?-1:Math.min(R,R*t,F,F*t),m=p(0,l,h),_=p(Lt,u,d),E=g(et,l,h),I=g(et+Lt,u,d);r=(m-E)/2,i=(_-I)/2,s=-(m+E)/2,a=-(_+I)/2}return{ratioX:r,ratioY:i,offsetX:s,offsetY:a}}class Wp extends Ts{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data,{labels:{pointStyle:r,textAlign:i,color:s,useBorderRadius:a,borderRadius:o}}=e.legend.options;return t.labels.length&&t.datasets.length?t.labels.map((c,l)=>{const h=e.getDatasetMeta(0).controller.getStyle(l);return{text:c,fillStyle:h.backgroundColor,fontColor:s,hidden:!e.getDataVisibility(l),lineDash:h.borderDash,lineDashOffset:h.borderDashOffset,lineJoin:h.borderJoinStyle,lineWidth:h.borderWidth,strokeStyle:h.borderColor,textAlign:i,pointStyle:r,borderRadius:a&&(o||h.borderRadius),index:l}}):[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const r=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=r;else{let s=c=>+r[c];if(We(r[e])){const{key:c="value"}=this._parsing;s=l=>+ds(r[l],c)}let a,o;for(a=e,o=e+t;a<o;++a)i._parsed[a]=s(a)}}_getRotation(){return Er(this.options.rotation-90)}_getCircumference(){return Er(this.options.circumference)}_getRotationExtents(){let e=yt,t=-yt;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const i=this.chart.getDatasetMeta(r).controller,s=i._getRotation(),a=i._getCircumference();e=Math.min(e,s),t=Math.max(t,s+a)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:r}=t,i=this._cachedMeta,s=i.data,a=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,o=Math.max((Math.min(r.width,r.height)-a)/2,0),c=Math.min(HA(this.options.cutout,o),1),l=this._getRingWeight(this.index),{circumference:u,rotation:h}=this._getRotationExtents(),{ratioX:d,ratioY:p,offsetX:g,offsetY:m}=Pk(h,u,c),_=(r.width-a)/d,E=(r.height-a)/p,I=Math.max(Math.min(_,E)/2,0),v=Qv(this.options.radius,I),R=Math.max(v*c,0),F=(v-R)/this._getVisibleDatasetWeightTotal();this.offsetX=g*v,this.offsetY=m*v,i.total=this.calculateTotal(),this.outerRadius=v-F*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-F*l,0),this.updateElements(s,0,s.length,e)}_circumference(e,t){const r=this.options,i=this._cachedMeta,s=this._getCircumference();return t&&r.animation.animateRotate||!this.chart.getDataVisibility(e)||i._parsed[e]===null||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*s/yt)}updateElements(e,t,r,i){const s=i==="reset",a=this.chart,o=a.chartArea,l=a.options.animation,u=(o.left+o.right)/2,h=(o.top+o.bottom)/2,d=s&&l.animateScale,p=d?0:this.innerRadius,g=d?0:this.outerRadius,{sharedOptions:m,includeOptions:_}=this._getSharedOptions(t,i);let E=this._getRotation(),I;for(I=0;I<t;++I)E+=this._circumference(I,s);for(I=t;I<t+r;++I){const v=this._circumference(I,s),R=e[I],F={x:u+this.offsetX,y:h+this.offsetY,startAngle:E,endAngle:E+v,circumference:v,outerRadius:g,innerRadius:p};_&&(F.options=m||this.resolveDataElementOptions(I,R.active?"active":i)),E+=v,this.updateElement(R,I,F,i)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let r=0,i;for(i=0;i<t.length;i++){const s=e._parsed[i];s!==null&&!isNaN(s)&&this.chart.getDataVisibility(i)&&!t[i].hidden&&(r+=Math.abs(s))}return r}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?yt*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart,i=r.data.labels||[],s=Ql(t._parsed[e],r.options.locale);return{label:i[e]||"",value:s}}getMaxBorderWidth(e){let t=0;const r=this.chart;let i,s,a,o,c;if(!e){for(i=0,s=r.data.datasets.length;i<s;++i)if(r.isDatasetVisible(i)){a=r.getDatasetMeta(i),e=a.data,o=a.controller;break}}if(!e)return 0;for(i=0,s=e.length;i<s;++i)c=o.resolveDataElementOptions(i),c.borderAlign!=="inner"&&(t=Math.max(t,c.borderWidth||0,c.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let r=0,i=e.length;r<i;++r){const s=this.resolveDataElementOptions(r);t=Math.max(t,s.offset||0,s.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let r=0;r<e;++r)this.chart.isDatasetVisible(r)&&(t+=this._getRingWeight(r));return t}_getRingWeight(e){return Math.max(Le(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class Dk extends Ts{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:r,data:i=[],_dataset:s}=t,a=this.chart._animationsDisabled;let{start:o,count:c}=sE(t,i,a);this._drawStart=o,this._drawCount=c,aE(t)&&(o=0,c=i.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!s._decimated,r.points=i;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(r,void 0,{animated:!a,options:l},e),this.updateElements(i,o,c,e)}updateElements(e,t,r,i){const s=i==="reset",{iScale:a,vScale:o,_stacked:c,_dataset:l}=this._cachedMeta,{sharedOptions:u,includeOptions:h}=this._getSharedOptions(t,i),d=a.axis,p=o.axis,{spanGaps:g,segment:m}=this.options,_=xo(g)?g:Number.POSITIVE_INFINITY,E=this.chart._animationsDisabled||s||i==="none",I=t+r,v=e.length;let R=t>0&&this.getParsed(t-1);for(let F=0;F<v;++F){const O=e[F],y=E?O:{};if(F<t||F>=I){y.skip=!0;continue}const w=this.getParsed(F),T=ze(w[p]),S=y[d]=a.getPixelForValue(w[d],F),A=y[p]=s||T?o.getBasePixel():o.getPixelForValue(c?this.applyStack(o,w,c):w[p],F);y.skip=isNaN(S)||isNaN(A)||T,y.stop=F>0&&Math.abs(w[d]-R[d])>_,m&&(y.parsed=w,y.raw=l.data[F]),h&&(y.options=u||this.resolveDataElementOptions(F,O.active?"active":i)),E||this.updateElement(O,F,y,i),R=w}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,r=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return r;const s=i[0].size(this.resolveDataElementOptions(0)),a=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(r,s,a)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}class IE extends Ts{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:r,color:i}}=e.legend.options;return t.labels.map((s,a)=>{const c=e.getDatasetMeta(0).controller.getStyle(a);return{text:s,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:i,lineWidth:c.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart,i=r.data.labels||[],s=Ql(t._parsed[e].r,r.options.locale);return{label:i[e]||"",value:s}}parseObjectData(e,t,r,i){return pE.bind(this)(e,t,r,i)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((r,i)=>{const s=this.getParsed(i).r;!isNaN(s)&&this.chart.getDataVisibility(i)&&(s<t.min&&(t.min=s),s>t.max&&(t.max=s))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,r=e.options,i=Math.min(t.right-t.left,t.bottom-t.top),s=Math.max(i/2,0),a=Math.max(r.cutoutPercentage?s/100*r.cutoutPercentage:1,0),o=(s-a)/e.getVisibleDatasetCount();this.outerRadius=s-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(e,t,r,i){const s=i==="reset",a=this.chart,c=a.options.animation,l=this._cachedMeta.rScale,u=l.xCenter,h=l.yCenter,d=l.getIndexAngle(0)-.5*et;let p=d,g;const m=360/this.countVisibleElements();for(g=0;g<t;++g)p+=this._computeAngle(g,i,m);for(g=t;g<t+r;g++){const _=e[g];let E=p,I=p+this._computeAngle(g,i,m),v=a.getDataVisibility(g)?l.getDistanceFromCenterForValue(this.getParsed(g).r):0;p=I,s&&(c.animateScale&&(v=0),c.animateRotate&&(E=I=d));const R={x:u,y:h,innerRadius:0,outerRadius:v,startAngle:E,endAngle:I,options:this.resolveDataElementOptions(g,_.active?"active":i)};this.updateElement(_,g,R,i)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((r,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&t++}),t}_computeAngle(e,t,r){return this.chart.getDataVisibility(e)?Er(this.resolveDataElementOptions(e,t).angle||r):0}}class Fk extends Wp{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class Ok extends Ts{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const t=this._cachedMeta.vScale,r=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(r[t.axis])}}parseObjectData(e,t,r,i){return pE.bind(this)(e,t,r,i)}update(e){const t=this._cachedMeta,r=t.dataset,i=t.data||[],s=t.iScale.getLabels();if(r.points=i,e!=="resize"){const a=this.resolveDatasetElementOptions(e);this.options.showLine||(a.borderWidth=0);const o={_loop:!0,_fullLoop:s.length===i.length,options:a};this.updateElement(r,void 0,o,e)}this.updateElements(i,0,i.length,e)}updateElements(e,t,r,i){const s=this._cachedMeta.rScale,a=i==="reset";for(let o=t;o<t+r;o++){const c=e[o],l=this.resolveDataElementOptions(o,c.active?"active":i),u=s.getPointPositionForValue(o,this.getParsed(o).r),h=a?s.xCenter:u.x,d=a?s.yCenter:u.y,p={x:h,y:d,angle:u.angle,skip:isNaN(h)||isNaN(d),options:l};this.updateElement(c,o,p,i)}}}class Mk extends Ts{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,r=this.chart.data.labels||[],{xScale:i,yScale:s}=t,a=this.getParsed(e),o=i.getLabelForValue(a.x),c=s.getLabelForValue(a.y);return{label:r[e]||"",value:"("+o+", "+c+")"}}update(e){const t=this._cachedMeta,{data:r=[]}=t,i=this.chart._animationsDisabled;let{start:s,count:a}=sE(t,r,i);if(this._drawStart=s,this._drawCount=a,aE(t)&&(s=0,a=r.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:c}=t;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!c._decimated,o.points=r;const l=this.resolveDatasetElementOptions(e);l.segment=this.options.segment,this.updateElement(o,void 0,{animated:!i,options:l},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(r,s,a,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,r,i){const s=i==="reset",{iScale:a,vScale:o,_stacked:c,_dataset:l}=this._cachedMeta,u=this.resolveDataElementOptions(t,i),h=this.getSharedOptions(u),d=this.includeOptions(i,h),p=a.axis,g=o.axis,{spanGaps:m,segment:_}=this.options,E=xo(m)?m:Number.POSITIVE_INFINITY,I=this.chart._animationsDisabled||s||i==="none";let v=t>0&&this.getParsed(t-1);for(let R=t;R<t+r;++R){const F=e[R],O=this.getParsed(R),y=I?F:{},w=ze(O[g]),T=y[p]=a.getPixelForValue(O[p],R),S=y[g]=s||w?o.getBasePixel():o.getPixelForValue(c?this.applyStack(o,O,c):O[g],R);y.skip=isNaN(T)||isNaN(S)||w,y.stop=R>0&&Math.abs(O[p]-v[p])>E,_&&(y.parsed=O,y.raw=l.data[R]),d&&(y.options=h||this.resolveDataElementOptions(R,F.active?"active":i)),I||this.updateElement(F,R,y,i),v=O}this.updateSharedOptions(h,i,u)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let o=0;for(let c=t.length-1;c>=0;--c)o=Math.max(o,t[c].size(this.resolveDataElementOptions(c))/2);return o>0&&o}const r=e.dataset,i=r.options&&r.options.borderWidth||0;if(!t.length)return i;const s=t[0].size(this.resolveDataElementOptions(0)),a=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(i,s,a)/2}}var Lk=Object.freeze({__proto__:null,BarController:Ck,BubbleController:Rk,DoughnutController:Wp,LineController:Dk,PieController:Fk,PolarAreaController:IE,RadarController:Ok,ScatterController:Mk});function zs(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class jp{static override(e){Object.assign(jp.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return zs()}parse(){return zs()}format(){return zs()}add(){return zs()}diff(){return zs()}startOf(){return zs()}endOf(){return zs()}}var Nk={_date:jp};function Vk(n,e,t,r){const{controller:i,data:s,_sorted:a}=n,o=i._cachedMeta.iScale,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(o&&e===o.axis&&e!=="r"&&a&&s.length){const l=o._reversePixels?eS:li;if(r){if(i._sharedOptions){const u=s[0],h=typeof u.getRange=="function"&&u.getRange(e);if(h){const d=l(s,e,t-h),p=l(s,e,t+h);return{lo:d.lo,hi:p.hi}}}}else{const u=l(s,e,t);if(c){const{vScale:h}=i._cachedMeta,{_parsed:d}=n,p=d.slice(0,u.lo+1).reverse().findIndex(m=>!ze(m[h.axis]));u.lo-=Math.max(0,p);const g=d.slice(u.hi).findIndex(m=>!ze(m[h.axis]));u.hi+=Math.max(0,g)}return u}}return{lo:0,hi:s.length-1}}function Lf(n,e,t,r,i){const s=n.getSortedVisibleDatasetMetas(),a=t[e];for(let o=0,c=s.length;o<c;++o){const{index:l,data:u}=s[o],{lo:h,hi:d}=Vk(s[o],e,a,i);for(let p=h;p<=d;++p){const g=u[p];g.skip||r(g,l,p)}}}function Bk(n){const e=n.indexOf("x")!==-1,t=n.indexOf("y")!==-1;return function(r,i){const s=e?Math.abs(r.x-i.x):0,a=t?Math.abs(r.y-i.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))}}function Md(n,e,t,r,i){const s=[];return!i&&!n.isPointInArea(e)||Lf(n,t,e,function(o,c,l){!i&&!ui(o,n.chartArea,0)||o.inRange(e.x,e.y,r)&&s.push({element:o,datasetIndex:c,index:l})},!0),s}function Uk(n,e,t,r){let i=[];function s(a,o,c){const{startAngle:l,endAngle:u}=a.getProps(["startAngle","endAngle"],r),{angle:h}=eE(a,{x:e.x,y:e.y});vl(h,l,u)&&i.push({element:a,datasetIndex:o,index:c})}return Lf(n,t,e,s),i}function Hk(n,e,t,r,i,s){let a=[];const o=Bk(t);let c=Number.POSITIVE_INFINITY;function l(u,h,d){const p=u.inRange(e.x,e.y,i);if(r&&!p)return;const g=u.getCenterPoint(i);if(!(!!s||n.isPointInArea(g))&&!p)return;const _=o(e,g);_<c?(a=[{element:u,datasetIndex:h,index:d}],c=_):_===c&&a.push({element:u,datasetIndex:h,index:d})}return Lf(n,t,e,l),a}function Ld(n,e,t,r,i,s){return!s&&!n.isPointInArea(e)?[]:t==="r"&&!r?Uk(n,e,t,i):Hk(n,e,t,r,i,s)}function U1(n,e,t,r,i){const s=[],a=t==="x"?"inXRange":"inYRange";let o=!1;return Lf(n,t,e,(c,l,u)=>{c[a]&&c[a](e[t],i)&&(s.push({element:c,datasetIndex:l,index:u}),o=o||c.inRange(e.x,e.y,i))}),r&&!o?[]:s}var zk={modes:{index(n,e,t,r){const i=js(e,n),s=t.axis||"x",a=t.includeInvisible||!1,o=t.intersect?Md(n,i,s,r,a):Ld(n,i,s,!1,r,a),c=[];return o.length?(n.getSortedVisibleDatasetMetas().forEach(l=>{const u=o[0].index,h=l.data[u];h&&!h.skip&&c.push({element:h,datasetIndex:l.index,index:u})}),c):[]},dataset(n,e,t,r){const i=js(e,n),s=t.axis||"xy",a=t.includeInvisible||!1;let o=t.intersect?Md(n,i,s,r,a):Ld(n,i,s,!1,r,a);if(o.length>0){const c=o[0].datasetIndex,l=n.getDatasetMeta(c).data;o=[];for(let u=0;u<l.length;++u)o.push({element:l[u],datasetIndex:c,index:u})}return o},point(n,e,t,r){const i=js(e,n),s=t.axis||"xy",a=t.includeInvisible||!1;return Md(n,i,s,r,a)},nearest(n,e,t,r){const i=js(e,n),s=t.axis||"xy",a=t.includeInvisible||!1;return Ld(n,i,s,t.intersect,r,a)},x(n,e,t,r){const i=js(e,n);return U1(n,i,"x",t.intersect,r)},y(n,e,t,r){const i=js(e,n);return U1(n,i,"y",t.intersect,r)}}};const AE=["left","top","right","bottom"];function mc(n,e){return n.filter(t=>t.pos===e)}function H1(n,e){return n.filter(t=>AE.indexOf(t.pos)===-1&&t.box.axis===e)}function _c(n,e){return n.sort((t,r)=>{const i=e?r:t,s=e?t:r;return i.weight===s.weight?i.index-s.index:i.weight-s.weight})}function $k(n){const e=[];let t,r,i,s,a,o;for(t=0,r=(n||[]).length;t<r;++t)i=n[t],{position:s,options:{stack:a,stackWeight:o=1}}=i,e.push({index:t,box:i,pos:s,horizontal:i.isHorizontal(),weight:i.weight,stack:a&&s+a,stackWeight:o});return e}function Wk(n){const e={};for(const t of n){const{stack:r,pos:i,stackWeight:s}=t;if(!r||!AE.includes(i))continue;const a=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=s}return e}function jk(n,e){const t=Wk(n),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let s,a,o;for(s=0,a=n.length;s<a;++s){o=n[s];const{fullSize:c}=o.box,l=t[o.stack],u=l&&o.stackWeight/l.weight;o.horizontal?(o.width=u?u*r:c&&e.availableWidth,o.height=i):(o.width=r,o.height=u?u*i:c&&e.availableHeight)}return t}function Gk(n){const e=$k(n),t=_c(e.filter(l=>l.box.fullSize),!0),r=_c(mc(e,"left"),!0),i=_c(mc(e,"right")),s=_c(mc(e,"top"),!0),a=_c(mc(e,"bottom")),o=H1(e,"x"),c=H1(e,"y");return{fullSize:t,leftAndTop:r.concat(s),rightAndBottom:i.concat(c).concat(a).concat(o),chartArea:mc(e,"chartArea"),vertical:r.concat(i).concat(c),horizontal:s.concat(a).concat(o)}}function z1(n,e,t,r){return Math.max(n[t],e[t])+Math.max(n[r],e[r])}function SE(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function qk(n,e,t,r){const{pos:i,box:s}=t,a=n.maxPadding;if(!We(i)){t.size&&(n[i]-=t.size);const h=r[t.stack]||{size:0,count:1};h.size=Math.max(h.size,t.horizontal?s.height:s.width),t.size=h.size/h.count,n[i]+=t.size}s.getPadding&&SE(a,s.getPadding());const o=Math.max(0,e.outerWidth-z1(a,n,"left","right")),c=Math.max(0,e.outerHeight-z1(a,n,"top","bottom")),l=o!==n.w,u=c!==n.h;return n.w=o,n.h=c,t.horizontal?{same:l,other:u}:{same:u,other:l}}function Kk(n){const e=n.maxPadding;function t(r){const i=Math.max(e[r]-n[r],0);return n[r]+=i,i}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}function Yk(n,e){const t=e.maxPadding;function r(i){const s={left:0,top:0,right:0,bottom:0};return i.forEach(a=>{s[a]=Math.max(e[a],t[a])}),s}return r(n?["left","right"]:["top","bottom"])}function Rc(n,e,t,r){const i=[];let s,a,o,c,l,u;for(s=0,a=n.length,l=0;s<a;++s){o=n[s],c=o.box,c.update(o.width||e.w,o.height||e.h,Yk(o.horizontal,e));const{same:h,other:d}=qk(e,t,o,r);l|=h&&i.length,u=u||d,c.fullSize||i.push(o)}return l&&Rc(i,e,t,r)||u}function zu(n,e,t,r,i){n.top=t,n.left=e,n.right=e+r,n.bottom=t+i,n.width=r,n.height=i}function $1(n,e,t,r){const i=t.padding;let{x:s,y:a}=e;for(const o of n){const c=o.box,l=r[o.stack]||{placed:0,weight:1},u=o.stackWeight/l.weight||1;if(o.horizontal){const h=e.w*u,d=l.size||c.height;yl(l.start)&&(a=l.start),c.fullSize?zu(c,i.left,a,t.outerWidth-i.right-i.left,d):zu(c,e.left+l.placed,a,h,d),l.start=a,l.placed+=h,a=c.bottom}else{const h=e.h*u,d=l.size||c.width;yl(l.start)&&(s=l.start),c.fullSize?zu(c,s,i.top,d,t.outerHeight-i.bottom-i.top):zu(c,s,e.top+l.placed,d,h),l.start=s,l.placed+=h,s=c.right}}e.x=s,e.y=a}var Tn={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;t!==-1&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,r){if(!n)return;const i=kn(n.options.layout.padding),s=Math.max(e-i.width,0),a=Math.max(t-i.height,0),o=Gk(n.boxes),c=o.vertical,l=o.horizontal;it(n.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const u=c.reduce((m,_)=>_.box.options&&_.box.options.display===!1?m:m+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:t,padding:i,availableWidth:s,availableHeight:a,vBoxMaxWidth:s/2/u,hBoxMaxHeight:a/2}),d=Object.assign({},i);SE(d,kn(r));const p=Object.assign({maxPadding:d,w:s,h:a,x:i.left,y:i.top},i),g=jk(c.concat(l),h);Rc(o.fullSize,p,h,g),Rc(c,p,h,g),Rc(l,p,h,g)&&Rc(c,p,h,g),Kk(p),$1(o.leftAndTop,p,h,g),p.x+=p.w,p.y+=p.h,$1(o.rightAndBottom,p,h,g),n.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},it(o.chartArea,m=>{const _=m.box;Object.assign(_,n.chartArea),_.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class kE{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,r){}removeEventListener(e,t,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,r,i){return t=Math.max(0,t||e.width),r=r||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):r)}}isAttached(e){return!0}updateConfig(e){}}class Xk extends kE{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const ph="$chartjs",Qk={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},W1=n=>n===null||n==="";function Jk(n,e){const t=n.style,r=n.getAttribute("height"),i=n.getAttribute("width");if(n[ph]={initial:{height:r,width:i,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",W1(i)){const s=S1(n,"width");s!==void 0&&(n.width=s)}if(W1(r))if(n.style.height==="")n.height=n.width/(e||2);else{const s=S1(n,"height");s!==void 0&&(n.height=s)}return n}const CE=qS?{passive:!0}:!1;function Zk(n,e,t){n&&n.addEventListener(e,t,CE)}function eC(n,e,t){n&&n.canvas&&n.canvas.removeEventListener(e,t,CE)}function tC(n,e){const t=Qk[n.type]||n.type,{x:r,y:i}=js(n,e);return{type:t,chart:e,native:n,x:r!==void 0?r:null,y:i!==void 0?i:null}}function Vh(n,e){for(const t of n)if(t===e||t.contains(e))return!0}function nC(n,e,t){const r=n.canvas,i=new MutationObserver(s=>{let a=!1;for(const o of s)a=a||Vh(o.addedNodes,r),a=a&&!Vh(o.removedNodes,r);a&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}function rC(n,e,t){const r=n.canvas,i=new MutationObserver(s=>{let a=!1;for(const o of s)a=a||Vh(o.removedNodes,r),a=a&&!Vh(o.addedNodes,r);a&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}const wl=new Map;let j1=0;function RE(){const n=window.devicePixelRatio;n!==j1&&(j1=n,wl.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function iC(n,e){wl.size||window.addEventListener("resize",RE),wl.set(n,e)}function sC(n){wl.delete(n),wl.size||window.removeEventListener("resize",RE)}function aC(n,e,t){const r=n.canvas,i=r&&$p(r);if(!i)return;const s=iE((o,c)=>{const l=i.clientWidth;t(o,c),l<i.clientWidth&&t()},window),a=new ResizeObserver(o=>{const c=o[0],l=c.contentRect.width,u=c.contentRect.height;l===0&&u===0||s(l,u)});return a.observe(i),iC(n,s),a}function Nd(n,e,t){t&&t.disconnect(),e==="resize"&&sC(n)}function oC(n,e,t){const r=n.canvas,i=iE(s=>{n.ctx!==null&&t(tC(s,n))},n);return Zk(r,e,i),i}class cC extends kE{acquireContext(e,t){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(Jk(e,t),r):null}releaseContext(e){const t=e.canvas;if(!t[ph])return!1;const r=t[ph].initial;["height","width"].forEach(s=>{const a=r[s];ze(a)?t.removeAttribute(s):t.setAttribute(s,a)});const i=r.style||{};return Object.keys(i).forEach(s=>{t.style[s]=i[s]}),t.width=t.width,delete t[ph],!0}addEventListener(e,t,r){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),a={attach:nC,detach:rC,resize:aC}[t]||oC;i[t]=a(e,t,r)}removeEventListener(e,t){const r=e.$proxies||(e.$proxies={}),i=r[t];if(!i)return;({attach:Nd,detach:Nd,resize:Nd}[t]||eC)(e,t,i),r[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,r,i){return GS(e,t,r,i)}isAttached(e){const t=e&&$p(e);return!!(t&&t.isConnected)}}function lC(n){return!zp()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Xk:cC}class Ii{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}hasValue(){return xo(this.x)&&xo(this.y)}getProps(e,t){const r=this.$animations;if(!t||!r)return this;const i={};return e.forEach(s=>{i[s]=r[s]&&r[s].active()?r[s]._to:this[s]}),i}}function uC(n,e){const t=n.options.ticks,r=hC(n),i=Math.min(t.maxTicksLimit||r,r),s=t.major.enabled?dC(e):[],a=s.length,o=s[0],c=s[a-1],l=[];if(a>i)return pC(e,l,s,a/i),l;const u=fC(s,e,i);if(a>0){let h,d;const p=a>1?Math.round((c-o)/(a-1)):null;for($u(e,l,u,ze(p)?0:o-p,o),h=0,d=a-1;h<d;h++)$u(e,l,u,s[h],s[h+1]);return $u(e,l,u,c,ze(p)?e.length:c+p),l}return $u(e,l,u),l}function hC(n){const e=n.options.offset,t=n._tickSize(),r=n._length/t+(e?0:1),i=n._maxLength/t;return Math.floor(Math.min(r,i))}function fC(n,e,t){const r=gC(n),i=e.length/t;if(!r)return Math.max(i,1);const s=YA(r);for(let a=0,o=s.length-1;a<o;a++){const c=s[a];if(c>i)return c}return Math.max(i,1)}function dC(n){const e=[];let t,r;for(t=0,r=n.length;t<r;t++)n[t].major&&e.push(t);return e}function pC(n,e,t,r){let i=0,s=t[0],a;for(r=Math.ceil(r),a=0;a<n.length;a++)a===s&&(e.push(n[a]),i++,s=t[i*r])}function $u(n,e,t,r,i){const s=Le(r,0),a=Math.min(Le(i,n.length),n.length);let o=0,c,l,u;for(t=Math.ceil(t),i&&(c=i-r,t=c/Math.floor(c/t)),u=s;u<0;)o++,u=Math.round(s+o*t);for(l=Math.max(s,0);l<a;l++)l===u&&(e.push(n[l]),o++,u=Math.round(s+o*t))}function gC(n){const e=n.length;let t,r;if(e<2)return!1;for(r=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==r)return!1;return r}const mC=n=>n==="left"?"right":n==="right"?"left":n,G1=(n,e,t)=>e==="top"||e==="left"?n[e]+t:n[e]-t,q1=(n,e)=>Math.min(e||n,n);function K1(n,e){const t=[],r=n.length/e,i=n.length;let s=0;for(;s<i;s+=r)t.push(n[Math.floor(s)]);return t}function _C(n,e,t){const r=n.ticks.length,i=Math.min(e,r-1),s=n._startPixel,a=n._endPixel,o=1e-6;let c=n.getPixelForTick(i),l;if(!(t&&(r===1?l=Math.max(c-s,a-c):e===0?l=(n.getPixelForTick(1)-c)/2:l=(c-n.getPixelForTick(i-1))/2,c+=i<e?l:-l,c<s-o||c>a+o)))return c}function xC(n,e){it(n,t=>{const r=t.gc,i=r.length/2;let s;if(i>e){for(s=0;s<i;++s)delete t.data[r[s]];r.splice(0,i)}})}function xc(n){return n.drawTicks?n.tickLength:0}function Y1(n,e){if(!n.display)return 0;const t=Kt(n.font,e),r=kn(n.padding);return(It(n.text)?n.text.length:1)*t.lineHeight+r.height}function yC(n,e){return ws(n,{scale:e,type:"scale"})}function vC(n,e,t){return ws(n,{tick:t,index:e,type:"tick"})}function EC(n,e,t){let r=Lp(n);return(t&&e!=="right"||!t&&e==="right")&&(r=mC(r)),r}function wC(n,e,t,r){const{top:i,left:s,bottom:a,right:o,chart:c}=n,{chartArea:l,scales:u}=c;let h=0,d,p,g;const m=a-i,_=o-s;if(n.isHorizontal()){if(p=gn(r,s,o),We(t)){const E=Object.keys(t)[0],I=t[E];g=u[E].getPixelForValue(I)+m-e}else t==="center"?g=(l.bottom+l.top)/2+m-e:g=G1(n,t,e);d=o-s}else{if(We(t)){const E=Object.keys(t)[0],I=t[E];p=u[E].getPixelForValue(I)-_+e}else t==="center"?p=(l.left+l.right)/2-_+e:p=G1(n,t,e);g=gn(r,a,i),h=t==="left"?-Lt:Lt}return{titleX:p,titleY:g,maxWidth:d,rotation:h}}class Ca extends Ii{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:r,_suggestedMax:i}=this;return e=Kn(e,Number.POSITIVE_INFINITY),t=Kn(t,Number.NEGATIVE_INFINITY),r=Kn(r,Number.POSITIVE_INFINITY),i=Kn(i,Number.NEGATIVE_INFINITY),{min:Kn(e,r),max:Kn(t,i),minDefined:Dt(e),maxDefined:Dt(t)}}getMinMax(e){let{min:t,max:r,minDefined:i,maxDefined:s}=this.getUserBounds(),a;if(i&&s)return{min:t,max:r};const o=this.getMatchingVisibleMetas();for(let c=0,l=o.length;c<l;++c)a=o[c].controller.getMinMax(this,e),i||(t=Math.min(t,a.min)),s||(r=Math.max(r,a.max));return t=s&&t>r?r:t,r=i&&t>r?t:r,{min:Kn(t,Kn(r,t)),max:Kn(r,Kn(t,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ft(this.options.beforeUpdate,[this])}update(e,t,r){const{beginAtZero:i,grace:s,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=bS(this,s,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=o<this.ticks.length;this._convertTicksToLabels(c?K1(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=uC(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,r;this.isHorizontal()?(t=this.left,r=this.right):(t=this.top,r=this.bottom,e=!e),this._startPixel=t,this._endPixel=r,this._reversePixels=e,this._length=r-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ft(this.options.afterUpdate,[this])}beforeSetDimensions(){ft(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ft(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),ft(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ft(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let r,i,s;for(r=0,i=e.length;r<i;r++)s=e[r],s.label=ft(t.callback,[s.value,r,e],this)}afterTickToLabelConversion(){ft(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ft(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,r=q1(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,s=t.maxRotation;let a=i,o,c,l;if(!this._isVisible()||!t.display||i>=s||r<=1||!this.isHorizontal()){this.labelRotation=i;return}const u=this._getLabelSizes(),h=u.widest.width,d=u.highest.height,p=sn(this.chart.width-h,0,this.maxWidth);o=e.offset?this.maxWidth/r:p/(r-1),h+6>o&&(o=p/(r-(e.offset?.5:1)),c=this.maxHeight-xc(e.grid)-t.padding-Y1(e.title,this.chart.options.font),l=Math.sqrt(h*h+d*d),a=Op(Math.min(Math.asin(sn((u.highest.height+6)/o,-1,1)),Math.asin(sn(c/l,-1,1))-Math.asin(sn(d/l,-1,1)))),a=Math.max(i,Math.min(s,a))),this.labelRotation=a}afterCalculateLabelRotation(){ft(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ft(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:r,title:i,grid:s}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const c=Y1(i,t.options.font);if(o?(e.width=this.maxWidth,e.height=xc(s)+c):(e.height=this.maxHeight,e.width=xc(s)+c),r.display&&this.ticks.length){const{first:l,last:u,widest:h,highest:d}=this._getLabelSizes(),p=r.padding*2,g=Er(this.labelRotation),m=Math.cos(g),_=Math.sin(g);if(o){const E=r.mirror?0:_*h.width+m*d.height;e.height=Math.min(this.maxHeight,e.height+E+p)}else{const E=r.mirror?0:m*h.width+_*d.height;e.width=Math.min(this.maxWidth,e.width+E+p)}this._calculatePadding(l,u,_,m)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,r,i){const{ticks:{align:s,padding:a},position:o}=this.options,c=this.labelRotation!==0,l=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,p=0;c?l?(d=i*e.width,p=r*t.height):(d=r*e.height,p=i*t.width):s==="start"?p=t.width:s==="end"?d=e.width:s!=="inner"&&(d=e.width/2,p=t.width/2),this.paddingLeft=Math.max((d-u+a)*this.width/(this.width-u),0),this.paddingRight=Math.max((p-h+a)*this.width/(this.width-h),0)}else{let u=t.height/2,h=e.height/2;s==="start"?(u=0,h=e.height):s==="end"&&(u=t.height,h=0),this.paddingTop=u+a,this.paddingBottom=h+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ft(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,r;for(t=0,r=e.length;t<r;t++)ze(e[t].label)&&(e.splice(t,1),r--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let r=this.ticks;t<r.length&&(r=K1(r,t)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,r){const{ctx:i,_longestTextCache:s}=this,a=[],o=[],c=Math.floor(t/q1(t,r));let l=0,u=0,h,d,p,g,m,_,E,I,v,R,F;for(h=0;h<t;h+=c){if(g=e[h].label,m=this._resolveTickFontOptions(h),i.font=_=m.string,E=s[_]=s[_]||{data:{},gc:[]},I=m.lineHeight,v=R=0,!ze(g)&&!It(g))v=Lh(i,E.data,E.gc,v,g),R=I;else if(It(g))for(d=0,p=g.length;d<p;++d)F=g[d],!ze(F)&&!It(F)&&(v=Lh(i,E.data,E.gc,v,F),R+=I);a.push(v),o.push(R),l=Math.max(v,l),u=Math.max(R,u)}xC(s,t);const O=a.indexOf(l),y=o.indexOf(u),w=T=>({width:a[T]||0,height:o[T]||0});return{first:w(0),last:w(t-1),widest:w(O),highest:w(y),widths:a,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return ZA(this._alignToPixels?Hs(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const r=t[e];return r.$context||(r.$context=vC(this.getContext(),e,r))}return this.$context||(this.$context=yC(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Er(this.labelRotation),r=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),s=this._getLabelSizes(),a=e.autoSkipPadding||0,o=s?s.widest.width+a:0,c=s?s.highest.height+a:0;return this.isHorizontal()?c*r>o*i?o/r:c/i:c*i<o*r?c/r:o/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,r=this.chart,i=this.options,{grid:s,position:a,border:o}=i,c=s.offset,l=this.isHorizontal(),h=this.ticks.length+(c?1:0),d=xc(s),p=[],g=o.setContext(this.getContext()),m=g.display?g.width:0,_=m/2,E=function(ue){return Hs(r,ue,m)};let I,v,R,F,O,y,w,T,S,A,k,D;if(a==="top")I=E(this.bottom),y=this.bottom-d,T=I-_,A=E(e.top)+_,D=e.bottom;else if(a==="bottom")I=E(this.top),A=e.top,D=E(e.bottom)-_,y=I+_,T=this.top+d;else if(a==="left")I=E(this.right),O=this.right-d,w=I-_,S=E(e.left)+_,k=e.right;else if(a==="right")I=E(this.left),S=e.left,k=E(e.right)-_,O=I+_,w=this.left+d;else if(t==="x"){if(a==="center")I=E((e.top+e.bottom)/2+.5);else if(We(a)){const ue=Object.keys(a)[0],he=a[ue];I=E(this.chart.scales[ue].getPixelForValue(he))}A=e.top,D=e.bottom,y=I+_,T=y+d}else if(t==="y"){if(a==="center")I=E((e.left+e.right)/2);else if(We(a)){const ue=Object.keys(a)[0],he=a[ue];I=E(this.chart.scales[ue].getPixelForValue(he))}O=I-_,w=O-d,S=e.left,k=e.right}const oe=Le(i.ticks.maxTicksLimit,h),ie=Math.max(1,Math.ceil(h/oe));for(v=0;v<h;v+=ie){const ue=this.getContext(v),he=s.setContext(ue),Oe=o.setContext(ue),K=he.lineWidth,Se=he.color,Ce=Oe.dash||[],z=Oe.dashOffset,Q=he.tickWidth,G=he.tickColor,j=he.tickBorderDash||[],se=he.tickBorderDashOffset;R=_C(this,v,c),R!==void 0&&(F=Hs(r,R,K),l?O=w=S=k=F:y=T=A=D=F,p.push({tx1:O,ty1:y,tx2:w,ty2:T,x1:S,y1:A,x2:k,y2:D,width:K,color:Se,borderDash:Ce,borderDashOffset:z,tickWidth:Q,tickColor:G,tickBorderDash:j,tickBorderDashOffset:se}))}return this._ticksLength=h,this._borderValue=I,p}_computeLabelItems(e){const t=this.axis,r=this.options,{position:i,ticks:s}=r,a=this.isHorizontal(),o=this.ticks,{align:c,crossAlign:l,padding:u,mirror:h}=s,d=xc(r.grid),p=d+u,g=h?-u:p,m=-Er(this.labelRotation),_=[];let E,I,v,R,F,O,y,w,T,S,A,k,D="middle";if(i==="top")O=this.bottom-g,y=this._getXAxisLabelAlignment();else if(i==="bottom")O=this.top+g,y=this._getXAxisLabelAlignment();else if(i==="left"){const ie=this._getYAxisLabelAlignment(d);y=ie.textAlign,F=ie.x}else if(i==="right"){const ie=this._getYAxisLabelAlignment(d);y=ie.textAlign,F=ie.x}else if(t==="x"){if(i==="center")O=(e.top+e.bottom)/2+p;else if(We(i)){const ie=Object.keys(i)[0],ue=i[ie];O=this.chart.scales[ie].getPixelForValue(ue)+p}y=this._getXAxisLabelAlignment()}else if(t==="y"){if(i==="center")F=(e.left+e.right)/2-p;else if(We(i)){const ie=Object.keys(i)[0],ue=i[ie];F=this.chart.scales[ie].getPixelForValue(ue)}y=this._getYAxisLabelAlignment(d).textAlign}t==="y"&&(c==="start"?D="top":c==="end"&&(D="bottom"));const oe=this._getLabelSizes();for(E=0,I=o.length;E<I;++E){v=o[E],R=v.label;const ie=s.setContext(this.getContext(E));w=this.getPixelForTick(E)+s.labelOffset,T=this._resolveTickFontOptions(E),S=T.lineHeight,A=It(R)?R.length:1;const ue=A/2,he=ie.color,Oe=ie.textStrokeColor,K=ie.textStrokeWidth;let Se=y;a?(F=w,y==="inner"&&(E===I-1?Se=this.options.reverse?"left":"right":E===0?Se=this.options.reverse?"right":"left":Se="center"),i==="top"?l==="near"||m!==0?k=-A*S+S/2:l==="center"?k=-oe.highest.height/2-ue*S+S:k=-oe.highest.height+S/2:l==="near"||m!==0?k=S/2:l==="center"?k=oe.highest.height/2-ue*S:k=oe.highest.height-A*S,h&&(k*=-1),m!==0&&!ie.showLabelBackdrop&&(F+=S/2*Math.sin(m))):(O=w,k=(1-A)*S/2);let Ce;if(ie.showLabelBackdrop){const z=kn(ie.backdropPadding),Q=oe.heights[E],G=oe.widths[E];let j=k-z.top,se=0-z.left;switch(D){case"middle":j-=Q/2;break;case"bottom":j-=Q;break}switch(y){case"center":se-=G/2;break;case"right":se-=G;break;case"inner":E===I-1?se-=G:E>0&&(se-=G/2);break}Ce={left:se,top:j,width:G+z.width,height:Q+z.height,color:ie.backdropColor}}_.push({label:R,font:T,textOffset:k,options:{rotation:m,color:he,strokeColor:Oe,strokeWidth:K,textAlign:Se,textBaseline:D,translation:[F,O],backdrop:Ce}})}return _}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Er(this.labelRotation))return e==="top"?"left":"right";let i="center";return t.align==="start"?i="left":t.align==="end"?i="right":t.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:r,mirror:i,padding:s}}=this.options,a=this._getLabelSizes(),o=e+s,c=a.widest.width;let l,u;return t==="left"?i?(u=this.right+s,r==="near"?l="left":r==="center"?(l="center",u+=c/2):(l="right",u+=c)):(u=this.right-o,r==="near"?l="right":r==="center"?(l="center",u-=c/2):(l="left",u=this.left)):t==="right"?i?(u=this.left+s,r==="near"?l="right":r==="center"?(l="center",u-=c/2):(l="left",u-=c)):(u=this.left+o,r==="near"?l="left":r==="center"?(l="center",u+=c/2):(l="right",u=this.right)):l="right",{textAlign:l,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:r,top:i,width:s,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(r,i,s,a),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex(s=>s.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const t=this.options.grid,r=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,a;const o=(c,l,u)=>{!u.width||!u.color||(r.save(),r.lineWidth=u.width,r.strokeStyle=u.color,r.setLineDash(u.borderDash||[]),r.lineDashOffset=u.borderDashOffset,r.beginPath(),r.moveTo(c.x,c.y),r.lineTo(l.x,l.y),r.stroke(),r.restore())};if(t.display)for(s=0,a=i.length;s<a;++s){const c=i[s];t.drawOnChartArea&&o({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),t.drawTicks&&o({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:r,grid:i}}=this,s=r.setContext(this.getContext()),a=r.display?s.width:0;if(!a)return;const o=i.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let l,u,h,d;this.isHorizontal()?(l=Hs(e,this.left,a)-a/2,u=Hs(e,this.right,o)+o/2,h=d=c):(h=Hs(e,this.top,a)-a/2,d=Hs(e,this.bottom,o)+o/2,l=u=c),t.save(),t.lineWidth=s.width,t.strokeStyle=s.color,t.beginPath(),t.moveTo(l,h),t.lineTo(u,d),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,i=this._computeLabelArea();i&&Ff(r,i);const s=this.getLabelItems(e);for(const a of s){const o=a.options,c=a.font,l=a.label,u=a.textOffset;da(r,l,0,u,c,o)}i&&Of(r)}drawTitle(){const{ctx:e,options:{position:t,title:r,reverse:i}}=this;if(!r.display)return;const s=Kt(r.font),a=kn(r.padding),o=r.align;let c=s.lineHeight/2;t==="bottom"||t==="center"||We(t)?(c+=a.bottom,It(r.text)&&(c+=s.lineHeight*(r.text.length-1))):c+=a.top;const{titleX:l,titleY:u,maxWidth:h,rotation:d}=wC(this,c,t,o);da(e,r.text,0,0,s,{color:r.color,maxWidth:h,rotation:d,textAlign:EC(o,t,i),textBaseline:"middle",translation:[l,u]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,r=Le(e.grid&&e.grid.z,-1),i=Le(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Ca.prototype.draw?[{z:t,draw:s=>{this.draw(s)}}]:[{z:r,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",i=[];let s,a;for(s=0,a=t.length;s<a;++s){const o=t[s];o[r]===this.id&&(!e||o.type===e)&&i.push(o)}return i}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return Kt(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Wu{constructor(e,t,r){this.type=e,this.scope=t,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let r;IC(t)&&(r=this.register(t));const i=this.items,s=e.id,a=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in i||(i[s]=e,TC(e,a,r),this.override&&At.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const t=this.items,r=e.id,i=this.scope;r in t&&delete t[r],i&&r in At[i]&&(delete At[i][r],this.override&&delete fa[r])}}function TC(n,e,t){const r=xl(Object.create(null),[t?At.get(t):{},At.get(e),n.defaults]);At.set(e,r),n.defaultRoutes&&bC(e,n.defaultRoutes),n.descriptors&&At.describe(e,n.descriptors)}function bC(n,e){Object.keys(e).forEach(t=>{const r=t.split("."),i=r.pop(),s=[n].concat(r).join("."),a=e[t].split("."),o=a.pop(),c=a.join(".");At.route(s,i,c,o)})}function IC(n){return"id"in n&&"defaults"in n}class AC{constructor(){this.controllers=new Wu(Ts,"datasets",!0),this.elements=new Wu(Ii,"elements"),this.plugins=new Wu(Object,"plugins"),this.scales=new Wu(Ca,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,r){[...t].forEach(i=>{const s=r||this._getRegistryForType(i);r||s.isForType(i)||s===this.plugins&&i.id?this._exec(e,s,i):it(i,a=>{const o=r||this._getRegistryForType(a);this._exec(e,o,a)})})}_exec(e,t,r){const i=Fp(e);ft(r["before"+i],[],r),t[e](r),ft(r["after"+i],[],r)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const r=this._typedRegistries[t];if(r.isForType(e))return r}return this.plugins}_get(e,t,r){const i=t.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return i}}var Mr=new AC;class SC{constructor(){this._init=void 0}notify(e,t,r,i){if(t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),this._init===void 0)return;const s=i?this._descriptors(e).filter(i):this._descriptors(e),a=this._notify(s,e,t,r);return t==="afterDestroy"&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),a}_notify(e,t,r,i){i=i||{};for(const s of e){const a=s.plugin,o=a[r],c=[t,i,s.options];if(ft(o,c,a)===!1&&i.cancelable)return!1}return!0}invalidate(){ze(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const r=e&&e.config,i=Le(r.options&&r.options.plugins,{}),s=kC(r);return i===!1&&!t?[]:RC(e,s,i,t)}_notifyStateChanges(e){const t=this._oldCache||[],r=this._cache,i=(s,a)=>s.filter(o=>!a.some(c=>o.plugin.id===c.plugin.id));this._notify(i(t,r),e,"stop"),this._notify(i(r,t),e,"start")}}function kC(n){const e={},t=[],r=Object.keys(Mr.plugins.items);for(let s=0;s<r.length;s++)t.push(Mr.getPlugin(r[s]));const i=n.plugins||[];for(let s=0;s<i.length;s++){const a=i[s];t.indexOf(a)===-1&&(t.push(a),e[a.id]=!0)}return{plugins:t,localIds:e}}function CC(n,e){return!e&&n===!1?null:n===!0?{}:n}function RC(n,{plugins:e,localIds:t},r,i){const s=[],a=n.getContext();for(const o of e){const c=o.id,l=CC(r[c],i);l!==null&&s.push({plugin:o,options:PC(n.config,{plugin:o,local:t[c]},l,a)})}return s}function PC(n,{plugin:e,local:t},r,i){const s=n.pluginScopeKeys(e),a=n.getOptionScopes(r,s);return t&&e.defaults&&a.push(e.defaults),n.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function I0(n,e){const t=At.datasets[n]||{};return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function DC(n,e){let t=n;return n==="_index_"?t=e:n==="_value_"&&(t=e==="x"?"y":"x"),t}function FC(n,e){return n===e?"_index_":"_value_"}function X1(n){if(n==="x"||n==="y"||n==="r")return n}function OC(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function A0(n,...e){if(X1(n))return n;for(const t of e){const r=t.axis||OC(t.position)||n.length>1&&X1(n[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function Q1(n,e,t){if(t[e+"AxisID"]===n)return{axis:e}}function MC(n,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(r=>r.xAxisID===n||r.yAxisID===n);if(t.length)return Q1(n,"x",t[0])||Q1(n,"y",t[0])}return{}}function LC(n,e){const t=fa[n.type]||{scales:{}},r=e.scales||{},i=I0(n.type,e),s=Object.create(null);return Object.keys(r).forEach(a=>{const o=r[a];if(!We(o))return console.error(`Invalid scale configuration for scale: ${a}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const c=A0(a,o,MC(a,n),At.scales[o.type]),l=FC(c,i),u=t.scales||{};s[a]=Wc(Object.create(null),[{axis:c},o,u[c],u[l]])}),n.data.datasets.forEach(a=>{const o=a.type||n.type,c=a.indexAxis||I0(o,e),u=(fa[o]||{}).scales||{};Object.keys(u).forEach(h=>{const d=DC(h,c),p=a[d+"AxisID"]||d;s[p]=s[p]||Object.create(null),Wc(s[p],[{axis:d},r[p],u[h]])})}),Object.keys(s).forEach(a=>{const o=s[a];Wc(o,[At.scales[o.type],At.scale])}),s}function PE(n){const e=n.options||(n.options={});e.plugins=Le(e.plugins,{}),e.scales=LC(n,e)}function DE(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function NC(n){return n=n||{},n.data=DE(n.data),PE(n),n}const J1=new Map,FE=new Set;function ju(n,e){let t=J1.get(n);return t||(t=e(),J1.set(n,t),FE.add(t)),t}const yc=(n,e,t)=>{const r=ds(e,t);r!==void 0&&n.add(r)};class VC{constructor(e){this._config=NC(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=DE(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),PE(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return ju(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return ju(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return ju(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,r=this.type;return ju(`${r}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const r=this._scopeCache;let i=r.get(e);return(!i||t)&&(i=new Map,r.set(e,i)),i}getOptionScopes(e,t,r){const{options:i,type:s}=this,a=this._cachedScopes(e,r),o=a.get(t);if(o)return o;const c=new Set;t.forEach(u=>{e&&(c.add(e),u.forEach(h=>yc(c,e,h))),u.forEach(h=>yc(c,i,h)),u.forEach(h=>yc(c,fa[s]||{},h)),u.forEach(h=>yc(c,At,h)),u.forEach(h=>yc(c,T0,h))});const l=Array.from(c);return l.length===0&&l.push(Object.create(null)),FE.has(t)&&a.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,fa[t]||{},At.datasets[t]||{},{type:t},At,T0]}resolveNamedOptions(e,t,r,i=[""]){const s={$shared:!0},{resolver:a,subPrefixes:o}=Z1(this._resolverCache,e,i);let c=a;if(UC(a,t)){s.$shared=!1,r=ps(r)?r():r;const l=this.createResolver(e,r,o);c=yo(a,r,l)}for(const l of t)s[l]=c[l];return s}createResolver(e,t,r=[""],i){const{resolver:s}=Z1(this._resolverCache,e,r);return We(t)?yo(s,t,void 0,i):s}}function Z1(n,e,t){let r=n.get(e);r||(r=new Map,n.set(e,r));const i=t.join();let s=r.get(i);return s||(s={resolver:Bp(e,t),subPrefixes:t.filter(o=>!o.toLowerCase().includes("hover"))},r.set(i,s)),s}const BC=n=>We(n)&&Object.getOwnPropertyNames(n).some(e=>ps(n[e]));function UC(n,e){const{isScriptable:t,isIndexable:r}=uE(n);for(const i of e){const s=t(i),a=r(i),o=(a||s)&&n[i];if(s&&(ps(o)||BC(o))||a&&It(o))return!0}return!1}var HC="4.5.1";const zC=["top","bottom","left","right","chartArea"];function e_(n,e){return n==="top"||n==="bottom"||zC.indexOf(n)===-1&&e==="x"}function t_(n,e){return function(t,r){return t[n]===r[n]?t[e]-r[e]:t[n]-r[n]}}function n_(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),ft(t&&t.onComplete,[n],e)}function $C(n){const e=n.chart,t=e.options.animation;ft(t&&t.onProgress,[n],e)}function OE(n){return zp()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const gh={},r_=n=>{const e=OE(n);return Object.values(gh).filter(t=>t.canvas===e).pop()};function WC(n,e,t){const r=Object.keys(n);for(const i of r){const s=+i;if(s>=e){const a=n[i];delete n[i],(t>0||s>e)&&(n[s+t]=a)}}}function jC(n,e,t,r){return!t||n.type==="mouseout"?null:r?e:n}class Gp{static defaults=At;static instances=gh;static overrides=fa;static registry=Mr;static version=HC;static getChart=r_;static register(...e){Mr.add(...e),i_()}static unregister(...e){Mr.remove(...e),i_()}constructor(e,t){const r=this.config=new VC(t),i=OE(e),s=r_(i);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const a=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||lC(i)),this.platform.updateConfig(r);const o=this.platform.acquireContext(i,a.aspectRatio),c=o&&o.canvas,l=c&&c.height,u=c&&c.width;if(this.id=UA(),this.ctx=o,this.canvas=c,this.width=u,this.height=l,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new SC,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=rS(h=>this.update(h),a.resizeDelay||0),this._dataChanges=[],gh[this.id]=this,!o||!c){console.error("Failed to create chart: can't acquire context from the given item");return}ii.listen(this,"complete",n_),ii.listen(this,"progress",$C),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:r,height:i,_aspectRatio:s}=this;return ze(e)?t&&s?s:i?r/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Mr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():A1(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return T1(this.canvas,this.ctx),this}stop(){return ii.stop(this),this}resize(e,t){ii.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const r=this.options,i=this.canvas,s=r.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(i,e,t,s),o=r.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,A1(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),ft(r.onResize,[this,a],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};it(t,(r,i)=>{r.id=i})}buildOrUpdateScales(){const e=this.options,t=e.scales,r=this.scales,i=Object.keys(r).reduce((a,o)=>(a[o]=!1,a),{});let s=[];t&&(s=s.concat(Object.keys(t).map(a=>{const o=t[a],c=A0(a,o),l=c==="r",u=c==="x";return{options:o,dposition:l?"chartArea":u?"bottom":"left",dtype:l?"radialLinear":u?"category":"linear"}}))),it(s,a=>{const o=a.options,c=o.id,l=A0(c,o),u=Le(o.type,a.dtype);(o.position===void 0||e_(o.position,l)!==e_(a.dposition))&&(o.position=a.dposition),i[c]=!0;let h=null;if(c in r&&r[c].type===u)h=r[c];else{const d=Mr.getScale(u);h=new d({id:c,type:u,ctx:this.ctx,chart:this}),r[h.id]=h}h.init(o,e)}),it(i,(a,o)=>{a||delete r[o]}),it(r,a=>{Tn.configure(this,a,a.options),Tn.addBox(this,a)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,r=e.length;if(e.sort((i,s)=>i.index-s.index),r>t){for(let i=t;i<r;++i)this._destroyDatasetMeta(i);e.splice(t,r-t)}this._sortedMetasets=e.slice(0).sort(t_("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((r,i)=>{t.filter(s=>s===r._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let r,i;for(this._removeUnreferencedMetasets(),r=0,i=t.length;r<i;r++){const s=t[r];let a=this.getDatasetMeta(r);const o=s.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(r),a=this.getDatasetMeta(r)),a.type=o,a.indexAxis=s.indexAxis||I0(o,this.options),a.order=s.order||0,a.index=r,a.label=""+s.label,a.visible=this.isDatasetVisible(r),a.controller)a.controller.updateIndex(r),a.controller.linkScales();else{const c=Mr.getController(o),{datasetElementType:l,dataElementType:u}=At.datasets[o];Object.assign(c,{dataElementType:Mr.getElement(u),datasetElementType:l&&Mr.getElement(l)}),a.controller=new c(this,r),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){it(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const r=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let l=0,u=this.data.datasets.length;l<u;l++){const{controller:h}=this.getDatasetMeta(l),d=!i&&s.indexOf(h)===-1;h.buildOrUpdateElements(d),a=Math.max(+h.getMaxOverflow(),a)}a=this._minPadding=r.layout.autoPadding?a:0,this._updateLayout(a),i||it(s,l=>{l.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(t_("z","_idx"));const{_active:o,_lastEvent:c}=this;c?this._eventHandler(c,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){it(this.scales,e=>{Tn.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!p1(t,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:r,start:i,count:s}of t){const a=r==="_removeElements"?-s:s;WC(e,i,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,r=s=>new Set(e.filter(a=>a[0]===s).map((a,o)=>o+","+a.splice(1).join(","))),i=r(0);for(let s=1;s<t;s++)if(!p1(i,r(s)))return;return Array.from(i).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Tn.update(this,this.width,this.height,e);const t=this.chartArea,r=t.width<=0||t.height<=0;this._layers=[],it(this.boxes,i=>{r&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,s)=>{i._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,r=this.data.datasets.length;t<r;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,r=this.data.datasets.length;t<r;++t)this._updateDataset(t,ps(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const r=this.getDatasetMeta(e),i={meta:r,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(r.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ii.has(this)?this.attached&&!ii.running(this)&&ii.start(this):(this.draw(),n_({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,r=[];let i,s;for(i=0,s=t.length;i<s;++i){const a=t[i];(!e||a.visible)&&r.push(a)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,r={meta:e,index:e.index,cancelable:!0},i=EE(this,e);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(i&&Ff(t,i),e.controller.draw(),i&&Of(t),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return ui(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,r,i){const s=zk.modes[t];return typeof s=="function"?s(this,e,r,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],r=this._metasets;let i=r.filter(s=>s&&s._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},r.push(i)),i}getContext(){return this.$context||(this.$context=ws(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!t.hidden}setDatasetVisibility(e,t){const r=this.getDatasetMeta(e);r.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,r){const i=r?"show":"hide",s=this.getDatasetMeta(e),a=s.controller._resolveAnimations(void 0,i);yl(t)?(s.data[t].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),a.update(s,{visible:r}),this.update(o=>o.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),ii.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),T1(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete gh[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,r=(s,a)=>{t.addEventListener(this,s,a),e[s]=a},i=(s,a,o)=>{s.offsetX=a,s.offsetY=o,this._eventHandler(s)};it(this.options.events,s=>r(s,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,r=(c,l)=>{t.addEventListener(this,c,l),e[c]=l},i=(c,l)=>{e[c]&&(t.removeEventListener(this,c,l),delete e[c])},s=(c,l)=>{this.canvas&&this.resize(c,l)};let a;const o=()=>{i("attach",o),this.attached=!0,this.resize(),r("resize",s),r("detach",a)};a=()=>{this.attached=!1,i("resize",s),this._stop(),this._resize(0,0),r("attach",o)},t.isAttached(this.canvas)?o():a()}unbindEvents(){it(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},it(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,r){const i=r?"set":"remove";let s,a,o,c;for(t==="dataset"&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+i+"DatasetHoverStyle"]()),o=0,c=e.length;o<c;++o){a=e[o];const l=a&&this.getDatasetMeta(a.datasetIndex).controller;l&&l[i+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],r=e.map(({datasetIndex:s,index:a})=>{const o=this.getDatasetMeta(s);if(!o)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:o.data[a],index:a}});!Fh(r,t)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,t))}notifyPlugins(e,t,r){return this._plugins.notify(this,e,t,r)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,r){const i=this.options.hover,s=(c,l)=>c.filter(u=>!l.some(h=>u.datasetIndex===h.datasetIndex&&u.index===h.index)),a=s(t,e),o=r?e:s(e,t);a.length&&this.updateHoverStyle(a,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(e,t){const r={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,i)===!1)return;const s=this._handleEvent(e,t,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,i),(s||r.changed)&&this.render(),this}_handleEvent(e,t,r){const{_active:i=[],options:s}=this,a=t,o=this._getActiveElements(e,i,r,a),c=GA(e),l=jC(e,this._lastEvent,r,c);r&&(this._lastEvent=null,ft(s.onHover,[e,o,this],this),c&&ft(s.onClick,[e,o,this],this));const u=!Fh(o,i);return(u||t)&&(this._active=o,this._updateHoverStyles(o,i,t)),this._lastEvent=l,u}_getActiveElements(e,t,r,i){if(e.type==="mouseout")return[];if(!r)return t;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,i)}}function i_(){return it(Gp.instances,n=>n._plugins.invalidate())}function GC(n,e,t){const{startAngle:r,x:i,y:s,outerRadius:a,innerRadius:o,options:c}=e,{borderWidth:l,borderJoinStyle:u}=c,h=Math.min(l/a,xn(r-t));if(n.beginPath(),n.arc(i,s,a-l/2,r+h/2,t-h/2),o>0){const d=Math.min(l/o,xn(r-t));n.arc(i,s,o+l/2,t-d/2,r+d/2,!0)}else{const d=Math.min(l/2,a*xn(r-t));if(u==="round")n.arc(i,s,d,t-et/2,r+et/2,!0);else if(u==="bevel"){const p=2*d*d,g=-p*Math.cos(t+et/2)+i,m=-p*Math.sin(t+et/2)+s,_=p*Math.cos(r+et/2)+i,E=p*Math.sin(r+et/2)+s;n.lineTo(g,m),n.lineTo(_,E)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function qC(n,e,t){const{startAngle:r,pixelMargin:i,x:s,y:a,outerRadius:o,innerRadius:c}=e;let l=i/o;n.beginPath(),n.arc(s,a,o,r-l,t+l),c>i?(l=i/c,n.arc(s,a,c,t+l,r-l,!0)):n.arc(s,a,i,t+Lt,r-Lt),n.closePath(),n.clip()}function KC(n){return Vp(n,["outerStart","outerEnd","innerStart","innerEnd"])}function YC(n,e,t,r){const i=KC(n.options.borderRadius),s=(t-e)/2,a=Math.min(s,r*e/2),o=c=>{const l=(t-Math.min(s,c))*r/2;return sn(c,0,Math.min(s,l))};return{outerStart:o(i.outerStart),outerEnd:o(i.outerEnd),innerStart:sn(i.innerStart,0,a),innerEnd:sn(i.innerEnd,0,a)}}function ja(n,e,t,r){return{x:t+n*Math.cos(e),y:r+n*Math.sin(e)}}function Bh(n,e,t,r,i,s){const{x:a,y:o,startAngle:c,pixelMargin:l,innerRadius:u}=e,h=Math.max(e.outerRadius+r+t-l,0),d=u>0?u+r+t+l:0;let p=0;const g=i-c;if(r){const ie=u>0?u-r:0,ue=h>0?h-r:0,he=(ie+ue)/2,Oe=he!==0?g*he/(he+r):g;p=(g-Oe)/2}const m=Math.max(.001,g*h-t/et)/h,_=(g-m)/2,E=c+_+p,I=i-_-p,{outerStart:v,outerEnd:R,innerStart:F,innerEnd:O}=YC(e,d,h,I-E),y=h-v,w=h-R,T=E+v/y,S=I-R/w,A=d+F,k=d+O,D=E+F/A,oe=I-O/k;if(n.beginPath(),s){const ie=(T+S)/2;if(n.arc(a,o,h,T,ie),n.arc(a,o,h,ie,S),R>0){const K=ja(w,S,a,o);n.arc(K.x,K.y,R,S,I+Lt)}const ue=ja(k,I,a,o);if(n.lineTo(ue.x,ue.y),O>0){const K=ja(k,oe,a,o);n.arc(K.x,K.y,O,I+Lt,oe+Math.PI)}const he=(I-O/d+(E+F/d))/2;if(n.arc(a,o,d,I-O/d,he,!0),n.arc(a,o,d,he,E+F/d,!0),F>0){const K=ja(A,D,a,o);n.arc(K.x,K.y,F,D+Math.PI,E-Lt)}const Oe=ja(y,E,a,o);if(n.lineTo(Oe.x,Oe.y),v>0){const K=ja(y,T,a,o);n.arc(K.x,K.y,v,E-Lt,T)}}else{n.moveTo(a,o);const ie=Math.cos(T)*h+a,ue=Math.sin(T)*h+o;n.lineTo(ie,ue);const he=Math.cos(S)*h+a,Oe=Math.sin(S)*h+o;n.lineTo(he,Oe)}n.closePath()}function XC(n,e,t,r,i){const{fullCircles:s,startAngle:a,circumference:o}=e;let c=e.endAngle;if(s){Bh(n,e,t,r,c,i);for(let l=0;l<s;++l)n.fill();isNaN(o)||(c=a+(o%yt||yt))}return Bh(n,e,t,r,c,i),n.fill(),c}function QC(n,e,t,r,i){const{fullCircles:s,startAngle:a,circumference:o,options:c}=e,{borderWidth:l,borderJoinStyle:u,borderDash:h,borderDashOffset:d,borderRadius:p}=c,g=c.borderAlign==="inner";if(!l)return;n.setLineDash(h||[]),n.lineDashOffset=d,g?(n.lineWidth=l*2,n.lineJoin=u||"round"):(n.lineWidth=l,n.lineJoin=u||"bevel");let m=e.endAngle;if(s){Bh(n,e,t,r,m,i);for(let _=0;_<s;++_)n.stroke();isNaN(o)||(m=a+(o%yt||yt))}g&&qC(n,e,m),c.selfJoin&&m-a>=et&&p===0&&u!=="miter"&&GC(n,e,m),s||(Bh(n,e,t,r,m,i),n.stroke())}class JC extends Ii{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,r){const i=this.getProps(["x","y"],r),{angle:s,distance:a}=eE(i,{x:e,y:t}),{startAngle:o,endAngle:c,innerRadius:l,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),d=(this.options.spacing+this.options.borderWidth)/2,p=Le(h,c-o),g=vl(s,o,c)&&o!==c,m=p>=yt||g,_=ci(a,l+d,u+d);return m&&_}getCenterPoint(e){const{x:t,y:r,startAngle:i,endAngle:s,innerRadius:a,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:l}=this.options,u=(i+s)/2,h=(a+o+l+c)/2;return{x:t+Math.cos(u)*h,y:r+Math.sin(u)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:r}=this,i=(t.offset||0)/4,s=(t.spacing||0)/2,a=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=r>yt?Math.floor(r/yt):0,r===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const o=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(o)*i,Math.sin(o)*i);const c=1-Math.sin(Math.min(et,r||0)),l=i*c;e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,XC(e,this,l,s,a),QC(e,this,l,s,a),e.restore()}}function ME(n,e,t=e){n.lineCap=Le(t.borderCapStyle,e.borderCapStyle),n.setLineDash(Le(t.borderDash,e.borderDash)),n.lineDashOffset=Le(t.borderDashOffset,e.borderDashOffset),n.lineJoin=Le(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=Le(t.borderWidth,e.borderWidth),n.strokeStyle=Le(t.borderColor,e.borderColor)}function ZC(n,e,t){n.lineTo(t.x,t.y)}function eR(n){return n.stepped?gS:n.tension||n.cubicInterpolationMode==="monotone"?mS:ZC}function LE(n,e,t={}){const r=n.length,{start:i=0,end:s=r-1}=t,{start:a,end:o}=e,c=Math.max(i,a),l=Math.min(s,o),u=i<a&&s<a||i>o&&s>o;return{count:r,start:c,loop:e.loop,ilen:l<c&&!u?r+l-c:l-c}}function tR(n,e,t,r){const{points:i,options:s}=e,{count:a,start:o,loop:c,ilen:l}=LE(i,t,r),u=eR(s);let{move:h=!0,reverse:d}=r||{},p,g,m;for(p=0;p<=l;++p)g=i[(o+(d?l-p:p))%a],!g.skip&&(h?(n.moveTo(g.x,g.y),h=!1):u(n,m,g,d,s.stepped),m=g);return c&&(g=i[(o+(d?l:0))%a],u(n,m,g,d,s.stepped)),!!c}function nR(n,e,t,r){const i=e.points,{count:s,start:a,ilen:o}=LE(i,t,r),{move:c=!0,reverse:l}=r||{};let u=0,h=0,d,p,g,m,_,E;const I=R=>(a+(l?o-R:R))%s,v=()=>{m!==_&&(n.lineTo(u,_),n.lineTo(u,m),n.lineTo(u,E))};for(c&&(p=i[I(0)],n.moveTo(p.x,p.y)),d=0;d<=o;++d){if(p=i[I(d)],p.skip)continue;const R=p.x,F=p.y,O=R|0;O===g?(F<m?m=F:F>_&&(_=F),u=(h*u+R)/++h):(v(),n.lineTo(R,F),g=O,h=0,m=_=F),E=F}v()}function S0(n){const e=n.options,t=e.borderDash&&e.borderDash.length;return!n._decimated&&!n._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?nR:tR}function rR(n){return n.stepped?KS:n.tension||n.cubicInterpolationMode==="monotone"?YS:Gs}function iR(n,e,t,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,t,r)&&i.closePath()),ME(n,e.options),n.stroke(i)}function sR(n,e,t,r){const{segments:i,options:s}=e,a=S0(e);for(const o of i)ME(n,s,o.style),n.beginPath(),a(n,e,o,{start:t,end:t+r-1})&&n.closePath(),n.stroke()}const aR=typeof Path2D=="function";function oR(n,e,t,r){aR&&!e.options.segment?iR(n,e,t,r):sR(n,e,t,r)}class Nf extends Ii{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const i=r.spanGaps?this._loop:this._fullLoop;US(this._points,r,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=tk(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,r=e.length;return r&&t[e[r-1].end]}interpolate(e,t){const r=this.options,i=e[t],s=this.points,a=vE(this,{property:t,start:i,end:i});if(!a.length)return;const o=[],c=rR(r);let l,u;for(l=0,u=a.length;l<u;++l){const{start:h,end:d}=a[l],p=s[h],g=s[d];if(p===g){o.push(p);continue}const m=Math.abs((i-p[t])/(g[t]-p[t])),_=c(p,g,m,r.stepped);_[t]=e[t],o.push(_)}return o.length===1?o[0]:o}pathSegment(e,t,r){return S0(this)(e,this,t,r)}path(e,t,r){const i=this.segments,s=S0(this);let a=this._loop;t=t||0,r=r||this.points.length-t;for(const o of i)a&=s(e,this,o,{start:t,end:t+r-1});return!!a}draw(e,t,r,i){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),oR(e,this,r,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function s_(n,e,t,r){const i=n.options,{[t]:s}=n.getProps([t],r);return Math.abs(e-s)<i.radius+i.hitRadius}class cR extends Ii{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,r){const i=this.options,{x:s,y:a}=this.getProps(["x","y"],r);return Math.pow(e-s,2)+Math.pow(t-a,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return s_(this,e,"x",t)}inYRange(e,t){return s_(this,e,"y",t)}getCenterPoint(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}size(e){e=e||this.options||{};let t=e.radius||0;t=Math.max(t,t&&e.hoverRadius||0);const r=t&&e.borderWidth||0;return(t+r)*2}draw(e,t){const r=this.options;this.skip||r.radius<.1||!ui(this,t,this.size(r)/2)||(e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.fillStyle=r.backgroundColor,b0(e,r,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function NE(n,e){const{x:t,y:r,base:i,width:s,height:a}=n.getProps(["x","y","base","width","height"],e);let o,c,l,u,h;return n.horizontal?(h=a/2,o=Math.min(t,i),c=Math.max(t,i),l=r-h,u=r+h):(h=s/2,o=t-h,c=t+h,l=Math.min(r,i),u=Math.max(r,i)),{left:o,top:l,right:c,bottom:u}}function ns(n,e,t,r){return n?0:sn(e,t,r)}function lR(n,e,t){const r=n.options.borderWidth,i=n.borderSkipped,s=lE(r);return{t:ns(i.top,s.top,0,t),r:ns(i.right,s.right,0,e),b:ns(i.bottom,s.bottom,0,t),l:ns(i.left,s.left,0,e)}}function uR(n,e,t){const{enableBorderRadius:r}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,s=ra(i),a=Math.min(e,t),o=n.borderSkipped,c=r||We(i);return{topLeft:ns(!c||o.top||o.left,s.topLeft,0,a),topRight:ns(!c||o.top||o.right,s.topRight,0,a),bottomLeft:ns(!c||o.bottom||o.left,s.bottomLeft,0,a),bottomRight:ns(!c||o.bottom||o.right,s.bottomRight,0,a)}}function hR(n){const e=NE(n),t=e.right-e.left,r=e.bottom-e.top,i=lR(n,t/2,r/2),s=uR(n,t/2,r/2);return{outer:{x:e.left,y:e.top,w:t,h:r,radius:s},inner:{x:e.left+i.l,y:e.top+i.t,w:t-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,s.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(i.b,i.r))}}}}function Vd(n,e,t,r){const i=e===null,s=t===null,o=n&&!(i&&s)&&NE(n,r);return o&&(i||ci(e,o.left,o.right))&&(s||ci(t,o.top,o.bottom))}function fR(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function dR(n,e){n.rect(e.x,e.y,e.w,e.h)}function Bd(n,e,t={}){const r=n.x!==t.x?-e:0,i=n.y!==t.y?-e:0,s=(n.x+n.w!==t.x+t.w?e:0)-r,a=(n.y+n.h!==t.y+t.h?e:0)-i;return{x:n.x+r,y:n.y+i,w:n.w+s,h:n.h+a,radius:n.radius}}class pR extends Ii{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:r,backgroundColor:i}}=this,{inner:s,outer:a}=hR(this),o=fR(a.radius)?El:dR;e.save(),(a.w!==s.w||a.h!==s.h)&&(e.beginPath(),o(e,Bd(a,t,s)),e.clip(),o(e,Bd(s,-t,a)),e.fillStyle=r,e.fill("evenodd")),e.beginPath(),o(e,Bd(s,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,r){return Vd(this,e,t,r)}inXRange(e,t){return Vd(this,e,null,t)}inYRange(e,t){return Vd(this,null,e,t)}getCenterPoint(e){const{x:t,y:r,base:i,horizontal:s}=this.getProps(["x","y","base","horizontal"],e);return{x:s?(t+i)/2:t,y:s?r:(r+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}var gR=Object.freeze({__proto__:null,ArcElement:JC,BarElement:pR,LineElement:Nf,PointElement:cR});const k0=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],a_=k0.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function VE(n){return k0[n%k0.length]}function BE(n){return a_[n%a_.length]}function mR(n,e){return n.borderColor=VE(e),n.backgroundColor=BE(e),++e}function _R(n,e){return n.backgroundColor=n.data.map(()=>VE(e++)),e}function xR(n,e){return n.backgroundColor=n.data.map(()=>BE(e++)),e}function yR(n){let e=0;return(t,r)=>{const i=n.getDatasetMeta(r).controller;i instanceof Wp?e=_R(t,e):i instanceof IE?e=xR(t,e):i&&(e=mR(t,e))}}function o_(n){let e;for(e in n)if(n[e].borderColor||n[e].backgroundColor)return!0;return!1}function vR(n){return n&&(n.borderColor||n.backgroundColor)}function ER(){return At.borderColor!=="rgba(0,0,0,0.1)"||At.backgroundColor!=="rgba(0,0,0,0.1)"}var wR={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,e,t){if(!t.enabled)return;const{data:{datasets:r},options:i}=n.config,{elements:s}=i,a=o_(r)||vR(i)||s&&o_(s)||ER();if(!t.forceOverride&&a)return;const o=yR(n);r.forEach(o)}};function TR(n,e,t,r,i){const s=i.samples||r;if(s>=t)return n.slice(e,e+t);const a=[],o=(t-2)/(s-2);let c=0;const l=e+t-1;let u=e,h,d,p,g,m;for(a[c++]=n[u],h=0;h<s-2;h++){let _=0,E=0,I;const v=Math.floor((h+1)*o)+1+e,R=Math.min(Math.floor((h+2)*o)+1,t)+e,F=R-v;for(I=v;I<R;I++)_+=n[I].x,E+=n[I].y;_/=F,E/=F;const O=Math.floor(h*o)+1+e,y=Math.min(Math.floor((h+1)*o)+1,t)+e,{x:w,y:T}=n[u];for(p=g=-1,I=O;I<y;I++)g=.5*Math.abs((w-_)*(n[I].y-T)-(w-n[I].x)*(E-T)),g>p&&(p=g,d=n[I],m=I);a[c++]=d,u=m}return a[c++]=n[l],a}function bR(n,e,t,r){let i=0,s=0,a,o,c,l,u,h,d,p,g,m;const _=[],E=e+t-1,I=n[e].x,R=n[E].x-I;for(a=e;a<e+t;++a){o=n[a],c=(o.x-I)/R*r,l=o.y;const F=c|0;if(F===u)l<g?(g=l,h=a):l>m&&(m=l,d=a),i=(s*i+o.x)/++s;else{const O=a-1;if(!ze(h)&&!ze(d)){const y=Math.min(h,d),w=Math.max(h,d);y!==p&&y!==O&&_.push({...n[y],x:i}),w!==p&&w!==O&&_.push({...n[w],x:i})}a>0&&O!==p&&_.push(n[O]),_.push(o),u=F,s=0,g=m=l,h=d=p=a}}return _}function UE(n){if(n._decimated){const e=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function c_(n){n.data.datasets.forEach(e=>{UE(e)})}function IR(n,e){const t=e.length;let r=0,i;const{iScale:s}=n,{min:a,max:o,minDefined:c,maxDefined:l}=s.getUserBounds();return c&&(r=sn(li(e,s.axis,a).lo,0,t-1)),l?i=sn(li(e,s.axis,o).hi+1,r,t)-r:i=t-r,{start:r,count:i}}var AR={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,e,t)=>{if(!t.enabled){c_(n);return}const r=n.width;n.data.datasets.forEach((i,s)=>{const{_data:a,indexAxis:o}=i,c=n.getDatasetMeta(s),l=a||i.data;if(Cc([o,n.options.indexAxis])==="y"||!c.controller.supportsDecimation)return;const u=n.scales[c.xAxisID];if(u.type!=="linear"&&u.type!=="time"||n.options.parsing)return;let{start:h,count:d}=IR(c,l);const p=t.threshold||4*r;if(d<=p){UE(i);return}ze(a)&&(i._data=l,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let g;switch(t.algorithm){case"lttb":g=TR(l,h,d,r,t);break;case"min-max":g=bR(l,h,d,r);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}i._decimated=g})},destroy(n){c_(n)}};function SR(n,e,t){const r=n.segments,i=n.points,s=e.points,a=[];for(const o of r){let{start:c,end:l}=o;l=Vf(c,l,i);const u=C0(t,i[c],i[l],o.loop);if(!e.segments){a.push({source:o,target:u,start:i[c],end:i[l]});continue}const h=vE(e,u);for(const d of h){const p=C0(t,s[d.start],s[d.end],d.loop),g=yE(o,i,p);for(const m of g)a.push({source:m,target:d,start:{[t]:l_(u,p,"start",Math.max)},end:{[t]:l_(u,p,"end",Math.min)}})}}return a}function C0(n,e,t,r){if(r)return;let i=e[n],s=t[n];return n==="angle"&&(i=xn(i),s=xn(s)),{property:n,start:i,end:s}}function kR(n,e){const{x:t=null,y:r=null}=n||{},i=e.points,s=[];return e.segments.forEach(({start:a,end:o})=>{o=Vf(a,o,i);const c=i[a],l=i[o];r!==null?(s.push({x:c.x,y:r}),s.push({x:l.x,y:r})):t!==null&&(s.push({x:t,y:c.y}),s.push({x:t,y:l.y}))}),s}function Vf(n,e,t){for(;e>n;e--){const r=t[e];if(!isNaN(r.x)&&!isNaN(r.y))break}return e}function l_(n,e,t,r){return n&&e?r(n[t],e[t]):n?n[t]:e?e[t]:0}function HE(n,e){let t=[],r=!1;return It(n)?(r=!0,t=n):t=kR(n,e),t.length?new Nf({points:t,options:{tension:0},_loop:r,_fullLoop:r}):null}function u_(n){return n&&n.fill!==!1}function CR(n,e,t){let i=n[e].fill;const s=[e];let a;if(!t)return i;for(;i!==!1&&s.indexOf(i)===-1;){if(!Dt(i))return i;if(a=n[i],!a)return!1;if(a.visible)return i;s.push(i),i=a.fill}return!1}function RR(n,e,t){const r=OR(n);if(We(r))return isNaN(r.value)?!1:r;let i=parseFloat(r);return Dt(i)&&Math.floor(i)===i?PR(r[0],e,i,t):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function PR(n,e,t,r){return(n==="-"||n==="+")&&(t=e+t),t===e||t<0||t>=r?!1:t}function DR(n,e){let t=null;return n==="start"?t=e.bottom:n==="end"?t=e.top:We(n)?t=e.getPixelForValue(n.value):e.getBasePixel&&(t=e.getBasePixel()),t}function FR(n,e,t){let r;return n==="start"?r=t:n==="end"?r=e.options.reverse?e.min:e.max:We(n)?r=n.value:r=e.getBaseValue(),r}function OR(n){const e=n.options,t=e.fill;let r=Le(t&&t.target,t);return r===void 0&&(r=!!e.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function MR(n){const{scale:e,index:t,line:r}=n,i=[],s=r.segments,a=r.points,o=LR(e,t);o.push(HE({x:null,y:e.bottom},r));for(let c=0;c<s.length;c++){const l=s[c];for(let u=l.start;u<=l.end;u++)NR(i,a[u],o)}return new Nf({points:i,options:{}})}function LR(n,e){const t=[],r=n.getMatchingVisibleMetas("line");for(let i=0;i<r.length;i++){const s=r[i];if(s.index===e)break;s.hidden||t.unshift(s.dataset)}return t}function NR(n,e,t){const r=[];for(let i=0;i<t.length;i++){const s=t[i],{first:a,last:o,point:c}=VR(s,e,"x");if(!(!c||a&&o)){if(a)r.unshift(c);else if(n.push(c),!o)break}}n.push(...r)}function VR(n,e,t){const r=n.interpolate(e,t);if(!r)return{};const i=r[t],s=n.segments,a=n.points;let o=!1,c=!1;for(let l=0;l<s.length;l++){const u=s[l],h=a[u.start][t],d=a[u.end][t];if(ci(i,h,d)){o=i===h,c=i===d;break}}return{first:o,last:c,point:r}}class zE{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,r){const{x:i,y:s,radius:a}=this;return t=t||{start:0,end:yt},e.arc(i,s,a,t.end,t.start,!0),!r.bounds}interpolate(e){const{x:t,y:r,radius:i}=this,s=e.angle;return{x:t+Math.cos(s)*i,y:r+Math.sin(s)*i,angle:s}}}function BR(n){const{chart:e,fill:t,line:r}=n;if(Dt(t))return UR(e,t);if(t==="stack")return MR(n);if(t==="shape")return!0;const i=HR(n);return i instanceof zE?i:HE(i,r)}function UR(n,e){const t=n.getDatasetMeta(e);return t&&n.isDatasetVisible(e)?t.dataset:null}function HR(n){return(n.scale||{}).getPointPositionForValue?$R(n):zR(n)}function zR(n){const{scale:e={},fill:t}=n,r=DR(t,e);if(Dt(r)){const i=e.isHorizontal();return{x:i?r:null,y:i?null:r}}return null}function $R(n){const{scale:e,fill:t}=n,r=e.options,i=e.getLabels().length,s=r.reverse?e.max:e.min,a=FR(t,e,s),o=[];if(r.grid.circular){const c=e.getPointPositionForValue(0,s);return new zE({x:c.x,y:c.y,radius:e.getDistanceFromCenterForValue(a)})}for(let c=0;c<i;++c)o.push(e.getPointPositionForValue(c,a));return o}function Ud(n,e,t){const r=BR(e),{chart:i,index:s,line:a,scale:o,axis:c}=e,l=a.options,u=l.fill,h=l.backgroundColor,{above:d=h,below:p=h}=u||{},g=i.getDatasetMeta(s),m=EE(i,g);r&&a.points.length&&(Ff(n,t),WR(n,{line:a,target:r,above:d,below:p,area:t,scale:o,axis:c,clip:m}),Of(n))}function WR(n,e){const{line:t,target:r,above:i,below:s,area:a,scale:o,clip:c}=e,l=t._loop?"angle":e.axis;n.save();let u=s;s!==i&&(l==="x"?(h_(n,r,a.top),Hd(n,{line:t,target:r,color:i,scale:o,property:l,clip:c}),n.restore(),n.save(),h_(n,r,a.bottom)):l==="y"&&(f_(n,r,a.left),Hd(n,{line:t,target:r,color:s,scale:o,property:l,clip:c}),n.restore(),n.save(),f_(n,r,a.right),u=i)),Hd(n,{line:t,target:r,color:u,scale:o,property:l,clip:c}),n.restore()}function h_(n,e,t){const{segments:r,points:i}=e;let s=!0,a=!1;n.beginPath();for(const o of r){const{start:c,end:l}=o,u=i[c],h=i[Vf(c,l,i)];s?(n.moveTo(u.x,u.y),s=!1):(n.lineTo(u.x,t),n.lineTo(u.x,u.y)),a=!!e.pathSegment(n,o,{move:a}),a?n.closePath():n.lineTo(h.x,t)}n.lineTo(e.first().x,t),n.closePath(),n.clip()}function f_(n,e,t){const{segments:r,points:i}=e;let s=!0,a=!1;n.beginPath();for(const o of r){const{start:c,end:l}=o,u=i[c],h=i[Vf(c,l,i)];s?(n.moveTo(u.x,u.y),s=!1):(n.lineTo(t,u.y),n.lineTo(u.x,u.y)),a=!!e.pathSegment(n,o,{move:a}),a?n.closePath():n.lineTo(t,h.y)}n.lineTo(t,e.first().y),n.closePath(),n.clip()}function Hd(n,e){const{line:t,target:r,property:i,color:s,scale:a,clip:o}=e,c=SR(t,r,i);for(const{source:l,target:u,start:h,end:d}of c){const{style:{backgroundColor:p=s}={}}=l,g=r!==!0;n.save(),n.fillStyle=p,jR(n,a,o,g&&C0(i,h,d)),n.beginPath();const m=!!t.pathSegment(n,l);let _;if(g){m?n.closePath():d_(n,r,d,i);const E=!!r.pathSegment(n,u,{move:m,reverse:!0});_=m&&E,_||d_(n,r,h,i)}n.closePath(),n.fill(_?"evenodd":"nonzero"),n.restore()}}function jR(n,e,t,r){const i=e.chart.chartArea,{property:s,start:a,end:o}=r||{};if(s==="x"||s==="y"){let c,l,u,h;s==="x"?(c=a,l=i.top,u=o,h=i.bottom):(c=i.left,l=a,u=i.right,h=o),n.beginPath(),t&&(c=Math.max(c,t.left),u=Math.min(u,t.right),l=Math.max(l,t.top),h=Math.min(h,t.bottom)),n.rect(c,l,u-c,h-l),n.clip()}}function d_(n,e,t,r){const i=e.interpolate(t,r);i&&n.lineTo(i.x,i.y)}var GR={id:"filler",afterDatasetsUpdate(n,e,t){const r=(n.data.datasets||[]).length,i=[];let s,a,o,c;for(a=0;a<r;++a)s=n.getDatasetMeta(a),o=s.dataset,c=null,o&&o.options&&o instanceof Nf&&(c={visible:n.isDatasetVisible(a),index:a,fill:RR(o,a,r),chart:n,axis:s.controller.options.indexAxis,scale:s.vScale,line:o}),s.$filler=c,i.push(c);for(a=0;a<r;++a)c=i[a],!(!c||c.fill===!1)&&(c.fill=CR(i,a,t.propagate))},beforeDraw(n,e,t){const r=t.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),s=n.chartArea;for(let a=i.length-1;a>=0;--a){const o=i[a].$filler;o&&(o.line.updateControlPoints(s,o.axis),r&&o.fill&&Ud(n.ctx,o,s))}},beforeDatasetsDraw(n,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const r=n.getSortedVisibleDatasetMetas();for(let i=r.length-1;i>=0;--i){const s=r[i].$filler;u_(s)&&Ud(n.ctx,s,n.chartArea)}},beforeDatasetDraw(n,e,t){const r=e.meta.$filler;!u_(r)||t.drawTime!=="beforeDatasetDraw"||Ud(n.ctx,r,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const p_=(n,e)=>{let{boxHeight:t=e,boxWidth:r=e}=n;return n.usePointStyle&&(t=Math.min(t,e),r=n.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:t,itemHeight:Math.max(e,t)}},qR=(n,e)=>n!==null&&e!==null&&n.datasetIndex===e.datasetIndex&&n.index===e.index;class g_ extends Ii{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,r){this.maxWidth=e,this.maxHeight=t,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=ft(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(r=>e.filter(r,this.chart.data))),e.sort&&(t=t.sort((r,i)=>e.sort(r,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,i=Kt(r.font),s=i.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:c}=p_(r,s);let l,u;t.font=i.string,this.isHorizontal()?(l=this.maxWidth,u=this._fitRows(a,s,o,c)+10):(u=this.maxHeight,l=this._fitCols(a,i,o,c)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,t,r,i){const{ctx:s,maxWidth:a,options:{labels:{padding:o}}}=this,c=this.legendHitBoxes=[],l=this.lineWidths=[0],u=i+o;let h=e;s.textAlign="left",s.textBaseline="middle";let d=-1,p=-u;return this.legendItems.forEach((g,m)=>{const _=r+t/2+s.measureText(g.text).width;(m===0||l[l.length-1]+_+2*o>a)&&(h+=u,l[l.length-(m>0?0:1)]=0,p+=u,d++),c[m]={left:0,top:p,row:d,width:_,height:i},l[l.length-1]+=_+o}),h}_fitCols(e,t,r,i){const{ctx:s,maxHeight:a,options:{labels:{padding:o}}}=this,c=this.legendHitBoxes=[],l=this.columnSizes=[],u=a-e;let h=o,d=0,p=0,g=0,m=0;return this.legendItems.forEach((_,E)=>{const{itemWidth:I,itemHeight:v}=KR(r,t,s,_,i);E>0&&p+v+2*o>u&&(h+=d+o,l.push({width:d,height:p}),g+=d+o,m++,d=p=0),c[E]={left:g,top:p,col:m,width:I,height:v},d=Math.max(d,I),p+=v+o}),h+=d,l.push({width:d,height:p}),h}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:r,labels:{padding:i},rtl:s}}=this,a=co(s,this.left,this.width);if(this.isHorizontal()){let o=0,c=gn(r,this.left+i,this.right-this.lineWidths[o]);for(const l of t)o!==l.row&&(o=l.row,c=gn(r,this.left+i,this.right-this.lineWidths[o])),l.top+=this.top+e+i,l.left=a.leftForLtr(a.x(c),l.width),c+=l.width+i}else{let o=0,c=gn(r,this.top+e+i,this.bottom-this.columnSizes[o].height);for(const l of t)l.col!==o&&(o=l.col,c=gn(r,this.top+e+i,this.bottom-this.columnSizes[o].height)),l.top=c,l.left+=this.left+i,l.left=a.leftForLtr(a.x(l.left),l.width),c+=l.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Ff(e,this),this._draw(),Of(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:r,ctx:i}=this,{align:s,labels:a}=e,o=At.color,c=co(e.rtl,this.left,this.width),l=Kt(a.font),{padding:u}=a,h=l.size,d=h/2;let p;this.drawTitle(),i.textAlign=c.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:g,boxHeight:m,itemHeight:_}=p_(a,h),E=function(O,y,w){if(isNaN(g)||g<=0||isNaN(m)||m<0)return;i.save();const T=Le(w.lineWidth,1);if(i.fillStyle=Le(w.fillStyle,o),i.lineCap=Le(w.lineCap,"butt"),i.lineDashOffset=Le(w.lineDashOffset,0),i.lineJoin=Le(w.lineJoin,"miter"),i.lineWidth=T,i.strokeStyle=Le(w.strokeStyle,o),i.setLineDash(Le(w.lineDash,[])),a.usePointStyle){const S={radius:m*Math.SQRT2/2,pointStyle:w.pointStyle,rotation:w.rotation,borderWidth:T},A=c.xPlus(O,g/2),k=y+d;cE(i,S,A,k,a.pointStyleWidth&&g)}else{const S=y+Math.max((h-m)/2,0),A=c.leftForLtr(O,g),k=ra(w.borderRadius);i.beginPath(),Object.values(k).some(D=>D!==0)?El(i,{x:A,y:S,w:g,h:m,radius:k}):i.rect(A,S,g,m),i.fill(),T!==0&&i.stroke()}i.restore()},I=function(O,y,w){da(i,w.text,O,y+_/2,l,{strikethrough:w.hidden,textAlign:c.textAlign(w.textAlign)})},v=this.isHorizontal(),R=this._computeTitleHeight();v?p={x:gn(s,this.left+u,this.right-r[0]),y:this.top+u+R,line:0}:p={x:this.left+u,y:gn(s,this.top+R+u,this.bottom-t[0].height),line:0},mE(this.ctx,e.textDirection);const F=_+u;this.legendItems.forEach((O,y)=>{i.strokeStyle=O.fontColor,i.fillStyle=O.fontColor;const w=i.measureText(O.text).width,T=c.textAlign(O.textAlign||(O.textAlign=a.textAlign)),S=g+d+w;let A=p.x,k=p.y;c.setWidth(this.width),v?y>0&&A+S+u>this.right&&(k=p.y+=F,p.line++,A=p.x=gn(s,this.left+u,this.right-r[p.line])):y>0&&k+F>this.bottom&&(A=p.x=A+t[p.line].width+u,p.line++,k=p.y=gn(s,this.top+R+u,this.bottom-t[p.line].height));const D=c.x(A);if(E(D,k,O),A=iS(T,A+g+d,v?A+S:this.right,e.rtl),I(c.x(A),k,O),v)p.x+=S+u;else if(typeof O.text!="string"){const oe=l.lineHeight;p.y+=$E(O,oe)+u}else p.y+=F}),_E(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,r=Kt(t.font),i=kn(t.padding);if(!t.display)return;const s=co(e.rtl,this.left,this.width),a=this.ctx,o=t.position,c=r.size/2,l=i.top+c;let u,h=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),u=this.top+l,h=gn(e.align,h,this.right-d);else{const g=this.columnSizes.reduce((m,_)=>Math.max(m,_.height),0);u=l+gn(e.align,this.top,this.bottom-g-e.labels.padding-this._computeTitleHeight())}const p=gn(o,h,h+d);a.textAlign=s.textAlign(Lp(o)),a.textBaseline="middle",a.strokeStyle=t.color,a.fillStyle=t.color,a.font=r.string,da(a,t.text,p,u,r)}_computeTitleHeight(){const e=this.options.title,t=Kt(e.font),r=kn(e.padding);return e.display?t.lineHeight+r.height:0}_getLegendItemAt(e,t){let r,i,s;if(ci(e,this.left,this.right)&&ci(t,this.top,this.bottom)){for(s=this.legendHitBoxes,r=0;r<s.length;++r)if(i=s[r],ci(e,i.left,i.left+i.width)&&ci(t,i.top,i.top+i.height))return this.legendItems[r]}return null}handleEvent(e){const t=this.options;if(!QR(e.type,t))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const i=this._hoveredItem,s=qR(i,r);i&&!s&&ft(t.onLeave,[e,i,this],this),this._hoveredItem=r,r&&!s&&ft(t.onHover,[e,r,this],this)}else r&&ft(t.onClick,[e,r,this],this)}}function KR(n,e,t,r,i){const s=YR(r,n,e,t),a=XR(i,r,e.lineHeight);return{itemWidth:s,itemHeight:a}}function YR(n,e,t,r){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((s,a)=>s.length>a.length?s:a)),e+t.size/2+r.measureText(i).width}function XR(n,e,t){let r=n;return typeof e.text!="string"&&(r=$E(e,t)),r}function $E(n,e){const t=n.text?n.text.length:0;return e*t}function QR(n,e){return!!((n==="mousemove"||n==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(n==="click"||n==="mouseup"))}var JR={id:"legend",_element:g_,start(n,e,t){const r=n.legend=new g_({ctx:n.ctx,options:t,chart:n});Tn.configure(n,r,t),Tn.addBox(n,r)},stop(n){Tn.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const r=n.legend;Tn.configure(n,r,t),r.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const r=e.datasetIndex,i=t.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:r,textAlign:i,color:s,useBorderRadius:a,borderRadius:o}}=n.legend.options;return n._getSortedDatasetMetas().map(c=>{const l=c.controller.getStyle(t?0:void 0),u=kn(l.borderWidth);return{text:e[c.index].label,fillStyle:l.backgroundColor,fontColor:s,hidden:!c.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:l.borderColor,pointStyle:r||l.pointStyle,rotation:l.rotation,textAlign:i||l.textAlign,borderRadius:a&&(o||l.borderRadius),datasetIndex:c.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class qp extends Ii{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const i=It(r.text)?r.text.length:1;this._padding=kn(r.padding);const s=i*Kt(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:r,bottom:i,right:s,options:a}=this,o=a.align;let c=0,l,u,h;return this.isHorizontal()?(u=gn(o,r,s),h=t+e,l=s-r):(a.position==="left"?(u=r+e,h=gn(o,i,t),c=et*-.5):(u=s-e,h=gn(o,t,i),c=et*.5),l=i-t),{titleX:u,titleY:h,maxWidth:l,rotation:c}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const r=Kt(t.font),s=r.lineHeight/2+this._padding.top,{titleX:a,titleY:o,maxWidth:c,rotation:l}=this._drawArgs(s);da(e,t.text,0,0,r,{color:t.color,maxWidth:c,rotation:l,textAlign:Lp(t.align),textBaseline:"middle",translation:[a,o]})}}function ZR(n,e){const t=new qp({ctx:n.ctx,options:e,chart:n});Tn.configure(n,t,e),Tn.addBox(n,t),n.titleBlock=t}var eP={id:"title",_element:qp,start(n,e,t){ZR(n,t)},stop(n){const e=n.titleBlock;Tn.removeBox(n,e),delete n.titleBlock},beforeUpdate(n,e,t){const r=n.titleBlock;Tn.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Gu=new WeakMap;var tP={id:"subtitle",start(n,e,t){const r=new qp({ctx:n.ctx,options:t,chart:n});Tn.configure(n,r,t),Tn.addBox(n,r),Gu.set(n,r)},stop(n){Tn.removeBox(n,Gu.get(n)),Gu.delete(n)},beforeUpdate(n,e,t){const r=Gu.get(n);Tn.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Pc={average(n){if(!n.length)return!1;let e,t,r=new Set,i=0,s=0;for(e=0,t=n.length;e<t;++e){const o=n[e].element;if(o&&o.hasValue()){const c=o.tooltipPosition();r.add(c.x),i+=c.y,++s}}return s===0||r.size===0?!1:{x:[...r].reduce((o,c)=>o+c)/r.size,y:i/s}},nearest(n,e){if(!n.length)return!1;let t=e.x,r=e.y,i=Number.POSITIVE_INFINITY,s,a,o;for(s=0,a=n.length;s<a;++s){const c=n[s].element;if(c&&c.hasValue()){const l=c.getCenterPoint(),u=w0(e,l);u<i&&(i=u,o=c)}}if(o){const c=o.tooltipPosition();t=c.x,r=c.y}return{x:t,y:r}}};function Fr(n,e){return e&&(It(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function si(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function nP(n,e){const{element:t,datasetIndex:r,index:i}=e,s=n.getDatasetMeta(r).controller,{label:a,value:o}=s.getLabelAndValue(i);return{chart:n,label:a,parsed:s.getParsed(i),raw:n.data.datasets[r].data[i],formattedValue:o,dataset:s.getDataset(),dataIndex:i,datasetIndex:r,element:t}}function m_(n,e){const t=n.chart.ctx,{body:r,footer:i,title:s}=n,{boxWidth:a,boxHeight:o}=e,c=Kt(e.bodyFont),l=Kt(e.titleFont),u=Kt(e.footerFont),h=s.length,d=i.length,p=r.length,g=kn(e.padding);let m=g.height,_=0,E=r.reduce((R,F)=>R+F.before.length+F.lines.length+F.after.length,0);if(E+=n.beforeBody.length+n.afterBody.length,h&&(m+=h*l.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),E){const R=e.displayColors?Math.max(o,c.lineHeight):c.lineHeight;m+=p*R+(E-p)*c.lineHeight+(E-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let I=0;const v=function(R){_=Math.max(_,t.measureText(R).width+I)};return t.save(),t.font=l.string,it(n.title,v),t.font=c.string,it(n.beforeBody.concat(n.afterBody),v),I=e.displayColors?a+2+e.boxPadding:0,it(r,R=>{it(R.before,v),it(R.lines,v),it(R.after,v)}),I=0,t.font=u.string,it(n.footer,v),t.restore(),_+=g.width,{width:_,height:m}}function rP(n,e){const{y:t,height:r}=e;return t<r/2?"top":t>n.height-r/2?"bottom":"center"}function iP(n,e,t,r){const{x:i,width:s}=r,a=t.caretSize+t.caretPadding;if(n==="left"&&i+s+a>e.width||n==="right"&&i-s-a<0)return!0}function sP(n,e,t,r){const{x:i,width:s}=t,{width:a,chartArea:{left:o,right:c}}=n;let l="center";return r==="center"?l=i<=(o+c)/2?"left":"right":i<=s/2?l="left":i>=a-s/2&&(l="right"),iP(l,n,e,t)&&(l="center"),l}function __(n,e,t){const r=t.yAlign||e.yAlign||rP(n,t);return{xAlign:t.xAlign||e.xAlign||sP(n,e,t,r),yAlign:r}}function aP(n,e){let{x:t,width:r}=n;return e==="right"?t-=r:e==="center"&&(t-=r/2),t}function oP(n,e,t){let{y:r,height:i}=n;return e==="top"?r+=t:e==="bottom"?r-=i+t:r-=i/2,r}function x_(n,e,t,r){const{caretSize:i,caretPadding:s,cornerRadius:a}=n,{xAlign:o,yAlign:c}=t,l=i+s,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=ra(a);let g=aP(e,o);const m=oP(e,c,l);return c==="center"?o==="left"?g+=l:o==="right"&&(g-=l):o==="left"?g-=Math.max(u,d)+i:o==="right"&&(g+=Math.max(h,p)+i),{x:sn(g,0,r.width-e.width),y:sn(m,0,r.height-e.height)}}function qu(n,e,t){const r=kn(t.padding);return e==="center"?n.x+n.width/2:e==="right"?n.x+n.width-r.right:n.x+r.left}function y_(n){return Fr([],si(n))}function cP(n,e,t){return ws(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}function v_(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}const WE={beforeTitle:ni,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,r=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return t[e.dataIndex]}return""},afterTitle:ni,beforeBody:ni,beforeLabel:ni,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return ze(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:ni,afterBody:ni,beforeFooter:ni,footer:ni,afterFooter:ni};function Hn(n,e,t,r){const i=n[e].call(t,r);return typeof i>"u"?WE[e].call(t,r):i}class E_ extends Ii{static positioners=Pc;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,r=this.options.setContext(this.getContext()),i=r.enabled&&t.options.animation&&r.animations,s=new wE(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=cP(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:r}=t,i=Hn(r,"beforeTitle",this,e),s=Hn(r,"title",this,e),a=Hn(r,"afterTitle",this,e);let o=[];return o=Fr(o,si(i)),o=Fr(o,si(s)),o=Fr(o,si(a)),o}getBeforeBody(e,t){return y_(Hn(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:r}=t,i=[];return it(e,s=>{const a={before:[],lines:[],after:[]},o=v_(r,s);Fr(a.before,si(Hn(o,"beforeLabel",this,s))),Fr(a.lines,Hn(o,"label",this,s)),Fr(a.after,si(Hn(o,"afterLabel",this,s))),i.push(a)}),i}getAfterBody(e,t){return y_(Hn(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:r}=t,i=Hn(r,"beforeFooter",this,e),s=Hn(r,"footer",this,e),a=Hn(r,"afterFooter",this,e);let o=[];return o=Fr(o,si(i)),o=Fr(o,si(s)),o=Fr(o,si(a)),o}_createItems(e){const t=this._active,r=this.chart.data,i=[],s=[],a=[];let o=[],c,l;for(c=0,l=t.length;c<l;++c)o.push(nP(this.chart,t[c]));return e.filter&&(o=o.filter((u,h,d)=>e.filter(u,h,d,r))),e.itemSort&&(o=o.sort((u,h)=>e.itemSort(u,h,r))),it(o,u=>{const h=v_(e.callbacks,u);i.push(Hn(h,"labelColor",this,u)),s.push(Hn(h,"labelPointStyle",this,u)),a.push(Hn(h,"labelTextColor",this,u))}),this.labelColors=i,this.labelPointStyles=s,this.labelTextColors=a,this.dataPoints=o,o}update(e,t){const r=this.options.setContext(this.getContext()),i=this._active;let s,a=[];if(!i.length)this.opacity!==0&&(s={opacity:0});else{const o=Pc[r.position].call(this,i,this._eventPosition);a=this._createItems(r),this.title=this.getTitle(a,r),this.beforeBody=this.getBeforeBody(a,r),this.body=this.getBody(a,r),this.afterBody=this.getAfterBody(a,r),this.footer=this.getFooter(a,r);const c=this._size=m_(this,r),l=Object.assign({},o,c),u=__(this.chart,r,l),h=x_(r,l,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,s={opacity:1,x:h.x,y:h.y,width:c.width,height:c.height,caretX:o.x,caretY:o.y}}this._tooltipItems=a,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,r,i){const s=this.getCaretPosition(e,r,i);t.lineTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.lineTo(s.x3,s.y3)}getCaretPosition(e,t,r){const{xAlign:i,yAlign:s}=this,{caretSize:a,cornerRadius:o}=r,{topLeft:c,topRight:l,bottomLeft:u,bottomRight:h}=ra(o),{x:d,y:p}=e,{width:g,height:m}=t;let _,E,I,v,R,F;return s==="center"?(R=p+m/2,i==="left"?(_=d,E=_-a,v=R+a,F=R-a):(_=d+g,E=_+a,v=R-a,F=R+a),I=_):(i==="left"?E=d+Math.max(c,u)+a:i==="right"?E=d+g-Math.max(l,h)-a:E=this.caretX,s==="top"?(v=p,R=v-a,_=E-a,I=E+a):(v=p+m,R=v+a,_=E+a,I=E-a),F=v),{x1:_,x2:E,x3:I,y1:v,y2:R,y3:F}}drawTitle(e,t,r){const i=this.title,s=i.length;let a,o,c;if(s){const l=co(r.rtl,this.x,this.width);for(e.x=qu(this,r.titleAlign,r),t.textAlign=l.textAlign(r.titleAlign),t.textBaseline="middle",a=Kt(r.titleFont),o=r.titleSpacing,t.fillStyle=r.titleColor,t.font=a.string,c=0;c<s;++c)t.fillText(i[c],l.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+o,c+1===s&&(e.y+=r.titleMarginBottom-o)}}_drawColorBox(e,t,r,i,s){const a=this.labelColors[r],o=this.labelPointStyles[r],{boxHeight:c,boxWidth:l}=s,u=Kt(s.bodyFont),h=qu(this,"left",s),d=i.x(h),p=c<u.lineHeight?(u.lineHeight-c)/2:0,g=t.y+p;if(s.usePointStyle){const m={radius:Math.min(l,c)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},_=i.leftForLtr(d,l)+l/2,E=g+c/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,b0(e,m,_,E),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,b0(e,m,_,E)}else{e.lineWidth=We(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const m=i.leftForLtr(d,l),_=i.leftForLtr(i.xPlus(d,1),l-2),E=ra(a.borderRadius);Object.values(E).some(I=>I!==0)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,El(e,{x:m,y:g,w:l,h:c,radius:E}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),El(e,{x:_,y:g+1,w:l-2,h:c-2,radius:E}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(m,g,l,c),e.strokeRect(m,g,l,c),e.fillStyle=a.backgroundColor,e.fillRect(_,g+1,l-2,c-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,t,r){const{body:i}=this,{bodySpacing:s,bodyAlign:a,displayColors:o,boxHeight:c,boxWidth:l,boxPadding:u}=r,h=Kt(r.bodyFont);let d=h.lineHeight,p=0;const g=co(r.rtl,this.x,this.width),m=function(w){t.fillText(w,g.x(e.x+p),e.y+d/2),e.y+=d+s},_=g.textAlign(a);let E,I,v,R,F,O,y;for(t.textAlign=a,t.textBaseline="middle",t.font=h.string,e.x=qu(this,_,r),t.fillStyle=r.bodyColor,it(this.beforeBody,m),p=o&&_!=="right"?a==="center"?l/2+u:l+2+u:0,R=0,O=i.length;R<O;++R){for(E=i[R],I=this.labelTextColors[R],t.fillStyle=I,it(E.before,m),v=E.lines,o&&v.length&&(this._drawColorBox(t,e,R,g,r),d=Math.max(h.lineHeight,c)),F=0,y=v.length;F<y;++F)m(v[F]),d=h.lineHeight;it(E.after,m)}p=0,d=h.lineHeight,it(this.afterBody,m),e.y-=s}drawFooter(e,t,r){const i=this.footer,s=i.length;let a,o;if(s){const c=co(r.rtl,this.x,this.width);for(e.x=qu(this,r.footerAlign,r),e.y+=r.footerMarginTop,t.textAlign=c.textAlign(r.footerAlign),t.textBaseline="middle",a=Kt(r.footerFont),t.fillStyle=r.footerColor,t.font=a.string,o=0;o<s;++o)t.fillText(i[o],c.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+r.footerSpacing}}drawBackground(e,t,r,i){const{xAlign:s,yAlign:a}=this,{x:o,y:c}=e,{width:l,height:u}=r,{topLeft:h,topRight:d,bottomLeft:p,bottomRight:g}=ra(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(o+h,c),a==="top"&&this.drawCaret(e,t,r,i),t.lineTo(o+l-d,c),t.quadraticCurveTo(o+l,c,o+l,c+d),a==="center"&&s==="right"&&this.drawCaret(e,t,r,i),t.lineTo(o+l,c+u-g),t.quadraticCurveTo(o+l,c+u,o+l-g,c+u),a==="bottom"&&this.drawCaret(e,t,r,i),t.lineTo(o+p,c+u),t.quadraticCurveTo(o,c+u,o,c+u-p),a==="center"&&s==="left"&&this.drawCaret(e,t,r,i),t.lineTo(o,c+h),t.quadraticCurveTo(o,c,o+h,c),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,r=this.$animations,i=r&&r.x,s=r&&r.y;if(i||s){const a=Pc[e.position].call(this,this._active,this._eventPosition);if(!a)return;const o=this._size=m_(this,e),c=Object.assign({},a,this._size),l=__(t,e,c),u=x_(e,c,l,t);(i._to!==u.x||s._to!==u.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},s={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const a=kn(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=r,this.drawBackground(s,e,i,t),mE(e,t.textDirection),s.y+=a.top,this.drawTitle(s,e,t),this.drawBody(s,e,t),this.drawFooter(s,e,t),_E(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const r=this._active,i=e.map(({datasetIndex:o,index:c})=>{const l=this.chart.getDatasetMeta(o);if(!l)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:l.data[c],index:c}}),s=!Fh(r,i),a=this._positionChanged(i,t);(s||a)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,r=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,s=this._active||[],a=this._getActiveElements(e,s,t,r),o=this._positionChanged(a,e),c=t||!Fh(a,s)||o;return c&&(this._active=a,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),c}_getActiveElements(e,t,r,i){const s=this.options;if(e.type==="mouseout")return[];if(!i)return t.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,s.mode,s,r);return s.reverse&&a.reverse(),a}_positionChanged(e,t){const{caretX:r,caretY:i,options:s}=this,a=Pc[s.position].call(this,e,t);return a!==!1&&(r!==a.x||i!==a.y)}}var lP={id:"tooltip",_element:E_,positioners:Pc,afterInit(n,e,t){t&&(n.tooltip=new E_({chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(n.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t)}},afterEvent(n,e){if(n.tooltip){const t=e.replay;n.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:WE},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},uP=Object.freeze({__proto__:null,Colors:wR,Decimation:AR,Filler:GR,Legend:JR,SubTitle:tP,Title:eP,Tooltip:lP});const hP=(n,e,t,r)=>(typeof e=="string"?(t=n.push(e)-1,r.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function fP(n,e,t,r){const i=n.indexOf(e);if(i===-1)return hP(n,e,t,r);const s=n.lastIndexOf(e);return i!==s?t:i}const dP=(n,e)=>n===null?null:sn(Math.round(n),0,e);function w_(n){const e=this.getLabels();return n>=0&&n<e.length?e[n]:n}class pP extends Ca{static id="category";static defaults={ticks:{callback:w_}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const r=this.getLabels();for(const{index:i,label:s}of t)r[i]===s&&r.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(ze(e))return null;const r=this.getLabels();return t=isFinite(t)&&r[t]===e?t:fP(r,e,Le(t,e),this._addedLabels),dP(t,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:r,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),t||(i=this.getLabels().length-1)),this.min=r,this.max=i}buildTicks(){const e=this.min,t=this.max,r=this.options.offset,i=[];let s=this.getLabels();s=e===0&&t===s.length-1?s:s.slice(e,t+1),this._valueRange=Math.max(s.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let a=e;a<=t;a++)i.push({value:a});return i}getLabelForValue(e){return w_.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function gP(n,e){const t=[],{bounds:i,step:s,min:a,max:o,precision:c,count:l,maxTicks:u,maxDigits:h,includeBounds:d}=n,p=s||1,g=u-1,{min:m,max:_}=e,E=!ze(a),I=!ze(o),v=!ze(l),R=(_-m)/(h+1);let F=m1((_-m)/g/p)*p,O,y,w,T;if(F<1e-14&&!E&&!I)return[{value:m},{value:_}];T=Math.ceil(_/F)-Math.floor(m/F),T>g&&(F=m1(T*F/g/p)*p),ze(c)||(O=Math.pow(10,c),F=Math.ceil(F*O)/O),i==="ticks"?(y=Math.floor(m/F)*F,w=Math.ceil(_/F)*F):(y=m,w=_),E&&I&&s&&QA((o-a)/s,F/1e3)?(T=Math.round(Math.min((o-a)/F,u)),F=(o-a)/T,y=a,w=o):v?(y=E?a:y,w=I?o:w,T=l-1,F=(w-y)/T):(T=(w-y)/F,jc(T,Math.round(T),F/1e3)?T=Math.round(T):T=Math.ceil(T));const S=Math.max(_1(F),_1(y));O=Math.pow(10,ze(c)?S:c),y=Math.round(y*O)/O,w=Math.round(w*O)/O;let A=0;for(E&&(d&&y!==a?(t.push({value:a}),y<a&&A++,jc(Math.round((y+A*F)*O)/O,a,T_(a,R,n))&&A++):y<a&&A++);A<T;++A){const k=Math.round((y+A*F)*O)/O;if(I&&k>o)break;t.push({value:k})}return I&&d&&w!==o?t.length&&jc(t[t.length-1].value,o,T_(o,R,n))?t[t.length-1].value=o:t.push({value:o}):(!I||w===o)&&t.push({value:w}),t}function T_(n,e,{horizontal:t,minRotation:r}){const i=Er(r),s=(t?Math.sin(i):Math.cos(i))||.001,a=.75*e*(""+n).length;return Math.min(e/s,a)}class Uh extends Ca{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return ze(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:r}=this.getUserBounds();let{min:i,max:s}=this;const a=c=>i=t?i:c,o=c=>s=r?s:c;if(e){const c=Ur(i),l=Ur(s);c<0&&l<0?o(0):c>0&&l>0&&a(0)}if(i===s){let c=s===0?1:Math.abs(s*.05);o(s+c),e||a(i-c)}this.min=i,this.max=s}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:r}=e,i;return r?(i=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),t=t||11),t&&(i=Math.min(t,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const i={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},s=this._range||this,a=gP(i,s);return e.bounds==="ticks"&&Zv(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const e=this.ticks;let t=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const i=(r-t)/Math.max(e.length-1,1)/2;t-=i,r+=i}this._startValue=t,this._endValue=r,this._valueRange=r-t}getLabelForValue(e){return Ql(e,this.chart.options.locale,this.options.ticks.format)}}class mP extends Uh{static id="linear";static defaults={ticks:{callback:Df.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Dt(e)?e:0,this.max=Dt(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,r=Er(this.options.ticks.minRotation),i=(e?Math.sin(r):Math.cos(r))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,s.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const Tl=n=>Math.floor(es(n)),$s=(n,e)=>Math.pow(10,Tl(n)+e);function b_(n){return n/Math.pow(10,Tl(n))===1}function I_(n,e,t){const r=Math.pow(10,t),i=Math.floor(n/r);return Math.ceil(e/r)-i}function _P(n,e){const t=e-n;let r=Tl(t);for(;I_(n,e,r)>10;)r++;for(;I_(n,e,r)<10;)r--;return Math.min(r,Tl(n))}function xP(n,{min:e,max:t}){e=Kn(n.min,e);const r=[],i=Tl(e);let s=_P(e,t),a=s<0?Math.pow(10,Math.abs(s)):1;const o=Math.pow(10,s),c=i>s?Math.pow(10,i):0,l=Math.round((e-c)*a)/a,u=Math.floor((e-c)/o/10)*o*10;let h=Math.floor((l-u)/Math.pow(10,s)),d=Kn(n.min,Math.round((c+u+h*Math.pow(10,s))*a)/a);for(;d<t;)r.push({value:d,major:b_(d),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(s++,h=2,a=s>=0?1:a),d=Math.round((c+u+h*Math.pow(10,s))*a)/a;const p=Kn(n.max,d);return r.push({value:p,major:b_(p),significand:h}),r}class yP extends Ca{static id="logarithmic";static defaults={ticks:{callback:Df.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const r=Uh.prototype.parse.apply(this,[e,t]);if(r===0){this._zero=!0;return}return Dt(r)&&r>0?r:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Dt(e)?Math.max(0,e):null,this.max=Dt(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Dt(this._userMin)&&(this.min=e===$s(this.min,0)?$s(this.min,-1):$s(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let r=this.min,i=this.max;const s=o=>r=e?r:o,a=o=>i=t?i:o;r===i&&(r<=0?(s(1),a(10)):(s($s(r,-1)),a($s(i,1)))),r<=0&&s($s(i,-1)),i<=0&&a($s(r,1)),this.min=r,this.max=i}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},r=xP(t,this);return e.bounds==="ticks"&&Zv(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(e){return e===void 0?"0":Ql(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=es(e),this._valueRange=es(this.max)-es(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(es(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function R0(n){const e=n.ticks;if(e.display&&n.display){const t=kn(e.backdropPadding);return Le(e.font&&e.font.size,At.font.size)+t.height}return 0}function vP(n,e,t){return t=It(t)?t:[t],{w:pS(n,e.string,t),h:t.length*e.lineHeight}}function A_(n,e,t,r,i){return n===r||n===i?{start:e-t/2,end:e+t/2}:n<r||n>i?{start:e-t,end:e}:{start:e,end:e+t}}function EP(n){const e={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},t=Object.assign({},e),r=[],i=[],s=n._pointLabels.length,a=n.options.pointLabels,o=a.centerPointLabels?et/s:0;for(let c=0;c<s;c++){const l=a.setContext(n.getPointLabelContext(c));i[c]=l.padding;const u=n.getPointPosition(c,n.drawingArea+i[c],o),h=Kt(l.font),d=vP(n.ctx,h,n._pointLabels[c]);r[c]=d;const p=xn(n.getIndexAngle(c)+o),g=Math.round(Op(p)),m=A_(g,u.x,d.w,0,180),_=A_(g,u.y,d.h,90,270);wP(t,e,p,m,_)}n.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),n._pointLabelItems=IP(n,r,i)}function wP(n,e,t,r,i){const s=Math.abs(Math.sin(t)),a=Math.abs(Math.cos(t));let o=0,c=0;r.start<e.l?(o=(e.l-r.start)/s,n.l=Math.min(n.l,e.l-o)):r.end>e.r&&(o=(r.end-e.r)/s,n.r=Math.max(n.r,e.r+o)),i.start<e.t?(c=(e.t-i.start)/a,n.t=Math.min(n.t,e.t-c)):i.end>e.b&&(c=(i.end-e.b)/a,n.b=Math.max(n.b,e.b+c))}function TP(n,e,t){const r=n.drawingArea,{extra:i,additionalAngle:s,padding:a,size:o}=t,c=n.getPointPosition(e,r+i+a,s),l=Math.round(Op(xn(c.angle+Lt))),u=kP(c.y,o.h,l),h=AP(l),d=SP(c.x,o.w,h);return{visible:!0,x:c.x,y:u,textAlign:h,left:d,top:u,right:d+o.w,bottom:u+o.h}}function bP(n,e){if(!e)return!0;const{left:t,top:r,right:i,bottom:s}=n;return!(ui({x:t,y:r},e)||ui({x:t,y:s},e)||ui({x:i,y:r},e)||ui({x:i,y:s},e))}function IP(n,e,t){const r=[],i=n._pointLabels.length,s=n.options,{centerPointLabels:a,display:o}=s.pointLabels,c={extra:R0(s)/2,additionalAngle:a?et/i:0};let l;for(let u=0;u<i;u++){c.padding=t[u],c.size=e[u];const h=TP(n,u,c);r.push(h),o==="auto"&&(h.visible=bP(h,l),h.visible&&(l=h))}return r}function AP(n){return n===0||n===180?"center":n<180?"left":"right"}function SP(n,e,t){return t==="right"?n-=e:t==="center"&&(n-=e/2),n}function kP(n,e,t){return t===90||t===270?n-=e/2:(t>270||t<90)&&(n-=e),n}function CP(n,e,t){const{left:r,top:i,right:s,bottom:a}=t,{backdropColor:o}=e;if(!ze(o)){const c=ra(e.borderRadius),l=kn(e.backdropPadding);n.fillStyle=o;const u=r-l.left,h=i-l.top,d=s-r+l.width,p=a-i+l.height;Object.values(c).some(g=>g!==0)?(n.beginPath(),El(n,{x:u,y:h,w:d,h:p,radius:c}),n.fill()):n.fillRect(u,h,d,p)}}function RP(n,e){const{ctx:t,options:{pointLabels:r}}=n;for(let i=e-1;i>=0;i--){const s=n._pointLabelItems[i];if(!s.visible)continue;const a=r.setContext(n.getPointLabelContext(i));CP(t,a,s);const o=Kt(a.font),{x:c,y:l,textAlign:u}=s;da(t,n._pointLabels[i],c,l+o.lineHeight/2,o,{color:a.color,textAlign:u,textBaseline:"middle"})}}function jE(n,e,t,r){const{ctx:i}=n;if(t)i.arc(n.xCenter,n.yCenter,e,0,yt);else{let s=n.getPointPosition(0,e);i.moveTo(s.x,s.y);for(let a=1;a<r;a++)s=n.getPointPosition(a,e),i.lineTo(s.x,s.y)}}function PP(n,e,t,r,i){const s=n.ctx,a=e.circular,{color:o,lineWidth:c}=e;!a&&!r||!o||!c||t<0||(s.save(),s.strokeStyle=o,s.lineWidth=c,s.setLineDash(i.dash||[]),s.lineDashOffset=i.dashOffset,s.beginPath(),jE(n,t,a,r),s.closePath(),s.stroke(),s.restore())}function DP(n,e,t){return ws(n,{label:t,index:e,type:"pointLabel"})}class FP extends Uh{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Df.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=kn(R0(this.options)/2),t=this.width=this.maxWidth-e.width,r=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+r/2+e.top),this.drawingArea=Math.floor(Math.min(t,r)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Dt(e)&&!isNaN(e)?e:0,this.max=Dt(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/R0(this.options))}generateTickLabels(e){Uh.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,r)=>{const i=ft(this.options.pointLabels.callback,[t,r],this);return i||i===0?i:""}).filter((t,r)=>this.chart.getDataVisibility(r))}fit(){const e=this.options;e.display&&e.pointLabels.display?EP(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,r,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((r-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,r,i))}getIndexAngle(e){const t=yt/(this._pointLabels.length||1),r=this.options.startAngle||0;return xn(e*t+Er(r))}getDistanceFromCenterForValue(e){if(ze(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(ze(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const r=t[e];return DP(this.getContext(),e,r)}}getPointPosition(e,t,r=0){const i=this.getIndexAngle(e)-Lt+r;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:r,right:i,bottom:s}=this._pointLabelItems[e];return{left:t,top:r,right:i,bottom:s}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const r=this.ctx;r.save(),r.beginPath(),jE(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),r.closePath(),r.fillStyle=e,r.fill(),r.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:r,grid:i,border:s}=t,a=this._pointLabels.length;let o,c,l;if(t.pointLabels.display&&RP(this,a),i.display&&this.ticks.forEach((u,h)=>{if(h!==0||h===0&&this.min<0){c=this.getDistanceFromCenterForValue(u.value);const d=this.getContext(h),p=i.setContext(d),g=s.setContext(d);PP(this,p,c,a,g)}}),r.display){for(e.save(),o=a-1;o>=0;o--){const u=r.setContext(this.getPointLabelContext(o)),{color:h,lineWidth:d}=u;!d||!h||(e.lineWidth=d,e.strokeStyle=h,e.setLineDash(u.borderDash),e.lineDashOffset=u.borderDashOffset,c=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),l=this.getPointPosition(o,c),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,r=t.ticks;if(!r.display)return;const i=this.getIndexAngle(0);let s,a;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((o,c)=>{if(c===0&&this.min>=0&&!t.reverse)return;const l=r.setContext(this.getContext(c)),u=Kt(l.font);if(s=this.getDistanceFromCenterForValue(this.ticks[c].value),l.showLabelBackdrop){e.font=u.string,a=e.measureText(o.label).width,e.fillStyle=l.backdropColor;const h=kn(l.backdropPadding);e.fillRect(-a/2-h.left,-s-u.size/2-h.top,a+h.width,u.size+h.height)}da(e,o.label,0,-s,u,{color:l.color,strokeColor:l.textStrokeColor,strokeWidth:l.textStrokeWidth})}),e.restore()}drawTitle(){}}const Bf={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},$n=Object.keys(Bf);function S_(n,e){return n-e}function k_(n,e){if(ze(e))return null;const t=n._adapter,{parser:r,round:i,isoWeekday:s}=n._parseOpts;let a=e;return typeof r=="function"&&(a=r(a)),Dt(a)||(a=typeof r=="string"?t.parse(a,r):t.parse(a)),a===null?null:(i&&(a=i==="week"&&(xo(s)||s===!0)?t.startOf(a,"isoWeek",s):t.startOf(a,i)),+a)}function C_(n,e,t,r){const i=$n.length;for(let s=$n.indexOf(n);s<i-1;++s){const a=Bf[$n[s]],o=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((t-e)/(o*a.size))<=r)return $n[s]}return $n[i-1]}function OP(n,e,t,r,i){for(let s=$n.length-1;s>=$n.indexOf(t);s--){const a=$n[s];if(Bf[a].common&&n._adapter.diff(i,r,a)>=e-1)return a}return $n[t?$n.indexOf(t):0]}function MP(n){for(let e=$n.indexOf(n)+1,t=$n.length;e<t;++e)if(Bf[$n[e]].common)return $n[e]}function R_(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:r,hi:i}=Mp(t,e),s=t[r]>=e?t[r]:t[i];n[s]=!0}}function LP(n,e,t,r){const i=n._adapter,s=+i.startOf(e[0].value,r),a=e[e.length-1].value;let o,c;for(o=s;o<=a;o=+i.add(o,1,r))c=t[o],c>=0&&(e[c].major=!0);return e}function P_(n,e,t){const r=[],i={},s=e.length;let a,o;for(a=0;a<s;++a)o=e[a],i[o]=a,r.push({value:o,major:!1});return s===0||!t?r:LP(n,r,i,t)}class P0 extends Ca{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const r=e.time||(e.time={}),i=this._adapter=new Nk._date(e.adapters.date);i.init(t),Wc(r.displayFormats,i.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:k_(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,r=e.time.unit||"day";let{min:i,max:s,minDefined:a,maxDefined:o}=this.getUserBounds();function c(l){!a&&!isNaN(l.min)&&(i=Math.min(i,l.min)),!o&&!isNaN(l.max)&&(s=Math.max(s,l.max))}(!a||!o)&&(c(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&c(this.getMinMax(!1))),i=Dt(i)&&!isNaN(i)?i:+t.startOf(Date.now(),r),s=Dt(s)&&!isNaN(s)?s:+t.endOf(Date.now(),r)+1,this.min=Math.min(i,s-1),this.max=Math.max(i+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],r=e[e.length-1]),{min:t,max:r}}buildTicks(){const e=this.options,t=e.time,r=e.ticks,i=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const s=this.min,a=this.max,o=tS(i,s,a);return this._unit=t.unit||(r.autoSkip?C_(t.minUnit,this.min,this.max,this._getLabelCapacity(s)):OP(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:MP(this._unit),this.initOffsets(i),e.reverse&&o.reverse(),P_(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,r=0,i,s;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?t=1-i:t=(this.getDecimalForValue(e[1])-i)/2,s=this.getDecimalForValue(e[e.length-1]),e.length===1?r=s:r=(s-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;t=sn(t,0,a),r=sn(r,0,a),this._offsets={start:t,end:r,factor:1/(t+1+r)}}_generate(){const e=this._adapter,t=this.min,r=this.max,i=this.options,s=i.time,a=s.unit||C_(s.minUnit,t,r,this._getLabelCapacity(t)),o=Le(i.ticks.stepSize,1),c=a==="week"?s.isoWeekday:!1,l=xo(c)||c===!0,u={};let h=t,d,p;if(l&&(h=+e.startOf(h,"isoWeek",c)),h=+e.startOf(h,l?"day":a),e.diff(r,t,a)>1e5*o)throw new Error(t+" and "+r+" are too far apart with stepSize of "+o+" "+a);const g=i.ticks.source==="data"&&this.getDataTimestamps();for(d=h,p=0;d<r;d=+e.add(d,o,a),p++)R_(u,d,g);return(d===r||i.bounds==="ticks"||p===1)&&R_(u,d,g),Object.keys(u).sort(S_).map(m=>+m)}getLabelForValue(e){const t=this._adapter,r=this.options.time;return r.tooltipFormat?t.format(e,r.tooltipFormat):t.format(e,r.displayFormats.datetime)}format(e,t){const i=this.options.time.displayFormats,s=this._unit,a=t||i[s];return this._adapter.format(e,a)}_tickFormatFunction(e,t,r,i){const s=this.options,a=s.ticks.callback;if(a)return ft(a,[e,t,r],this);const o=s.time.displayFormats,c=this._unit,l=this._majorUnit,u=c&&o[c],h=l&&o[l],d=r[t],p=l&&h&&d&&d.major;return this._adapter.format(e,i||(p?h:u))}generateTickLabels(e){let t,r,i;for(t=0,r=e.length;t<r;++t)i=e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+r)*t.factor)}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,r=this.ctx.measureText(e).width,i=Er(this.isHorizontal()?t.maxRotation:t.minRotation),s=Math.cos(i),a=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:r*s+o*a,h:r*a+o*s}}_getLabelCapacity(e){const t=this.options.time,r=t.displayFormats,i=r[t.unit]||r.millisecond,s=this._tickFormatFunction(e,0,P_(this,[e],this._majorUnit),i),a=this._getLabelSize(s),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],t,r;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,r=i.length;t<r;++t)e=e.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,r;if(e.length)return e;const i=this.getLabels();for(t=0,r=i.length;t<r;++t)e.push(k_(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return nE(e.sort(S_))}}function Ku(n,e,t){let r=0,i=n.length-1,s,a,o,c;t?(e>=n[r].pos&&e<=n[i].pos&&({lo:r,hi:i}=li(n,"pos",e)),{pos:s,time:o}=n[r],{pos:a,time:c}=n[i]):(e>=n[r].time&&e<=n[i].time&&({lo:r,hi:i}=li(n,"time",e)),{time:s,pos:o}=n[r],{time:a,pos:c}=n[i]);const l=a-s;return l?o+(c-o)*(e-s)/l:o}class NP extends P0{static id="timeseries";static defaults=P0.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Ku(t,this.min),this._tableRange=Ku(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:r}=this,i=[],s=[];let a,o,c,l,u;for(a=0,o=e.length;a<o;++a)l=e[a],l>=t&&l<=r&&i.push(l);if(i.length<2)return[{time:t,pos:0},{time:r,pos:1}];for(a=0,o=i.length;a<o;++a)u=i[a+1],c=i[a-1],l=i[a],Math.round((u+c)/2)!==l&&s.push({time:l,pos:a/(o-1)});return s}_generate(){const e=this.min,t=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(t)||r.length===1)&&r.push(t),r.sort((i,s)=>i-s)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),r=this.getLabelTimestamps();return t.length&&r.length?e=this.normalize(t.concat(r)):e=t.length?t:r,e=this._cache.all=e,e}getDecimalForValue(e){return(Ku(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return Ku(this._table,r*this._tableRange+this._minPos,!0)}}var VP=Object.freeze({__proto__:null,CategoryScale:pP,LinearScale:mP,LogarithmicScale:yP,RadialLinearScale:FP,TimeScale:P0,TimeSeriesScale:NP});const BP=[Lk,gR,uP,VP];Gp.register(...BP);const P={authOverlay:document.getElementById("auth-overlay"),mainApp:document.getElementById("main-app"),loggedInUserNameEl:document.getElementById("logged-in-user-name"),btnLogout:document.getElementById("btn-logout"),authForm:document.getElementById("auth-form"),authError:document.getElementById("auth-error"),registerFields:document.getElementById("register-fields"),btnLogin:document.getElementById("btn-login"),btnRegister:document.getElementById("btn-register"),authSwitchBack:document.getElementById("auth-switch-back"),linkBackLogin:document.getElementById("link-back-login"),authPending:document.getElementById("auth-pending"),btnPendingLogout:document.getElementById("btn-pending-logout"),tabBtnAdmin:document.getElementById("tab-btn-admin"),adminUsersList:document.getElementById("admin-users-list"),adminPreapproveForm:document.getElementById("admin-preapprove-form"),adminNewEmail:document.getElementById("admin-new-email"),adminEmailsList:document.getElementById("admin-emails-list"),tabBtns:document.querySelectorAll(".tab-btn"),tabContents:document.querySelectorAll(".tab-content"),playerSelect:document.getElementById("player-select"),recordPlayerNameEl:document.getElementById("record-player-name"),addRoundContainer:document.getElementById("add-round-container"),readonlyWarningContainer:document.getElementById("readonly-warning-container"),addRoundForm:document.getElementById("add-round-form"),historyTbody:document.getElementById("history-tbody"),emptyState:document.getElementById("empty-state"),loadingState:document.getElementById("loading-state"),handicapIndexEl:document.getElementById("handicap-index"),indexSubtextEl:document.getElementById("index-subtext"),btnCalculateDaily:document.getElementById("btn-calculate-daily"),dailyHandicapResult:document.getElementById("daily-handicap-result"),dhPlayerName:document.getElementById("dh-player-name"),dhValue:document.getElementById("dh-value"),tabBtnComp:document.getElementById("tab-btn-comp"),btnCreateCompContainer:document.getElementById("btn-show-create-comp"),createCompContainer:document.getElementById("create-comp-container"),createCompForm:document.getElementById("create-comp-form"),btnCancelComp:document.getElementById("btn-cancel-comp"),compSelect:document.getElementById("comp-select"),logCompRoundContainer:document.getElementById("log-comp-round-form")?document.getElementById("log-comp-round-form").closest(".card"):null,logCompRoundForm:document.getElementById("log-comp-round-form"),compRecentRoundsTbody:document.getElementById("comp-recent-rounds-tbody"),compLeaderboardHead:document.getElementById("comp-leaderboard-head"),compLeaderboardTbody:document.getElementById("comp-leaderboard-tbody"),compRulesDesc:document.getElementById("active-comp-rules-summary"),tabBtnPractice:document.querySelector('[data-target="tab-practice"]'),practiceSelect:document.getElementById("drill-select"),btnLogPracticeContainer:document.getElementById("practice-form-container"),logPracticeContainer:document.getElementById("practice-form-container"),logPracticeForm:document.getElementById("form-log-practice"),btnSavePractice:document.getElementById("btn-save-practice"),btnEmailCoach:document.getElementById("btn-email-coach"),btnExportPractice:document.getElementById("btn-export-practice"),drillLiveTotalEl:document.getElementById("drill-live-total"),btnCancelPractice:document.getElementById("btn-cancel-practice"),practiceDashboardResults:document.getElementById("practice-best-score")?document.getElementById("practice-best-score").parentElement.parentElement:null,practiceRecentTbody:document.getElementById("practice-history-tbody"),tabBtnOncourse:document.getElementById("tab-btn-oncourse"),btnModeSimple:document.getElementById("btn-mode-simple"),btnModeDetailed:document.getElementById("btn-mode-detailed"),ocModeDesc:document.getElementById("oc-mode-desc"),btnRound9:document.getElementById("btn-round-9"),btnRound18:document.getElementById("btn-round-18"),ocCourseSelect:document.getElementById("oc-course-select"),ocTeeSelect:document.getElementById("oc-tee-select"),ocCourseInfoLine:document.getElementById("oc-course-info-line"),ocDailyHandicapLine:document.getElementById("oc-daily-handicap-line"),ocPlayerSelect:document.getElementById("oc-player-select"),btnOcAddPlayer:document.getElementById("btn-oc-add-player"),ocAddedPlayersList:document.getElementById("oc-players-list"),ocLinkComp:document.getElementById("oc-link-comp"),btnOcStart:document.getElementById("btn-oc-start"),btnWizardPrev:document.getElementById("btn-wizard-prev"),btnWizardNext:document.getElementById("btn-wizard-next"),btnWizardDelete:document.getElementById("btn-wizard-delete"),btnOcReviewRound:document.getElementById("btn-oc-review-round"),reviewRoundModal:document.getElementById("review-round-modal"),tempoPlayBtn:document.getElementById("tempo-play-btn"),tempoResetCounter:document.getElementById("tempo-reset-counter"),tempoSwingCounter:document.getElementById("tempo-swing-counter"),tempoSwingState:document.getElementById("tempo-swing-state"),tempoCoreCircle:document.getElementById("tempo-core-circle"),tempoRing:document.getElementById("tempo-ring"),tempoSelect:document.getElementById("tempo-select"),tempoVibeSelect:document.getElementById("tempo-vibe-select"),tempoSpeedSlider:document.getElementById("tempo-speed-slider"),tempoSpeedDisplay:document.getElementById("tempo-speed-display"),tempoDelaySlider:document.getElementById("tempo-delay-slider"),tempoDelayDisplay:document.getElementById("tempo-delay-display"),tempoLoopToggle:document.getElementById("tempo-loop-toggle"),tempoDelayContainer:document.getElementById("tempo-delay-container"),nativeAudioPlayer:document.getElementById("native-audio-player"),reviewContent:document.getElementById("review-content"),btnCloseReview:document.getElementById("btn-close-review"),btnReviewFinished:document.getElementById("btn-review-finished"),aiModalOverlay:document.getElementById("ai-modal-overlay"),aiModalTitle:document.getElementById("ai-modal-title"),aiPromptTextarea:document.getElementById("ai-prompt-textarea"),btnCopyAiPrompt:document.getElementById("btn-copy-ai-prompt"),btnCloseAiModal:document.getElementById("btn-close-ai-modal")},D_="golfAppDefaultTab";function UP(){const n=localStorage.getItem(D_);if(n){const e=Array.from(P.tabBtns).find(t=>t.getAttribute("data-target")===n);if(e){P.tabBtns.forEach(r=>r.classList.remove("active")),P.tabContents.forEach(r=>{r.classList.add("hidden"),r.classList.remove("active")}),e.classList.add("active");const t=document.getElementById(n);t&&(t.classList.remove("hidden"),t.classList.add("active"))}}P.tabBtns.forEach(e=>{e.addEventListener("click",()=>{P.tabBtns.forEach(i=>i.classList.remove("active")),P.tabContents.forEach(i=>{i.classList.add("hidden"),i.classList.remove("active")}),e.classList.add("active");const t=e.getAttribute("data-target"),r=document.getElementById(t);r&&(r.classList.remove("hidden"),r.classList.add("active"),localStorage.setItem(D_,t))})})}function F_(n=H.currentRounds,e=[]){if(!P.historyTbody)return;P.historyTbody.innerHTML="";const t=H.currentUser&&H.viewingPlayerId===H.currentUser.uid,r=window.currentUserIsAdmin||!1;n.length===0?P.emptyState&&P.emptyState.classList.remove("hidden"):(P.emptyState&&P.emptyState.classList.add("hidden"),n.forEach(i=>{const s=document.createElement("tr");i.notCounting&&(s.style.opacity="0.5",s.style.textDecoration="line-through");const a=(113/i.slope*(i.adjustedGross-i.rating)).toFixed(1);let o=`<span>${a}</span>`;e.includes(i.id)&&(o=`<span class="asterisk-highlight">${a} *</span>`);let c=i.date;c&&c.toDate?c=c.toDate():typeof c=="string"&&(c=new Date(c));const l=c?c.toLocaleDateString():"Unknown";s.innerHTML=`
                <td>${l}</td>
                <td>${i.course}</td>
                <td>${i.rating} / ${i.slope}</td>
                <td><strong>${i.adjustedGross}</strong></td>
                <td>${o}</td>
                <td>
                    <button class="btn btn-secondary btn-sm toggle-count-btn" data-id="${i.id}" title="Toggle Counting Rules">
                        ${i.notCounting?"Include":"Exclude"}
                    </button>
                    ${t||r?`<button class="btn btn-danger btn-sm del-round-btn" data-id="${i.id}">X</button>`:""}
                </td>
            `,P.historyTbody.appendChild(s)}))}function HP(n=H.liveRoundGroups){P.ocAddedPlayersList&&(P.ocAddedPlayersList.innerHTML="",n.forEach((e,t)=>{const r=document.createElement("div");r.style.cssText="display:flex; justify-content:space-between; align-items:center; padding:8px; background:#f1f5f9; margin-bottom:5px; border-radius:5px;";const i=document.createElement("span");i.textContent=e.name;const s=document.createElement("button");s.textContent="Remove",s.className="btn-text",s.style.cssText="color:#ef4444; padding:0;",s.addEventListener("click",()=>{H.liveRoundGroups.splice(t,1),H.liveRoundGroups=[...H.liveRoundGroups]}),r.appendChild(i),r.appendChild(s),P.ocAddedPlayersList.appendChild(r)}))}let Yu=null;function zP(n=H.currentRounds){const e=document.getElementById("handicap-chart"),t=document.getElementById("chart-no-data");if(!e)return;const r=n.filter(a=>!a.notCounting&&a.slope&&a.adjustedGross&&a.rating).sort((a,o)=>{const c=a.date?.toDate?a.date.toDate():new Date(a.date),l=o.date?.toDate?o.date.toDate():new Date(o.date);return c-l});if(r.length<3){e.style.display="none",t&&t.classList.remove("hidden");return}e.style.display="",t&&t.classList.add("hidden");const i=r.map(a=>(a.date?.toDate?a.date.toDate():new Date(a.date)).toLocaleDateString("en-AU",{day:"numeric",month:"short"})),s=r.map(a=>+(113/a.slope*(a.adjustedGross-a.rating)).toFixed(1));Yu&&(Yu.destroy(),Yu=null),Yu=new Gp(e,{type:"line",data:{labels:i,datasets:[{label:"Differential",data:s,borderColor:"#3867d6",backgroundColor:"rgba(56,103,214,0.08)",fill:!0,tension:.4,pointBackgroundColor:"#3867d6",pointRadius:5,pointHoverRadius:7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:a=>` Differential: ${a.parsed.y}`}}},scales:{y:{reverse:!1,title:{display:!0,text:"Differential (lower = better)"},grid:{color:"rgba(0,0,0,0.04)"}},x:{grid:{display:!1}}}}})}window.addEventListener("stateChange",n=>{const{property:e,newValue:t}=n.detail;switch(e){case"currentRounds":F_(t,H.usedIds),zP(t);break;case"handicapIndex":P.handicapIndexEl&&(P.handicapIndexEl.textContent=t>0?t:"N/A"),P.indexSubtextEl&&(P.indexSubtextEl.textContent=H.currentRounds.filter(r=>r.notCounting!==!0).length<3?"Need 3 scores to establish index":"Current WHS Index");break;case"usedIds":F_(H.currentRounds,t);break;case"liveRoundGroups":HP(t);break;case"currentUser":t?P.loggedInUserNameEl&&(P.loggedInUserNameEl.textContent=t.displayName||t.email):P.loggedInUserNameEl&&(P.loggedInUserNameEl.textContent="");break}});const $P=()=>{};var O_={};const GE=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},WP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],a=n[t++],o=n[t++],c=((i&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},qE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],a=i+1<n.length,o=a?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0,u=s>>2,h=(s&3)<<4|o>>4;let d=(o&15)<<2|l>>6,p=l&63;c||(p=64,a||(d=64)),r.push(t[u],t[h],t[d],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(GE(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):WP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],o=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||o==null||l==null||h==null)throw new jP;const d=s<<2|o>>4;if(r.push(d),l!==64){const p=o<<4&240|l>>2;if(r.push(p),h!==64){const g=l<<6&192|h;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class jP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const GP=function(n){const e=GE(n);return qE.encodeByteArray(e,!0)},KE=function(n){return GP(n).replace(/\./g,"")},YE=function(n){try{return qE.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function XE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const qP=()=>XE().__FIREBASE_DEFAULTS__,KP=()=>{if(typeof process>"u"||typeof O_>"u")return;const n=O_.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},YP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&YE(n[1]);return e&&JSON.parse(e)},Uf=()=>{try{return $P()||qP()||KP()||YP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},QE=n=>Uf()?.emulatorHosts?.[n],XP=n=>{const e=QE(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},JE=()=>Uf()?.config,ZE=n=>Uf()?.[`_${n}`];class QP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function bs(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Kp(n){return(await fetch(n,{credentials:"include"})).ok}const Kc={};function JP(){const n={prod:[],emulator:[]};for(const e of Object.keys(Kc))Kc[e]?n.emulator.push(e):n.prod.push(e);return n}function ZP(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let M_=!1;function ew(n,e){if(typeof window>"u"||typeof document>"u"||!bs(window.location.host)||Kc[n]===e||Kc[n]||M_)return;Kc[n]=e;function t(d){return`__firebase__banner__${d}`}const r="__firebase__banner",s=JP().prod.length>0;function a(){const d=document.getElementById(r);d&&d.remove()}function o(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function c(d,p){d.setAttribute("width","24"),d.setAttribute("id",p),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function l(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{M_=!0,a()},d}function u(d,p){d.setAttribute("id",p),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=ZP(r),p=t("text"),g=document.getElementById(p)||document.createElement("span"),m=t("learnmore"),_=document.getElementById(m)||document.createElement("a"),E=t("preprendIcon"),I=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const v=d.element;o(v),u(_,m);const R=l();c(I,E),v.append(I,g,_,R),document.body.appendChild(v)}s?(g.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function Zt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function eD(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zt())}function tw(){const n=Uf()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function tD(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function nD(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function rD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function iD(){const n=Zt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function nw(){return!tw()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rw(){return!tw()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function iw(){try{return typeof indexedDB=="object"}catch{return!1}}function sD(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const aD="FirebaseError";class Yr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=aD,Object.setPrototypeOf(this,Yr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jl.prototype.create)}}class Jl{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?oD(s,r):"Error",o=`${this.serviceName}: ${a} (${i}).`;return new Yr(i,o,r)}}function oD(n,e){return n.replace(cD,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const cD=/\{\$([^}]+)}/g;function lD(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function pa(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],a=e[i];if(L_(s)&&L_(a)){if(!pa(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function L_(n){return n!==null&&typeof n=="object"}function Zl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Dc(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Fc(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function uD(n,e){const t=new hD(n,e);return t.subscribe.bind(t)}class hD{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");fD(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=zd),i.error===void 0&&(i.error=zd),i.complete===void 0&&(i.complete=zd);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function fD(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function zd(){}function vt(n){return n&&n._delegate?n._delegate:n}class gs{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const qs="[DEFAULT]";class dD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new QP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gD(e))try{this.getOrInitializeService({instanceIdentifier:qs})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=qs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=qs){return this.instances.has(e)}getOptions(e=qs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);r===o&&a.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:pD(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=qs){return this.component?this.component.multipleInstances?e:qs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function pD(n){return n===qs?void 0:n}function gD(n){return n.instantiationMode==="EAGER"}class mD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new dD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var $e;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})($e||($e={}));const _D={debug:$e.DEBUG,verbose:$e.VERBOSE,info:$e.INFO,warn:$e.WARN,error:$e.ERROR,silent:$e.SILENT},xD=$e.INFO,yD={[$e.DEBUG]:"log",[$e.VERBOSE]:"log",[$e.INFO]:"info",[$e.WARN]:"warn",[$e.ERROR]:"error"},vD=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=yD[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yp{constructor(e){this.name=e,this._logLevel=xD,this._logHandler=vD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $e))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_D[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$e.DEBUG,...e),this._logHandler(this,$e.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$e.VERBOSE,...e),this._logHandler(this,$e.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$e.INFO,...e),this._logHandler(this,$e.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$e.WARN,...e),this._logHandler(this,$e.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$e.ERROR,...e),this._logHandler(this,$e.ERROR,...e)}}const ED=(n,e)=>e.some(t=>n instanceof t);let N_,V_;function wD(){return N_||(N_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function TD(){return V_||(V_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sw=new WeakMap,D0=new WeakMap,aw=new WeakMap,$d=new WeakMap,Xp=new WeakMap;function bD(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(os(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&sw.set(t,n)}).catch(()=>{}),Xp.set(e,n),e}function ID(n){if(D0.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});D0.set(n,e)}let F0={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return D0.get(n);if(e==="objectStoreNames")return n.objectStoreNames||aw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return os(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function AD(n){F0=n(F0)}function SD(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Wd(this),e,...t);return aw.set(r,e.sort?e.sort():[e]),os(r)}:TD().includes(n)?function(...e){return n.apply(Wd(this),e),os(sw.get(this))}:function(...e){return os(n.apply(Wd(this),e))}}function kD(n){return typeof n=="function"?SD(n):(n instanceof IDBTransaction&&ID(n),ED(n,wD())?new Proxy(n,F0):n)}function os(n){if(n instanceof IDBRequest)return bD(n);if($d.has(n))return $d.get(n);const e=kD(n);return e!==n&&($d.set(n,e),Xp.set(e,n)),e}const Wd=n=>Xp.get(n);function CD(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,e),o=os(a);return r&&a.addEventListener("upgradeneeded",c=>{r(os(a.result),c.oldVersion,c.newVersion,os(a.transaction),c)}),t&&a.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),o.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),o}const RD=["get","getKey","getAll","getAllKeys","count"],PD=["put","add","delete","clear"],jd=new Map;function B_(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(jd.get(e))return jd.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=PD.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||RD.includes(t)))return;const s=async function(a,...o){const c=this.transaction(a,i?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(o.shift())),(await Promise.all([l[t](...o),i&&c.done]))[0]};return jd.set(e,s),s}AD(n=>({...n,get:(e,t,r)=>B_(e,t)||n.get(e,t,r),has:(e,t)=>!!B_(e,t)||n.has(e,t)}));class DD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(FD(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function FD(n){return n.getComponent()?.type==="VERSION"}const O0="@firebase/app",U_="0.14.9";const xi=new Yp("@firebase/app"),OD="@firebase/app-compat",MD="@firebase/analytics-compat",LD="@firebase/analytics",ND="@firebase/app-check-compat",VD="@firebase/app-check",BD="@firebase/auth",UD="@firebase/auth-compat",HD="@firebase/database",zD="@firebase/data-connect",$D="@firebase/database-compat",WD="@firebase/functions",jD="@firebase/functions-compat",GD="@firebase/installations",qD="@firebase/installations-compat",KD="@firebase/messaging",YD="@firebase/messaging-compat",XD="@firebase/performance",QD="@firebase/performance-compat",JD="@firebase/remote-config",ZD="@firebase/remote-config-compat",e4="@firebase/storage",t4="@firebase/storage-compat",n4="@firebase/firestore",r4="@firebase/ai",i4="@firebase/firestore-compat",s4="firebase",a4="12.10.0";const M0="[DEFAULT]",o4={[O0]:"fire-core",[OD]:"fire-core-compat",[LD]:"fire-analytics",[MD]:"fire-analytics-compat",[VD]:"fire-app-check",[ND]:"fire-app-check-compat",[BD]:"fire-auth",[UD]:"fire-auth-compat",[HD]:"fire-rtdb",[zD]:"fire-data-connect",[$D]:"fire-rtdb-compat",[WD]:"fire-fn",[jD]:"fire-fn-compat",[GD]:"fire-iid",[qD]:"fire-iid-compat",[KD]:"fire-fcm",[YD]:"fire-fcm-compat",[XD]:"fire-perf",[QD]:"fire-perf-compat",[JD]:"fire-rc",[ZD]:"fire-rc-compat",[e4]:"fire-gcs",[t4]:"fire-gcs-compat",[n4]:"fire-fst",[i4]:"fire-fst-compat",[r4]:"fire-vertex","fire-js":"fire-js",[s4]:"fire-js-all"};const Hh=new Map,c4=new Map,L0=new Map;function H_(n,e){try{n.container.addComponent(e)}catch(t){xi.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ga(n){const e=n.name;if(L0.has(e))return xi.debug(`There were multiple attempts to register component ${e}.`),!1;L0.set(e,n);for(const t of Hh.values())H_(t,n);for(const t of c4.values())H_(t,n);return!0}function Hf(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Qn(n){return n==null?!1:n.settings!==void 0}const l4={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},cs=new Jl("app","Firebase",l4);class u4{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new gs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw cs.create("app-deleted",{appName:this._name})}}const jo=a4;function ow(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:M0,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw cs.create("bad-app-name",{appName:String(i)});if(t||(t=JE()),!t)throw cs.create("no-options");const s=Hh.get(i);if(s){if(pa(t,s.options)&&pa(r,s.config))return s;throw cs.create("duplicate-app",{appName:i})}const a=new mD(i);for(const c of L0.values())a.addComponent(c);const o=new u4(t,r,a);return Hh.set(i,o),o}function cw(n=M0){const e=Hh.get(n);if(!e&&n===M0&&JE())return ow();if(!e)throw cs.create("no-app",{appName:n});return e}function Hr(n,e,t){let r=o4[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),xi.warn(a.join(" "));return}ga(new gs(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const h4="firebase-heartbeat-database",f4=1,bl="firebase-heartbeat-store";let Gd=null;function lw(){return Gd||(Gd=CD(h4,f4,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(bl)}catch(t){console.warn(t)}}}}).catch(n=>{throw cs.create("idb-open",{originalErrorMessage:n.message})})),Gd}async function d4(n){try{const t=(await lw()).transaction(bl),r=await t.objectStore(bl).get(uw(n));return await t.done,r}catch(e){if(e instanceof Yr)xi.warn(e.message);else{const t=cs.create("idb-get",{originalErrorMessage:e?.message});xi.warn(t.message)}}}async function z_(n,e){try{const r=(await lw()).transaction(bl,"readwrite");await r.objectStore(bl).put(e,uw(n)),await r.done}catch(t){if(t instanceof Yr)xi.warn(t.message);else{const r=cs.create("idb-set",{originalErrorMessage:t?.message});xi.warn(r.message)}}}function uw(n){return`${n.name}!${n.options.appId}`}const p4=1024,g4=30;class m4{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new x4(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=$_();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>g4){const i=y4(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){xi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=$_(),{heartbeatsToSend:t,unsentEntries:r}=_4(this._heartbeatsCache.heartbeats),i=KE(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return xi.warn(e),""}}}function $_(){return new Date().toISOString().substring(0,10)}function _4(n,e=p4){const t=[];let r=n.slice();for(const i of n){const s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),W_(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),W_(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class x4{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return iw()?sD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await d4(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return z_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return z_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function W_(n){return KE(JSON.stringify({version:2,heartbeats:n})).length}function y4(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function v4(n){ga(new gs("platform-logger",e=>new DD(e),"PRIVATE")),ga(new gs("heartbeat",e=>new m4(e),"PRIVATE")),Hr(O0,U_,n),Hr(O0,U_,"esm2020"),Hr("fire-js","")}v4("");var E4="firebase",w4="12.10.0";Hr(E4,w4,"app");function hw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const T4=hw,fw=new Jl("auth","Firebase",hw());const zh=new Yp("@firebase/auth");function b4(n,...e){zh.logLevel<=$e.WARN&&zh.warn(`Auth (${jo}): ${n}`,...e)}function mh(n,...e){zh.logLevel<=$e.ERROR&&zh.error(`Auth (${jo}): ${n}`,...e)}function Sr(n,...e){throw Qp(n,...e)}function zr(n,...e){return Qp(n,...e)}function dw(n,e,t){const r={...T4(),[e]:t};return new Jl("auth","Firebase",r).create(e,{appName:n.name})}function gi(n){return dw(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Qp(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return fw.create(n,...e)}function Re(n,e,...t){if(!n)throw Qp(e,...t)}function hi(n){const e="INTERNAL ASSERTION FAILED: "+n;throw mh(e),new Error(e)}function yi(n,e){n||hi(e)}function N0(){return typeof self<"u"&&self.location?.href||""}function I4(){return j_()==="http:"||j_()==="https:"}function j_(){return typeof self<"u"&&self.location?.protocol||null}function A4(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(I4()||nD()||"connection"in navigator)?navigator.onLine:!0}function S4(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class eu{constructor(e,t){this.shortDelay=e,this.longDelay=t,yi(t>e,"Short delay should be less than long delay!"),this.isMobile=eD()||rD()}get(){return A4()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jp(n,e){yi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class pw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;hi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;hi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;hi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const k4={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const C4=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],R4=new eu(3e4,6e4);function Ai(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Xr(n,e,t,r,i={}){return gw(n,i,async()=>{let s={},a={};r&&(e==="GET"?a=r:s={body:JSON.stringify(r)});const o=Zl({key:n.config.apiKey,...a}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const l={method:e,headers:c,...s};return tD()||(l.referrerPolicy="no-referrer"),n.emulatorConfig&&bs(n.emulatorConfig.host)&&(l.credentials="include"),pw.fetch()(await mw(n,n.config.apiHost,t,o),l)})}async function gw(n,e,t){n._canInitEmulator=!1;const r={...k4,...e};try{const i=new D4(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Xu(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[c,l]=o.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xu(n,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Xu(n,"email-already-in-use",a);if(c==="USER_DISABLED")throw Xu(n,"user-disabled",a);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw dw(n,u,l);Sr(n,u)}}catch(i){if(i instanceof Yr)throw i;Sr(n,"network-request-failed",{message:String(i)})}}async function tu(n,e,t,r,i={}){const s=await Xr(n,e,t,r,i);return"mfaPendingCredential"in s&&Sr(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function mw(n,e,t,r){const i=`${e}${t}?${r}`,s=n,a=s.config.emulator?Jp(n.config,i):`${n.config.apiScheme}://${i}`;return C4.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function P4(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class D4{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(zr(this.auth,"network-request-failed")),R4.get())})}}function Xu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=zr(n,e,r);return i.customData._tokenResponse=t,i}function G_(n){return n!==void 0&&n.enterprise!==void 0}class F4{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return P4(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function O4(n,e){return Xr(n,"GET","/v2/recaptchaConfig",Ai(n,e))}async function M4(n,e){return Xr(n,"POST","/v1/accounts:delete",e)}async function $h(n,e){return Xr(n,"POST","/v1/accounts:lookup",e)}function Yc(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function L4(n,e=!1){const t=vt(n),r=await t.getIdToken(e),i=Zp(r);Re(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:Yc(qd(i.auth_time)),issuedAtTime:Yc(qd(i.iat)),expirationTime:Yc(qd(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function qd(n){return Number(n)*1e3}function Zp(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return mh("JWT malformed, contained fewer than 3 sections"),null;try{const i=YE(t);return i?JSON.parse(i):(mh("Failed to decode base64 JWT payload"),null)}catch(i){return mh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function q_(n){const e=Zp(n);return Re(e,"internal-error"),Re(typeof e.exp<"u","internal-error"),Re(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Eo(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Yr&&N4(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function N4({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class V4{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class V0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Yc(this.lastLoginAt),this.creationTime=Yc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Wh(n){const e=n.auth,t=await n.getIdToken(),r=await Eo(n,$h(e,{idToken:t}));Re(r?.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const s=i.providerUserInfo?.length?_w(i.providerUserInfo):[],a=U4(n.providerData,s),o=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!a?.length,l=o?c:!1,u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new V0(i.createdAt,i.lastLoginAt),isAnonymous:l};Object.assign(n,u)}async function B4(n){const e=vt(n);await Wh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function U4(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function _w(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function H4(n,e){const t=await gw(n,{},async()=>{const r=Zl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=await mw(n,i,"/v1/token",`key=${s}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:o,body:r};return n.emulatorConfig&&bs(n.emulatorConfig.host)&&(c.credentials="include"),pw.fetch()(a,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function z4(n,e){return Xr(n,"POST","/v2/accounts:revokeToken",Ai(n,e))}class lo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Re(e.idToken,"internal-error"),Re(typeof e.idToken<"u","internal-error"),Re(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):q_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Re(e.length!==0,"internal-error");const t=q_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Re(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await H4(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new lo;return r&&(Re(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(Re(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(Re(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lo,this.toJSON())}_performRefresh(){return hi("not implemented")}}function Hi(n,e){Re(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class wr{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new V4(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new V0(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Eo(this,this.stsTokenManager.getToken(this.auth,e));return Re(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return L4(this,e)}reload(){return B4(this)}_assign(e){this!==e&&(Re(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new wr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Re(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Wh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qn(this.auth.app))return Promise.reject(gi(this.auth));const e=await this.getIdToken();return await Eo(this,M4(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,c=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:d,isAnonymous:p,providerData:g,stsTokenManager:m}=t;Re(h&&m,e,"internal-error");const _=lo.fromJSON(this.name,m);Re(typeof h=="string",e,"internal-error"),Hi(r,e.name),Hi(i,e.name),Re(typeof d=="boolean",e,"internal-error"),Re(typeof p=="boolean",e,"internal-error"),Hi(s,e.name),Hi(a,e.name),Hi(o,e.name),Hi(c,e.name),Hi(l,e.name),Hi(u,e.name);const E=new wr({uid:h,auth:e,email:i,emailVerified:d,displayName:r,isAnonymous:p,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:_,createdAt:l,lastLoginAt:u});return g&&Array.isArray(g)&&(E.providerData=g.map(I=>({...I}))),c&&(E._redirectEventId=c),E}static async _fromIdTokenResponse(e,t,r=!1){const i=new lo;i.updateFromServerResponse(t);const s=new wr({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Wh(s),s}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];Re(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?_w(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,o=new lo;o.updateFromIdToken(r);const c=new wr({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:a}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new V0(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(c,l),c}}const K_=new Map;function fi(n){yi(n instanceof Function,"Expected a class definition");let e=K_.get(n);return e?(yi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,K_.set(n,e),e)}class xw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}xw.type="NONE";const Y_=xw;function _h(n,e,t){return`firebase:${n}:${e}:${t}`}class uo{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=_h(this.userKey,i.apiKey,s),this.fullPersistenceKey=_h("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await $h(this.auth,{idToken:e}).catch(()=>{});return t?wr._fromGetAccountInfoResponse(this.auth,t,e):null}return wr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new uo(fi(Y_),e,r);const i=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=i[0]||fi(Y_);const a=_h(r,e.config.apiKey,e.name);let o=null;for(const l of t)try{const u=await l._get(a);if(u){let h;if(typeof u=="string"){const d=await $h(e,{idToken:u}).catch(()=>{});if(!d)break;h=await wr._fromGetAccountInfoResponse(e,d,u)}else h=wr._fromJSON(e,u);l!==s&&(o=h),s=l;break}}catch{}const c=i.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new uo(s,e,r):(s=c[0],o&&await s._set(a,o.toJSON()),await Promise.all(t.map(async l=>{if(l!==s)try{await l._remove(a)}catch{}})),new uo(s,e,r))}}function X_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ww(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(yw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(bw(e))return"Blackberry";if(Iw(e))return"Webos";if(vw(e))return"Safari";if((e.includes("chrome/")||Ew(e))&&!e.includes("edge/"))return"Chrome";if(Tw(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function yw(n=Zt()){return/firefox\//i.test(n)}function vw(n=Zt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ew(n=Zt()){return/crios\//i.test(n)}function ww(n=Zt()){return/iemobile/i.test(n)}function Tw(n=Zt()){return/android/i.test(n)}function bw(n=Zt()){return/blackberry/i.test(n)}function Iw(n=Zt()){return/webos/i.test(n)}function eg(n=Zt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function $4(n=Zt()){return eg(n)&&!!window.navigator?.standalone}function W4(){return iD()&&document.documentMode===10}function Aw(n=Zt()){return eg(n)||Tw(n)||Iw(n)||bw(n)||/windows phone/i.test(n)||ww(n)}function Sw(n,e=[]){let t;switch(n){case"Browser":t=X_(Zt());break;case"Worker":t=`${X_(Zt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${jo}/${r}`}class j4{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((a,o)=>{try{const c=e(s);a(c)}catch(c){o(c)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function G4(n,e={}){return Xr(n,"GET","/v2/passwordPolicy",Ai(n,e))}const q4=6;class K4{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??q4,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Y4{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Q_(this),this.idTokenSubscription=new Q_(this),this.beforeStateQueue=new j4(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=fw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=fi(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await uo.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await $h(this,{idToken:e}),r=await wr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Qn(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,a=r?._redirectEventId,o=await this.tryRedirectSignIn(e);(!s||s===a)&&o?.user&&(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Re(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Wh(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=S4()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qn(this.app))return Promise.reject(gi(this));const t=e?vt(e):null;return t&&Re(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Re(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qn(this.app)?Promise.reject(gi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qn(this.app)?Promise.reject(gi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(fi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await G4(this),t=new K4(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Jl("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await z4(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&fi(e)||this._popupRedirectResolver;Re(t,this,"argument-error"),this.redirectPersistenceManager=await uo.create(this,[fi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Re(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,i);return()=>{a=!0,c()}}else{const c=e.addObserver(t);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Re(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Sw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Qn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&b4(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Is(n){return vt(n)}class Q_{constructor(e){this.auth=e,this.observer=null,this.addObserver=uD(t=>this.observer=t)}get next(){return Re(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function X4(n){zf=n}function kw(n){return zf.loadJS(n)}function Q4(){return zf.recaptchaEnterpriseScript}function J4(){return zf.gapiScript}function Z4(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class eF{constructor(){this.enterprise=new tF}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class tF{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const nF="recaptcha-enterprise",Cw="NO_RECAPTCHA";class rF{constructor(e){this.type=nF,this.auth=Is(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{O4(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const l=new F4(c);return s.tenantId==null?s._agentRecaptchaConfig=l:s._tenantRecaptchaConfigs[s.tenantId]=l,a(l.siteKey)}}).catch(c=>{o(c)})})}function i(s,a,o){const c=window.grecaptcha;G_(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(l=>{a(l)}).catch(()=>{a(Cw)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eF().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(o=>{if(!t&&G_(window.grecaptcha))i(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Q4();c.length!==0&&(c+=o),kw(c).then(()=>{i(o,s,a)}).catch(l=>{a(l)})}}).catch(o=>{a(o)})})}}async function J_(n,e,t,r=!1,i=!1){const s=new rF(n);let a;if(i)a=Cw;else try{a=await s.verify(t)}catch{a=await s.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const c=o.phoneEnrollmentInfo.phoneNumber,l=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const c=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function jh(n,e,t,r,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await J_(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await J_(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(s)})}function iF(n,e){const t=Hf(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(pa(s,e??{}))return i;Sr(i,"already-initialized")}return t.initialize({options:e})}function sF(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(fi);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function aF(n,e,t){const r=Is(n);Re(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=Rw(e),{host:a,port:o}=oF(e),c=o===null?"":`:${o}`,l={url:`${s}//${a}${c}/`},u=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Re(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Re(pa(l,r.config.emulator)&&pa(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,bs(a)?(Kp(`${s}//${a}${c}`),ew("Auth",!0)):cF()}function Rw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oF(n){const e=Rw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:Z_(r.substr(s.length+1))}}else{const[s,a]=r.split(":");return{host:s,port:Z_(a)}}}function Z_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function cF(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class tg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return hi("not implemented")}_getIdTokenResponse(e){return hi("not implemented")}_linkToIdToken(e,t){return hi("not implemented")}_getReauthenticationResolver(e){return hi("not implemented")}}async function lF(n,e){return Xr(n,"POST","/v1/accounts:signUp",e)}async function uF(n,e){return tu(n,"POST","/v1/accounts:signInWithPassword",Ai(n,e))}async function hF(n,e){return Xr(n,"POST","/v1/accounts:sendOobCode",Ai(n,e))}async function fF(n,e){return hF(n,e)}async function dF(n,e){return tu(n,"POST","/v1/accounts:signInWithEmailLink",Ai(n,e))}async function pF(n,e){return tu(n,"POST","/v1/accounts:signInWithEmailLink",Ai(n,e))}class Il extends tg{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Il(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Il(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jh(e,t,"signInWithPassword",uF);case"emailLink":return dF(e,{email:this._email,oobCode:this._password});default:Sr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jh(e,r,"signUpPassword",lF);case"emailLink":return pF(e,{idToken:t,email:this._email,oobCode:this._password});default:Sr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ho(n,e){return tu(n,"POST","/v1/accounts:signInWithIdp",Ai(n,e))}const gF="http://localhost";class ma extends tg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ma(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Sr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=t;if(!r||!i)return null;const a=new ma(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ho(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ho(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ho(e,t)}buildRequest(){const e={requestUri:gF,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Zl(t)}return e}}function mF(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function _F(n){const e=Dc(Fc(n)).link,t=e?Dc(Fc(e)).deep_link_id:null,r=Dc(Fc(n)).deep_link_id;return(r?Dc(Fc(r)).link:null)||r||t||e||n}class ng{constructor(e){const t=Dc(Fc(e)),r=t.apiKey??null,i=t.oobCode??null,s=mF(t.mode??null);Re(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=_F(e);try{return new ng(t)}catch{return null}}}class Go{constructor(){this.providerId=Go.PROVIDER_ID}static credential(e,t){return Il._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ng.parseLink(t);return Re(r,"argument-error"),Il._fromEmailAndCode(e,r.code,r.tenantId)}}Go.PROVIDER_ID="password";Go.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Go.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Pw{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nu extends Pw{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class qi extends nu{constructor(){super("facebook.com")}static credential(e){return ma._fromParams({providerId:qi.PROVIDER_ID,signInMethod:qi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qi.credentialFromTaggedObject(e)}static credentialFromError(e){return qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qi.credential(e.oauthAccessToken)}catch{return null}}}qi.FACEBOOK_SIGN_IN_METHOD="facebook.com";qi.PROVIDER_ID="facebook.com";class Ki extends nu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ma._fromParams({providerId:Ki.PROVIDER_ID,signInMethod:Ki.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ki.credentialFromTaggedObject(e)}static credentialFromError(e){return Ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ki.credential(t,r)}catch{return null}}}Ki.GOOGLE_SIGN_IN_METHOD="google.com";Ki.PROVIDER_ID="google.com";class Yi extends nu{constructor(){super("github.com")}static credential(e){return ma._fromParams({providerId:Yi.PROVIDER_ID,signInMethod:Yi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Yi.credentialFromTaggedObject(e)}static credentialFromError(e){return Yi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Yi.credential(e.oauthAccessToken)}catch{return null}}}Yi.GITHUB_SIGN_IN_METHOD="github.com";Yi.PROVIDER_ID="github.com";class Xi extends nu{constructor(){super("twitter.com")}static credential(e,t){return ma._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Xi.credential(t,r)}catch{return null}}}Xi.TWITTER_SIGN_IN_METHOD="twitter.com";Xi.PROVIDER_ID="twitter.com";async function xF(n,e){return tu(n,"POST","/v1/accounts:signUp",Ai(n,e))}class _a{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await wr._fromIdTokenResponse(e,r,i),a=ex(r);return new _a({user:s,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=ex(r);return new _a({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function ex(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Gh extends Yr{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Gh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new Gh(e,t,r,i)}}function Dw(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Gh._fromErrorAndOperation(n,s,e,r):s})}async function yF(n,e,t=!1){const r=await Eo(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return _a._forOperation(n,"link",r)}async function vF(n,e,t=!1){const{auth:r}=n;if(Qn(r.app))return Promise.reject(gi(r));const i="reauthenticate";try{const s=await Eo(n,Dw(r,i,e,n),t);Re(s.idToken,r,"internal-error");const a=Zp(s.idToken);Re(a,r,"internal-error");const{sub:o}=a;return Re(n.uid===o,r,"user-mismatch"),_a._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Sr(r,"user-mismatch"),s}}async function Fw(n,e,t=!1){if(Qn(n.app))return Promise.reject(gi(n));const r="signIn",i=await Dw(n,r,e),s=await _a._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function EF(n,e){return Fw(Is(n),e)}async function Ow(n){const e=Is(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function rg(n,e,t){const r=Is(n);await jh(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",fF)}async function wF(n,e,t){if(Qn(n.app))return Promise.reject(gi(n));const r=Is(n),a=await jh(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xF).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&Ow(n),c}),o=await _a._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function TF(n,e,t){return Qn(n.app)?Promise.reject(gi(n)):EF(vt(n),Go.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ow(n),r})}async function bF(n,e){return Xr(n,"POST","/v1/accounts:update",e)}async function IF(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=vt(n),s={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await Eo(r,bF(r.auth,s));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const o=r.providerData.find(({providerId:c})=>c==="password");o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function AF(n,e,t,r){return vt(n).onIdTokenChanged(e,t,r)}function SF(n,e,t){return vt(n).beforeAuthStateChanged(e,t)}function kF(n,e,t,r){return vt(n).onAuthStateChanged(e,t,r)}function tx(n){return vt(n).signOut()}const qh="__sak";class Mw{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(qh,"1"),this.storage.removeItem(qh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const CF=1e3,RF=10;class Lw extends Mw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Aw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,c)=>{this.notifyListeners(a,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},s=this.storage.getItem(r);W4()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,RF):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},CF)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Lw.type="LOCAL";const PF=Lw;class Nw extends Mw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Nw.type="SESSION";const Vw=Nw;function DF(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class $f{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new $f(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,a=this.handlersMap[i];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const o=Array.from(a).map(async l=>l(t.origin,s)),c=await DF(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$f.receivers=[];function ig(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class FF{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((o,c)=>{const l=ig("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(d.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function $r(){return window}function OF(n){$r().location.href=n}function Bw(){return typeof $r().WorkerGlobalScope<"u"&&typeof $r().importScripts=="function"}async function MF(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function LF(){return navigator?.serviceWorker?.controller||null}function NF(){return Bw()?self:null}const Uw="firebaseLocalStorageDb",VF=1,Kh="firebaseLocalStorage",Hw="fbase_key";class ru{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Wf(n,e){return n.transaction([Kh],e?"readwrite":"readonly").objectStore(Kh)}function BF(){const n=indexedDB.deleteDatabase(Uw);return new ru(n).toPromise()}function B0(){const n=indexedDB.open(Uw,VF);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Kh,{keyPath:Hw})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Kh)?e(r):(r.close(),await BF(),e(await B0()))})})}async function nx(n,e,t){const r=Wf(n,!0).put({[Hw]:e,value:t});return new ru(r).toPromise()}async function UF(n,e){const t=Wf(n,!1).get(e),r=await new ru(t).toPromise();return r===void 0?null:r.value}function rx(n,e){const t=Wf(n,!0).delete(e);return new ru(t).toPromise()}const HF=800,zF=3;class zw{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await B0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>zF)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Bw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$f._getInstance(NF()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await MF(),!this.activeServiceWorker)return;this.sender=new FF(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||LF()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await B0();return await nx(e,qh,"1"),await rx(e,qh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>nx(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>UF(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rx(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Wf(i,!1).getAll();return new ru(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),HF)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zw.type="LOCAL";const $F=zw;new eu(3e4,6e4);function WF(n,e){return e?fi(e):(Re(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class sg extends tg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ho(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ho(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ho(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function jF(n){return Fw(n.auth,new sg(n),n.bypassAuthState)}function GF(n){const{auth:e,user:t}=n;return Re(t,e,"internal-error"),vF(t,new sg(n),n.bypassAuthState)}async function qF(n){const{auth:e,user:t}=n;return Re(t,e,"internal-error"),yF(t,new sg(n),n.bypassAuthState)}class $w{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(c))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jF;case"linkViaPopup":case"linkViaRedirect":return qF;case"reauthViaPopup":case"reauthViaRedirect":return GF;default:Sr(this.auth,"internal-error")}}resolve(e){yi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const KF=new eu(2e3,1e4);class ao extends $w{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,ao.currentPopupAction&&ao.currentPopupAction.cancel(),ao.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Re(e,this.auth,"internal-error"),e}async onExecution(){yi(this.filter.length===1,"Popup operations only handle one event");const e=ig();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(zr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(zr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ao.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,KF.get())};e()}}ao.currentPopupAction=null;const YF="pendingRedirect",xh=new Map;class XF extends $w{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=xh.get(this.auth._key());if(!e){try{const r=await QF(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}xh.set(this.auth._key(),e)}return this.bypassAuthState||xh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function QF(n,e){const t=eO(e),r=ZF(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function JF(n,e){xh.set(n._key(),e)}function ZF(n){return fi(n._redirectPersistence)}function eO(n){return _h(YF,n.config.apiKey,n.name)}async function tO(n,e,t=!1){if(Qn(n.app))return Promise.reject(gi(n));const r=Is(n),i=WF(r,e),a=await new XF(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const nO=600*1e3;class rO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!iO(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Ww(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(zr(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=nO&&this.cachedEventUids.clear(),this.cachedEventUids.has(ix(e))}saveEventToCache(e){this.cachedEventUids.add(ix(e)),this.lastProcessedEventTime=Date.now()}}function ix(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Ww({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function iO(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ww(n);default:return!1}}async function sO(n,e={}){return Xr(n,"GET","/v1/projects",e)}const aO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,oO=/^https?/;async function cO(n){if(n.config.emulator)return;const{authorizedDomains:e}=await sO(n);for(const t of e)try{if(lO(t))return}catch{}Sr(n,"unauthorized-domain")}function lO(n){const e=N0(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!oO.test(t))return!1;if(aO.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const uO=new eu(3e4,6e4);function sx(){const n=$r().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function hO(n){return new Promise((e,t)=>{function r(){sx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sx(),t(zr(n,"network-request-failed"))},timeout:uO.get()})}if($r().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if($r().gapi?.load)r();else{const i=Z4("iframefcb");return $r()[i]=()=>{gapi.load?r():t(zr(n,"network-request-failed"))},kw(`${J4()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw yh=null,e})}let yh=null;function fO(n){return yh=yh||hO(n),yh}const dO=new eu(5e3,15e3),pO="__/auth/iframe",gO="emulator/auth/iframe",mO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_O=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xO(n){const e=n.config;Re(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Jp(e,gO):`https://${n.config.authDomain}/${pO}`,r={apiKey:e.apiKey,appName:n.name,v:jo},i=_O.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Zl(r).slice(1)}`}async function yO(n){const e=await fO(n),t=$r().gapi;return Re(t,n,"internal-error"),e.open({where:document.body,url:xO(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mO,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const a=zr(n,"network-request-failed"),o=$r().setTimeout(()=>{s(a)},dO.get());function c(){$r().clearTimeout(o),i(r)}r.ping(c).then(c,()=>{s(a)})}))}const vO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},EO=500,wO=600,TO="_blank",bO="http://localhost";class ax{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function IO(n,e,t,r=EO,i=wO){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c={...vO,width:r.toString(),height:i.toString(),top:s,left:a},l=Zt().toLowerCase();t&&(o=Ew(l)?TO:t),yw(l)&&(e=e||bO,c.scrollbars="yes");const u=Object.entries(c).reduce((d,[p,g])=>`${d}${p}=${g},`,"");if($4(l)&&o!=="_self")return AO(e||"",o),new ax(null);const h=window.open(e||"",o,u);Re(h,n,"popup-blocked");try{h.focus()}catch{}return new ax(h)}function AO(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const SO="__/auth/handler",kO="emulator/auth/handler",CO=encodeURIComponent("fac");async function ox(n,e,t,r,i,s){Re(n.config.authDomain,n,"auth-domain-config-required"),Re(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:jo,eventId:i};if(e instanceof Pw){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",lD(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))a[u]=h}if(e instanceof nu){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(a.scopes=u.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const u of Object.keys(o))o[u]===void 0&&delete o[u];const c=await n._getAppCheckToken(),l=c?`#${CO}=${encodeURIComponent(c)}`:"";return`${RO(n)}?${Zl(o).slice(1)}${l}`}function RO({config:n}){return n.emulator?Jp(n,kO):`https://${n.authDomain}/${SO}`}const Kd="webStorageSupport";class PO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Vw,this._completeRedirectFn=tO,this._overrideRedirectResult=JF}async _openPopup(e,t,r,i){yi(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await ox(e,t,r,N0(),i);return IO(e,s,ig())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await ox(e,t,r,N0(),i);return OF(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(yi(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await yO(e),r=new rO(e);return t.register("authEvent",i=>(Re(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Kd,{type:Kd},i=>{const s=i?.[0]?.[Kd];s!==void 0&&t(!!s),Sr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=cO(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Aw()||vw()||eg()}}const DO=PO;var cx="@firebase/auth",lx="1.12.1";class FO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Re(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function OO(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function MO(n){ga(new gs("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;Re(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Sw(n)},l=new Y4(r,i,s,c);return sF(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ga(new gs("auth-internal",e=>{const t=Is(e.getProvider("auth").getImmediate());return(r=>new FO(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Hr(cx,lx,OO(n)),Hr(cx,lx,"esm2020")}const LO=300,NO=ZE("authIdTokenMaxAge")||LO;let ux=null;const VO=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>NO)return;const i=t?.token;ux!==i&&(ux=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function BO(n=cw()){const e=Hf(n,"auth");if(e.isInitialized())return e.getImmediate();const t=iF(n,{popupRedirectResolver:DO,persistence:[$F,PF,Vw]}),r=ZE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const a=VO(s.toString());SF(t,a,()=>a(t.currentUser)),AF(t,o=>a(o))}}const i=QE("auth");return i&&aF(t,`http://${i}`),t}function UO(){return document.getElementsByTagName("head")?.[0]??document}X4({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=zr("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",UO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});MO("Browser");var hx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ls,jw;(function(){var n;function e(y,w){function T(){}T.prototype=w.prototype,y.F=w.prototype,y.prototype=new T,y.prototype.constructor=y,y.D=function(S,A,k){for(var D=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)D[oe-2]=arguments[oe];return w.prototype[A].apply(S,D)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(y,w,T){T||(T=0);const S=Array(16);if(typeof w=="string")for(var A=0;A<16;++A)S[A]=w.charCodeAt(T++)|w.charCodeAt(T++)<<8|w.charCodeAt(T++)<<16|w.charCodeAt(T++)<<24;else for(A=0;A<16;++A)S[A]=w[T++]|w[T++]<<8|w[T++]<<16|w[T++]<<24;w=y.g[0],T=y.g[1],A=y.g[2];let k=y.g[3],D;D=w+(k^T&(A^k))+S[0]+3614090360&4294967295,w=T+(D<<7&4294967295|D>>>25),D=k+(A^w&(T^A))+S[1]+3905402710&4294967295,k=w+(D<<12&4294967295|D>>>20),D=A+(T^k&(w^T))+S[2]+606105819&4294967295,A=k+(D<<17&4294967295|D>>>15),D=T+(w^A&(k^w))+S[3]+3250441966&4294967295,T=A+(D<<22&4294967295|D>>>10),D=w+(k^T&(A^k))+S[4]+4118548399&4294967295,w=T+(D<<7&4294967295|D>>>25),D=k+(A^w&(T^A))+S[5]+1200080426&4294967295,k=w+(D<<12&4294967295|D>>>20),D=A+(T^k&(w^T))+S[6]+2821735955&4294967295,A=k+(D<<17&4294967295|D>>>15),D=T+(w^A&(k^w))+S[7]+4249261313&4294967295,T=A+(D<<22&4294967295|D>>>10),D=w+(k^T&(A^k))+S[8]+1770035416&4294967295,w=T+(D<<7&4294967295|D>>>25),D=k+(A^w&(T^A))+S[9]+2336552879&4294967295,k=w+(D<<12&4294967295|D>>>20),D=A+(T^k&(w^T))+S[10]+4294925233&4294967295,A=k+(D<<17&4294967295|D>>>15),D=T+(w^A&(k^w))+S[11]+2304563134&4294967295,T=A+(D<<22&4294967295|D>>>10),D=w+(k^T&(A^k))+S[12]+1804603682&4294967295,w=T+(D<<7&4294967295|D>>>25),D=k+(A^w&(T^A))+S[13]+4254626195&4294967295,k=w+(D<<12&4294967295|D>>>20),D=A+(T^k&(w^T))+S[14]+2792965006&4294967295,A=k+(D<<17&4294967295|D>>>15),D=T+(w^A&(k^w))+S[15]+1236535329&4294967295,T=A+(D<<22&4294967295|D>>>10),D=w+(A^k&(T^A))+S[1]+4129170786&4294967295,w=T+(D<<5&4294967295|D>>>27),D=k+(T^A&(w^T))+S[6]+3225465664&4294967295,k=w+(D<<9&4294967295|D>>>23),D=A+(w^T&(k^w))+S[11]+643717713&4294967295,A=k+(D<<14&4294967295|D>>>18),D=T+(k^w&(A^k))+S[0]+3921069994&4294967295,T=A+(D<<20&4294967295|D>>>12),D=w+(A^k&(T^A))+S[5]+3593408605&4294967295,w=T+(D<<5&4294967295|D>>>27),D=k+(T^A&(w^T))+S[10]+38016083&4294967295,k=w+(D<<9&4294967295|D>>>23),D=A+(w^T&(k^w))+S[15]+3634488961&4294967295,A=k+(D<<14&4294967295|D>>>18),D=T+(k^w&(A^k))+S[4]+3889429448&4294967295,T=A+(D<<20&4294967295|D>>>12),D=w+(A^k&(T^A))+S[9]+568446438&4294967295,w=T+(D<<5&4294967295|D>>>27),D=k+(T^A&(w^T))+S[14]+3275163606&4294967295,k=w+(D<<9&4294967295|D>>>23),D=A+(w^T&(k^w))+S[3]+4107603335&4294967295,A=k+(D<<14&4294967295|D>>>18),D=T+(k^w&(A^k))+S[8]+1163531501&4294967295,T=A+(D<<20&4294967295|D>>>12),D=w+(A^k&(T^A))+S[13]+2850285829&4294967295,w=T+(D<<5&4294967295|D>>>27),D=k+(T^A&(w^T))+S[2]+4243563512&4294967295,k=w+(D<<9&4294967295|D>>>23),D=A+(w^T&(k^w))+S[7]+1735328473&4294967295,A=k+(D<<14&4294967295|D>>>18),D=T+(k^w&(A^k))+S[12]+2368359562&4294967295,T=A+(D<<20&4294967295|D>>>12),D=w+(T^A^k)+S[5]+4294588738&4294967295,w=T+(D<<4&4294967295|D>>>28),D=k+(w^T^A)+S[8]+2272392833&4294967295,k=w+(D<<11&4294967295|D>>>21),D=A+(k^w^T)+S[11]+1839030562&4294967295,A=k+(D<<16&4294967295|D>>>16),D=T+(A^k^w)+S[14]+4259657740&4294967295,T=A+(D<<23&4294967295|D>>>9),D=w+(T^A^k)+S[1]+2763975236&4294967295,w=T+(D<<4&4294967295|D>>>28),D=k+(w^T^A)+S[4]+1272893353&4294967295,k=w+(D<<11&4294967295|D>>>21),D=A+(k^w^T)+S[7]+4139469664&4294967295,A=k+(D<<16&4294967295|D>>>16),D=T+(A^k^w)+S[10]+3200236656&4294967295,T=A+(D<<23&4294967295|D>>>9),D=w+(T^A^k)+S[13]+681279174&4294967295,w=T+(D<<4&4294967295|D>>>28),D=k+(w^T^A)+S[0]+3936430074&4294967295,k=w+(D<<11&4294967295|D>>>21),D=A+(k^w^T)+S[3]+3572445317&4294967295,A=k+(D<<16&4294967295|D>>>16),D=T+(A^k^w)+S[6]+76029189&4294967295,T=A+(D<<23&4294967295|D>>>9),D=w+(T^A^k)+S[9]+3654602809&4294967295,w=T+(D<<4&4294967295|D>>>28),D=k+(w^T^A)+S[12]+3873151461&4294967295,k=w+(D<<11&4294967295|D>>>21),D=A+(k^w^T)+S[15]+530742520&4294967295,A=k+(D<<16&4294967295|D>>>16),D=T+(A^k^w)+S[2]+3299628645&4294967295,T=A+(D<<23&4294967295|D>>>9),D=w+(A^(T|~k))+S[0]+4096336452&4294967295,w=T+(D<<6&4294967295|D>>>26),D=k+(T^(w|~A))+S[7]+1126891415&4294967295,k=w+(D<<10&4294967295|D>>>22),D=A+(w^(k|~T))+S[14]+2878612391&4294967295,A=k+(D<<15&4294967295|D>>>17),D=T+(k^(A|~w))+S[5]+4237533241&4294967295,T=A+(D<<21&4294967295|D>>>11),D=w+(A^(T|~k))+S[12]+1700485571&4294967295,w=T+(D<<6&4294967295|D>>>26),D=k+(T^(w|~A))+S[3]+2399980690&4294967295,k=w+(D<<10&4294967295|D>>>22),D=A+(w^(k|~T))+S[10]+4293915773&4294967295,A=k+(D<<15&4294967295|D>>>17),D=T+(k^(A|~w))+S[1]+2240044497&4294967295,T=A+(D<<21&4294967295|D>>>11),D=w+(A^(T|~k))+S[8]+1873313359&4294967295,w=T+(D<<6&4294967295|D>>>26),D=k+(T^(w|~A))+S[15]+4264355552&4294967295,k=w+(D<<10&4294967295|D>>>22),D=A+(w^(k|~T))+S[6]+2734768916&4294967295,A=k+(D<<15&4294967295|D>>>17),D=T+(k^(A|~w))+S[13]+1309151649&4294967295,T=A+(D<<21&4294967295|D>>>11),D=w+(A^(T|~k))+S[4]+4149444226&4294967295,w=T+(D<<6&4294967295|D>>>26),D=k+(T^(w|~A))+S[11]+3174756917&4294967295,k=w+(D<<10&4294967295|D>>>22),D=A+(w^(k|~T))+S[2]+718787259&4294967295,A=k+(D<<15&4294967295|D>>>17),D=T+(k^(A|~w))+S[9]+3951481745&4294967295,y.g[0]=y.g[0]+w&4294967295,y.g[1]=y.g[1]+(A+(D<<21&4294967295|D>>>11))&4294967295,y.g[2]=y.g[2]+A&4294967295,y.g[3]=y.g[3]+k&4294967295}r.prototype.v=function(y,w){w===void 0&&(w=y.length);const T=w-this.blockSize,S=this.C;let A=this.h,k=0;for(;k<w;){if(A==0)for(;k<=T;)i(this,y,k),k+=this.blockSize;if(typeof y=="string"){for(;k<w;)if(S[A++]=y.charCodeAt(k++),A==this.blockSize){i(this,S),A=0;break}}else for(;k<w;)if(S[A++]=y[k++],A==this.blockSize){i(this,S),A=0;break}}this.h=A,this.o+=w},r.prototype.A=function(){var y=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);y[0]=128;for(var w=1;w<y.length-8;++w)y[w]=0;w=this.o*8;for(var T=y.length-8;T<y.length;++T)y[T]=w&255,w/=256;for(this.v(y),y=Array(16),w=0,T=0;T<4;++T)for(let S=0;S<32;S+=8)y[w++]=this.g[T]>>>S&255;return y};function s(y,w){var T=o;return Object.prototype.hasOwnProperty.call(T,y)?T[y]:T[y]=w(y)}function a(y,w){this.h=w;const T=[];let S=!0;for(let A=y.length-1;A>=0;A--){const k=y[A]|0;S&&k==w||(T[A]=k,S=!1)}this.g=T}var o={};function c(y){return-128<=y&&y<128?s(y,function(w){return new a([w|0],w<0?-1:0)}):new a([y|0],y<0?-1:0)}function l(y){if(isNaN(y)||!isFinite(y))return h;if(y<0)return _(l(-y));const w=[];let T=1;for(let S=0;y>=T;S++)w[S]=y/T|0,T*=4294967296;return new a(w,0)}function u(y,w){if(y.length==0)throw Error("number format error: empty string");if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(y.charAt(0)=="-")return _(u(y.substring(1),w));if(y.indexOf("-")>=0)throw Error('number format error: interior "-" character');const T=l(Math.pow(w,8));let S=h;for(let k=0;k<y.length;k+=8){var A=Math.min(8,y.length-k);const D=parseInt(y.substring(k,k+A),w);A<8?(A=l(Math.pow(w,A)),S=S.j(A).add(l(D))):(S=S.j(T),S=S.add(l(D)))}return S}var h=c(0),d=c(1),p=c(16777216);n=a.prototype,n.m=function(){if(m(this))return-_(this).m();let y=0,w=1;for(let T=0;T<this.g.length;T++){const S=this.i(T);y+=(S>=0?S:4294967296+S)*w,w*=4294967296}return y},n.toString=function(y){if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(g(this))return"0";if(m(this))return"-"+_(this).toString(y);const w=l(Math.pow(y,6));var T=this;let S="";for(;;){const A=R(T,w).g;T=E(T,A.j(w));let k=((T.g.length>0?T.g[0]:T.h)>>>0).toString(y);if(T=A,g(T))return k+S;for(;k.length<6;)k="0"+k;S=k+S}},n.i=function(y){return y<0?0:y<this.g.length?this.g[y]:this.h};function g(y){if(y.h!=0)return!1;for(let w=0;w<y.g.length;w++)if(y.g[w]!=0)return!1;return!0}function m(y){return y.h==-1}n.l=function(y){return y=E(this,y),m(y)?-1:g(y)?0:1};function _(y){const w=y.g.length,T=[];for(let S=0;S<w;S++)T[S]=~y.g[S];return new a(T,~y.h).add(d)}n.abs=function(){return m(this)?_(this):this},n.add=function(y){const w=Math.max(this.g.length,y.g.length),T=[];let S=0;for(let A=0;A<=w;A++){let k=S+(this.i(A)&65535)+(y.i(A)&65535),D=(k>>>16)+(this.i(A)>>>16)+(y.i(A)>>>16);S=D>>>16,k&=65535,D&=65535,T[A]=D<<16|k}return new a(T,T[T.length-1]&-2147483648?-1:0)};function E(y,w){return y.add(_(w))}n.j=function(y){if(g(this)||g(y))return h;if(m(this))return m(y)?_(this).j(_(y)):_(_(this).j(y));if(m(y))return _(this.j(_(y)));if(this.l(p)<0&&y.l(p)<0)return l(this.m()*y.m());const w=this.g.length+y.g.length,T=[];for(var S=0;S<2*w;S++)T[S]=0;for(S=0;S<this.g.length;S++)for(let A=0;A<y.g.length;A++){const k=this.i(S)>>>16,D=this.i(S)&65535,oe=y.i(A)>>>16,ie=y.i(A)&65535;T[2*S+2*A]+=D*ie,I(T,2*S+2*A),T[2*S+2*A+1]+=k*ie,I(T,2*S+2*A+1),T[2*S+2*A+1]+=D*oe,I(T,2*S+2*A+1),T[2*S+2*A+2]+=k*oe,I(T,2*S+2*A+2)}for(y=0;y<w;y++)T[y]=T[2*y+1]<<16|T[2*y];for(y=w;y<2*w;y++)T[y]=0;return new a(T,0)};function I(y,w){for(;(y[w]&65535)!=y[w];)y[w+1]+=y[w]>>>16,y[w]&=65535,w++}function v(y,w){this.g=y,this.h=w}function R(y,w){if(g(w))throw Error("division by zero");if(g(y))return new v(h,h);if(m(y))return w=R(_(y),w),new v(_(w.g),_(w.h));if(m(w))return w=R(y,_(w)),new v(_(w.g),w.h);if(y.g.length>30){if(m(y)||m(w))throw Error("slowDivide_ only works with positive integers.");for(var T=d,S=w;S.l(y)<=0;)T=F(T),S=F(S);var A=O(T,1),k=O(S,1);for(S=O(S,2),T=O(T,2);!g(S);){var D=k.add(S);D.l(y)<=0&&(A=A.add(T),k=D),S=O(S,1),T=O(T,1)}return w=E(y,A.j(w)),new v(A,w)}for(A=h;y.l(w)>=0;){for(T=Math.max(1,Math.floor(y.m()/w.m())),S=Math.ceil(Math.log(T)/Math.LN2),S=S<=48?1:Math.pow(2,S-48),k=l(T),D=k.j(w);m(D)||D.l(y)>0;)T-=S,k=l(T),D=k.j(w);g(k)&&(k=d),A=A.add(k),y=E(y,D)}return new v(A,y)}n.B=function(y){return R(this,y).h},n.and=function(y){const w=Math.max(this.g.length,y.g.length),T=[];for(let S=0;S<w;S++)T[S]=this.i(S)&y.i(S);return new a(T,this.h&y.h)},n.or=function(y){const w=Math.max(this.g.length,y.g.length),T=[];for(let S=0;S<w;S++)T[S]=this.i(S)|y.i(S);return new a(T,this.h|y.h)},n.xor=function(y){const w=Math.max(this.g.length,y.g.length),T=[];for(let S=0;S<w;S++)T[S]=this.i(S)^y.i(S);return new a(T,this.h^y.h)};function F(y){const w=y.g.length+1,T=[];for(let S=0;S<w;S++)T[S]=y.i(S)<<1|y.i(S-1)>>>31;return new a(T,y.h)}function O(y,w){const T=w>>5;w%=32;const S=y.g.length-T,A=[];for(let k=0;k<S;k++)A[k]=w>0?y.i(k+T)>>>w|y.i(k+T+1)<<32-w:y.i(k+T);return new a(A,y.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,jw=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=l,a.fromString=u,ls=a}).apply(typeof hx<"u"?hx:typeof self<"u"?self:typeof window<"u"?window:{});var Qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Gw,Oc,qw,vh,U0,Kw,Yw,Xw;(function(){var n,e=Object.defineProperty;function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qu=="object"&&Qu];for(var x=0;x<f.length;++x){var b=f[x];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var r=t(this);function i(f,x){if(x)e:{var b=r;f=f.split(".");for(var M=0;M<f.length-1;M++){var Y=f[M];if(!(Y in b))break e;b=b[Y]}f=f[f.length-1],M=b[f],x=x(M),x!=M&&x!=null&&e(b,f,{configurable:!0,writable:!0,value:x})}}i("Symbol.dispose",function(f){return f||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(f){return f||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(f){return f||function(x){var b=[],M;for(M in x)Object.prototype.hasOwnProperty.call(x,M)&&b.push([M,x[M]]);return b}});var s=s||{},a=this||self;function o(f){var x=typeof f;return x=="object"&&f!=null||x=="function"}function c(f,x,b){return f.call.apply(f.bind,arguments)}function l(f,x,b){return l=c,l.apply(null,arguments)}function u(f,x){var b=Array.prototype.slice.call(arguments,1);return function(){var M=b.slice();return M.push.apply(M,arguments),f.apply(this,M)}}function h(f,x){function b(){}b.prototype=x.prototype,f.Z=x.prototype,f.prototype=new b,f.prototype.constructor=f,f.Ob=function(M,Y,te){for(var _e=Array(arguments.length-2),Ue=2;Ue<arguments.length;Ue++)_e[Ue-2]=arguments[Ue];return x.prototype[Y].apply(M,_e)}}var d=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?f=>f&&AsyncContext.Snapshot.wrap(f):f=>f;function p(f){const x=f.length;if(x>0){const b=Array(x);for(let M=0;M<x;M++)b[M]=f[M];return b}return[]}function g(f,x){for(let M=1;M<arguments.length;M++){const Y=arguments[M];var b=typeof Y;if(b=b!="object"?b:Y?Array.isArray(Y)?"array":b:"null",b=="array"||b=="object"&&typeof Y.length=="number"){b=f.length||0;const te=Y.length||0;f.length=b+te;for(let _e=0;_e<te;_e++)f[b+_e]=Y[_e]}else f.push(Y)}}class m{constructor(x,b){this.i=x,this.j=b,this.h=0,this.g=null}get(){let x;return this.h>0?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function _(f){a.setTimeout(()=>{throw f},0)}function E(){var f=y;let x=null;return f.g&&(x=f.g,f.g=f.g.next,f.g||(f.h=null),x.next=null),x}class I{constructor(){this.h=this.g=null}add(x,b){const M=v.get();M.set(x,b),this.h?this.h.next=M:this.g=M,this.h=M}}var v=new m(()=>new R,f=>f.reset());class R{constructor(){this.next=this.g=this.h=null}set(x,b){this.h=x,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let F,O=!1,y=new I,w=()=>{const f=Promise.resolve(void 0);F=()=>{f.then(T)}};function T(){for(var f;f=E();){try{f.h.call(f.g)}catch(b){_(b)}var x=v;x.j(f),x.h<100&&(x.h++,f.next=x.g,x.g=f)}O=!1}function S(){this.u=this.u,this.C=this.C}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function A(f,x){this.type=f,this.g=this.target=x,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var k=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var f=!1,x=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const b=()=>{};a.addEventListener("test",b,x),a.removeEventListener("test",b,x)}catch{}return f})();function D(f){return/^[\s\xa0]*$/.test(f)}function oe(f,x){A.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f&&this.init(f,x)}h(oe,A),oe.prototype.init=function(f,x){const b=this.type=f.type,M=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;this.target=f.target||f.srcElement,this.g=x,x=f.relatedTarget,x||(b=="mouseover"?x=f.fromElement:b=="mouseout"&&(x=f.toElement)),this.relatedTarget=x,M?(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=f.pointerType,this.state=f.state,this.i=f,f.defaultPrevented&&oe.Z.h.call(this)},oe.prototype.h=function(){oe.Z.h.call(this);const f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var ie="closure_listenable_"+(Math.random()*1e6|0),ue=0;function he(f,x,b,M,Y){this.listener=f,this.proxy=null,this.src=x,this.type=b,this.capture=!!M,this.ha=Y,this.key=++ue,this.da=this.fa=!1}function Oe(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function K(f,x,b){for(const M in f)x.call(b,f[M],M,f)}function Se(f,x){for(const b in f)x.call(void 0,f[b],b,f)}function Ce(f){const x={};for(const b in f)x[b]=f[b];return x}const z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q(f,x){let b,M;for(let Y=1;Y<arguments.length;Y++){M=arguments[Y];for(b in M)f[b]=M[b];for(let te=0;te<z.length;te++)b=z[te],Object.prototype.hasOwnProperty.call(M,b)&&(f[b]=M[b])}}function G(f){this.src=f,this.g={},this.h=0}G.prototype.add=function(f,x,b,M,Y){const te=f.toString();f=this.g[te],f||(f=this.g[te]=[],this.h++);const _e=se(f,x,M,Y);return _e>-1?(x=f[_e],b||(x.fa=!1)):(x=new he(x,this.src,te,!!M,Y),x.fa=b,f.push(x)),x};function j(f,x){const b=x.type;if(b in f.g){var M=f.g[b],Y=Array.prototype.indexOf.call(M,x,void 0),te;(te=Y>=0)&&Array.prototype.splice.call(M,Y,1),te&&(Oe(x),f.g[b].length==0&&(delete f.g[b],f.h--))}}function se(f,x,b,M){for(let Y=0;Y<f.length;++Y){const te=f[Y];if(!te.da&&te.listener==x&&te.capture==!!b&&te.ha==M)return Y}return-1}var ge="closure_lm_"+(Math.random()*1e6|0),we={};function me(f,x,b,M,Y){if(Array.isArray(x)){for(let te=0;te<x.length;te++)me(f,x[te],b,M,Y);return null}return b=Et(b),f&&f[ie]?f.J(x,b,o(M)?!!M.capture:!1,Y):fe(f,x,b,!1,M,Y)}function fe(f,x,b,M,Y,te){if(!x)throw Error("Invalid event type");const _e=o(Y)?!!Y.capture:!!Y;let Ue=Ve(f);if(Ue||(f[ge]=Ue=new G(f)),b=Ue.add(x,b,M,_e,te),b.proxy)return b;if(M=Ge(),b.proxy=M,M.src=f,M.listener=b,f.addEventListener)k||(Y=_e),Y===void 0&&(Y=!1),f.addEventListener(x.toString(),M,Y);else if(f.attachEvent)f.attachEvent(qe(x.toString()),M);else if(f.addListener&&f.removeListener)f.addListener(M);else throw Error("addEventListener and attachEvent are unavailable.");return b}function Ge(){function f(b){return x.call(f.src,f.listener,b)}const x=nt;return f}function W(f,x,b,M,Y){if(Array.isArray(x))for(var te=0;te<x.length;te++)W(f,x[te],b,M,Y);else M=o(M)?!!M.capture:!!M,b=Et(b),f&&f[ie]?(f=f.i,te=String(x).toString(),te in f.g&&(x=f.g[te],b=se(x,b,M,Y),b>-1&&(Oe(x[b]),Array.prototype.splice.call(x,b,1),x.length==0&&(delete f.g[te],f.h--)))):f&&(f=Ve(f))&&(x=f.g[x.toString()],f=-1,x&&(f=se(x,b,M,Y)),(b=f>-1?x[f]:null)&&mt(b))}function mt(f){if(typeof f!="number"&&f&&!f.da){var x=f.src;if(x&&x[ie])j(x.i,f);else{var b=f.type,M=f.proxy;x.removeEventListener?x.removeEventListener(b,M,f.capture):x.detachEvent?x.detachEvent(qe(b),M):x.addListener&&x.removeListener&&x.removeListener(M),(b=Ve(x))?(j(b,f),b.h==0&&(b.src=null,x[ge]=null)):Oe(f)}}}function qe(f){return f in we?we[f]:we[f]="on"+f}function nt(f,x){if(f.da)f=!0;else{x=new oe(x,this);const b=f.listener,M=f.ha||f.src;f.fa&&mt(f),f=b.call(M,x)}return f}function Ve(f){return f=f[ge],f instanceof G?f:null}var xe="__closure_events_fn_"+(Math.random()*1e9>>>0);function Et(f){return typeof f=="function"?f:(f[xe]||(f[xe]=function(x){return f.handleEvent(x)}),f[xe])}function rt(){S.call(this),this.i=new G(this),this.M=this,this.G=null}h(rt,S),rt.prototype[ie]=!0,rt.prototype.removeEventListener=function(f,x,b,M){W(this,f,x,b,M)};function lt(f,x){var b,M=f.G;if(M)for(b=[];M;M=M.G)b.push(M);if(f=f.M,M=x.type||x,typeof x=="string")x=new A(x,f);else if(x instanceof A)x.target=x.target||f;else{var Y=x;x=new A(M,f),Q(x,Y)}Y=!0;let te,_e;if(b)for(_e=b.length-1;_e>=0;_e--)te=x.g=b[_e],Y=Un(te,M,!0,x)&&Y;if(te=x.g=f,Y=Un(te,M,!0,x)&&Y,Y=Un(te,M,!1,x)&&Y,b)for(_e=0;_e<b.length;_e++)te=x.g=b[_e],Y=Un(te,M,!1,x)&&Y}rt.prototype.N=function(){if(rt.Z.N.call(this),this.i){var f=this.i;for(const x in f.g){const b=f.g[x];for(let M=0;M<b.length;M++)Oe(b[M]);delete f.g[x],f.h--}}this.G=null},rt.prototype.J=function(f,x,b,M){return this.i.add(String(f),x,!1,b,M)},rt.prototype.K=function(f,x,b,M){return this.i.add(String(f),x,!0,b,M)};function Un(f,x,b,M){if(x=f.i.g[String(x)],!x)return!0;x=x.concat();let Y=!0;for(let te=0;te<x.length;++te){const _e=x[te];if(_e&&!_e.da&&_e.capture==b){const Ue=_e.listener,Gt=_e.ha||_e.src;_e.fa&&j(f.i,_e),Y=Ue.call(Gt,M)!==!1&&Y}}return Y&&!M.defaultPrevented}function Ps(f,x){if(typeof f!="function")if(f&&typeof f.handleEvent=="function")f=l(f.handleEvent,f);else throw Error("Invalid listener argument");return Number(x)>2147483647?-1:a.setTimeout(f,x||0)}function fr(f){f.g=Ps(()=>{f.g=null,f.i&&(f.i=!1,fr(f))},f.l);const x=f.h;f.h=null,f.m.apply(null,x)}class Pn extends S{constructor(x,b){super(),this.m=x,this.l=b,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:fr(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Dn(f){S.call(this),this.h=f,this.g={}}h(Dn,S);var dr=[];function Di(f){K(f.g,function(x,b){this.g.hasOwnProperty(b)&&mt(x)},f),f.g={}}Dn.prototype.N=function(){Dn.Z.N.call(this),Di(this)},Dn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wt=a.JSON.stringify,rr=a.JSON.parse,Be=class{stringify(f){return a.JSON.stringify(f,void 0)}parse(f){return a.JSON.parse(f,void 0)}};function wt(){}function Fn(){}var _t={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function pr(){A.call(this,"d")}h(pr,A);function Va(){A.call(this,"c")}h(Va,A);var Zr={},Iu=null;function Ds(){return Iu=Iu||new rt}Zr.Ia="serverreachability";function ic(f){A.call(this,Zr.Ia,f)}h(ic,A);function Fi(f){const x=Ds();lt(x,new ic(x))}Zr.STAT_EVENT="statevent";function Au(f,x){A.call(this,Zr.STAT_EVENT,f),this.stat=x}h(Au,A);function cn(f){const x=Ds();lt(x,new Au(x,f))}Zr.Ja="timingevent";function Fs(f,x){A.call(this,Zr.Ja,f),this.size=x}h(Fs,A);function Os(f,x){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){f()},x)}function Ms(){this.g=!0}Ms.prototype.ua=function(){this.g=!1};function _d(f,x,b,M,Y,te){f.info(function(){if(f.g)if(te){var _e="",Ue=te.split("&");for(let ct=0;ct<Ue.length;ct++){var Gt=Ue[ct].split("=");if(Gt.length>1){const tn=Gt[0];Gt=Gt[1];const Pr=tn.split("_");_e=Pr.length>=2&&Pr[1]=="type"?_e+(tn+"="+Gt+"&"):_e+(tn+"=redacted&")}}}else _e=null;else _e=te;return"XMLHTTP REQ ("+M+") [attempt "+Y+"]: "+x+`
`+b+`
`+_e})}function xd(f,x,b,M,Y,te,_e){f.info(function(){return"XMLHTTP RESP ("+M+") [ attempt "+Y+"]: "+x+`
`+b+`
`+te+" "+_e})}function Oi(f,x,b,M){f.info(function(){return"XMLHTTP TEXT ("+x+"): "+vd(f,b)+(M?" "+M:"")})}function yd(f,x){f.info(function(){return"TIMEOUT: "+x})}Ms.prototype.info=function(){};function vd(f,x){if(!f.g)return x;if(!x)return null;try{const te=JSON.parse(x);if(te){for(f=0;f<te.length;f++)if(Array.isArray(te[f])){var b=te[f];if(!(b.length<2)){var M=b[1];if(Array.isArray(M)&&!(M.length<1)){var Y=M[0];if(Y!="noop"&&Y!="stop"&&Y!="close")for(let _e=1;_e<M.length;_e++)M[_e]=""}}}}return Wt(te)}catch{return x}}var Ba={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ua={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Su;function sc(){}h(sc,wt),sc.prototype.g=function(){return new XMLHttpRequest},Su=new sc;function Ls(f){return encodeURIComponent(String(f))}function C(f){var x=1;f=f.split(":");const b=[];for(;x>0&&f.length;)b.push(f.shift()),x--;return f.length&&b.push(f.join(":")),b}function V(f,x,b,M){this.j=f,this.i=x,this.l=b,this.S=M||1,this.V=new Dn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new L}function L(){this.i=null,this.g="",this.h=!1}var N={},B={};function U(f,x,b){f.M=1,f.A=ku(Rr(x)),f.u=b,f.R=!0,J(f,null)}function J(f,x){f.F=Date.now(),ee(f),f.B=Rr(f.A);var b=f.B,M=f.S;Array.isArray(M)||(M=[String(M)]),Hm(b.i,"t",M),f.C=0,b=f.j.L,f.h=new L,f.g=s1(f.j,b?x:null,!f.u),f.P>0&&(f.O=new Pn(l(f.Y,f,f.g),f.P)),x=f.V,b=f.g,M=f.ba;var Y="readystatechange";Array.isArray(Y)||(Y&&(dr[0]=Y.toString()),Y=dr);for(let te=0;te<Y.length;te++){const _e=me(b,Y[te],M||x.handleEvent,!1,x.h||x);if(!_e)break;x.g[_e.key]=_e}x=f.J?Ce(f.J):{},f.u?(f.v||(f.v="POST"),x["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.B,f.v,f.u,x)):(f.v="GET",f.g.ea(f.B,f.v,null,x)),Fi(),_d(f.i,f.v,f.B,f.l,f.S,f.u)}V.prototype.ba=function(f){f=f.target;const x=this.O;x&&Vi(f)==3?x.j():this.Y(f)},V.prototype.Y=function(f){try{if(f==this.g)e:{const Ue=Vi(this.g),Gt=this.g.ya(),ct=this.g.ca();if(!(Ue<3)&&(Ue!=3||this.g&&(this.h.h||this.g.la()||Km(this.g)))){this.K||Ue!=4||Gt==7||(Gt==8||ct<=0?Fi(3):Fi(2)),pe(this);var x=this.g.ca();this.X=x;var b=re(this);if(this.o=x==200,xd(this.i,this.v,this.B,this.l,this.S,Ue,x),this.o){if(this.U&&!this.L){t:{if(this.g){var M,Y=this.g;if((M=Y.g?Y.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(M)){var te=M;break t}}te=null}if(f=te)Oi(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ve(this,f);else{this.o=!1,this.m=3,cn(12),le(this),Ee(this);break e}}if(this.R){f=!0;let tn;for(;!this.K&&this.C<b.length;)if(tn=Z(this,b),tn==B){Ue==4&&(this.m=4,cn(14),f=!1),Oi(this.i,this.l,null,"[Incomplete Response]");break}else if(tn==N){this.m=4,cn(15),Oi(this.i,this.l,b,"[Invalid Chunk]"),f=!1;break}else Oi(this.i,this.l,tn,null),ve(this,tn);if(X(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ue!=4||b.length!=0||this.h.h||(this.m=1,cn(16),f=!1),this.o=this.o&&f,!f)Oi(this.i,this.l,b,"[Invalid Chunked Response]"),le(this),Ee(this);else if(b.length>0&&!this.W){this.W=!0;var _e=this.j;_e.g==this&&_e.aa&&!_e.P&&(_e.j.info("Great, no buffering proxy detected. Bytes received: "+b.length),Ad(_e),_e.P=!0,cn(11))}}else Oi(this.i,this.l,b,null),ve(this,b);Ue==4&&le(this),this.o&&!this.K&&(Ue==4?t1(this.j,this):(this.o=!1,ee(this)))}else gA(this.g),x==400&&b.indexOf("Unknown SID")>0?(this.m=3,cn(12)):(this.m=0,cn(13)),le(this),Ee(this)}}}catch{}};function re(f){if(!X(f))return f.g.la();const x=Km(f.g);if(x==="")return"";let b="";const M=x.length,Y=Vi(f.g)==4;if(!f.h.i){if(typeof TextDecoder>"u")return le(f),Ee(f),"";f.h.i=new a.TextDecoder}for(let te=0;te<M;te++)f.h.h=!0,b+=f.h.i.decode(x[te],{stream:!(Y&&te==M-1)});return x.length=0,f.h.g+=b,f.C=0,f.h.g}function X(f){return f.g?f.v=="GET"&&f.M!=2&&f.j.Aa:!1}function Z(f,x){var b=f.C,M=x.indexOf(`
`,b);return M==-1?B:(b=Number(x.substring(b,M)),isNaN(b)?N:(M+=1,M+b>x.length?B:(x=x.slice(M,M+b),f.C=M+b,x)))}V.prototype.cancel=function(){this.K=!0,le(this)};function ee(f){f.T=Date.now()+f.H,ce(f,f.H)}function ce(f,x){if(f.D!=null)throw Error("WatchDog timer not null");f.D=Os(l(f.aa,f),x)}function pe(f){f.D&&(a.clearTimeout(f.D),f.D=null)}V.prototype.aa=function(){this.D=null;const f=Date.now();f-this.T>=0?(yd(this.i,this.B),this.M!=2&&(Fi(),cn(17)),le(this),this.m=2,Ee(this)):ce(this,this.T-f)};function Ee(f){f.j.I==0||f.K||t1(f.j,f)}function le(f){pe(f);var x=f.O;x&&typeof x.dispose=="function"&&x.dispose(),f.O=null,Di(f.V),f.g&&(x=f.g,f.g=null,x.abort(),x.dispose())}function ve(f,x){try{var b=f.j;if(b.I!=0&&(b.g==f||ei(b.h,f))){if(!f.L&&ei(b.h,f)&&b.I==3){try{var M=b.Ba.g.parse(x)}catch{M=null}if(Array.isArray(M)&&M.length==3){var Y=M;if(Y[0]==0){e:if(!b.v){if(b.g)if(b.g.F+3e3<f.F)Fu(b),Pu(b);else break e;Id(b),cn(18)}}else b.xa=Y[1],0<b.xa-b.K&&Y[2]<37500&&b.F&&b.A==0&&!b.C&&(b.C=Os(l(b.Va,b),6e3));jt(b.h)<=1&&b.ta&&(b.ta=void 0)}else Vs(b,11)}else if((f.L||b.g==f)&&Fu(b),!D(x))for(Y=b.Ba.g.parse(x),x=0;x<Y.length;x++){let ct=Y[x];const tn=ct[0];if(!(tn<=b.K))if(b.K=tn,ct=ct[1],b.I==2)if(ct[0]=="c"){b.M=ct[1],b.ba=ct[2];const Pr=ct[3];Pr!=null&&(b.ka=Pr,b.j.info("VER="+b.ka));const Bs=ct[4];Bs!=null&&(b.za=Bs,b.j.info("SVER="+b.za));const Bi=ct[5];Bi!=null&&typeof Bi=="number"&&Bi>0&&(M=1.5*Bi,b.O=M,b.j.info("backChannelRequestTimeoutMs_="+M)),M=b;const Ui=f.g;if(Ui){const Mu=Ui.g?Ui.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Mu){var te=M.h;te.g||Mu.indexOf("spdy")==-1&&Mu.indexOf("quic")==-1&&Mu.indexOf("h2")==-1||(te.j=te.l,te.g=new Set,te.h&&(ti(te,te.h),te.h=null))}if(M.G){const Sd=Ui.g?Ui.g.getResponseHeader("X-HTTP-Session-Id"):null;Sd&&(M.wa=Sd,xt(M.J,M.G,Sd))}}b.I=3,b.l&&b.l.ra(),b.aa&&(b.T=Date.now()-f.F,b.j.info("Handshake RTT: "+b.T+"ms")),M=b;var _e=f;if(M.na=i1(M,M.L?M.ba:null,M.W),_e.L){Mi(M.h,_e);var Ue=_e,Gt=M.O;Gt&&(Ue.H=Gt),Ue.D&&(pe(Ue),ee(Ue)),M.g=_e}else Zm(M);b.i.length>0&&Du(b)}else ct[0]!="stop"&&ct[0]!="close"||Vs(b,7);else b.I==3&&(ct[0]=="stop"||ct[0]=="close"?ct[0]=="stop"?Vs(b,7):bd(b):ct[0]!="noop"&&b.l&&b.l.qa(ct),b.A=0)}}Fi(4)}catch{}}var Fe=class{constructor(f,x){this.g=f,this.map=x}};function ut(f){this.l=f||10,a.PerformanceNavigationTiming?(f=a.performance.getEntriesByType("navigation"),f=f.length>0&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ht(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function jt(f){return f.h?1:f.g?f.g.size:0}function ei(f,x){return f.h?f.h==x:f.g?f.g.has(x):!1}function ti(f,x){f.g?f.g.add(x):f.h=x}function Mi(f,x){f.h&&f.h==x?f.h=null:f.g&&f.g.has(x)&&f.g.delete(x)}ut.prototype.cancel=function(){if(this.i=Cr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Cr(f){if(f.h!=null)return f.i.concat(f.h.G);if(f.g!=null&&f.g.size!==0){let x=f.i;for(const b of f.g.values())x=x.concat(b.G);return x}return p(f.i)}var Ha=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gr(f,x){if(f){f=f.split("&");for(let b=0;b<f.length;b++){const M=f[b].indexOf("=");let Y,te=null;M>=0?(Y=f[b].substring(0,M),te=f[b].substring(M+1)):Y=f[b],x(Y,te?decodeURIComponent(te.replace(/\+/g," ")):"")}}}function Li(f){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let x;f instanceof Li?(this.l=f.l,ac(this,f.j),this.o=f.o,this.g=f.g,oc(this,f.u),this.h=f.h,Ed(this,zm(f.i)),this.m=f.m):f&&(x=String(f).match(Ha))?(this.l=!1,ac(this,x[1]||"",!0),this.o=cc(x[2]||""),this.g=cc(x[3]||"",!0),oc(this,x[4]),this.h=cc(x[5]||"",!0),Ed(this,x[6]||"",!0),this.m=cc(x[7]||"")):(this.l=!1,this.i=new uc(null,this.l))}Li.prototype.toString=function(){const f=[];var x=this.j;x&&f.push(lc(x,Nm,!0),":");var b=this.g;return(b||x=="file")&&(f.push("//"),(x=this.o)&&f.push(lc(x,Nm,!0),"@"),f.push(Ls(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.u,b!=null&&f.push(":",String(b))),(b=this.h)&&(this.g&&b.charAt(0)!="/"&&f.push("/"),f.push(lc(b,b.charAt(0)=="/"?aA:sA,!0))),(b=this.i.toString())&&f.push("?",b),(b=this.m)&&f.push("#",lc(b,cA)),f.join("")},Li.prototype.resolve=function(f){const x=Rr(this);let b=!!f.j;b?ac(x,f.j):b=!!f.o,b?x.o=f.o:b=!!f.g,b?x.g=f.g:b=f.u!=null;var M=f.h;if(b)oc(x,f.u);else if(b=!!f.h){if(M.charAt(0)!="/")if(this.g&&!this.h)M="/"+M;else{var Y=x.h.lastIndexOf("/");Y!=-1&&(M=x.h.slice(0,Y+1)+M)}if(Y=M,Y==".."||Y==".")M="";else if(Y.indexOf("./")!=-1||Y.indexOf("/.")!=-1){M=Y.lastIndexOf("/",0)==0,Y=Y.split("/");const te=[];for(let _e=0;_e<Y.length;){const Ue=Y[_e++];Ue=="."?M&&_e==Y.length&&te.push(""):Ue==".."?((te.length>1||te.length==1&&te[0]!="")&&te.pop(),M&&_e==Y.length&&te.push("")):(te.push(Ue),M=!0)}M=te.join("/")}else M=Y}return b?x.h=M:b=f.i.toString()!=="",b?Ed(x,zm(f.i)):b=!!f.m,b&&(x.m=f.m),x};function Rr(f){return new Li(f)}function ac(f,x,b){f.j=b?cc(x,!0):x,f.j&&(f.j=f.j.replace(/:$/,""))}function oc(f,x){if(x){if(x=Number(x),isNaN(x)||x<0)throw Error("Bad port number "+x);f.u=x}else f.u=null}function Ed(f,x,b){x instanceof uc?(f.i=x,lA(f.i,f.l)):(b||(x=lc(x,oA)),f.i=new uc(x,f.l))}function xt(f,x,b){f.i.set(x,b)}function ku(f){return xt(f,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),f}function cc(f,x){return f?x?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function lc(f,x,b){return typeof f=="string"?(f=encodeURI(f).replace(x,iA),b&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function iA(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Nm=/[#\/\?@]/g,sA=/[#\?:]/g,aA=/[#\?]/g,oA=/[#\?@]/g,cA=/#/g;function uc(f,x){this.h=this.g=null,this.i=f||null,this.j=!!x}function Ns(f){f.g||(f.g=new Map,f.h=0,f.i&&gr(f.i,function(x,b){f.add(decodeURIComponent(x.replace(/\+/g," ")),b)}))}n=uc.prototype,n.add=function(f,x){Ns(this),this.i=null,f=za(this,f);let b=this.g.get(f);return b||this.g.set(f,b=[]),b.push(x),this.h+=1,this};function Vm(f,x){Ns(f),x=za(f,x),f.g.has(x)&&(f.i=null,f.h-=f.g.get(x).length,f.g.delete(x))}function Bm(f,x){return Ns(f),x=za(f,x),f.g.has(x)}n.forEach=function(f,x){Ns(this),this.g.forEach(function(b,M){b.forEach(function(Y){f.call(x,Y,M,this)},this)},this)};function Um(f,x){Ns(f);let b=[];if(typeof x=="string")Bm(f,x)&&(b=b.concat(f.g.get(za(f,x))));else for(f=Array.from(f.g.values()),x=0;x<f.length;x++)b=b.concat(f[x]);return b}n.set=function(f,x){return Ns(this),this.i=null,f=za(this,f),Bm(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[x]),this.h+=1,this},n.get=function(f,x){return f?(f=Um(this,f),f.length>0?String(f[0]):x):x};function Hm(f,x,b){Vm(f,x),b.length>0&&(f.i=null,f.g.set(za(f,x),p(b)),f.h+=b.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],x=Array.from(this.g.keys());for(let M=0;M<x.length;M++){var b=x[M];const Y=Ls(b);b=Um(this,b);for(let te=0;te<b.length;te++){let _e=Y;b[te]!==""&&(_e+="="+Ls(b[te])),f.push(_e)}}return this.i=f.join("&")};function zm(f){const x=new uc;return x.i=f.i,f.g&&(x.g=new Map(f.g),x.h=f.h),x}function za(f,x){return x=String(x),f.j&&(x=x.toLowerCase()),x}function lA(f,x){x&&!f.j&&(Ns(f),f.i=null,f.g.forEach(function(b,M){const Y=M.toLowerCase();M!=Y&&(Vm(this,M),Hm(this,Y,b))},f)),f.j=x}function uA(f,x){const b=new Ms;if(a.Image){const M=new Image;M.onload=u(Ni,b,"TestLoadImage: loaded",!0,x,M),M.onerror=u(Ni,b,"TestLoadImage: error",!1,x,M),M.onabort=u(Ni,b,"TestLoadImage: abort",!1,x,M),M.ontimeout=u(Ni,b,"TestLoadImage: timeout",!1,x,M),a.setTimeout(function(){M.ontimeout&&M.ontimeout()},1e4),M.src=f}else x(!1)}function hA(f,x){const b=new Ms,M=new AbortController,Y=setTimeout(()=>{M.abort(),Ni(b,"TestPingServer: timeout",!1,x)},1e4);fetch(f,{signal:M.signal}).then(te=>{clearTimeout(Y),te.ok?Ni(b,"TestPingServer: ok",!0,x):Ni(b,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(Y),Ni(b,"TestPingServer: error",!1,x)})}function Ni(f,x,b,M,Y){try{Y&&(Y.onload=null,Y.onerror=null,Y.onabort=null,Y.ontimeout=null),M(b)}catch{}}function fA(){this.g=new Be}function wd(f){this.i=f.Sb||null,this.h=f.ab||!1}h(wd,wt),wd.prototype.g=function(){return new Cu(this.i,this.h)};function Cu(f,x){rt.call(this),this.H=f,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Cu,rt),n=Cu.prototype,n.open=function(f,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=f,this.D=x,this.readyState=1,fc(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const x={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};f&&(x.body=f),(this.H||a).fetch(new Request(this.D,x)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,hc(this)),this.readyState=0},n.Pa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,fc(this)),this.g&&(this.readyState=3,fc(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;$m(this)}else f.text().then(this.Oa.bind(this),this.ga.bind(this))};function $m(f){f.j.read().then(f.Ma.bind(f)).catch(f.ga.bind(f))}n.Ma=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var x=f.value?f.value:new Uint8Array(0);(x=this.B.decode(x,{stream:!f.done}))&&(this.response=this.responseText+=x)}f.done?hc(this):fc(this),this.readyState==3&&$m(this)}},n.Oa=function(f){this.g&&(this.response=this.responseText=f,hc(this))},n.Na=function(f){this.g&&(this.response=f,hc(this))},n.ga=function(){this.g&&hc(this)};function hc(f){f.readyState=4,f.l=null,f.j=null,f.B=null,fc(f)}n.setRequestHeader=function(f,x){this.A.append(f,x)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],x=this.h.entries();for(var b=x.next();!b.done;)b=b.value,f.push(b[0]+": "+b[1]),b=x.next();return f.join(`\r
`)};function fc(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Cu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Wm(f){let x="";return K(f,function(b,M){x+=M,x+=":",x+=b,x+=`\r
`}),x}function Td(f,x,b){e:{for(M in b){var M=!1;break e}M=!0}M||(b=Wm(b),typeof f=="string"?b!=null&&Ls(b):xt(f,x,b))}function Ct(f){rt.call(this),this.headers=new Map,this.L=f||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Ct,rt);var dA=/^https?$/i,pA=["POST","PUT"];n=Ct.prototype,n.Fa=function(f){this.H=f},n.ea=function(f,x,b,M){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);x=x?x.toUpperCase():"GET",this.D=f,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Su.g(),this.g.onreadystatechange=d(l(this.Ca,this));try{this.B=!0,this.g.open(x,String(f),!0),this.B=!1}catch(te){jm(this,te);return}if(f=b||"",b=new Map(this.headers),M)if(Object.getPrototypeOf(M)===Object.prototype)for(var Y in M)b.set(Y,M[Y]);else if(typeof M.keys=="function"&&typeof M.get=="function")for(const te of M.keys())b.set(te,M.get(te));else throw Error("Unknown input type for opt_headers: "+String(M));M=Array.from(b.keys()).find(te=>te.toLowerCase()=="content-type"),Y=a.FormData&&f instanceof a.FormData,!(Array.prototype.indexOf.call(pA,x,void 0)>=0)||M||Y||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[te,_e]of b)this.g.setRequestHeader(te,_e);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(f),this.v=!1}catch(te){jm(this,te)}};function jm(f,x){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=x,f.o=5,Gm(f),Ru(f)}function Gm(f){f.A||(f.A=!0,lt(f,"complete"),lt(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=f||7,lt(this,"complete"),lt(this,"abort"),Ru(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ru(this,!0)),Ct.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?qm(this):this.Xa())},n.Xa=function(){qm(this)};function qm(f){if(f.h&&typeof s<"u"){if(f.v&&Vi(f)==4)setTimeout(f.Ca.bind(f),0);else if(lt(f,"readystatechange"),Vi(f)==4){f.h=!1;try{const te=f.ca();e:switch(te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break e;default:x=!1}var b;if(!(b=x)){var M;if(M=te===0){let _e=String(f.D).match(Ha)[1]||null;!_e&&a.self&&a.self.location&&(_e=a.self.location.protocol.slice(0,-1)),M=!dA.test(_e?_e.toLowerCase():"")}b=M}if(b)lt(f,"complete"),lt(f,"success");else{f.o=6;try{var Y=Vi(f)>2?f.g.statusText:""}catch{Y=""}f.l=Y+" ["+f.ca()+"]",Gm(f)}}finally{Ru(f)}}}}function Ru(f,x){if(f.g){f.m&&(clearTimeout(f.m),f.m=null);const b=f.g;f.g=null,x||lt(f,"ready");try{b.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Vi(f){return f.g?f.g.readyState:0}n.ca=function(){try{return Vi(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(f){if(this.g){var x=this.g.responseText;return f&&x.indexOf(f)==0&&(x=x.substring(f.length)),rr(x)}};function Km(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.F){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function gA(f){const x={};f=(f.g&&Vi(f)>=2&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let M=0;M<f.length;M++){if(D(f[M]))continue;var b=C(f[M]);const Y=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const te=x[Y]||[];x[Y]=te,te.push(b)}Se(x,function(M){return M.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function dc(f,x,b){return b&&b.internalChannelParams&&b.internalChannelParams[f]||x}function Ym(f){this.za=0,this.i=[],this.j=new Ms,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=dc("failFast",!1,f),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=dc("baseRetryDelayMs",5e3,f),this.Za=dc("retryDelaySeedMs",1e4,f),this.Ta=dc("forwardChannelMaxRetries",2,f),this.va=dc("forwardChannelRequestTimeoutMs",2e4,f),this.ma=f&&f.xmlHttpFactory||void 0,this.Ua=f&&f.Rb||void 0,this.Aa=f&&f.useFetchStreams||!1,this.O=void 0,this.L=f&&f.supportsCrossDomainXhr||!1,this.M="",this.h=new ut(f&&f.concurrentRequestLimit),this.Ba=new fA,this.S=f&&f.fastHandshake||!1,this.R=f&&f.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=f&&f.Pb||!1,f&&f.ua&&this.j.ua(),f&&f.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&f&&f.detectBufferingProxy||!1,this.ia=void 0,f&&f.longPollingTimeout&&f.longPollingTimeout>0&&(this.ia=f.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ym.prototype,n.ka=8,n.I=1,n.connect=function(f,x,b,M){cn(0),this.W=f,this.H=x||{},b&&M!==void 0&&(this.H.OSID=b,this.H.OAID=M),this.F=this.X,this.J=i1(this,null,this.W),Du(this)};function bd(f){if(Xm(f),f.I==3){var x=f.V++,b=Rr(f.J);if(xt(b,"SID",f.M),xt(b,"RID",x),xt(b,"TYPE","terminate"),pc(f,b),x=new V(f,f.j,x),x.M=2,x.A=ku(Rr(b)),b=!1,a.navigator&&a.navigator.sendBeacon)try{b=a.navigator.sendBeacon(x.A.toString(),"")}catch{}!b&&a.Image&&(new Image().src=x.A,b=!0),b||(x.g=s1(x.j,null),x.g.ea(x.A)),x.F=Date.now(),ee(x)}r1(f)}function Pu(f){f.g&&(Ad(f),f.g.cancel(),f.g=null)}function Xm(f){Pu(f),f.v&&(a.clearTimeout(f.v),f.v=null),Fu(f),f.h.cancel(),f.m&&(typeof f.m=="number"&&a.clearTimeout(f.m),f.m=null)}function Du(f){if(!ht(f.h)&&!f.m){f.m=!0;var x=f.Ea;F||w(),O||(F(),O=!0),y.add(x,f),f.D=0}}function mA(f,x){return jt(f.h)>=f.h.j-(f.m?1:0)?!1:f.m?(f.i=x.G.concat(f.i),!0):f.I==1||f.I==2||f.D>=(f.Sa?0:f.Ta)?!1:(f.m=Os(l(f.Ea,f,x),n1(f,f.D)),f.D++,!0)}n.Ea=function(f){if(this.m)if(this.m=null,this.I==1){if(!f){this.V=Math.floor(Math.random()*1e5),f=this.V++;const Y=new V(this,this.j,f);let te=this.o;if(this.U&&(te?(te=Ce(te),Q(te,this.U)):te=this.U),this.u!==null||this.R||(Y.J=te,te=null),this.S)e:{for(var x=0,b=0;b<this.i.length;b++){t:{var M=this.i[b];if("__data__"in M.map&&(M=M.map.__data__,typeof M=="string")){M=M.length;break t}M=void 0}if(M===void 0)break;if(x+=M,x>4096){x=b;break e}if(x===4096||b===this.i.length-1){x=b+1;break e}}x=1e3}else x=1e3;x=Jm(this,Y,x),b=Rr(this.J),xt(b,"RID",f),xt(b,"CVER",22),this.G&&xt(b,"X-HTTP-Session-Id",this.G),pc(this,b),te&&(this.R?x="headers="+Ls(Wm(te))+"&"+x:this.u&&Td(b,this.u,te)),ti(this.h,Y),this.Ra&&xt(b,"TYPE","init"),this.S?(xt(b,"$req",x),xt(b,"SID","null"),Y.U=!0,U(Y,b,null)):U(Y,b,x),this.I=2}}else this.I==3&&(f?Qm(this,f):this.i.length==0||ht(this.h)||Qm(this))};function Qm(f,x){var b;x?b=x.l:b=f.V++;const M=Rr(f.J);xt(M,"SID",f.M),xt(M,"RID",b),xt(M,"AID",f.K),pc(f,M),f.u&&f.o&&Td(M,f.u,f.o),b=new V(f,f.j,b,f.D+1),f.u===null&&(b.J=f.o),x&&(f.i=x.G.concat(f.i)),x=Jm(f,b,1e3),b.H=Math.round(f.va*.5)+Math.round(f.va*.5*Math.random()),ti(f.h,b),U(b,M,x)}function pc(f,x){f.H&&K(f.H,function(b,M){xt(x,M,b)}),f.l&&K({},function(b,M){xt(x,M,b)})}function Jm(f,x,b){b=Math.min(f.i.length,b);const M=f.l?l(f.l.Ka,f.l,f):null;e:{var Y=f.i;let Ue=-1;for(;;){const Gt=["count="+b];Ue==-1?b>0?(Ue=Y[0].g,Gt.push("ofs="+Ue)):Ue=0:Gt.push("ofs="+Ue);let ct=!0;for(let tn=0;tn<b;tn++){var te=Y[tn].g;const Pr=Y[tn].map;if(te-=Ue,te<0)Ue=Math.max(0,Y[tn].g-100),ct=!1;else try{te="req"+te+"_"||"";try{var _e=Pr instanceof Map?Pr:Object.entries(Pr);for(const[Bs,Bi]of _e){let Ui=Bi;o(Bi)&&(Ui=Wt(Bi)),Gt.push(te+Bs+"="+encodeURIComponent(Ui))}}catch(Bs){throw Gt.push(te+"type="+encodeURIComponent("_badmap")),Bs}}catch{M&&M(Pr)}}if(ct){_e=Gt.join("&");break e}}_e=void 0}return f=f.i.splice(0,b),x.G=f,_e}function Zm(f){if(!f.g&&!f.v){f.Y=1;var x=f.Da;F||w(),O||(F(),O=!0),y.add(x,f),f.A=0}}function Id(f){return f.g||f.v||f.A>=3?!1:(f.Y++,f.v=Os(l(f.Da,f),n1(f,f.A)),f.A++,!0)}n.Da=function(){if(this.v=null,e1(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var f=4*this.T;this.j.info("BP detection timer enabled: "+f),this.B=Os(l(this.Wa,this),f)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,cn(10),Pu(this),e1(this))};function Ad(f){f.B!=null&&(a.clearTimeout(f.B),f.B=null)}function e1(f){f.g=new V(f,f.j,"rpc",f.Y),f.u===null&&(f.g.J=f.o),f.g.P=0;var x=Rr(f.na);xt(x,"RID","rpc"),xt(x,"SID",f.M),xt(x,"AID",f.K),xt(x,"CI",f.F?"0":"1"),!f.F&&f.ia&&xt(x,"TO",f.ia),xt(x,"TYPE","xmlhttp"),pc(f,x),f.u&&f.o&&Td(x,f.u,f.o),f.O&&(f.g.H=f.O);var b=f.g;f=f.ba,b.M=1,b.A=ku(Rr(x)),b.u=null,b.R=!0,J(b,f)}n.Va=function(){this.C!=null&&(this.C=null,Pu(this),Id(this),cn(19))};function Fu(f){f.C!=null&&(a.clearTimeout(f.C),f.C=null)}function t1(f,x){var b=null;if(f.g==x){Fu(f),Ad(f),f.g=null;var M=2}else if(ei(f.h,x))b=x.G,Mi(f.h,x),M=1;else return;if(f.I!=0){if(x.o)if(M==1){b=x.u?x.u.length:0,x=Date.now()-x.F;var Y=f.D;M=Ds(),lt(M,new Fs(M,b)),Du(f)}else Zm(f);else if(Y=x.m,Y==3||Y==0&&x.X>0||!(M==1&&mA(f,x)||M==2&&Id(f)))switch(b&&b.length>0&&(x=f.h,x.i=x.i.concat(b)),Y){case 1:Vs(f,5);break;case 4:Vs(f,10);break;case 3:Vs(f,6);break;default:Vs(f,2)}}}function n1(f,x){let b=f.Qa+Math.floor(Math.random()*f.Za);return f.isActive()||(b*=2),b*x}function Vs(f,x){if(f.j.info("Error code "+x),x==2){var b=l(f.bb,f),M=f.Ua;const Y=!M;M=new Li(M||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ac(M,"https"),ku(M),Y?uA(M.toString(),b):hA(M.toString(),b)}else cn(2);f.I=0,f.l&&f.l.pa(x),r1(f),Xm(f)}n.bb=function(f){f?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))};function r1(f){if(f.I=0,f.ja=[],f.l){const x=Cr(f.h);(x.length!=0||f.i.length!=0)&&(g(f.ja,x),g(f.ja,f.i),f.h.i.length=0,p(f.i),f.i.length=0),f.l.oa()}}function i1(f,x,b){var M=b instanceof Li?Rr(b):new Li(b);if(M.g!="")x&&(M.g=x+"."+M.g),oc(M,M.u);else{var Y=a.location;M=Y.protocol,x=x?x+"."+Y.hostname:Y.hostname,Y=+Y.port;const te=new Li(null);M&&ac(te,M),x&&(te.g=x),Y&&oc(te,Y),b&&(te.h=b),M=te}return b=f.G,x=f.wa,b&&x&&xt(M,b,x),xt(M,"VER",f.ka),pc(f,M),M}function s1(f,x,b){if(x&&!f.L)throw Error("Can't create secondary domain capable XhrIo object.");return x=f.Aa&&!f.ma?new Ct(new wd({ab:b})):new Ct(f.ma),x.Fa(f.L),x}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function a1(){}n=a1.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ou(){}Ou.prototype.g=function(f,x){return new qn(f,x)};function qn(f,x){rt.call(this),this.g=new Ym(x),this.l=f,this.h=x&&x.messageUrlParams||null,f=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(f?f["X-WebChannel-Content-Type"]=x.messageContentType:f={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.sa&&(f?f["X-WebChannel-Client-Profile"]=x.sa:f={"X-WebChannel-Client-Profile":x.sa}),this.g.U=f,(f=x&&x.Qb)&&!D(f)&&(this.g.u=f),this.A=x&&x.supportsCrossDomainXhr||!1,this.v=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!D(x)&&(this.g.G=x,f=this.h,f!==null&&x in f&&(f=this.h,x in f&&delete f[x])),this.j=new $a(this)}h(qn,rt),qn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},qn.prototype.close=function(){bd(this.g)},qn.prototype.o=function(f){var x=this.g;if(typeof f=="string"){var b={};b.__data__=f,f=b}else this.v&&(b={},b.__data__=Wt(f),f=b);x.i.push(new Fe(x.Ya++,f)),x.I==3&&Du(x)},qn.prototype.N=function(){this.g.l=null,delete this.j,bd(this.g),delete this.g,qn.Z.N.call(this)};function o1(f){pr.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var x=f.__sm__;if(x){e:{for(const b in x){f=b;break e}f=void 0}(this.i=f)&&(f=this.i,x=x!==null&&f in x?x[f]:void 0),this.data=x}else this.data=f}h(o1,pr);function c1(){Va.call(this),this.status=1}h(c1,Va);function $a(f){this.g=f}h($a,a1),$a.prototype.ra=function(){lt(this.g,"a")},$a.prototype.qa=function(f){lt(this.g,new o1(f))},$a.prototype.pa=function(f){lt(this.g,new c1)},$a.prototype.oa=function(){lt(this.g,"b")},Ou.prototype.createWebChannel=Ou.prototype.g,qn.prototype.send=qn.prototype.o,qn.prototype.open=qn.prototype.m,qn.prototype.close=qn.prototype.close,Xw=function(){return new Ou},Yw=function(){return Ds()},Kw=Zr,U0={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ba.NO_ERROR=0,Ba.TIMEOUT=8,Ba.HTTP_ERROR=6,vh=Ba,Ua.COMPLETE="complete",qw=Ua,Fn.EventType=_t,_t.OPEN="a",_t.CLOSE="b",_t.ERROR="c",_t.MESSAGE="d",rt.prototype.listen=rt.prototype.J,Oc=Fn,Ct.prototype.listenOnce=Ct.prototype.K,Ct.prototype.getLastError=Ct.prototype.Ha,Ct.prototype.getLastErrorCode=Ct.prototype.ya,Ct.prototype.getStatus=Ct.prototype.ca,Ct.prototype.getResponseJson=Ct.prototype.La,Ct.prototype.getResponseText=Ct.prototype.la,Ct.prototype.send=Ct.prototype.ea,Ct.prototype.setWithCredentials=Ct.prototype.Fa,Gw=Ct}).apply(typeof Qu<"u"?Qu:typeof self<"u"?self:typeof window<"u"?window:{});class mn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}mn.UNAUTHENTICATED=new mn(null),mn.GOOGLE_CREDENTIALS=new mn("google-credentials-uid"),mn.FIRST_PARTY=new mn("first-party-uid"),mn.MOCK_USER=new mn("mock-user");let qo="12.10.0";function HO(n){qo=n}const xa=new Yp("@firebase/firestore");function eo(){return xa.logLevel}function ae(n,...e){if(xa.logLevel<=$e.DEBUG){const t=e.map(ag);xa.debug(`Firestore (${qo}): ${n}`,...t)}}function Mt(n,...e){if(xa.logLevel<=$e.ERROR){const t=e.map(ag);xa.error(`Firestore (${qo}): ${n}`,...t)}}function wo(n,...e){if(xa.logLevel<=$e.WARN){const t=e.map(ag);xa.warn(`Firestore (${qo}): ${n}`,...t)}}function ag(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function Te(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Qw(n,r,t)}function Qw(n,e,t){let r=`FIRESTORE (${qo}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Mt(r),new Error(r)}function Ae(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Qw(e,i,r)}function be(n,e){return n}const ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class de extends Yr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class zO{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $O{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(mn.UNAUTHENTICATED)))}shutdown(){}}class WO{constructor(e){this.t=e,this.currentUser=mn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ae(this.o===void 0,42304);let r=this.i;const i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let s=new Wr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Wr,e.enqueueRetryable((()=>i(this.currentUser)))};const a=()=>{const c=s;e.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},o=c=>{ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((c=>o(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?o(c):(ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Wr)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ae(typeof r.accessToken=="string",31837,{l:r}),new zO(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ae(e===null||typeof e=="string",2055,{h:e}),new mn(e)}}class jO{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=mn.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class GO{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new jO(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(mn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class fx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qO{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ae(this.o===void 0,3512);const r=s=>{s.error!=null&&ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,ae("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>r(s)))};const i=s=>{ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new fx(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Ae(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new fx(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function KO(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class og{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=KO(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function De(n,e){return n<e?-1:n>e?1:0}function H0(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),s=e.charAt(r);if(i!==s)return Yd(i)===Yd(s)?De(i,s):Yd(i)?1:-1}return De(n.length,e.length)}const YO=55296,XO=57343;function Yd(n){const e=n.charCodeAt(0);return e>=YO&&e<=XO}function To(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}function Jw(n){return n+"\0"}const dx="__name__";class Lr{constructor(e,t,r){t===void 0?t=0:t>e.length&&Te(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&Te(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Lr.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Lr?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=Lr.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return De(e.length,t.length)}static compareSegments(e,t){const r=Lr.isNumericId(e),i=Lr.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Lr.extractNumericId(e).compare(Lr.extractNumericId(t)):H0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ls.fromString(e.substring(4,e.length-2))}}class tt extends Lr{construct(e,t,r){return new tt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new de(ne.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new tt(t)}static emptyPath(){return new tt([])}}const QO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class St extends Lr{construct(e,t,r){return new St(e,t,r)}static isValidIdentifier(e){return QO.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),St.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===dx}static keyField(){return new St([dx])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new de(ne.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const o=e[i];if(o==="\\"){if(i+1===e.length)throw new de(ne.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new de(ne.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else o==="`"?(a=!a,i++):o!=="."||a?(r+=o,i++):(s(),i++)}if(s(),a)throw new de(ne.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new St(t)}static emptyPath(){return new St([])}}class ye{constructor(e){this.path=e}static fromPath(e){return new ye(tt.fromString(e))}static fromName(e){return new ye(tt.fromString(e).popFirst(5))}static empty(){return new ye(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return tt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ye(new tt(e.slice()))}}function Zw(n,e,t){if(!t)throw new de(ne.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JO(n,e,t,r){if(e===!0&&r===!0)throw new de(ne.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function px(n){if(!ye.isDocumentKey(n))throw new de(ne.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function gx(n){if(ye.isDocumentKey(n))throw new de(ne.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function eT(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function jf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Te(12329,{type:typeof n})}function In(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new de(ne.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=jf(n);throw new de(ne.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ZO(n,e){if(e<=0)throw new de(ne.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function $t(n,e){const t={typeString:n};return e&&(t.value=e),t}function iu(n,e){if(!eT(n))throw new de(ne.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new de(ne.INVALID_ARGUMENT,t);return!0}const mx=-62135596800,_x=1e6;class st{static now(){return st.fromMillis(Date.now())}static fromDate(e){return st.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*_x);return new st(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new de(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new de(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<mx)throw new de(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new de(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_x}_compareTo(e){return this.seconds===e.seconds?De(this.nanoseconds,e.nanoseconds):De(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:st._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(iu(e,st._jsonSchema))return new st(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-mx;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}st._jsonSchemaVersion="firestore/timestamp/1.0",st._jsonSchema={type:$t("string",st._jsonSchemaVersion),seconds:$t("number"),nanoseconds:$t("number")};class ke{static fromTimestamp(e){return new ke(e)}static min(){return new ke(new st(0,0))}static max(){return new ke(new st(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const bo=-1;class Yh{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function z0(n){return n.fields.find((e=>e.kind===2))}function Ks(n){return n.fields.filter((e=>e.kind!==2))}Yh.UNKNOWN_ID=-1;class Eh{constructor(e,t){this.fieldPath=e,this.kind=t}}class Al{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Al(0,tr.min())}}function tT(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ke.fromTimestamp(r===1e9?new st(t+1,0):new st(t,r));return new tr(i,ye.empty(),e)}function nT(n){return new tr(n.readTime,n.key,bo)}class tr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new tr(ke.min(),ye.empty(),bo)}static max(){return new tr(ke.max(),ye.empty(),bo)}}function cg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ye.comparator(n.documentKey,e.documentKey),t!==0?t:De(n.largestBatchId,e.largestBatchId))}const rT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function As(n){if(n.code!==ne.FAILED_PRECONDITION||n.message!==rT)throw n;ae("LocalStore","Unexpectedly lost primary lease")}class q{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Te(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new q(((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof q?t:q.resolve(t)}catch(t){return q.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):q.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):q.reject(t)}static resolve(e){return new q(((t,r)=>{t(e)}))}static reject(e){return new q(((t,r)=>{r(e)}))}static waitFor(e){return new q(((t,r)=>{let i=0,s=0,a=!1;e.forEach((o=>{++i,o.next((()=>{++s,a&&s===i&&t()}),(c=>r(c)))})),a=!0,s===i&&t()}))}static or(e){let t=q.resolve(!1);for(const r of e)t=t.next((i=>i?q.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,s)=>{r.push(t.call(this,i,s))})),this.waitFor(r)}static mapArray(e,t){return new q(((r,i)=>{const s=e.length,a=new Array(s);let o=0;for(let c=0;c<s;c++){const l=c;t(e[l]).next((u=>{a[l]=u,++o,o===s&&r(a)}),(u=>i(u)))}}))}static doWhile(e,t){return new q(((r,i)=>{const s=()=>{e()===!0?t().next((()=>{s()}),i):r()};s()}))}}const Yn="SimpleDb";class Gf{static open(e,t,r,i){try{return new Gf(t,e.transaction(i,r))}catch(s){throw new Xc(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Wr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Xc(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const i=lg(r.target.error);this.S.reject(new Xc(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ae(Yn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new tM(t)}}class us{static delete(e){return ae(Yn,"Removing database:",e),Xs(XE().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!iw())return!1;if(us.F())return!0;const e=Zt(),t=us.M(e),r=0<t&&t<10,i=sT(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,us.M(Zt())===12.2&&Mt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ae(Yn,"Opening database:",this.name),this.db=await new Promise(((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const a=s.target.result;t(a)},i.onblocked=()=>{r(new Xc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const a=s.target.error;a.name==="VersionError"?r(new de(ne.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new de(ne.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new Xc(e,a))},i.onupgradeneeded=s=>{ae(Yn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const a=s.target.result;this.N.k(a,i.transaction,s.oldVersion,this.version).next((()=>{ae(Yn,"Database upgrade to version "+this.version+" complete")}))}}))),this.K&&(this.db.onversionchange=t=>this.K(t)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const s=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(e);const o=Gf.open(this.db,e,s?"readonly":"readwrite",r),c=i(o).next((l=>(o.C(),l))).catch((l=>(o.abort(l),q.reject(l)))).toPromise();return c.catch((()=>{})),await o.D,c}catch(o){const c=o,l=c.name!=="FirebaseError"&&a<3;if(ae(Yn,"Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function sT(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class eM{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return Xs(this.U.delete())}}class Xc extends de{constructor(e,t){super(ne.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ss(n){return n.name==="IndexedDbTransactionError"}class tM{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ae(Yn,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(ae(Yn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Xs(r)}add(e){return ae(Yn,"ADD",this.store.name,e,e),Xs(this.store.add(e))}get(e){return Xs(this.store.get(e)).next((t=>(t===void 0&&(t=null),ae(Yn,"GET",this.store.name,e,t),t)))}delete(e){return ae(Yn,"DELETE",this.store.name,e),Xs(this.store.delete(e))}count(){return ae(Yn,"COUNT",this.store.name),Xs(this.store.count())}H(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const s=i.getAll(r.range);return new q(((a,o)=>{s.onerror=c=>{o(c.target.error)},s.onsuccess=c=>{a(c.target.result)}}))}{const s=this.cursor(r),a=[];return this.J(s,((o,c)=>{a.push(c)})).next((()=>a))}}Z(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new q(((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}}))}X(e,t){ae(Yn,"DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const i=this.cursor(r);return this.J(i,((s,a,o)=>o.delete()))}ee(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.J(i,t)}te(e){const t=this.cursor({});return new q(((r,i)=>{t.onerror=s=>{const a=lg(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next((o=>{o?a.continue():r()})):r()}}))}J(e,t){const r=[];return new q(((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const o=a.target.result;if(!o)return void i();const c=new eM(o),l=t(o.primaryKey,o.value,c);if(l instanceof q){const u=l.catch((h=>(c.done(),q.reject(h))));r.push(u)}c.isDone?i():c.G===null?o.continue():o.continue(c.G)}})).next((()=>q.waitFor(r)))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Xs(n){return new q(((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=lg(r.target.error);t(i)}}))}let xx=!1;function lg(n){const e=us.M(Zt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new de("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return xx||(xx=!0,setTimeout((()=>{throw r}),0)),r}}return n}const Qc="IndexBackfiller";class nM{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){ae(Qc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();ae(Qc,`Documents written: ${t}`)}catch(t){Ss(t)?ae(Qc,"Ignoring IndexedDB error during index backfill: ",t):await As(t)}await this.re(6e4)}))}}class rM{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const r=new Set;let i=t,s=!0;return q.doWhile((()=>s===!0&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((a=>{if(a!==null&&!r.has(a))return ae(Qc,`Processing collection: ${a}`),this.oe(e,a,i).next((o=>{i-=o,r.add(a)}));s=!1})))).next((()=>t-i))}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next((s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next((()=>this._e(i,s))).next((o=>(ae(Qc,`Updating offset: ${o}`),this.localStore.indexManager.updateCollectionGroup(e,t,o)))).next((()=>a.size))}))))}_e(e,t){let r=e;return t.changes.forEach(((i,s)=>{const a=nT(s);cg(a,r)>0&&(r=a)})),new tr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Wn.ce=-1;const sa=-1;function qf(n){return n==null}function Sl(n){return n===0&&1/n==-1/0}function aT(n){return typeof n=="number"&&Number.isInteger(n)&&!Sl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Xh="";function An(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yx(e)),e=iM(n.get(t),e);return yx(e)}function iM(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case Xh:t+="";break;default:t+=s}}return t}function yx(n){return n+Xh+""}function Vr(n){const e=n.length;if(Ae(e>=2,64408,{path:n}),e===2)return Ae(n.charAt(0)===Xh&&n.charAt(1)==="",56145,{path:n}),tt.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf(Xh,s);switch((a<0||a>t)&&Te(50515,{path:n}),n.charAt(a+1)){case"":const o=n.substring(s,a);let c;i.length===0?c=o:(i+=o,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,a),i+="\0";break;case"":i+=n.substring(s,a+1);break;default:Te(61167,{path:n})}s=a+2}return new tt(r)}const Ys="remoteDocuments",su="owner",Ga="owner",kl="mutationQueues",sM="userId",xr="mutations",vx="batchId",ta="userMutationsIndex",Ex=["userId","batchId"];function wh(n,e){return[n,An(e)]}function oT(n,e,t){return[n,An(e),t]}const aM={},Io="documentMutations",Qh="remoteDocumentsV14",oM=["prefixPath","collectionGroup","readTime","documentId"],Th="documentKeyIndex",cM=["prefixPath","collectionGroup","documentId"],cT="collectionGroupIndex",lM=["collectionGroup","readTime","prefixPath","documentId"],Cl="remoteDocumentGlobal",$0="remoteDocumentGlobalKey",Ao="targets",lT="queryTargetsIndex",uM=["canonicalId","targetId"],So="targetDocuments",hM=["targetId","path"],ug="documentTargetsIndex",fM=["path","targetId"],Jh="targetGlobalKey",aa="targetGlobal",Rl="collectionParents",dM=["collectionId","parent"],ko="clientMetadata",pM="clientId",Kf="bundles",gM="bundleId",Yf="namedQueries",mM="name",hg="indexConfiguration",_M="indexId",W0="collectionGroupIndex",xM="collectionGroup",Jc="indexState",yM=["indexId","uid"],uT="sequenceNumberIndex",vM=["uid","sequenceNumber"],Zc="indexEntries",EM=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],hT="documentKeyIndex",wM=["indexId","uid","orderedDocumentKey"],Xf="documentOverlays",TM=["userId","collectionPath","documentId"],j0="collectionPathOverlayIndex",bM=["userId","collectionPath","largestBatchId"],fT="collectionGroupOverlayIndex",IM=["userId","collectionGroup","largestBatchId"],fg="globals",AM="name",dT=[kl,xr,Io,Ys,Ao,su,aa,So,ko,Cl,Rl,Kf,Yf],SM=[...dT,Xf],pT=[kl,xr,Io,Qh,Ao,su,aa,So,ko,Cl,Rl,Kf,Yf,Xf],gT=pT,dg=[...gT,hg,Jc,Zc],kM=dg,mT=[...dg,fg],CM=mT;class G0 extends iT{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function en(n,e){const t=be(n);return us.O(t.le,e)}function wx(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ks(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _T(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class gt{constructor(e,t){this.comparator=e,this.root=t||ln.EMPTY}insert(e,t){return new gt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ln.BLACK,null,null))}remove(e){return new gt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ln.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ju(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ju(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ju(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ju(this.root,e,this.comparator,!0)}}class Ju{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ln{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??ln.RED,this.left=i??ln.EMPTY,this.right=s??ln.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new ln(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ln.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return ln.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ln.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ln.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Te(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Te(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Te(27949);return e+(this.isRed()?0:1)}}ln.EMPTY=null,ln.RED=!0,ln.BLACK=!1;ln.EMPTY=new class{constructor(){this.size=0}get key(){throw Te(57766)}get value(){throw Te(16141)}get color(){throw Te(16727)}get left(){throw Te(29726)}get right(){throw Te(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new ln(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ot{constructor(e){this.comparator=e,this.data=new gt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Tx(this.data.getIterator())}getIteratorFrom(e){return new Tx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ot)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ot(this.comparator);return t.data=e,t}}class Tx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function qa(n){return n.hasNext()?n.getNext():void 0}class jn{constructor(e){this.fields=e,e.sort(St.comparator)}static empty(){return new jn([])}unionWith(e){let t=new ot(St.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new jn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return To(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class xT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Vt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new xT("Invalid base64 string: "+s):s}})(e);return new Vt(t)}static fromUint8Array(e){const t=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(e);return new Vt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return De(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Vt.EMPTY_BYTE_STRING=new Vt("");const RM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vi(n){if(Ae(!!n,39018),typeof n=="string"){let e=0;const t=RM.exec(n);if(Ae(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Tt(n.seconds),nanos:Tt(n.nanos)}}function Tt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ei(n){return typeof n=="string"?Vt.fromBase64String(n):Vt.fromUint8Array(n)}const yT="server_timestamp",vT="__type__",ET="__previous_value__",wT="__local_write_time__";function pg(n){return(n?.mapValue?.fields||{})[vT]?.stringValue===yT}function Qf(n){const e=n.mapValue.fields[ET];return pg(e)?Qf(e):e}function Pl(n){const e=vi(n.mapValue.fields[wT].timestampValue);return new st(e.seconds,e.nanos)}class PM{constructor(e,t,r,i,s,a,o,c,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=c,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}const Zh="(default)";class ya{constructor(e,t){this.projectId=e,this.database=t||Zh}static empty(){return new ya("","")}get isDefaultDatabase(){return this.database===Zh}isEqual(e){return e instanceof ya&&e.projectId===this.projectId&&e.database===this.database}}function DM(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new de(ne.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ya(n.options.projectId,e)}const gg="__type__",TT="__max__",rs={mapValue:{fields:{__type__:{stringValue:TT}}}},mg="__vector__",Co="value",bh={nullValue:"NULL_VALUE"};function ms(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?pg(n)?4:bT(n)?9007199254740991:Jf(n)?10:11:Te(28295,{value:n})}function Gr(n,e){if(n===e)return!0;const t=ms(n);if(t!==ms(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Pl(n).isEqual(Pl(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=vi(i.timestampValue),o=vi(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return Ei(i.bytesValue).isEqual(Ei(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return Tt(i.geoPointValue.latitude)===Tt(s.geoPointValue.latitude)&&Tt(i.geoPointValue.longitude)===Tt(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return Tt(i.integerValue)===Tt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Tt(i.doubleValue),o=Tt(s.doubleValue);return a===o?Sl(a)===Sl(o):isNaN(a)&&isNaN(o)}return!1})(n,e);case 9:return To(n.arrayValue.values||[],e.arrayValue.values||[],Gr);case 10:case 11:return(function(i,s){const a=i.mapValue.fields||{},o=s.mapValue.fields||{};if(wx(a)!==wx(o))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(o[c]===void 0||!Gr(a[c],o[c])))return!1;return!0})(n,e);default:return Te(52216,{left:n})}}function Dl(n,e){return(n.values||[]).find((t=>Gr(t,e)))!==void 0}function _s(n,e){if(n===e)return 0;const t=ms(n),r=ms(e);if(t!==r)return De(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return De(n.booleanValue,e.booleanValue);case 2:return(function(s,a){const o=Tt(s.integerValue||s.doubleValue),c=Tt(a.integerValue||a.doubleValue);return o<c?-1:o>c?1:o===c?0:isNaN(o)?isNaN(c)?0:-1:1})(n,e);case 3:return bx(n.timestampValue,e.timestampValue);case 4:return bx(Pl(n),Pl(e));case 5:return H0(n.stringValue,e.stringValue);case 6:return(function(s,a){const o=Ei(s),c=Ei(a);return o.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(s,a){const o=s.split("/"),c=a.split("/");for(let l=0;l<o.length&&l<c.length;l++){const u=De(o[l],c[l]);if(u!==0)return u}return De(o.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,a){const o=De(Tt(s.latitude),Tt(a.latitude));return o!==0?o:De(Tt(s.longitude),Tt(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Ix(n.arrayValue,e.arrayValue);case 10:return(function(s,a){const o=s.fields||{},c=a.fields||{},l=o[Co]?.arrayValue,u=c[Co]?.arrayValue,h=De(l?.values?.length||0,u?.values?.length||0);return h!==0?h:Ix(l,u)})(n.mapValue,e.mapValue);case 11:return(function(s,a){if(s===rs.mapValue&&a===rs.mapValue)return 0;if(s===rs.mapValue)return 1;if(a===rs.mapValue)return-1;const o=s.fields||{},c=Object.keys(o),l=a.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let h=0;h<c.length&&h<u.length;++h){const d=H0(c[h],u[h]);if(d!==0)return d;const p=_s(o[c[h]],l[u[h]]);if(p!==0)return p}return De(c.length,u.length)})(n.mapValue,e.mapValue);default:throw Te(23264,{he:t})}}function bx(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return De(n,e);const t=vi(n),r=vi(e),i=De(t.seconds,r.seconds);return i!==0?i:De(t.nanos,r.nanos)}function Ix(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=_s(t[i],r[i]);if(s)return s}return De(t.length,r.length)}function Ro(n){return q0(n)}function q0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=vi(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ei(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return ye.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=q0(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${q0(t.fields[a])}`;return i+"}"})(n.mapValue):Te(61005,{value:n})}function Ih(n){switch(ms(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Qf(n);return e?16+Ih(e):16;case 5:return 2*n.stringValue.length;case 6:return Ei(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,s)=>i+Ih(s)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return ks(r.fields,((s,a)=>{i+=s.length+Ih(a)})),i})(n.mapValue);default:throw Te(13486,{value:n})}}function Fl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function K0(n){return!!n&&"integerValue"in n}function Ol(n){return!!n&&"arrayValue"in n}function Ax(n){return!!n&&"nullValue"in n}function Sx(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ah(n){return!!n&&"mapValue"in n}function Jf(n){return(n?.mapValue?.fields||{})[gg]?.stringValue===mg}function el(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return ks(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=el(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=el(n.arrayValue.values[t]);return e}return{...n}}function bT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===TT}const IT={mapValue:{fields:{[gg]:{stringValue:mg},[Co]:{arrayValue:{}}}}};function FM(n){return"nullValue"in n?bh:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Fl(ya.empty(),ye.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Jf(n)?IT:{mapValue:{}}:Te(35942,{value:n})}function OM(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Fl(ya.empty(),ye.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?IT:"mapValue"in n?Jf(n)?{mapValue:{}}:rs:Te(61959,{value:n})}function kx(n,e){const t=_s(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Cx(n,e){const t=_s(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class En{constructor(e){this.value=e}static empty(){return new En({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ah(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=el(t)}setAll(e){let t=St.emptyPath(),r={},i=[];e.forEach(((a,o)=>{if(!t.isImmediateParentOf(o)){const c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=o.popLast()}a?r[o.lastSegment()]=el(a):i.push(o.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ah(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Gr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ah(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ks(t,((i,s)=>e[i]=s));for(const i of r)delete e[i]}clone(){return new En(el(this.value))}}function AT(n){const e=[];return ks(n.fields,((t,r)=>{const i=new St([t]);if(Ah(r)){const s=AT(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)})),new jn(e)}class Pt{constructor(e,t,r,i,s,a,o){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new Pt(e,0,ke.min(),ke.min(),ke.min(),En.empty(),0)}static newFoundDocument(e,t,r,i){return new Pt(e,1,t,ke.min(),r,i,0)}static newNoDocument(e,t){return new Pt(e,2,t,ke.min(),ke.min(),En.empty(),0)}static newUnknownDocument(e,t){return new Pt(e,3,t,ke.min(),ke.min(),En.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=En.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=En.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Pt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Po{constructor(e,t){this.position=e,this.inclusive=t}}function Rx(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(s.field.isKeyField()?r=ye.comparator(ye.fromName(a.referenceValue),t.key):r=_s(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Px(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Gr(n.position[t],e.position[t]))return!1;return!0}class Ml{constructor(e,t="asc"){this.field=e,this.dir=t}}function MM(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ST{}class je extends ST{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new LM(e,t,r):t==="array-contains"?new BM(e,r):t==="in"?new FT(e,r):t==="not-in"?new UM(e,r):t==="array-contains-any"?new HM(e,r):new je(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new NM(e,r):new VM(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(_s(t,this.value)):t!==null&&ms(this.value)===ms(t)&&this.matchesComparison(_s(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Te(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class at extends ST{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new at(e,t)}matches(e){return Do(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Do(n){return n.op==="and"}function Y0(n){return n.op==="or"}function _g(n){return kT(n)&&Do(n)}function kT(n){for(const e of n.filters)if(e instanceof at)return!1;return!0}function X0(n){if(n instanceof je)return n.field.canonicalString()+n.op.toString()+Ro(n.value);if(_g(n))return n.filters.map((e=>X0(e))).join(",");{const e=n.filters.map((t=>X0(t))).join(",");return`${n.op}(${e})`}}function CT(n,e){return n instanceof je?(function(r,i){return i instanceof je&&r.op===i.op&&r.field.isEqual(i.field)&&Gr(r.value,i.value)})(n,e):n instanceof at?(function(r,i){return i instanceof at&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,a,o)=>s&&CT(a,i.filters[o])),!0):!1})(n,e):void Te(19439)}function RT(n,e){const t=n.filters.concat(e);return at.create(t,n.op)}function PT(n){return n instanceof je?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ro(t.value)}`})(n):n instanceof at?(function(t){return t.op.toString()+" {"+t.getFilters().map(PT).join(" ,")+"}"})(n):"Filter"}class LM extends je{constructor(e,t,r){super(e,t,r),this.key=ye.fromName(r.referenceValue)}matches(e){const t=ye.comparator(e.key,this.key);return this.matchesComparison(t)}}class NM extends je{constructor(e,t){super(e,"in",t),this.keys=DT("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class VM extends je{constructor(e,t){super(e,"not-in",t),this.keys=DT("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function DT(n,e){return(e.arrayValue?.values||[]).map((t=>ye.fromName(t.referenceValue)))}class BM extends je{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ol(t)&&Dl(t.arrayValue,this.value)}}class FT extends je{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Dl(this.value.arrayValue,t)}}class UM extends je{constructor(e,t){super(e,"not-in",t)}matches(e){if(Dl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Dl(this.value.arrayValue,t)}}class HM extends je{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ol(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Dl(this.value.arrayValue,r)))}}class zM{constructor(e,t=null,r=[],i=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=o,this.Te=null}}function Q0(n,e=null,t=[],r=[],i=null,s=null,a=null){return new zM(n,e,t,r,i,s,a)}function va(n){const e=be(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>X0(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),qf(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Ro(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Ro(r))).join(",")),e.Te=t}return e.Te}function au(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!MM(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!CT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Px(n.startAt,e.startAt)&&Px(n.endAt,e.endAt)}function ef(n){return ye.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function tf(n,e){return n.filters.filter((t=>t instanceof je&&t.field.isEqual(e)))}function Dx(n,e,t){let r=bh,i=!0;for(const s of tf(n,e)){let a=bh,o=!0;switch(s.op){case"<":case"<=":a=FM(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,o=!1;break;case"!=":case"not-in":a=bh}kx({value:r,inclusive:i},{value:a,inclusive:o})<0&&(r=a,i=o)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];kx({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function Fx(n,e,t){let r=rs,i=!0;for(const s of tf(n,e)){let a=rs,o=!0;switch(s.op){case">=":case">":a=OM(s.value),o=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,o=!1;break;case"!=":case"not-in":a=rs}Cx({value:r,inclusive:i},{value:a,inclusive:o})>0&&(r=a,i=o)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];Cx({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}class Ko{constructor(e,t=null,r=[],i=[],s=null,a="F",o=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=c,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function OT(n,e,t,r,i,s,a,o){return new Ko(n,e,t,r,i,s,a,o)}function ou(n){return new Ko(n)}function Ox(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function $M(n){return ye.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function MT(n){return n.collectionGroup!==null}function tl(n){const e=be(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new ot(St.comparator);return a.filters.forEach((c=>{c.getFlattenedFilters().forEach((l=>{l.isInequality()&&(o=o.add(l.field))}))})),o})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Ml(s,r))})),t.has(St.keyField().canonicalString())||e.Ie.push(new Ml(St.keyField(),r))}return e.Ie}function er(n){const e=be(n);return e.Ee||(e.Ee=WM(e,tl(n))),e.Ee}function WM(n,e){if(n.limitType==="F")return Q0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new Ml(i.field,s)}));const t=n.endAt?new Po(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Po(n.startAt.position,n.startAt.inclusive):null;return Q0(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function J0(n,e){const t=n.filters.concat([e]);return new Ko(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function jM(n,e){const t=n.explicitOrderBy.concat([e]);return new Ko(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function nf(n,e,t){return new Ko(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Zf(n,e){return au(er(n),er(e))&&n.limitType===e.limitType}function LT(n){return`${va(er(n))}|lt:${n.limitType}`}function to(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>PT(i))).join(", ")}]`),qf(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>Ro(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>Ro(i))).join(",")),`Target(${r})`})(er(n))}; limitType=${n.limitType})`}function cu(n,e){return e.isFoundDocument()&&(function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):ye.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(const s of tl(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,o,c){const l=Rx(a,o,c);return a.inclusive?l<=0:l<0})(r.startAt,tl(r),i)||r.endAt&&!(function(a,o,c){const l=Rx(a,o,c);return a.inclusive?l>=0:l>0})(r.endAt,tl(r),i))})(n,e)}function NT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function VT(n){return(e,t)=>{let r=!1;for(const i of tl(n)){const s=GM(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function GM(n,e,t){const r=n.field.isKeyField()?ye.comparator(e.key,t.key):(function(s,a,o){const c=a.data.field(s),l=o.data.field(s);return c!==null&&l!==null?_s(c,l):Te(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Te(19790,{direction:n.dir})}}class Si{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ks(this.inner,((t,r)=>{for(const[i,s]of r)e(i,s)}))}isEmpty(){return _T(this.inner)}size(){return this.innerSize}}const qM=new gt(ye.comparator);function Zn(){return qM}const BT=new gt(ye.comparator);function Mc(...n){let e=BT;for(const t of n)e=e.insert(t.key,t);return e}function UT(n){let e=BT;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Br(){return nl()}function HT(){return nl()}function nl(){return new Si((n=>n.toString()),((n,e)=>n.isEqual(e)))}const KM=new gt(ye.comparator),YM=new ot(ye.comparator);function He(...n){let e=YM;for(const t of n)e=e.add(t);return e}const XM=new ot(De);function xg(){return XM}function yg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Sl(e)?"-0":e}}function zT(n){return{integerValue:""+n}}function QM(n,e){return aT(e)?zT(e):yg(n,e)}class ed{constructor(){this._=void 0}}function JM(n,e,t){return n instanceof Fo?(function(i,s){const a={fields:{[vT]:{stringValue:yT},[wT]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&pg(s)&&(s=Qf(s)),s&&(a.fields[ET]=s),{mapValue:a}})(t,e):n instanceof Oo?WT(n,e):n instanceof Mo?jT(n,e):(function(i,s){const a=$T(i,s),o=Mx(a)+Mx(i.Ae);return K0(a)&&K0(i.Ae)?zT(o):yg(i.serializer,o)})(n,e)}function ZM(n,e,t){return n instanceof Oo?WT(n,e):n instanceof Mo?jT(n,e):t}function $T(n,e){return n instanceof Ll?(function(r){return K0(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}class Fo extends ed{}class Oo extends ed{constructor(e){super(),this.elements=e}}function WT(n,e){const t=GT(e);for(const r of n.elements)t.some((i=>Gr(i,r)))||t.push(r);return{arrayValue:{values:t}}}class Mo extends ed{constructor(e){super(),this.elements=e}}function jT(n,e){let t=GT(e);for(const r of n.elements)t=t.filter((i=>!Gr(i,r)));return{arrayValue:{values:t}}}class Ll extends ed{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Mx(n){return Tt(n.integerValue||n.doubleValue)}function GT(n){return Ol(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class qT{constructor(e,t){this.field=e,this.transform=t}}function eL(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Oo&&i instanceof Oo||r instanceof Mo&&i instanceof Mo?To(r.elements,i.elements,Gr):r instanceof Ll&&i instanceof Ll?Gr(r.Ae,i.Ae):r instanceof Fo&&i instanceof Fo})(n.transform,e.transform)}class tL{constructor(e,t){this.version=e,this.transformResults=t}}class Yt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Yt}static exists(e){return new Yt(void 0,e)}static updateTime(e){return new Yt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Sh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class td{}function KT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new lu(n.key,Yt.none()):new Yo(n.key,n.data,Yt.none());{const t=n.data,r=En.empty();let i=new ot(St.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new ki(n.key,r,new jn(i.toArray()),Yt.none())}}function nL(n,e,t){n instanceof Yo?(function(i,s,a){const o=i.value.clone(),c=Nx(i.fieldTransforms,s,a.transformResults);o.setAll(c),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()})(n,e,t):n instanceof ki?(function(i,s,a){if(!Sh(i.precondition,s))return void s.convertToUnknownDocument(a.version);const o=Nx(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(YT(i)),c.setAll(o),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function rl(n,e,t,r){return n instanceof Yo?(function(s,a,o,c){if(!Sh(s.precondition,a))return o;const l=s.value.clone(),u=Vx(s.fieldTransforms,c,a);return l.setAll(u),a.convertToFoundDocument(a.version,l).setHasLocalMutations(),null})(n,e,t,r):n instanceof ki?(function(s,a,o,c){if(!Sh(s.precondition,a))return o;const l=Vx(s.fieldTransforms,c,a),u=a.data;return u.setAll(YT(s)),u.setAll(l),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((h=>h.field)))})(n,e,t,r):(function(s,a,o){return Sh(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o})(n,e,t)}function rL(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=$T(r.transform,i||null);s!=null&&(t===null&&(t=En.empty()),t.set(r.field,s))}return t||null}function Lx(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&To(r,i,((s,a)=>eL(s,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Yo extends td{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ki extends td{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function YT(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Nx(n,e,t){const r=new Map;Ae(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,o=e.data.field(s.field);r.set(s.field,ZM(a,o,t[i]))}return r}function Vx(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,JM(s,a,e))}return r}class lu extends td{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class XT extends td{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class vg{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&nL(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=rl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=rl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=HT();return this.mutations.forEach((i=>{const s=e.get(i.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=t.has(i.key)?null:o;const c=KT(a,o);c!==null&&r.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(ke.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),He())}isEqual(e){return this.batchId===e.batchId&&To(this.mutations,e.mutations,((t,r)=>Lx(t,r)))&&To(this.baseMutations,e.baseMutations,((t,r)=>Lx(t,r)))}}class Eg{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Ae(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return KM})();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new Eg(e,t,r,i)}}class wg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class iL{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ut,Xe;function sL(n){switch(n){case ne.OK:return Te(64938);case ne.CANCELLED:case ne.UNKNOWN:case ne.DEADLINE_EXCEEDED:case ne.RESOURCE_EXHAUSTED:case ne.INTERNAL:case ne.UNAVAILABLE:case ne.UNAUTHENTICATED:return!1;case ne.INVALID_ARGUMENT:case ne.NOT_FOUND:case ne.ALREADY_EXISTS:case ne.PERMISSION_DENIED:case ne.FAILED_PRECONDITION:case ne.ABORTED:case ne.OUT_OF_RANGE:case ne.UNIMPLEMENTED:case ne.DATA_LOSS:return!0;default:return Te(15467,{code:n})}}function QT(n){if(n===void 0)return Mt("GRPC error has no .code"),ne.UNKNOWN;switch(n){case Ut.OK:return ne.OK;case Ut.CANCELLED:return ne.CANCELLED;case Ut.UNKNOWN:return ne.UNKNOWN;case Ut.DEADLINE_EXCEEDED:return ne.DEADLINE_EXCEEDED;case Ut.RESOURCE_EXHAUSTED:return ne.RESOURCE_EXHAUSTED;case Ut.INTERNAL:return ne.INTERNAL;case Ut.UNAVAILABLE:return ne.UNAVAILABLE;case Ut.UNAUTHENTICATED:return ne.UNAUTHENTICATED;case Ut.INVALID_ARGUMENT:return ne.INVALID_ARGUMENT;case Ut.NOT_FOUND:return ne.NOT_FOUND;case Ut.ALREADY_EXISTS:return ne.ALREADY_EXISTS;case Ut.PERMISSION_DENIED:return ne.PERMISSION_DENIED;case Ut.FAILED_PRECONDITION:return ne.FAILED_PRECONDITION;case Ut.ABORTED:return ne.ABORTED;case Ut.OUT_OF_RANGE:return ne.OUT_OF_RANGE;case Ut.UNIMPLEMENTED:return ne.UNIMPLEMENTED;case Ut.DATA_LOSS:return ne.DATA_LOSS;default:return Te(39323,{code:n})}}(Xe=Ut||(Ut={}))[Xe.OK=0]="OK",Xe[Xe.CANCELLED=1]="CANCELLED",Xe[Xe.UNKNOWN=2]="UNKNOWN",Xe[Xe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xe[Xe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xe[Xe.NOT_FOUND=5]="NOT_FOUND",Xe[Xe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xe[Xe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xe[Xe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xe[Xe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xe[Xe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xe[Xe.ABORTED=10]="ABORTED",Xe[Xe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xe[Xe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xe[Xe.INTERNAL=13]="INTERNAL",Xe[Xe.UNAVAILABLE=14]="UNAVAILABLE",Xe[Xe.DATA_LOSS=15]="DATA_LOSS";function aL(){return new TextEncoder}const oL=new ls([4294967295,4294967295],0);function Bx(n){const e=aL().encode(n),t=new jw;return t.update(e),new Uint8Array(t.digest())}function Ux(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ls([t,r],0),new ls([i,s],0)]}class Tg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Lc(`Invalid padding: ${t}`);if(r<0)throw new Lc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Lc(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Lc(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ls.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(ls.fromNumber(r)));return i.compare(oL)===1&&(i=new ls([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Bx(e),[r,i]=Ux(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);if(!this.we(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Tg(s,i,t);return r.forEach((o=>a.insert(o))),a}insert(e){if(this.ge===0)return;const t=Bx(e),[r,i]=Ux(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Lc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class uu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,hu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new uu(ke.min(),i,new gt(De),Zn(),He())}}class hu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new hu(r,t,He(),He(),He())}}class kh{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=i}}class JT{constructor(e,t){this.targetId=e,this.Ce=t}}class ZT{constructor(e,t,r=Vt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Hx{constructor(){this.ve=0,this.Fe=zx(),this.Me=Vt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=He(),t=He(),r=He();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Te(38017,{changeType:s})}})),new hu(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=zx()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Ae(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class cL{constructor(e){this.Ge=e,this.ze=new Map,this.je=Zn(),this.He=Zu(),this.Je=Zu(),this.Ze=new gt(De)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:Te(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(ef(s))if(r===0){const a=new ye(s.path);this.et(t,a,Pt.newNoDocument(a,ke.min()))}else Ae(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const o=this.ut(e),c=o?this.ct(o,e,a):1;if(c!==0){this.it(t);const l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,l)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,o;try{a=Ei(r).toUint8Array()}catch(c){if(c instanceof xT)return wo("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{o=new Tg(a,i,s)}catch(c){return wo(c instanceof Lc?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return o.ge===0?null:o}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((s=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.et(t,s,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((s,a)=>{const o=this.ot(a);if(o){if(s.current&&ef(o.target)){const c=new ye(o.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Pt.newNoDocument(c,e))}s.Be&&(t.set(a,s.ke()),s.Ke())}}));let r=He();this.Je.forEach(((s,a)=>{let o=!0;a.forEachWhile((c=>{const l=this.ot(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)})),o&&(r=r.add(s))})),this.je.forEach(((s,a)=>a.setReadTime(e)));const i=new uu(e,t,this.Ze,this.je,r);return this.je=Zn(),this.He=Zu(),this.Je=Zu(),this.Ze=new gt(De),i}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Hx,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new ot(De),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new ot(De),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ae("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Hx),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Zu(){return new gt(ye.comparator)}function zx(){return new gt(ye.comparator)}const lL={asc:"ASCENDING",desc:"DESCENDING"},uL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hL={and:"AND",or:"OR"};class fL{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Z0(n,e){return n.useProto3Json||qf(e)?e:{value:e}}function Lo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function eb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function dL(n,e){return Lo(n,e.toTimestamp())}function Nn(n){return Ae(!!n,49232),ke.fromTimestamp((function(t){const r=vi(t);return new st(r.seconds,r.nanos)})(n))}function bg(n,e){return ep(n,e).canonicalString()}function ep(n,e){const t=(function(i){return new tt(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function tb(n){const e=tt.fromString(n);return Ae(ub(e),10190,{key:e.toString()}),e}function rf(n,e){return bg(n.databaseId,e.path)}function oa(n,e){const t=tb(e);if(t.get(1)!==n.databaseId.projectId)throw new de(ne.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new de(ne.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ye(ib(t))}function nb(n,e){return bg(n.databaseId,e)}function rb(n){const e=tb(n);return e.length===4?tt.emptyPath():ib(e)}function tp(n){return new tt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ib(n){return Ae(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function $x(n,e,t){return{name:rf(n,e),fields:t.value.mapValue.fields}}function pL(n,e,t){const r=oa(n,e.name),i=Nn(e.updateTime),s=e.createTime?Nn(e.createTime):ke.min(),a=new En({mapValue:{fields:e.fields}}),o=Pt.newFoundDocument(r,i,s,a);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function gL(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:Te(39313,{state:l})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(l,u){return l.useProto3Json?(Ae(u===void 0||typeof u=="string",58123),Vt.fromBase64String(u||"")):(Ae(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),Vt.fromUint8Array(u||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&(function(l){const u=l.code===void 0?ne.UNKNOWN:QT(l.code);return new de(u,l.message||"")})(a);t=new ZT(r,i,s,o||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=oa(n,r.document.name),s=Nn(r.document.updateTime),a=r.document.createTime?Nn(r.document.createTime):ke.min(),o=new En({mapValue:{fields:r.document.fields}}),c=Pt.newFoundDocument(i,s,a,o),l=r.targetIds||[],u=r.removedTargetIds||[];t=new kh(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=oa(n,r.document),s=r.readTime?Nn(r.readTime):ke.min(),a=Pt.newNoDocument(i,s),o=r.removedTargetIds||[];t=new kh([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=oa(n,r.document),s=r.removedTargetIds||[];t=new kh([],s,i,null)}else{if(!("filter"in e))return Te(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new iL(i,s),o=r.targetId;t=new JT(o,a)}}return t}function sf(n,e){let t;if(e instanceof Yo)t={update:$x(n,e.key,e.value)};else if(e instanceof lu)t={delete:rf(n,e.key)};else if(e instanceof ki)t={update:$x(n,e.key,e.data),updateMask:EL(e.fieldMask)};else{if(!(e instanceof XT))return Te(16599,{dt:e.type});t={verify:rf(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(s,a){const o=a.transform;if(o instanceof Fo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Oo)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Mo)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Ll)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw Te(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:dL(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Te(27497)})(n,e.precondition)),t}function np(n,e){const t=e.currentDocument?(function(s){return s.updateTime!==void 0?Yt.updateTime(Nn(s.updateTime)):s.exists!==void 0?Yt.exists(s.exists):Yt.none()})(e.currentDocument):Yt.none(),r=e.updateTransforms?e.updateTransforms.map((i=>(function(a,o){let c=null;if("setToServerValue"in o)Ae(o.setToServerValue==="REQUEST_TIME",16630,{proto:o}),c=new Fo;else if("appendMissingElements"in o){const u=o.appendMissingElements.values||[];c=new Oo(u)}else if("removeAllFromArray"in o){const u=o.removeAllFromArray.values||[];c=new Mo(u)}else"increment"in o?c=new Ll(a,o.increment):Te(16584,{proto:o});const l=St.fromServerFormat(o.fieldPath);return new qT(l,c)})(n,i))):[];if(e.update){e.update.name;const i=oa(n,e.update.name),s=new En({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=(function(c){const l=c.fieldPaths||[];return new jn(l.map((u=>St.fromServerFormat(u))))})(e.updateMask);return new ki(i,s,a,t,r)}return new Yo(i,s,t,r)}if(e.delete){const i=oa(n,e.delete);return new lu(i,t)}if(e.verify){const i=oa(n,e.verify);return new XT(i,t)}return Te(1463,{proto:e})}function mL(n,e){return n&&n.length>0?(Ae(e!==void 0,14353),n.map((t=>(function(i,s){let a=i.updateTime?Nn(i.updateTime):Nn(s);return a.isEqual(ke.min())&&(a=Nn(s)),new tL(a,i.transformResults||[])})(t,e)))):[]}function sb(n,e){return{documents:[nb(n,e.path)]}}function ab(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=nb(n,i);const s=(function(l){if(l.length!==0)return lb(at.create(l,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const a=(function(l){if(l.length!==0)return l.map((u=>(function(d){return{field:no(d.field),direction:xL(d.dir)}})(u)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=Z0(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=(function(l){return{before:l.inclusive,values:l.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(l){return{before:!l.inclusive,values:l.position}})(e.endAt)),{ft:t,parent:i}}function ob(n){let e=rb(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Ae(r===1,65062);const u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=(function(h){const d=cb(h);return d instanceof at&&_g(d)?d.getFilters():[d]})(t.where));let a=[];t.orderBy&&(a=(function(h){return h.map((d=>(function(g){return new Ml(ro(g.field),(function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(g.direction))})(d)))})(t.orderBy));let o=null;t.limit&&(o=(function(h){let d;return d=typeof h=="object"?h.value:h,qf(d)?null:d})(t.limit));let c=null;t.startAt&&(c=(function(h){const d=!!h.before,p=h.values||[];return new Po(p,d)})(t.startAt));let l=null;return t.endAt&&(l=(function(h){const d=!h.before,p=h.values||[];return new Po(p,d)})(t.endAt)),OT(e,i,a,s,o,"F",c,l)}function _L(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Te(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cb(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ro(t.unaryFilter.field);return je.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=ro(t.unaryFilter.field);return je.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ro(t.unaryFilter.field);return je.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=ro(t.unaryFilter.field);return je.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Te(61313);default:return Te(60726)}})(n):n.fieldFilter!==void 0?(function(t){return je.create(ro(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Te(58110);default:return Te(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return at.create(t.compositeFilter.filters.map((r=>cb(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Te(1026)}})(t.compositeFilter.op))})(n):Te(30097,{filter:n})}function xL(n){return lL[n]}function yL(n){return uL[n]}function vL(n){return hL[n]}function no(n){return{fieldPath:n.canonicalString()}}function ro(n){return St.fromServerFormat(n.fieldPath)}function lb(n){return n instanceof je?(function(t){if(t.op==="=="){if(Sx(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NAN"}};if(Ax(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Sx(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NOT_NAN"}};if(Ax(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:no(t.field),op:yL(t.op),value:t.value}}})(n):n instanceof at?(function(t){const r=t.getFilters().map((i=>lb(i)));return r.length===1?r[0]:{compositeFilter:{op:vL(t.op),filters:r}}})(n):Te(54877,{filter:n})}function EL(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ub(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function hb(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class di{constructor(e,t,r,i,s=ke.min(),a=ke.min(),o=Vt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=c}withSequenceNumber(e){return new di(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new di(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new di(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new di(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fb{constructor(e){this.yt=e}}function wL(n,e){let t;if(e.document)t=pL(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ye.fromSegments(e.noDocument.path),i=wa(e.noDocument.readTime);t=Pt.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Te(56709);{const r=ye.fromSegments(e.unknownDocument.path),i=wa(e.unknownDocument.version);t=Pt.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime((function(i){const s=new st(i[0],i[1]);return ke.fromTimestamp(s)})(e.readTime)),t}function Wx(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:af(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(s,a){return{name:rf(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Lo(s,a.version.toTimestamp()),createTime:Lo(s,a.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ea(e.version)};else{if(!e.isUnknownDocument())return Te(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Ea(e.version)}}return r}function af(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ea(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function wa(n){const e=new st(n.seconds,n.nanoseconds);return ke.fromTimestamp(e)}function Qs(n,e){const t=(e.baseMutations||[]).map((s=>np(n.yt,s)));for(let s=0;s<e.mutations.length-1;++s){const a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const o=e.mutations[s+1];a.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map((s=>np(n.yt,s))),i=st.fromMillis(e.localWriteTimeMs);return new vg(e.batchId,i,t,r)}function Nc(n){const e=wa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?wa(n.lastLimboFreeSnapshotVersion):ke.min();let r;return r=(function(s){return s.documents!==void 0})(n.query)?(function(s){const a=s.documents.length;return Ae(a===1,1966,{count:a}),er(ou(rb(s.documents[0])))})(n.query):(function(s){return er(ob(s))})(n.query),new di(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Vt.fromBase64String(n.resumeToken))}function db(n,e){const t=Ea(e.snapshotVersion),r=Ea(e.lastLimboFreeSnapshotVersion);let i;i=ef(e.target)?sb(n.yt,e.target):ab(n.yt,e.target).ft;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:va(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function pb(n){const e=ob({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?nf(e,e.limit,"L"):e}function Xd(n,e){return new wg(e.largestBatchId,np(n.yt,e.overlayMutation))}function jx(n,e){const t=e.path.lastSegment();return[n,An(e.path.popLast()),t]}function Gx(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ea(r.readTime),documentKey:An(r.documentKey.path),largestBatchId:r.largestBatchId}}class TL{getBundleMetadata(e,t){return qx(e).get(t).next((r=>{if(r)return(function(s){return{id:s.bundleId,createTime:wa(s.createTime),version:s.version}})(r)}))}saveBundleMetadata(e,t){return qx(e).put((function(i){return{bundleId:i.id,createTime:Ea(Nn(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return Kx(e).get(t).next((r=>{if(r)return(function(s){return{name:s.name,query:pb(s.bundledQuery),readTime:wa(s.readTime)}})(r)}))}saveNamedQuery(e,t){return Kx(e).put((function(i){return{name:i.name,readTime:Ea(Nn(i.readTime)),bundledQuery:i.bundledQuery}})(t))}}function qx(n){return en(n,Kf)}function Kx(n){return en(n,Yf)}class nd{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new nd(e,r)}getOverlay(e,t){return vc(e).get(jx(this.userId,t)).next((r=>r?Xd(this.serializer,r):null))}getOverlays(e,t){const r=Br();return q.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){const i=[];return r.forEach(((s,a)=>{const o=new wg(t,a);i.push(this.bt(e,o))})),q.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach((a=>i.add(An(a.getCollectionPath()))));const s=[];return i.forEach((a=>{const o=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(vc(e).X(j0,o))})),q.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Br(),s=An(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return vc(e).H(j0,a).next((o=>{for(const c of o){const l=Xd(this.serializer,c);i.set(l.getKey(),l)}return i}))}getOverlaysForCollectionGroup(e,t,r,i){const s=Br();let a;const o=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return vc(e).ee({index:fT,range:o},((c,l,u)=>{const h=Xd(this.serializer,l);s.size()<i||h.largestBatchId===a?(s.set(h.getKey(),h),a=h.largestBatchId):u.done()})).next((()=>s))}bt(e,t){return vc(e).put((function(i,s,a){const[o,c,l]=jx(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:l,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:sf(i.yt,a.mutation)}})(this.serializer,this.userId,t))}}function vc(n){return en(n,Xf)}class bL{St(e){return en(e,fg)}getSessionToken(e){return this.St(e).get("sessionToken").next((t=>{const r=t?.value;return r?Vt.fromUint8Array(r):Vt.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Js{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Tt(e.integerValue));else if("doubleValue"in e){const r=Tt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Sl(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=vi(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ei(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?bT(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Jf(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):Te(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){const r=e.fields||{};this.Ft(t,55);for(const i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){const r=e.fields||{};this.Ft(t,53);const i=Co,s=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Tt(s)),this.Ot(i,t),this.Ct(r[i],t)}qt(e,t){const r=e.values||[];this.Ft(t,50);for(const i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),ye.fromName(e).path.forEach((r=>{this.Ft(t,60),this.$t(r,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Js.Wt=new Js;const Ka=255;function IL(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Yx(n){const e=64-(function(r){let i=0;for(let s=0;s<8;++s){const a=IL(255&r[s]);if(i+=a,a!==8)break}return i})(n);return Math.ceil(e/8)}class AL{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ht(r);else if(r<2048)this.Ht(960|r>>>6),this.Ht(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|r>>>12),this.Ht(128|63&r>>>6),this.Ht(128|63&r);else{const i=t.codePointAt(0);this.Ht(240|i>>>18),this.Ht(128|63&i>>>12),this.Ht(128|63&i>>>6),this.Ht(128|63&i)}}this.Jt()}Yt(e){const t=this.en(e),r=Yx(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){const t=this.en(e),r=Yx(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(Ka),this.sn(255)}_n(){this.an(Ka),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Ka?(this.sn(Ka),this.sn(0)):this.sn(t)}Ht(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Ka?(this.an(Ka),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class SL{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class kL{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Ec{constructor(){this.cn=new AL,this.ascending=new SL(this.cn),this.descending=new kL(this.cn)}seed(e){this.cn.seed(e)}ln(e){return e===0?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class Zs{constructor(e,t,r,i){this.hn=e,this.Pn=t,this.Tn=r,this.In=i}En(){const e=this.In.length,t=e===0||this.In[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new Zs(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:Ch(this.Tn),directionalValue:Ch(this.In),orderedDocumentKey:Ch(t),documentKey:r.path.toArray()}}An(e,t,r){const i=this.Rn(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function zi(n,e){let t=n.hn-e.hn;return t!==0?t:(t=Xx(n.Tn,e.Tn),t!==0?t:(t=Xx(n.In,e.In),t!==0?t:ye.comparator(n.Pn,e.Pn)))}function Xx(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Ch(n){return rw()?(function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r})(n):n}function Qx(n){return typeof n!="string"?n:(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(n)}class Jx{constructor(e){this.Vn=new ot(((t,r)=>St.comparator(t.field,r.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.mn.push(r)}}get fn(){return this.Vn.size>1}gn(e){if(Ae(e.collectionGroup===this.collectionId,49279),this.fn)return!1;const t=z0(e);if(t!==void 0&&!this.pn(t))return!1;const r=Ks(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.pn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){const o=this.Vn.getIterator().getNext();if(!i.has(o.field.canonicalString())){const c=r[s];if(!this.yn(o,c)||!this.wn(this.dn[a++],c))return!1}++s}for(;s<r.length;++s){const o=r[s];if(a>=this.dn.length||!this.wn(this.dn[a++],o))return!1}return!0}bn(){if(this.fn)return null;let e=new ot(St.comparator);const t=[];for(const r of this.mn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Eh(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Eh(r.field,0))}for(const r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Eh(r.field,r.dir==="asc"?0:1)));return new Yh(Yh.UNKNOWN_ID,this.collectionId,t,Al.empty())}pn(e){for(const t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function gb(n){if(Ae(n instanceof je||n instanceof at,20012),n instanceof je){if(n instanceof FT){const t=n.value.arrayValue?.values?.map((r=>je.create(n.field,"==",r)))||[];return at.create(t,"or")}return n}const e=n.filters.map((t=>gb(t)));return at.create(e,n.op)}function CL(n){if(n.getFilters().length===0)return[];const e=sp(gb(n));return Ae(mb(e),7391),rp(e)||ip(e)?[e]:e.getFilters()}function rp(n){return n instanceof je}function ip(n){return n instanceof at&&_g(n)}function mb(n){return rp(n)||ip(n)||(function(t){if(t instanceof at&&Y0(t)){for(const r of t.getFilters())if(!rp(r)&&!ip(r))return!1;return!0}return!1})(n)}function sp(n){if(Ae(n instanceof je||n instanceof at,34018),n instanceof je)return n;if(n.filters.length===1)return sp(n.filters[0]);const e=n.filters.map((r=>sp(r)));let t=at.create(e,n.op);return t=of(t),mb(t)?t:(Ae(t instanceof at,64498),Ae(Do(t),40251),Ae(t.filters.length>1,57927),t.filters.reduce(((r,i)=>Ig(r,i))))}function Ig(n,e){let t;return Ae(n instanceof je||n instanceof at,38388),Ae(e instanceof je||e instanceof at,25473),t=n instanceof je?e instanceof je?(function(i,s){return at.create([i,s],"and")})(n,e):Zx(n,e):e instanceof je?Zx(e,n):(function(i,s){if(Ae(i.filters.length>0&&s.filters.length>0,48005),Do(i)&&Do(s))return RT(i,s.getFilters());const a=Y0(i)?i:s,o=Y0(i)?s:i,c=a.filters.map((l=>Ig(l,o)));return at.create(c,"or")})(n,e),of(t)}function Zx(n,e){if(Do(e))return RT(e,n.getFilters());{const t=e.filters.map((r=>Ig(n,r)));return at.create(t,"or")}}function of(n){if(Ae(n instanceof je||n instanceof at,11850),n instanceof je)return n;const e=n.getFilters();if(e.length===1)return of(e[0]);if(kT(n))return n;const t=e.map((i=>of(i))),r=[];return t.forEach((i=>{i instanceof je?r.push(i):i instanceof at&&(i.op===n.op?r.push(...i.filters):r.push(i))})),r.length===1?r[0]:at.create(r,n.op)}class RL{constructor(){this.Sn=new Ag}addToCollectionParentIndex(e,t){return this.Sn.add(t),q.resolve()}getCollectionParents(e,t){return q.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return q.resolve()}deleteFieldIndex(e,t){return q.resolve()}deleteAllFieldIndexes(e){return q.resolve()}createTargetIndexes(e,t){return q.resolve()}getDocumentsMatchingTarget(e,t){return q.resolve(null)}getIndexType(e,t){return q.resolve(0)}getFieldIndexes(e,t){return q.resolve([])}getNextCollectionGroupToUpdate(e){return q.resolve(null)}getMinOffset(e,t){return q.resolve(tr.min())}getMinOffsetFromCollectionGroup(e,t){return q.resolve(tr.min())}updateCollectionGroup(e,t,r){return q.resolve()}updateIndexEntries(e,t){return q.resolve()}}class Ag{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ot(tt.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ot(tt.comparator)).toArray()}}const ey="IndexedDbIndexManager",eh=new Uint8Array(0);class PL{constructor(e,t){this.databaseId=t,this.Dn=new Ag,this.Cn=new Si((r=>va(r)),((r,i)=>au(r,i))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((()=>{this.Dn.add(t)}));const s={collectionId:r,parent:An(i)};return ty(e).put(s)}return q.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Jw(t),""],!1,!0);return ty(e).H(i).next((s=>{for(const a of s){if(a.collectionId!==t)break;r.push(Vr(a.parent))}return r}))}addFieldIndex(e,t){const r=wc(e),i=(function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map((c=>[c.fieldPath.canonicalString(),c.kind]))}})(t);delete i.indexId;const s=r.add(i);if(t.indexState){const a=Xa(e);return s.next((o=>{a.put(Gx(o,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return s.next()}deleteFieldIndex(e,t){const r=wc(e),i=Xa(e),s=Ya(e);return r.delete(t.indexId).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=wc(e),r=Ya(e),i=Xa(e);return t.X().next((()=>r.X())).next((()=>i.X()))}createTargetIndexes(e,t){return q.forEach(this.vn(t),(r=>this.getIndexType(e,r).next((i=>{if(i===0||i===1){const s=new Jx(r).bn();if(s!=null)return this.addFieldIndex(e,s)}}))))}getDocumentsMatchingTarget(e,t){const r=Ya(e);let i=!0;const s=new Map;return q.forEach(this.vn(t),(a=>this.Fn(e,a).next((o=>{i&&(i=!!o),s.set(a,o)})))).next((()=>{if(i){let a=He();const o=[];return q.forEach(s,((c,l)=>{ae(ey,`Using index ${(function(v){return`id=${v.indexId}|cg=${v.collectionGroup}|f=${v.fields.map((R=>`${R.fieldPath}:${R.kind}`)).join(",")}`})(c)} to execute ${va(t)}`);const u=(function(v,R){const F=z0(R);if(F===void 0)return null;for(const O of tf(v,F.fieldPath))switch(O.op){case"array-contains-any":return O.value.arrayValue.values||[];case"array-contains":return[O.value]}return null})(l,c),h=(function(v,R){const F=new Map;for(const O of Ks(R))for(const y of tf(v,O.fieldPath))switch(y.op){case"==":case"in":F.set(O.fieldPath.canonicalString(),y.value);break;case"not-in":case"!=":return F.set(O.fieldPath.canonicalString(),y.value),Array.from(F.values())}return null})(l,c),d=(function(v,R){const F=[];let O=!0;for(const y of Ks(R)){const w=y.kind===0?Dx(v,y.fieldPath,v.startAt):Fx(v,y.fieldPath,v.startAt);F.push(w.value),O&&(O=w.inclusive)}return new Po(F,O)})(l,c),p=(function(v,R){const F=[];let O=!0;for(const y of Ks(R)){const w=y.kind===0?Fx(v,y.fieldPath,v.endAt):Dx(v,y.fieldPath,v.endAt);F.push(w.value),O&&(O=w.inclusive)}return new Po(F,O)})(l,c),g=this.Mn(c,l,d),m=this.Mn(c,l,p),_=this.xn(c,l,h),E=this.On(c.indexId,u,g,d.inclusive,m,p.inclusive,_);return q.forEach(E,(I=>r.Z(I,t.limit).next((v=>{v.forEach((R=>{const F=ye.fromSegments(R.documentKey);a.has(F)||(a=a.add(F),o.push(F))}))}))))})).next((()=>o))}return q.resolve(null)}))}vn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=CL(at.create(e.filters,"and")).map((r=>Q0(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt))),this.Cn.set(e,t),t)}On(e,t,r,i,s,a,o){const c=(t!=null?t.length:1)*Math.max(r.length,s.length),l=c/(t!=null?t.length:1),u=[];for(let h=0;h<c;++h){const d=t?this.Nn(t[h/l]):eh,p=this.Bn(e,d,r[h%l],i),g=this.Ln(e,d,s[h%l],a),m=o.map((_=>this.Bn(e,d,_,!0)));u.push(...this.createRange(p,g,m))}return u}Bn(e,t,r,i){const s=new Zs(e,ye.empty(),t,r);return i?s:s.En()}Ln(e,t,r,i){const s=new Zs(e,ye.empty(),t,r);return i?s.En():s}Fn(e,t){const r=new Jx(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next((s=>{let a=null;for(const o of s)r.gn(o)&&(!a||o.fields.length>a.fields.length)&&(a=o);return a}))}getIndexType(e,t){let r=2;const i=this.vn(t);return q.forEach(i,(s=>this.Fn(e,s).next((a=>{a?r!==0&&a.fields.length<(function(c){let l=new ot(St.comparator),u=!1;for(const h of c.filters)for(const d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?u=!0:l=l.add(d.field));for(const h of c.orderBy)h.field.isKeyField()||(l=l.add(h.field));return l.size+(u?1:0)})(s)&&(r=1):r=0})))).next((()=>(function(a){return a.limit!==null})(t)&&i.length>1&&r===2?1:r))}kn(e,t){const r=new Ec;for(const i of Ks(e)){const s=t.data.field(i.fieldPath);if(s==null)return null;const a=r.ln(i.kind);Js.Wt.Dt(s,a)}return r.un()}Nn(e){const t=new Ec;return Js.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){const r=new Ec;return Js.Wt.Dt(Fl(this.databaseId,t),r.ln((function(s){const a=Ks(s);return a.length===0?0:a[a.length-1].kind})(e))),r.un()}xn(e,t,r){if(r===null)return[];let i=[];i.push(new Ec);let s=0;for(const a of Ks(e)){const o=r[s++];for(const c of i)if(this.qn(t,a.fieldPath)&&Ol(o))i=this.Un(i,a,o);else{const l=c.ln(a.kind);Js.Wt.Dt(o,l)}}return this.$n(i)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const o of i){const c=new Ec;c.seed(o.un()),Js.Wt.Dt(a,c.ln(t.kind)),s.push(c)}return s}qn(e,t){return!!e.filters.find((r=>r instanceof je&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in")))}getFieldIndexes(e,t){const r=wc(e),i=Xa(e);return(t?r.H(W0,IDBKeyRange.bound(t,t)):r.H()).next((s=>{const a=[];return q.forEach(s,(o=>i.get([o.indexId,this.uid]).next((c=>{a.push((function(u,h){const d=h?new Al(h.sequenceNumber,new tr(wa(h.readTime),new ye(Vr(h.documentKey)),h.largestBatchId)):Al.empty(),p=u.fields.map((([g,m])=>new Eh(St.fromServerFormat(g),m)));return new Yh(u.indexId,u.collectionGroup,p,d)})(o,c))})))).next((()=>a))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:De(r.collectionGroup,i.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,r){const i=wc(e),s=Xa(e);return this.Wn(e).next((a=>i.H(W0,IDBKeyRange.bound(t,t)).next((o=>q.forEach(o,(c=>s.put(Gx(c.indexId,this.uid,a,r))))))))}updateIndexEntries(e,t){const r=new Map;return q.forEach(t,((i,s)=>{const a=r.get(i.collectionGroup);return(a?q.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next((o=>(r.set(i.collectionGroup,o),q.forEach(o,(c=>this.Qn(e,i,c).next((l=>{const u=this.Gn(s,c);return l.isEqual(u)?q.resolve():this.zn(e,s,c,l,u)})))))))}))}jn(e,t,r,i){return Ya(e).put(i.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,i){return Ya(e).delete(i.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){const i=Ya(e);let s=new ot(zi);return i.ee({index:hT,range:IDBKeyRange.only([r.indexId,this.uid,Ch(this.Kn(r,t))])},((a,o)=>{s=s.add(new Zs(r.indexId,t,Qx(o.arrayValue),Qx(o.directionalValue)))})).next((()=>s))}Gn(e,t){let r=new ot(zi);const i=this.kn(t,e);if(i==null)return r;const s=z0(t);if(s!=null){const a=e.data.field(s.fieldPath);if(Ol(a))for(const o of a.arrayValue.values||[])r=r.add(new Zs(t.indexId,e.key,this.Nn(o),i))}else r=r.add(new Zs(t.indexId,e.key,eh,i));return r}zn(e,t,r,i,s){ae(ey,"Updating index entries for document '%s'",t.key);const a=[];return(function(c,l,u,h,d){const p=c.getIterator(),g=l.getIterator();let m=qa(p),_=qa(g);for(;m||_;){let E=!1,I=!1;if(m&&_){const v=u(m,_);v<0?I=!0:v>0&&(E=!0)}else m!=null?I=!0:E=!0;E?(h(_),_=qa(g)):I?(d(m),m=qa(p)):(m=qa(p),_=qa(g))}})(i,s,zi,(o=>{a.push(this.jn(e,t,r,o))}),(o=>{a.push(this.Hn(e,t,r,o))})),q.waitFor(a)}Wn(e){let t=1;return Xa(e).ee({index:uT,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((r,i,s)=>{s.done(),t=i.sequenceNumber+1})).next((()=>t))}createRange(e,t,r){r=r.sort(((a,o)=>zi(a,o))).filter(((a,o,c)=>!o||zi(a,c[o-1])!==0));const i=[];i.push(e);for(const a of r){const o=zi(a,e),c=zi(a,t);if(o===0)i[0]=e.En();else if(o>0&&c<0)i.push(a),i.push(a.En());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Jn(i[a],i[a+1]))return[];const o=i[a].An(this.uid,eh,ye.empty()),c=i[a+1].An(this.uid,eh,ye.empty());s.push(IDBKeyRange.bound(o,c))}return s}Jn(e,t){return zi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ny)}getMinOffset(e,t){return q.mapArray(this.vn(t),(r=>this.Fn(e,r).next((i=>i||Te(44426))))).next(ny)}}function ty(n){return en(n,Rl)}function Ya(n){return en(n,Zc)}function wc(n){return en(n,hg)}function Xa(n){return en(n,Jc)}function ny(n){Ae(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;cg(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new tr(e.readTime,e.documentKey,t)}const ry={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},_b=41943040;class _n{static withCacheSize(e){return new _n(e,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function xb(n,e,t){const r=n.store(xr),i=n.store(Io),s=[],a=IDBKeyRange.only(t.batchId);let o=0;const c=r.ee({range:a},((u,h,d)=>(o++,d.delete())));s.push(c.next((()=>{Ae(o===1,47070,{batchId:t.batchId})})));const l=[];for(const u of t.mutations){const h=oT(e,u.key.path,t.batchId);s.push(i.delete(h)),l.push(u.key)}return q.waitFor(s).next((()=>l))}function cf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Te(14731);e=n.noDocument}return JSON.stringify(e).length}_n.DEFAULT_COLLECTION_PERCENTILE=10,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,_n.DEFAULT=new _n(_b,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),_n.DISABLED=new _n(-1,0,0);class rd{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Zn={}}static wt(e,t,r,i){Ae(e.uid!=="",64387);const s=e.isAuthenticated()?e.uid:"";return new rd(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $i(e).ee({index:ta,range:r},((i,s,a)=>{t=!1,a.done()})).next((()=>t))}addMutationBatch(e,t,r,i){const s=io(e),a=$i(e);return a.add({}).next((o=>{Ae(typeof o=="number",49019);const c=new vg(o,t,r,i),l=(function(p,g,m){const _=m.baseMutations.map((I=>sf(p.yt,I))),E=m.mutations.map((I=>sf(p.yt,I)));return{userId:g,batchId:m.batchId,localWriteTimeMs:m.localWriteTime.toMillis(),baseMutations:_,mutations:E}})(this.serializer,this.userId,c),u=[];let h=new ot(((d,p)=>De(d.canonicalString(),p.canonicalString())));for(const d of i){const p=oT(this.userId,d.key.path,o);h=h.add(d.key.path.popLast()),u.push(a.put(l)),u.push(s.put(p,aM))}return h.forEach((d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))})),e.addOnCommittedListener((()=>{this.Zn[o]=c.keys()})),q.waitFor(u).next((()=>c))}))}lookupMutationBatch(e,t){return $i(e).get(t).next((r=>r?(Ae(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Qs(this.serializer,r)):null))}Xn(e,t){return this.Zn[t]?q.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next((r=>{if(r){const i=r.keys();return this.Zn[t]=i,i}return null}))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return $i(e).ee({index:ta,range:i},((a,o,c)=>{o.userId===this.userId&&(Ae(o.batchId>=r,47524,{Yn:r}),s=Qs(this.serializer,o)),c.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=sa;return $i(e).ee({index:ta,range:t,reverse:!0},((i,s,a)=>{r=s.batchId,a.done()})).next((()=>r))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,sa],[this.userId,Number.POSITIVE_INFINITY]);return $i(e).H(ta,t).next((r=>r.map((i=>Qs(this.serializer,i)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=wh(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return io(e).ee({range:i},((a,o,c)=>{const[l,u,h]=a,d=Vr(u);if(l===this.userId&&t.path.isEqual(d))return $i(e).get(h).next((p=>{if(!p)throw Te(61480,{er:a,batchId:h});Ae(p.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:p.userId,batchId:h}),s.push(Qs(this.serializer,p))}));c.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(De);const i=[];return t.forEach((s=>{const a=wh(this.userId,s.path),o=IDBKeyRange.lowerBound(a),c=io(e).ee({range:o},((l,u,h)=>{const[d,p,g]=l,m=Vr(p);d===this.userId&&s.path.isEqual(m)?r=r.add(g):h.done()}));i.push(c)})),q.waitFor(i).next((()=>this.tr(e,r)))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=wh(this.userId,r),a=IDBKeyRange.lowerBound(s);let o=new ot(De);return io(e).ee({range:a},((c,l,u)=>{const[h,d,p]=c,g=Vr(d);h===this.userId&&r.isPrefixOf(g)?g.length===i&&(o=o.add(p)):u.done()})).next((()=>this.tr(e,o)))}tr(e,t){const r=[],i=[];return t.forEach((s=>{i.push($i(e).get(s).next((a=>{if(a===null)throw Te(35274,{batchId:s});Ae(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:s}),r.push(Qs(this.serializer,a))})))})),q.waitFor(i).next((()=>r))}removeMutationBatch(e,t){return xb(e.le,this.userId,t).next((r=>(e.addOnCommittedListener((()=>{this.nr(t.batchId)})),q.forEach(r,(i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return q.resolve();const r=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),i=[];return io(e).ee({range:r},((s,a,o)=>{if(s[0]===this.userId){const c=Vr(s[1]);i.push(c)}else o.done()})).next((()=>{Ae(i.length===0,56720,{rr:i.map((s=>s.canonicalString()))})}))}))}containsKey(e,t){return yb(e,this.userId,t)}ir(e){return vb(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:sa,lastStreamToken:""}))}}function yb(n,e,t){const r=wh(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return io(n).ee({range:s,Y:!0},((o,c,l)=>{const[u,h,d]=o;u===e&&h===i&&(a=!0),l.done()})).next((()=>a))}function $i(n){return en(n,xr)}function io(n){return en(n,Io)}function vb(n){return en(n,kl)}class Ta{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Ta(0)}static ar(){return new Ta(-1)}}class DL{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next((t=>{const r=new Ta(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.ur(e).next((t=>ke.fromTimestamp(new st(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.ur(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,r){return this.ur(e).next((i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.cr(e,i))))}addTargetData(e,t){return this.lr(e,t).next((()=>this.ur(e).next((r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Qa(e).delete(t.targetId))).next((()=>this.ur(e))).next((r=>(Ae(r.targetCount>0,8065),r.targetCount-=1,this.cr(e,r))))}removeTargets(e,t,r){let i=0;const s=[];return Qa(e).ee(((a,o)=>{const c=Nc(o);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))})).next((()=>q.waitFor(s))).next((()=>i))}forEachTarget(e,t){return Qa(e).ee(((r,i)=>{const s=Nc(i);t(s)}))}ur(e){return iy(e).get(Jh).next((t=>(Ae(t!==null,2888),t)))}cr(e,t){return iy(e).put(Jh,t)}lr(e,t){return Qa(e).put(db(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next((t=>t.targetCount))}getTargetData(e,t){const r=va(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Qa(e).ee({range:i,index:lT},((a,o,c)=>{const l=Nc(o);au(t,l.target)&&(s=l,c.done())})).next((()=>s))}addMatchingKeys(e,t,r){const i=[],s=Qi(e);return t.forEach((a=>{const o=An(a.path);i.push(s.put({targetId:r,path:o})),i.push(this.referenceDelegate.addReference(e,r,a))})),q.waitFor(i)}removeMatchingKeys(e,t,r){const i=Qi(e);return q.forEach(t,(s=>{const a=An(s.path);return q.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])}))}removeMatchingKeysForTargetId(e,t){const r=Qi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Qi(e);let s=He();return i.ee({range:r,Y:!0},((a,o,c)=>{const l=Vr(a[1]),u=new ye(l);s=s.add(u)})).next((()=>s))}containsKey(e,t){const r=An(t.path),i=IDBKeyRange.bound([r],[Jw(r)],!1,!0);let s=0;return Qi(e).ee({index:ug,Y:!0,range:i},(([a,o],c,l)=>{a!==0&&(s++,l.done())})).next((()=>s>0))}At(e,t){return Qa(e).get(t).next((r=>r?Nc(r):null))}}function Qa(n){return en(n,Ao)}function iy(n){return en(n,aa)}function Qi(n){return en(n,So)}const sy="LruGarbageCollector",Eb=1048576;function ay([n,e],[t,r]){const i=De(n,t);return i===0?De(e,r):i}class FL{constructor(e){this.Pr=e,this.buffer=new ot(ay),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ay(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class wb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){ae(sy,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ss(t)?ae(sy,"Ignoring IndexedDB error during garbage collection: ",t):await As(t)}await this.Ar(3e5)}))}}class OL{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return q.resolve(Wn.ce);const r=new FL(t);return this.Vr.forEachTarget(e,(i=>r.Er(i.sequenceNumber))).next((()=>this.Vr.mr(e,(i=>r.Er(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ae("LruGarbageCollector","Garbage collection skipped; disabled"),q.resolve(ry)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ry):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,i,s,a,o,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((h=>(h>this.params.maximumSequenceNumbersToCollect?(ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,a=Date.now(),this.nthSequenceNumber(e,i)))).next((h=>(r=h,o=Date.now(),this.removeTargets(e,r,t)))).next((h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(e,r)))).next((h=>(l=Date.now(),eo()<=$e.DEBUG&&ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in `+(o-a)+`ms
	Removed ${s} targets in `+(c-o)+`ms
	Removed ${h} documents in `+(l-c)+`ms
Total Duration: ${l-u}ms`),q.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h}))))}}function Tb(n,e){return new OL(n,e)}class ML{constructor(e,t){this.db=e,this.garbageCollector=Tb(this,t)}dr(e){const t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,((r,i)=>t(i)))}addReference(e,t,r){return th(e,r)}removeReference(e,t,r){return th(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return th(e,t)}wr(e,t){return(function(i,s){let a=!1;return vb(i).te((o=>yb(i,o,s).next((c=>(c&&(a=!0),q.resolve(!c)))))).next((()=>a))})(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.yr(e,((a,o)=>{if(o<=t){const c=this.wr(e,a).next((l=>{if(!l)return s++,r.getEntry(e,a).next((()=>(r.removeEntry(a,ke.min()),Qi(e).delete((function(h){return[0,An(h.path)]})(a)))))}));i.push(c)}})).next((()=>q.waitFor(i))).next((()=>r.apply(e))).next((()=>s))}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return th(e,t)}yr(e,t){const r=Qi(e);let i,s=Wn.ce;return r.ee({index:ug},(([a,o],{path:c,sequenceNumber:l})=>{a===0?(s!==Wn.ce&&t(new ye(Vr(i)),s),s=l,i=c):s=Wn.ce})).next((()=>{s!==Wn.ce&&t(new ye(Vr(i)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function th(n,e){return Qi(n).put((function(r,i){return{targetId:0,path:An(r.path),sequenceNumber:i}})(e,n.currentSequenceNumber))}class bb{constructor(){this.changes=new Si((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?q.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class LL{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ws(e).put(r)}removeEntry(e,t,r){return Ws(e).delete((function(s,a){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],af(a),o[o.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next((r=>(r.byteSize+=t,this.br(e,r))))}getEntry(e,t){let r=Pt.newInvalidDocument(t);return Ws(e).ee({index:Th,range:IDBKeyRange.only(Tc(t))},((i,s)=>{r=this.Sr(t,s)})).next((()=>r))}Dr(e,t){let r={size:0,document:Pt.newInvalidDocument(t)};return Ws(e).ee({index:Th,range:IDBKeyRange.only(Tc(t))},((i,s)=>{r={document:this.Sr(t,s),size:cf(s)}})).next((()=>r))}getEntries(e,t){let r=Zn();return this.Cr(e,t,((i,s)=>{const a=this.Sr(i,s);r=r.insert(i,a)})).next((()=>r))}vr(e,t){let r=Zn(),i=new gt(ye.comparator);return this.Cr(e,t,((s,a)=>{const o=this.Sr(s,a);r=r.insert(s,o),i=i.insert(s,cf(a))})).next((()=>({documents:r,Fr:i})))}Cr(e,t,r){if(t.isEmpty())return q.resolve();let i=new ot(ly);t.forEach((c=>i=i.add(c)));const s=IDBKeyRange.bound(Tc(i.first()),Tc(i.last())),a=i.getIterator();let o=a.getNext();return Ws(e).ee({index:Th,range:s},((c,l,u)=>{const h=ye.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;o&&ly(o,h)<0;)r(o,null),o=a.getNext();o&&o.isEqual(h)&&(r(o,l),o=a.hasNext()?a.getNext():null),o?u.j(Tc(o)):u.done()})).next((()=>{for(;o;)r(o,null),o=a.hasNext()?a.getNext():null}))}getDocumentsMatchingQuery(e,t,r,i,s){const a=t.path,o=[a.popLast().toArray(),a.lastSegment(),af(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ws(e).H(IDBKeyRange.bound(o,c,!0)).next((l=>{s?.incrementDocumentReadCount(l.length);let u=Zn();for(const h of l){const d=this.Sr(ye.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(cu(t,d)||i.has(d.key))&&(u=u.insert(d.key,d))}return u}))}getAllFromCollectionGroup(e,t,r,i){let s=Zn();const a=cy(t,r),o=cy(t,tr.max());return Ws(e).ee({index:cT,range:IDBKeyRange.bound(a,o,!0)},((c,l,u)=>{const h=this.Sr(ye.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(h.key,h),s.size===i&&u.done()})).next((()=>s))}newChangeBuffer(e){return new NL(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return oy(e).get($0).next((t=>(Ae(!!t,20021),t)))}br(e,t){return oy(e).put($0,t)}Sr(e,t){if(t){const r=wL(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ke.min())))return r}return Pt.newInvalidDocument(e)}}function Ib(n){return new LL(n)}class NL extends bb{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new Si((r=>r.toString()),((r,i)=>r.isEqual(i)))}applyChanges(e){const t=[];let r=0,i=new ot(((s,a)=>De(s.canonicalString(),a.canonicalString())));return this.changes.forEach(((s,a)=>{const o=this.Or.get(s);if(t.push(this.Mr.removeEntry(e,s,o.readTime)),a.isValidDocument()){const c=Wx(this.Mr.serializer,a);i=i.add(s.path.popLast());const l=cf(c);r+=l-o.size,t.push(this.Mr.addEntry(e,s,c))}else if(r-=o.size,this.trackRemovals){const c=Wx(this.Mr.serializer,a.convertToNoDocument(ke.min()));t.push(this.Mr.addEntry(e,s,c))}})),i.forEach((s=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,s))})),t.push(this.Mr.updateMetadata(e,r)),q.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next((r=>(this.Or.set(t,{size:r.size,readTime:r.document.readTime}),r.document)))}getAllFromCache(e,t){return this.Mr.vr(e,t).next((({documents:r,Fr:i})=>(i.forEach(((s,a)=>{this.Or.set(s,{size:a,readTime:r.get(s).readTime})})),r)))}}function oy(n){return en(n,Cl)}function Ws(n){return en(n,Qh)}function Tc(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function cy(n,e){const t=e.documentKey.path.toArray();return[n,af(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ly(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=De(t[s],r[s]),i)return i;return i=De(t.length,r.length),i||(i=De(t[t.length-2],r[r.length-2]),i||De(t[t.length-1],r[r.length-1]))}class VL{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ab{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&rl(r.mutation,i,jn.empty(),st.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,He()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=He()){const i=Br();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((s=>{let a=Mc();return s.forEach(((o,c)=>{a=a.insert(o,c.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Br();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,He())))}populateOverlays(e,t,r){const i=[];return r.forEach((s=>{t.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(e,i).next((s=>{s.forEach(((a,o)=>{t.set(a,o)}))}))}computeViews(e,t,r,i){let s=Zn();const a=nl(),o=(function(){return nl()})();return t.forEach(((c,l)=>{const u=r.get(l.key);i.has(l.key)&&(u===void 0||u.mutation instanceof ki)?s=s.insert(l.key,l):u!==void 0?(a.set(l.key,u.mutation.getFieldMask()),rl(u.mutation,l,u.mutation.getFieldMask(),st.now())):a.set(l.key,jn.empty())})),this.recalculateAndSaveOverlays(e,s).next((c=>(c.forEach(((l,u)=>a.set(l,u))),t.forEach(((l,u)=>o.set(l,new VL(u,a.get(l)??null)))),o)))}recalculateAndSaveOverlays(e,t){const r=nl();let i=new gt(((a,o)=>a-o)),s=He();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const o of a)o.keys().forEach((c=>{const l=t.get(c);if(l===null)return;let u=r.get(c)||jn.empty();u=o.applyToLocalView(l,u),r.set(c,u);const h=(i.get(o.batchId)||He()).add(c);i=i.insert(o.batchId,h)}))})).next((()=>{const a=[],o=i.getReverseIterator();for(;o.hasNext();){const c=o.getNext(),l=c.key,u=c.value,h=HT();u.forEach((d=>{if(!s.has(d)){const p=KT(t.get(d),r.get(d));p!==null&&h.set(d,p),s=s.add(d)}})),a.push(this.documentOverlayCache.saveOverlays(e,l,h))}return q.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return $M(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):MT(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):q.resolve(Br());let o=bo,c=s;return a.next((l=>q.forEach(l,((u,h)=>(o<h.largestBatchId&&(o=h.largestBatchId),s.get(u)?q.resolve():this.remoteDocumentCache.getEntry(e,u).next((d=>{c=c.insert(u,d)}))))).next((()=>this.populateOverlays(e,l,s))).next((()=>this.computeViews(e,c,l,He()))).next((u=>({batchId:o,changes:UT(u)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ye(t)).next((r=>{let i=Mc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=Mc();return this.indexManager.getCollectionParents(e,s).next((o=>q.forEach(o,(c=>{const l=(function(h,d){return new Ko(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)})(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next((u=>{u.forEach(((h,d)=>{a=a.insert(h,d)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i)))).next((a=>{s.forEach(((c,l)=>{const u=l.getKey();a.get(u)===null&&(a=a.insert(u,Pt.newInvalidDocument(u)))}));let o=Mc();return a.forEach(((c,l)=>{const u=s.get(c);u!==void 0&&rl(u.mutation,l,jn.empty(),st.now()),cu(t,l)&&(o=o.insert(c,l))})),o}))}}class BL{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return q.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Nn(i.createTime)}})(t)),q.resolve()}getNamedQuery(e,t){return q.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:pb(i.bundledQuery),readTime:Nn(i.readTime)}})(t)),q.resolve()}}class UL{constructor(){this.overlays=new gt(ye.comparator),this.Lr=new Map}getOverlay(e,t){return q.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Br();return q.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,s)=>{this.bt(e,t,s)})),q.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Lr.get(r);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.Lr.delete(r)),q.resolve()}getOverlaysForCollection(e,t,r){const i=Br(),s=t.length+1,a=new ye(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const c=o.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return q.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new gt(((l,u)=>l-u));const a=this.overlays.getIterator();for(;a.hasNext();){const l=a.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let u=s.get(l.largestBatchId);u===null&&(u=Br(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const o=Br(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((l,u)=>o.set(l,u))),!(o.size()>=i)););return q.resolve(o)}bt(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new wg(t,r));let s=this.Lr.get(t);s===void 0&&(s=He(),this.Lr.set(t,s)),this.Lr.set(t,s.add(r.key))}}class HL{constructor(){this.sessionToken=Vt.EMPTY_BYTE_STRING}getSessionToken(e){return q.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,q.resolve()}}class Sg{constructor(){this.kr=new ot(nn.Kr),this.qr=new ot(nn.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new nn(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new nn(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new ye(new tt([])),r=new nn(t,e),i=new nn(t,e+1),s=[];return this.qr.forEachInRange([r,i],(a=>{this.Wr(a),s.push(a.key)})),s}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new ye(new tt([])),r=new nn(t,e),i=new nn(t,e+1);let s=He();return this.qr.forEachInRange([r,i],(a=>{s=s.add(a.key)})),s}containsKey(e){const t=new nn(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class nn{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return ye.comparator(e.key,t.key)||De(e.Hr,t.Hr)}static Ur(e,t){return De(e.Hr,t.Hr)||ye.comparator(e.key,t.key)}}class zL{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new ot(nn.Kr)}checkEmpty(e){return q.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new vg(s,t,r,i);this.mutationQueue.push(a);for(const o of i)this.Jr=this.Jr.add(new nn(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return q.resolve(a)}lookupMutationBatch(e,t){return q.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Xr(r),s=i<0?0:i;return q.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return q.resolve(this.mutationQueue.length===0?sa:this.Yn-1)}getAllMutationBatches(e){return q.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new nn(t,0),i=new nn(t,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([r,i],(a=>{const o=this.Zr(a.Hr);s.push(o)})),q.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(De);return t.forEach((i=>{const s=new nn(i,0),a=new nn(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,a],(o=>{r=r.add(o.Hr)}))})),q.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;ye.isDocumentKey(s)||(s=s.child(""));const a=new nn(new ye(s),0);let o=new ot(De);return this.Jr.forEachWhile((c=>{const l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(o=o.add(c.Hr)),!0)}),a),q.resolve(this.Yr(o))}Yr(e){const t=[];return e.forEach((r=>{const i=this.Zr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){Ae(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return q.forEach(t.mutations,(i=>{const s=new nn(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new nn(t,0),i=this.Jr.firstAfterOrEqual(r);return q.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,q.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class $L{constructor(e){this.ti=e,this.docs=(function(){return new gt(ye.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return q.resolve(r?r.document.mutableCopy():Pt.newInvalidDocument(t))}getEntries(e,t){let r=Zn();return t.forEach((i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Pt.newInvalidDocument(i))})),q.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Zn();const a=t.path,o=new ye(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(o);for(;c.hasNext();){const{key:l,value:{document:u}}=c.getNext();if(!a.isPrefixOf(l.path))break;l.path.length>a.length+1||cg(nT(u),r)<=0||(i.has(u.key)||cu(t,u))&&(s=s.insert(u.key,u.mutableCopy()))}return q.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Te(9500)}ni(e,t){return q.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new WL(this)}getSize(e){return q.resolve(this.size)}}class WL extends bb{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(r)})),q.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class jL{constructor(e){this.persistence=e,this.ri=new Si((t=>va(t)),au),this.lastRemoteSnapshotVersion=ke.min(),this.highestTargetId=0,this.ii=0,this.si=new Sg,this.targetCount=0,this.oi=Ta._r()}forEachTarget(e,t){return this.ri.forEach(((r,i)=>t(i))),q.resolve()}getLastRemoteSnapshotVersion(e){return q.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return q.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),q.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),q.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Ta(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,q.resolve()}updateTargetData(e,t){return this.lr(t),q.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,q.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.ri.forEach(((a,o)=>{o.sequenceNumber<=t&&r.get(o.targetId)===null&&(this.ri.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),q.waitFor(s).next((()=>i))}getTargetCount(e){return q.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return q.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),q.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((a=>{s.push(i.markPotentiallyOrphaned(e,a))})),q.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),q.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return q.resolve(r)}containsKey(e,t){return q.resolve(this.si.containsKey(t))}}class kg{constructor(e,t){this._i={},this.overlays={},this.ai=new Wn(0),this.ui=!1,this.ui=!0,this.ci=new HL,this.referenceDelegate=e(this),this.li=new jL(this),this.indexManager=new RL,this.remoteDocumentCache=(function(i){return new $L(i)})((r=>this.referenceDelegate.hi(r))),this.serializer=new fb(t),this.Pi=new BL(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new UL,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new zL(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){ae("MemoryPersistence","Starting transaction:",e);const i=new GL(this.ai.next());return this.referenceDelegate.Ti(),r(i).next((s=>this.referenceDelegate.Ii(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ei(e,t){return q.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class GL extends iT{constructor(e){super(),this.currentSequenceNumber=e}}class id{constructor(e){this.persistence=e,this.Ri=new Sg,this.Ai=null}static Vi(e){return new id(e)}get di(){if(this.Ai)return this.Ai;throw Te(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),q.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),q.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),q.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((i=>this.di.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((s=>this.di.add(s.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return q.forEach(this.di,(r=>{const i=ye.fromPath(r);return this.mi(e,i).next((s=>{s||t.removeEntry(i,ke.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return q.or([()=>q.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class lf{constructor(e,t){this.persistence=e,this.fi=new Si((r=>An(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=Tb(this,t)}static Vi(e,t){return new lf(e,t)}Ti(){}Ii(e){return q.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return q.forEach(this.fi,((r,i)=>this.wr(e,r,i).next((s=>s?q.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ni(e,(a=>this.wr(e,a,t).next((o=>{o||(r++,s.removeEntry(a,ke.min()))})))).next((()=>s.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),q.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),q.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),q.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),q.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ih(e.data.value)),t}wr(e,t,r){return q.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.fi.get(t);return q.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class qL{constructor(e){this.serializer=e}k(e,t,r,i){const s=new Gf("createOrUpgrade",t);r<1&&i>=1&&((function(c){c.createObjectStore(su)})(e),(function(c){c.createObjectStore(kl,{keyPath:sM}),c.createObjectStore(xr,{keyPath:vx,autoIncrement:!0}).createIndex(ta,Ex,{unique:!0}),c.createObjectStore(Io)})(e),uy(e),(function(c){c.createObjectStore(Ys)})(e));let a=q.resolve();return r<3&&i>=3&&(r!==0&&((function(c){c.deleteObjectStore(So),c.deleteObjectStore(Ao),c.deleteObjectStore(aa)})(e),uy(e)),a=a.next((()=>(function(c){const l=c.store(aa),u={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ke.min().toTimestamp(),targetCount:0};return l.put(Jh,u)})(s)))),r<4&&i>=4&&(r!==0&&(a=a.next((()=>(function(c,l){return l.store(xr).H().next((h=>{c.deleteObjectStore(xr),c.createObjectStore(xr,{keyPath:vx,autoIncrement:!0}).createIndex(ta,Ex,{unique:!0});const d=l.store(xr),p=h.map((g=>d.put(g)));return q.waitFor(p)}))})(e,s)))),a=a.next((()=>{(function(c){c.createObjectStore(ko,{keyPath:pM})})(e)}))),r<5&&i>=5&&(a=a.next((()=>this.gi(s)))),r<6&&i>=6&&(a=a.next((()=>((function(c){c.createObjectStore(Cl)})(e),this.pi(s))))),r<7&&i>=7&&(a=a.next((()=>this.yi(s)))),r<8&&i>=8&&(a=a.next((()=>this.wi(e,s)))),r<9&&i>=9&&(a=a.next((()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)}))),r<10&&i>=10&&(a=a.next((()=>this.bi(s)))),r<11&&i>=11&&(a=a.next((()=>{(function(c){c.createObjectStore(Kf,{keyPath:gM})})(e),(function(c){c.createObjectStore(Yf,{keyPath:mM})})(e)}))),r<12&&i>=12&&(a=a.next((()=>{(function(c){const l=c.createObjectStore(Xf,{keyPath:TM});l.createIndex(j0,bM,{unique:!1}),l.createIndex(fT,IM,{unique:!1})})(e)}))),r<13&&i>=13&&(a=a.next((()=>(function(c){const l=c.createObjectStore(Qh,{keyPath:oM});l.createIndex(Th,cM),l.createIndex(cT,lM)})(e))).next((()=>this.Si(e,s))).next((()=>e.deleteObjectStore(Ys)))),r<14&&i>=14&&(a=a.next((()=>this.Di(e,s)))),r<15&&i>=15&&(a=a.next((()=>(function(c){c.createObjectStore(hg,{keyPath:_M,autoIncrement:!0}).createIndex(W0,xM,{unique:!1}),c.createObjectStore(Jc,{keyPath:yM}).createIndex(uT,vM,{unique:!1}),c.createObjectStore(Zc,{keyPath:EM}).createIndex(hT,wM,{unique:!1})})(e)))),r<16&&i>=16&&(a=a.next((()=>{t.objectStore(Jc).clear()})).next((()=>{t.objectStore(Zc).clear()}))),r<17&&i>=17&&(a=a.next((()=>{(function(c){c.createObjectStore(fg,{keyPath:AM})})(e)}))),r<18&&i>=18&&rw()&&(a=a.next((()=>{t.objectStore(Jc).clear()})).next((()=>{t.objectStore(Zc).clear()}))),a}pi(e){let t=0;return e.store(Ys).ee(((r,i)=>{t+=cf(i)})).next((()=>{const r={byteSize:t};return e.store(Cl).put($0,r)}))}gi(e){const t=e.store(kl),r=e.store(xr);return t.H().next((i=>q.forEach(i,(s=>{const a=IDBKeyRange.bound([s.userId,sa],[s.userId,s.lastAcknowledgedBatchId]);return r.H(ta,a).next((o=>q.forEach(o,(c=>{Ae(c.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const l=Qs(this.serializer,c);return xb(e,s.userId,l).next((()=>{}))}))))}))))}yi(e){const t=e.store(So),r=e.store(Ys);return e.store(aa).get(Jh).next((i=>{const s=[];return r.ee(((a,o)=>{const c=new tt(a),l=(function(h){return[0,An(h)]})(c);s.push(t.get(l).next((u=>u?q.resolve():(h=>t.put({targetId:0,path:An(h),sequenceNumber:i.highestListenSequenceNumber}))(c))))})).next((()=>q.waitFor(s)))}))}wi(e,t){e.createObjectStore(Rl,{keyPath:dM});const r=t.store(Rl),i=new Ag,s=a=>{if(i.add(a)){const o=a.lastSegment(),c=a.popLast();return r.put({collectionId:o,parent:An(c)})}};return t.store(Ys).ee({Y:!0},((a,o)=>{const c=new tt(a);return s(c.popLast())})).next((()=>t.store(Io).ee({Y:!0},(([a,o,c],l)=>{const u=Vr(o);return s(u.popLast())}))))}bi(e){const t=e.store(Ao);return t.ee(((r,i)=>{const s=Nc(i),a=db(this.serializer,s);return t.put(a)}))}Si(e,t){const r=t.store(Ys),i=[];return r.ee(((s,a)=>{const o=t.store(Qh),c=(function(h){return h.document?new ye(tt.fromString(h.document.name).popFirst(5)):h.noDocument?ye.fromSegments(h.noDocument.path):h.unknownDocument?ye.fromSegments(h.unknownDocument.path):Te(36783)})(a).path.toArray(),l={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(o.put(l))})).next((()=>q.waitFor(i)))}Di(e,t){const r=t.store(xr),i=Ib(this.serializer),s=new kg(id.Vi,this.serializer.yt);return r.H().next((a=>{const o=new Map;return a.forEach((c=>{let l=o.get(c.userId)??He();Qs(this.serializer,c).keys().forEach((u=>l=l.add(u))),o.set(c.userId,l)})),q.forEach(o,((c,l)=>{const u=new mn(l),h=nd.wt(this.serializer,u),d=s.getIndexManager(u),p=rd.wt(u,this.serializer,d,s.referenceDelegate);return new Ab(i,p,h,d).recalculateAndSaveOverlaysForDocumentKeys(new G0(t,Wn.ce),c).next()}))}))}}function uy(n){n.createObjectStore(So,{keyPath:hM}).createIndex(ug,fM,{unique:!0}),n.createObjectStore(Ao,{keyPath:"targetId"}).createIndex(lT,uM,{unique:!0}),n.createObjectStore(aa)}const Wi="IndexedDbPersistence",Qd=18e5,Jd=5e3,Zd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",KL="main";class Cg{constructor(e,t,r,i,s,a,o,c,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=s,this.window=a,this.document=o,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=Number.NEGATIVE_INFINITY,this.ki=d=>Promise.resolve(),!Cg.v())throw new de(ne.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ML(this,i),this.Ki=t+KL,this.serializer=new fb(c),this.qi=new us(this.Ki,this.xi,new qL(this.serializer)),this.ci=new bL,this.li=new DL(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ib(this.serializer),this.Pi=new TL,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,u===!1&&Mt(Wi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new de(ne.FAILED_PRECONDITION,Zd);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.li.getHighestSequenceNumber(e)))})).then((e=>{this.ai=new Wn(e,this.Fi)})).then((()=>{this.ui=!0})).catch((e=>(this.qi&&this.qi.close(),Promise.reject(e))))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget((async()=>{this.started&&await this.$i()})))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>nh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.ji(e).next((t=>{t||(this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))))}))})).next((()=>this.Hi(e))).next((t=>this.isPrimary&&!t?this.Ji(e).next((()=>!1)):!!t&&this.Zi(e).next((()=>!0)))))).catch((e=>{if(Ss(e))return ae(Wi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ae(Wi,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable((()=>this.ki(e))),this.isPrimary=e}))}ji(e){return bc(e).get(Ga).next((t=>q.resolve(this.Xi(t))))}Yi(e){return nh(e).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,Qd)){this.Li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const r=en(t,ko);return r.H().next((i=>{const s=this.ns(i,Qd),a=i.filter((o=>s.indexOf(o)===-1));return q.forEach(a,(o=>r.delete(o.clientId))).next((()=>a))}))})).catch((()=>[]));if(this.Ui)for(const t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.$i().then((()=>this.es())).then((()=>this.Gi()))))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?q.resolve(!0):bc(e).get(Ga).next((t=>{if(t!==null&&this.ts(t.leaseTimestampMs,Jd)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new de(ne.FAILED_PRECONDITION,Zd);return!1}}return!(!this.networkEnabled||!this.inForeground)||nh(e).H().next((r=>this.ns(r,Jd).find((i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,o=this.networkEnabled===i.networkEnabled;if(s||a&&o)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&ae(Wi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[su,ko],(e=>{const t=new G0(e,Wn.ce);return this.Ji(t).next((()=>this.Yi(t)))})),this.qi.close(),this.ls()}ns(e,t){return e.filter((r=>this.ts(r.updateTimeMs,t)&&!this.ss(r.clientId)))}hs(){return this.runTransaction("getActiveClients","readonly",(e=>nh(e).H().next((t=>this.ns(t,Qd).map((r=>r.clientId))))))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return rd.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new PL(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return nd.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){ae(Wi,"Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",s=(function(c){return c===18?CM:c===17?mT:c===16?kM:c===15?dg:c===14?gT:c===13?pT:c===12?SM:c===11?dT:void Te(60245)})(this.xi);let a;return this.qi.runTransaction(e,i,s,(o=>(a=new G0(o,this.ai?this.ai.next():Wn.ce),t==="readwrite-primary"?this.ji(a).next((c=>!!c||this.Hi(a))).next((c=>{if(!c)throw Mt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))),new de(ne.FAILED_PRECONDITION,rT);return r(a)})).next((c=>this.Zi(a).next((()=>c)))):this.Ps(a).next((()=>r(a)))))).then((o=>(a.raiseOnCommittedEvent(),o)))}Ps(e){return bc(e).get(Ga).next((t=>{if(t!==null&&this.ts(t.leaseTimestampMs,Jd)&&!this.ss(t.ownerId)&&!this.Xi(t)&&!(this.Mi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new de(ne.FAILED_PRECONDITION,Zd)}))}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bc(e).put(Ga,t)}static v(){return us.v()}Ji(e){const t=bc(e);return t.get(Ga).next((r=>this.Xi(r)?(ae(Wi,"Releasing primary lease."),t.delete(Ga)):q.resolve()))}ts(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Mt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ni=()=>{this.Ci.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.$i())))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground=this.document.visibilityState==="visible")}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){typeof this.window?.addEventListener=="function"&&(this.Oi=()=>{this._s();const e=/(?:Version|Mobile)\/1[456]/;nw()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{const t=this.Ui?.getItem(this.rs(e))!==null;return ae(Wi,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Mt(Wi,"Failed to get zombied client id.",t),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){Mt("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch{}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bc(n){return en(n,su)}function nh(n){return en(n,ko)}function Sb(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Rg{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=i}static Es(e,t){let r=He(),i=He();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Rg(e,t.fromCache,r,i)}}class YL{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class kb{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return nw()?8:sT(Zt())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.gs(e,t).next((a=>{s.result=a})).next((()=>{if(!s.result)return this.ps(e,t,i,r).next((a=>{s.result=a}))})).next((()=>{if(s.result)return;const a=new YL;return this.ys(e,t,a).next((o=>{if(s.result=o,this.As)return this.ws(e,t,a,o.size)}))})).next((()=>s.result))}ws(e,t,r,i){return r.documentReadCount<this.Vs?(eo()<=$e.DEBUG&&ae("QueryEngine","SDK will not create cache indexes for query:",to(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),q.resolve()):(eo()<=$e.DEBUG&&ae("QueryEngine","Query:",to(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(eo()<=$e.DEBUG&&ae("QueryEngine","The SDK decides to create cache indexes for query:",to(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,er(t))):q.resolve())}gs(e,t){if(Ox(t))return q.resolve(null);let r=er(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=nf(t,null,"F"),r=er(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((s=>{const a=He(...s);return this.fs.getDocuments(e,a).next((o=>this.indexManager.getMinOffset(e,r).next((c=>{const l=this.bs(t,o);return this.Ss(t,l,a,c.readTime)?this.gs(e,nf(t,null,"F")):this.Ds(e,l,t,c)}))))})))))}ps(e,t,r,i){return Ox(t)||i.isEqual(ke.min())?q.resolve(null):this.fs.getDocuments(e,r).next((s=>{const a=this.bs(t,s);return this.Ss(t,a,r,i)?q.resolve(null):(eo()<=$e.DEBUG&&ae("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),to(t)),this.Ds(e,a,t,tT(i,bo)).next((o=>o)))}))}bs(e,t){let r=new ot(VT(e));return t.forEach(((i,s)=>{cu(e,s)&&(r=r.add(s))})),r}Ss(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ys(e,t,r){return eo()<=$e.DEBUG&&ae("QueryEngine","Using full collection scan to execute query:",to(t)),this.fs.getDocumentsMatchingQuery(e,t,tr.min(),r)}Ds(e,t,r,i){return this.fs.getDocumentsMatchingQuery(e,r,i).next((s=>(t.forEach((a=>{s=s.insert(a.key,a)})),s)))}}const Pg="LocalStore",XL=3e8;class QL{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new gt(De),this.Fs=new Si((s=>va(s)),au),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ab(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Cb(n,e,t,r){return new QL(n,e,t,r)}async function Rb(n,e){const t=be(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((s=>(i=s,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((s=>{const a=[],o=[];let c=He();for(const l of i){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of s){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(r,c).next((l=>({Ns:l,removedBatchIds:a,addedBatchIds:o})))}))}))}function JL(n,e){const t=be(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),s=t.xs.newChangeBuffer({trackRemovals:!0});return(function(o,c,l,u){const h=l.batch,d=h.keys();let p=q.resolve();return d.forEach((g=>{p=p.next((()=>u.getEntry(c,g))).next((m=>{const _=l.docVersions.get(g);Ae(_!==null,48541),m.version.compareTo(_)<0&&(h.applyToRemoteDocument(m,l),m.isValidDocument()&&(m.setReadTime(l.commitVersion),u.addEntry(m)))}))})),p.next((()=>o.mutationQueue.removeMutationBatch(c,h)))})(t,r,e,s).next((()=>s.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(o){let c=He();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(c=c.add(o.batch.mutations[l].key));return c})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function Pb(n){const e=be(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function ZL(n,e){const t=be(n),r=e.snapshotVersion;let i=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});i=t.vs;const o=[];e.targetChanges.forEach(((u,h)=>{const d=i.get(h);if(!d)return;o.push(t.li.removeMatchingKeys(s,u.removedDocuments,h).next((()=>t.li.addMatchingKeys(s,u.addedDocuments,h))));let p=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(Vt.EMPTY_BYTE_STRING,ke.min()).withLastLimboFreeSnapshotVersion(ke.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(h,p),(function(m,_,E){return m.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-m.snapshotVersion.toMicroseconds()>=XL?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(d,p,u)&&o.push(t.li.updateTargetData(s,p))}));let c=Zn(),l=He();if(e.documentUpdates.forEach((u=>{e.resolvedLimboDocuments.has(u)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))})),o.push(eN(s,a,e.documentUpdates).next((u=>{c=u.Bs,l=u.Ls}))),!r.isEqual(ke.min())){const u=t.li.getLastRemoteSnapshotVersion(s).next((h=>t.li.setTargetsMetadata(s,s.currentSequenceNumber,r)));o.push(u)}return q.waitFor(o).next((()=>a.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,c,l))).next((()=>c))})).then((s=>(t.vs=i,s)))}function eN(n,e,t){let r=He(),i=He();return t.forEach((s=>r=r.add(s))),e.getEntries(n,r).next((s=>{let a=Zn();return t.forEach(((o,c)=>{const l=s.get(o);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(o)),c.isNoDocument()&&c.version.isEqual(ke.min())?(e.removeEntry(o,c.readTime),a=a.insert(o,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),a=a.insert(o,c)):ae(Pg,"Ignoring outdated watch update for ",o,". Current version:",l.version," Watch version:",c.version)})),{Bs:a,Ls:i}}))}function tN(n,e){const t=be(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=sa),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function uf(n,e){const t=be(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.li.getTargetData(r,e).next((s=>s?(i=s,q.resolve(i)):t.li.allocateTargetId(r).next((a=>(i=new di(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.vs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function No(n,e,t){const r=be(n),i=r.vs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,(a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Ss(a))throw a;ae(Pg,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(i.target)}function ap(n,e,t){const r=be(n);let i=ke.min(),s=He();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(c,l,u){const h=be(c),d=h.Fs.get(u);return d!==void 0?q.resolve(h.vs.get(d)):h.li.getTargetData(l,u)})(r,a,er(e)).next((o=>{if(o)return i=o.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,o.targetId).next((c=>{s=c}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:ke.min(),t?s:He()))).next((o=>(Ob(r,NT(e),o),{documents:o,ks:s})))))}function Db(n,e){const t=be(n),r=be(t.li),i=t.vs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",(s=>r.At(s,e).next((a=>a?a.target:null))))}function Fb(n,e){const t=be(n),r=t.Ms.get(e)||ke.min();return t.persistence.runTransaction("Get new document changes","readonly",(i=>t.xs.getAllFromCollectionGroup(i,e,tT(r,bo),Number.MAX_SAFE_INTEGER))).then((i=>(Ob(t,e,i),i)))}function Ob(n,e,t){let r=n.Ms.get(e)||ke.min();t.forEach(((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),n.Ms.set(e,r)}const Mb="firestore_clients";function hy(n,e){return`${Mb}_${n}_${e}`}const Lb="firestore_mutations";function fy(n,e,t){let r=`${Lb}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const Nb="firestore_targets";function e0(n,e){return`${Nb}_${n}_${e}`}const Nr="SharedClientState";class hf{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static $s(e,t,r){const i=JSON.parse(r);let s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new de(i.error.code,i.error.message))),a?new hf(e,t,i.state,s):(Mt(Nr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class il{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){const r=JSON.parse(t);let i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new de(r.error.code,r.error.message))),s?new il(e,r.state,i):(Mt(Nr,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ff{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){const r=JSON.parse(t);let i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=xg();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=aT(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new ff(e,s):(Mt(Nr,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Dg{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Dg(t.clientId,t.onlineState):(Mt(Nr,`Failed to parse online state: ${e}`),null)}}class op{constructor(){this.activeTargetIds=xg()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class t0{constructor(e,t,r,i,s){this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new gt(De),this.started=!1,this.Zs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=hy(this.persistenceKey,this.zs),this.Ys=(function(c){return`firestore_sequence_number_${c}`})(this.persistenceKey),this.Js=this.Js.insert(this.zs,new op),this.eo=new RegExp(`^${Mb}_${a}_([^_]*)$`),this.no=new RegExp(`^${Lb}_${a}_(\\d+)(?:_(.*))?$`),this.ro=new RegExp(`^${Nb}_${a}_(\\d+)$`),this.io=(function(c){return`firestore_online_state_${c}`})(this.persistenceKey),this.so=(function(c){return`firestore_bundle_loaded_v2_${c}`})(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.hs();for(const r of e){if(r===this.zs)continue;const i=this.getItem(hy(this.persistenceKey,r));if(i){const s=ff.$s(r,i);s&&(this.Js=this.Js.insert(s.clientId,s))}}this.oo();const t=this.storage.getItem(this.io);if(t){const r=this._o(t);r&&this.ao(r)}for(const r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach(((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(e0(this.persistenceKey,e));if(i){const s=il.$s(e,i);s&&(r=s.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(e0(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach((i=>{this.lo(i)})),this.currentUser=e,r.forEach((i=>{this.addPendingMutation(i)}))}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ae(Nr,"READ",e,t),t}setItem(e,t){ae(Nr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ae(Nr,"REMOVE",e),this.storage.removeItem(e)}Hs(e){const t=e;if(t.storageArea===this.storage){if(ae(Nr,"EVENT",t.key,t.newValue),t.key===this.Xs)return void Mt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.eo.test(t.key)){if(t.newValue==null){const r=this.Eo(t.key);return this.Ro(r,null)}{const r=this.Ao(t.key,t.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.no.test(t.key)){if(t.newValue!==null){const r=this.Vo(t.key,t.newValue);if(r)return this.mo(r)}}else if(this.ro.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(t.key===this.io){if(t.newValue!==null){const r=this._o(t.newValue);if(r)return this.ao(r)}}else if(t.key===this.Ys){const r=(function(s){let a=Wn.ce;if(s!=null)try{const o=JSON.parse(s);Ae(typeof o=="number",30636,{yo:s}),a=o}catch(o){Mt(Nr,"Failed to read sequence number from WebStorage",o)}return a})(t.newValue);r!==Wn.ce&&this.sequenceNumberHandler(r)}else if(t.key===this.so){const r=this.wo(t.newValue);await Promise.all(r.map((i=>this.syncEngine.bo(i))))}}}else this.Zs.push(t)}))}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){const i=new hf(this.currentUser,e,t,r),s=fy(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}lo(e){const t=fy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){const t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){const i=e0(this.persistenceKey,e),s=new il(e,t,r);this.setItem(i,s.Ws())}Io(e){const t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){const t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){const r=this.Eo(e);return ff.$s(r,t)}Vo(e,t){const r=this.no.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return hf.$s(new mn(s),i,t)}fo(e,t){const r=this.ro.exec(e),i=Number(r[1]);return il.$s(i,t)}_o(e){return Dg.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);ae(Nr,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){const r=t?this.Js.insert(e,t):this.Js.remove(e),i=this.uo(this.Js),s=this.uo(r),a=[],o=[];return s.forEach((c=>{i.has(c)||a.push(c)})),i.forEach((c=>{s.has(c)||o.push(c)})),this.syncEngine.Co(a,o).then((()=>{this.Js=r}))}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=xg();return e.forEach(((r,i)=>{t=t.unionWith(i.activeTargetIds)})),t}}class Vb{constructor(){this.vo=new op,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new op,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class nN{Mo(e){}shutdown(){}}const dy="ConnectivityMonitor";class py{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){ae(dy,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){ae(dy,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let rh=null;function cp(){return rh===null?rh=(function(){return 268435456+Math.round(2147483648*Math.random())})():rh++,"0x"+rh.toString(16)}const n0="RestConnection",rN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class iN{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===Zh?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){const a=cp(),o=this.Qo(e,t.toUriEncodedString());ae(n0,`Sending RPC '${e}' ${a}:`,o,r);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(c,i,s);const{host:l}=new URL(o),u=bs(l);return this.zo(e,o,c,r,u).then((h=>(ae(n0,`Received RPC '${e}' ${a}: `,h),h)),(h=>{throw wo(n0,`RPC '${e}' ${a} failed with error: `,h,"url: ",o,"request:",r),h}))}jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+qo})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),r&&r.headers.forEach(((i,s)=>e[s]=i))}Qo(e,t){const r=rN[e];let i=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}class sN{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const dn="WebChannelConnection",Ic=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(i){setTimeout((()=>{throw i}),0)}}))};class fo extends iN{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!fo.c_){const e=Yw();Ic(e,Kw.STAT_EVENT,(t=>{t.stat===U0.PROXY?ae(dn,"STAT_EVENT: detected buffering proxy"):t.stat===U0.NOPROXY&&ae(dn,"STAT_EVENT: detected no buffering proxy")})),fo.c_=!0}}zo(e,t,r,i,s){const a=cp();return new Promise(((o,c)=>{const l=new Gw;l.setWithCredentials(!0),l.listenOnce(qw.COMPLETE,(()=>{try{switch(l.getLastErrorCode()){case vh.NO_ERROR:const h=l.getResponseJson();ae(dn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(h)),o(h);break;case vh.TIMEOUT:ae(dn,`RPC '${e}' ${a} timed out`),c(new de(ne.DEADLINE_EXCEEDED,"Request time out"));break;case vh.HTTP_ERROR:const d=l.getStatus();if(ae(dn,`RPC '${e}' ${a} failed with status:`,d,"response text:",l.getResponseText()),d>0){let p=l.getResponseJson();Array.isArray(p)&&(p=p[0]);const g=p?.error;if(g&&g.status&&g.message){const m=(function(E){const I=E.toLowerCase().replace(/_/g,"-");return Object.values(ne).indexOf(I)>=0?I:ne.UNKNOWN})(g.status);c(new de(m,g.message))}else c(new de(ne.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new de(ne.UNAVAILABLE,"Connection failed."));break;default:Te(9055,{l_:e,streamId:a,h_:l.getLastErrorCode(),P_:l.getLastError()})}}finally{ae(dn,`RPC '${e}' ${a} completed.`)}}));const u=JSON.stringify(i);ae(dn,`RPC '${e}' ${a} sending request:`,i),l.send(t,"POST",u,r,15)}))}T_(e,t,r){const i=cp(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;const l=s.join("");ae(dn,`Creating RPC '${e}' stream ${i}: ${l}`,o);const u=a.createWebChannel(l,o);this.I_(u);let h=!1,d=!1;const p=new sN({Ho:g=>{d?ae(dn,`Not sending because RPC '${e}' stream ${i} is closed:`,g):(h||(ae(dn,`Opening RPC '${e}' stream ${i} transport.`),u.open(),h=!0),ae(dn,`RPC '${e}' stream ${i} sending:`,g),u.send(g))},Jo:()=>u.close()});return Ic(u,Oc.EventType.OPEN,(()=>{d||(ae(dn,`RPC '${e}' stream ${i} transport opened.`),p.i_())})),Ic(u,Oc.EventType.CLOSE,(()=>{d||(d=!0,ae(dn,`RPC '${e}' stream ${i} transport closed`),p.o_(),this.E_(u))})),Ic(u,Oc.EventType.ERROR,(g=>{d||(d=!0,wo(dn,`RPC '${e}' stream ${i} transport errored. Name:`,g.name,"Message:",g.message),p.o_(new de(ne.UNAVAILABLE,"The operation could not be completed")))})),Ic(u,Oc.EventType.MESSAGE,(g=>{if(!d){const m=g.data[0];Ae(!!m,16349);const _=m,E=_?.error||_[0]?.error;if(E){ae(dn,`RPC '${e}' stream ${i} received error:`,E);const I=E.status;let v=(function(O){const y=Ut[O];if(y!==void 0)return QT(y)})(I),R=E.message;I==="NOT_FOUND"&&R.includes("database")&&R.includes("does not exist")&&R.includes(this.databaseId.database)&&wo(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),v===void 0&&(v=ne.INTERNAL,R="Unknown error status: "+I+" with message "+E.message),d=!0,p.o_(new de(v,R)),u.close()}else ae(dn,`RPC '${e}' stream ${i} received:`,m),p.__(m)}})),fo.u_(),setTimeout((()=>{p.s_()}),0),p}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Xw()}}function aN(n){return new fo(n)}function Bb(){return typeof window<"u"?window:null}function Rh(){return typeof document<"u"?document:null}function sd(n){return new fL(n,!0)}fo.c_=!1;class Ub{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=i,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&ae("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const gy="PersistentStream";class Hb{constructor(e,t,r,i,s,a,o,c){this.Ci=e,this.b_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ub(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ne.RESOURCE_EXHAUSTED?(Mt(t.toString()),Mt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ne.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new de(ne.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.H_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return ae(gy,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(ae(gy,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class oN extends Hb{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=gL(this.serializer,e),r=(function(s){if(!("targetChange"in s))return ke.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?ke.min():a.readTime?Nn(a.readTime):ke.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=tp(this.serializer),t.addTarget=(function(s,a){let o;const c=a.target;if(o=ef(c)?{documents:sb(s,c)}:{query:ab(s,c).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=eb(s,a.resumeToken);const l=Z0(s,a.expectedCount);l!==null&&(o.expectedCount=l)}else if(a.snapshotVersion.compareTo(ke.min())>0){o.readTime=Lo(s,a.snapshotVersion.toTimestamp());const l=Z0(s,a.expectedCount);l!==null&&(o.expectedCount=l)}return o})(this.serializer,e);const r=_L(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=tp(this.serializer),t.removeTarget=e,this.K_(t)}}class cN extends Hb{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Ae(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ae(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ae(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=mL(e.writeResults,e.commitTime),r=Nn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=tp(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>sf(this.serializer,r)))};this.K_(t)}}class lN{}class uN extends lN{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new de(ne.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,a])=>this.connection.Wo(e,ep(t,r),i,s,a))).catch((s=>{throw s.name==="FirebaseError"?(s.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new de(ne.UNKNOWN,s.toString())}))}jo(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,o])=>this.connection.jo(e,ep(t,r),i,a,o,s))).catch((a=>{throw a.name==="FirebaseError"?(a.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new de(ne.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function hN(n,e,t,r){return new uN(n,e,t,r)}class fN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Mt(t),this.aa=!1):ae("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const ba="RemoteStore";class dN{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo((a=>{r.enqueueAndForget((async()=>{Ra(this)&&(ae(ba,"Restarting streams for network reachability change."),await(async function(c){const l=be(c);l.Ea.add(4),await fu(l),l.Va.set("Unknown"),l.Ea.delete(4),await ad(l)})(this))}))})),this.Va=new fN(r,i)}}async function ad(n){if(Ra(n))for(const e of n.Ra)await e(!0)}async function fu(n){for(const e of n.Ra)await e(!1)}function od(n,e){const t=be(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Mg(t)?Og(t):Qo(t).O_()&&Fg(t,e))}function Vo(n,e){const t=be(n),r=Qo(t);t.Ia.delete(e),r.O_()&&zb(t,e),t.Ia.size===0&&(r.O_()?r.L_():Ra(t)&&t.Va.set("Unknown"))}function Fg(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ke.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qo(n).Z_(e)}function zb(n,e){n.da.$e(e),Qo(n).X_(e)}function Og(n){n.da=new cL({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Qo(n).start(),n.Va.ua()}function Mg(n){return Ra(n)&&!Qo(n).x_()&&n.Ia.size>0}function Ra(n){return be(n).Ea.size===0}function $b(n){n.da=void 0}async function pN(n){n.Va.set("Online")}async function gN(n){n.Ia.forEach(((e,t)=>{Fg(n,e)}))}async function mN(n,e){$b(n),Mg(n)?(n.Va.ha(e),Og(n)):n.Va.set("Unknown")}async function _N(n,e,t){if(n.Va.set("Online"),e instanceof ZT&&e.state===2&&e.cause)try{await(async function(i,s){const a=s.cause;for(const o of s.targetIds)i.Ia.has(o)&&(await i.remoteSyncer.rejectListen(o,a),i.Ia.delete(o),i.da.removeTarget(o))})(n,e)}catch(r){ae(ba,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await df(n,r)}else if(e instanceof kh?n.da.Xe(e):e instanceof JT?n.da.st(e):n.da.tt(e),!t.isEqual(ke.min()))try{const r=await Pb(n.localStore);t.compareTo(r)>=0&&await(function(s,a){const o=s.da.Tt(a);return o.targetChanges.forEach(((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const u=s.Ia.get(l);u&&s.Ia.set(l,u.withResumeToken(c.resumeToken,a))}})),o.targetMismatches.forEach(((c,l)=>{const u=s.Ia.get(c);if(!u)return;s.Ia.set(c,u.withResumeToken(Vt.EMPTY_BYTE_STRING,u.snapshotVersion)),zb(s,c);const h=new di(u.target,c,l,u.sequenceNumber);Fg(s,h)})),s.remoteSyncer.applyRemoteEvent(o)})(n,t)}catch(r){ae(ba,"Failed to raise snapshot:",r),await df(n,r)}}async function df(n,e,t){if(!Ss(e))throw e;n.Ea.add(1),await fu(n),n.Va.set("Offline"),t||(t=()=>Pb(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{ae(ba,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ad(n)}))}function Wb(n,e){return e().catch((t=>df(n,t,e)))}async function Xo(n){const e=be(n),t=xs(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:sa;for(;xN(e);)try{const i=await tN(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,yN(e,i)}catch(i){await df(e,i)}jb(e)&&Gb(e)}function xN(n){return Ra(n)&&n.Ta.length<10}function yN(n,e){n.Ta.push(e);const t=xs(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function jb(n){return Ra(n)&&!xs(n).x_()&&n.Ta.length>0}function Gb(n){xs(n).start()}async function vN(n){xs(n).ra()}async function EN(n){const e=xs(n);for(const t of n.Ta)e.ea(t.mutations)}async function wN(n,e,t){const r=n.Ta.shift(),i=Eg.from(r,e,t);await Wb(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await Xo(n)}async function TN(n,e){e&&xs(n).Y_&&await(async function(r,i){if((function(a){return sL(a)&&a!==ne.ABORTED})(i.code)){const s=r.Ta.shift();xs(r).B_(),await Wb(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i))),await Xo(r)}})(n,e),jb(n)&&Gb(n)}async function my(n,e){const t=be(n);t.asyncQueue.verifyOperationInProgress(),ae(ba,"RemoteStore received new credentials");const r=Ra(t);t.Ea.add(3),await fu(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ad(t)}async function lp(n,e){const t=be(n);e?(t.Ea.delete(2),await ad(t)):e||(t.Ea.add(2),await fu(t),t.Va.set("Unknown"))}function Qo(n){return n.ma||(n.ma=(function(t,r,i){const s=be(t);return s.sa(),new oN(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:pN.bind(null,n),Yo:gN.bind(null,n),t_:mN.bind(null,n),J_:_N.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Mg(n)?Og(n):n.Va.set("Unknown")):(await n.ma.stop(),$b(n))}))),n.ma}function xs(n){return n.fa||(n.fa=(function(t,r,i){const s=be(t);return s.sa(),new cN(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:vN.bind(null,n),t_:TN.bind(null,n),ta:EN.bind(null,n),na:wN.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await Xo(n)):(await n.fa.stop(),n.Ta.length>0&&(ae(ba,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Lg{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Wr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,o=new Lg(e,t,a,i,s);return o.start(r),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new de(ne.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ng(n,e){if(Mt("AsyncQueue",`${e}: ${n}`),Ss(n))return new de(ne.UNAVAILABLE,`${e}: ${n}`);throw n}class po{static emptySet(e){return new po(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ye.comparator(t.key,r.key):(t,r)=>ye.comparator(t.key,r.key),this.keyedMap=Mc(),this.sortedSet=new gt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof po)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new po;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class _y{constructor(){this.ga=new gt(ye.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Te(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Bo{constructor(e,t,r,i,s,a,o,c,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach((o=>{a.push({type:0,doc:o})})),new Bo(e,t,po.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class bN{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class IN{constructor(){this.queries=xy(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=be(t),s=i.queries;i.queries=xy(),s.forEach(((a,o)=>{for(const c of o.ba)c.onError(r)}))})(this,new de(ne.ABORTED,"Firestore shutting down"))}}function xy(){return new Si((n=>LT(n)),Zf)}async function Vg(n,e){const t=be(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.Sa()&&e.Da()&&(r=2):(s=new bN,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await t.onListen(i,!0);break;case 1:s.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const o=Ng(a,`Initialization of query '${to(e.query)}' failed`);return void e.onError(o)}t.queries.set(i,s),s.ba.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&Ug(t)}async function Bg(n,e){const t=be(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const a=s.ba.indexOf(e);a>=0&&(s.ba.splice(a,1),s.ba.length===0?i=e.Da()?0:1:!s.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function AN(n,e){const t=be(n);let r=!1;for(const i of e){const s=i.query,a=t.queries.get(s);if(a){for(const o of a.ba)o.Fa(i)&&(r=!0);a.wa=i}}r&&Ug(t)}function SN(n,e,t){const r=be(n),i=r.queries.get(e);if(i)for(const s of i.ba)s.onError(t);r.queries.delete(e)}function Ug(n){n.Ca.forEach((e=>{e.next()}))}var up,yy;(yy=up||(up={})).Ma="default",yy.Cache="cache";class Hg{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Bo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Bo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==up.Cache}}class qb{constructor(e){this.key=e}}class Kb{constructor(e){this.key=e}}class kN{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=He(),this.mutatedKeys=He(),this.eu=VT(e),this.tu=new po(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new _y,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,o=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((u,h)=>{const d=i.get(u),p=cu(this.query,h)?h:null,g=!!d&&this.mutatedKeys.has(d.key),m=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let _=!1;d&&p?d.data.isEqual(p.data)?g!==m&&(r.track({type:3,doc:p}),_=!0):this.su(d,p)||(r.track({type:2,doc:p}),_=!0,(c&&this.eu(p,c)>0||l&&this.eu(p,l)<0)&&(o=!0)):!d&&p?(r.track({type:0,doc:p}),_=!0):d&&!p&&(r.track({type:1,doc:d}),_=!0,(c||l)&&(o=!0)),_&&(p?(a=a.add(p),s=m?s.add(u):s.delete(u)):(a=a.delete(u),s=s.delete(u)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const u=this.query.limitType==="F"?a.last():a.first();a=a.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{tu:a,iu:r,Ss:o,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((u,h)=>(function(p,g){const m=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Te(20277,{Vt:_})}};return m(p)-m(g)})(u.type,h.type)||this.eu(u.doc,h.doc))),this.ou(r),i=i??!1;const o=t&&!i?this._u():[],c=this.Ya.size===0&&this.current&&!i?1:0,l=c!==this.Xa;return this.Xa=c,a.length!==0||l?{snapshot:new Bo(this.query,e.tu,s,a,e.mutatedKeys,c===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new _y,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=He(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new Kb(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new qb(r))})),t}cu(e){this.Za=e.ks,this.Ya=He();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Bo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const Jo="SyncEngine";class CN{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class RN{constructor(e){this.key=e,this.hu=!1}}class PN{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Si((o=>LT(o)),Zf),this.Iu=new Map,this.Eu=new Set,this.Ru=new gt(ye.comparator),this.Au=new Map,this.Vu=new Sg,this.du={},this.mu=new Map,this.fu=Ta.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function DN(n,e,t=!0){const r=cd(n);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await Yb(r,e,t,!0),i}async function FN(n,e){const t=cd(n);await Yb(t,e,!0,!1)}async function Yb(n,e,t,r){const i=await uf(n.localStore,er(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t);let o;return r&&(o=await zg(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&od(n.remoteStore,i),o}async function zg(n,e,t,r,i){n.pu=(h,d,p)=>(async function(m,_,E,I){let v=_.view.ru(E);v.Ss&&(v=await ap(m.localStore,_.query,!1).then((({documents:y})=>_.view.ru(y,v))));const R=I&&I.targetChanges.get(_.targetId),F=I&&I.targetMismatches.get(_.targetId)!=null,O=_.view.applyChanges(v,m.isPrimaryClient,R,F);return hp(m,_.targetId,O.au),O.snapshot})(n,h,d,p);const s=await ap(n.localStore,e,!0),a=new kN(e,s.ks),o=a.ru(s.documents),c=hu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=a.applyChanges(o,n.isPrimaryClient,c);hp(n,t,l.au);const u=new CN(e,t,a);return n.Tu.set(e,u),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),l.snapshot}async function ON(n,e,t){const r=be(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((a=>!Zf(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await No(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Vo(r.remoteStore,i.targetId),Uo(r,i.targetId)})).catch(As)):(Uo(r,i.targetId),await No(r.localStore,i.targetId,!0))}async function MN(n,e){const t=be(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Vo(t.remoteStore,r.targetId))}async function LN(n,e,t){const r=Gg(n);try{const i=await(function(a,o){const c=be(a),l=st.now(),u=o.reduce(((p,g)=>p.add(g.key)),He());let h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",(p=>{let g=Zn(),m=He();return c.xs.getEntries(p,u).next((_=>{g=_,g.forEach(((E,I)=>{I.isValidDocument()||(m=m.add(E))}))})).next((()=>c.localDocuments.getOverlayedDocuments(p,g))).next((_=>{h=_;const E=[];for(const I of o){const v=rL(I,h.get(I.key).overlayedDocument);v!=null&&E.push(new ki(I.key,v,AT(v.value.mapValue),Yt.exists(!0)))}return c.mutationQueue.addMutationBatch(p,l,E,o)})).next((_=>{d=_;const E=_.applyToLocalDocumentSet(h,m);return c.documentOverlayCache.saveOverlays(p,_.batchId,E)}))})).then((()=>({batchId:d.batchId,changes:UT(h)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,o,c){let l=a.du[a.currentUser.toKey()];l||(l=new gt(De)),l=l.insert(o,c),a.du[a.currentUser.toKey()]=l})(r,i.batchId,t),await Cs(r,i.changes),await Xo(r.remoteStore)}catch(i){const s=Ng(i,"Failed to persist write");t.reject(s)}}async function Xb(n,e){const t=be(n);try{const r=await ZL(t.localStore,e);e.targetChanges.forEach(((i,s)=>{const a=t.Au.get(s);a&&(Ae(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Ae(a.hu,14607):i.removedDocuments.size>0&&(Ae(a.hu,42227),a.hu=!1))})),await Cs(t,r,e)}catch(r){await As(r)}}function vy(n,e,t){const r=be(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((s,a)=>{const o=a.view.va(e);o.snapshot&&i.push(o.snapshot)})),(function(a,o){const c=be(a);c.onlineState=o;let l=!1;c.queries.forEach(((u,h)=>{for(const d of h.ba)d.va(o)&&(l=!0)})),l&&Ug(c)})(r.eventManager,e),i.length&&r.Pu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function NN(n,e,t){const r=be(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),s=i&&i.key;if(s){let a=new gt(ye.comparator);a=a.insert(s,Pt.newNoDocument(s,ke.min()));const o=He().add(s),c=new uu(ke.min(),new Map,new gt(De),a,o);await Xb(r,c),r.Ru=r.Ru.remove(s),r.Au.delete(e),jg(r)}else await No(r.localStore,e,!1).then((()=>Uo(r,e,t))).catch(As)}async function VN(n,e){const t=be(n),r=e.batch.batchId;try{const i=await JL(t.localStore,e);Wg(t,r,null),$g(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Cs(t,i)}catch(i){await As(i)}}async function BN(n,e,t){const r=be(n);try{const i=await(function(a,o){const c=be(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",(l=>{let u;return c.mutationQueue.lookupMutationBatch(l,o).next((h=>(Ae(h!==null,37113),u=h.keys(),c.mutationQueue.removeMutationBatch(l,h)))).next((()=>c.mutationQueue.performConsistencyCheck(l))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,o))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u))).next((()=>c.localDocuments.getDocuments(l,u)))}))})(r.localStore,e);Wg(r,e,t),$g(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Cs(r,i)}catch(i){await As(i)}}function $g(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Wg(n,e,t){const r=be(n);let i=r.du[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.du[r.currentUser.toKey()]=i}}function Uo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||Qb(n,r)}))}function Qb(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Vo(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),jg(n))}function hp(n,e,t){for(const r of t)r instanceof qb?(n.Vu.addReference(r.key,e),UN(n,r)):r instanceof Kb?(ae(Jo,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Qb(n,r.key)):Te(19791,{wu:r})}function UN(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(ae(Jo,"New document in limbo: "+t),n.Eu.add(r),jg(n))}function jg(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new ye(tt.fromString(e)),r=n.fu.next();n.Au.set(r,new RN(t)),n.Ru=n.Ru.insert(t,r),od(n.remoteStore,new di(er(ou(t.path)),r,"TargetPurposeLimboResolution",Wn.ce))}}async function Cs(n,e,t){const r=be(n),i=[],s=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((o,c)=>{a.push(r.pu(c,e,t).then((l=>{if((l||t)&&r.isPrimaryClient){const u=l?!l.fromCache:t?.targetChanges.get(c.targetId)?.current;r.sharedClientState.updateQueryState(c.targetId,u?"current":"not-current")}if(l){i.push(l);const u=Rg.Es(c.targetId,l);s.push(u)}})))})),await Promise.all(a),r.Pu.J_(i),await(async function(c,l){const u=be(c);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",(h=>q.forEach(l,(d=>q.forEach(d.Ts,(p=>u.persistence.referenceDelegate.addReference(h,d.targetId,p))).next((()=>q.forEach(d.Is,(p=>u.persistence.referenceDelegate.removeReference(h,d.targetId,p)))))))))}catch(h){if(!Ss(h))throw h;ae(Pg,"Failed to update sequence numbers: "+h)}for(const h of l){const d=h.targetId;if(!h.fromCache){const p=u.vs.get(d),g=p.snapshotVersion,m=p.withLastLimboFreeSnapshotVersion(g);u.vs=u.vs.insert(d,m)}}})(r.localStore,s))}async function HN(n,e){const t=be(n);if(!t.currentUser.isEqual(e)){ae(Jo,"User change. New user:",e.toKey());const r=await Rb(t.localStore,e);t.currentUser=e,(function(s,a){s.mu.forEach((o=>{o.forEach((c=>{c.reject(new de(ne.CANCELLED,a))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Cs(t,r.Ns)}}function zN(n,e){const t=be(n),r=t.Au.get(e);if(r&&r.hu)return He().add(r.key);{let i=He();const s=t.Iu.get(e);if(!s)return i;for(const a of s){const o=t.Tu.get(a);i=i.unionWith(o.view.nu)}return i}}async function $N(n,e){const t=be(n),r=await ap(t.localStore,e.query,!0),i=e.view.cu(r);return t.isPrimaryClient&&hp(t,e.targetId,i.au),i}async function WN(n,e){const t=be(n);return Fb(t.localStore,e).then((r=>Cs(t,r)))}async function jN(n,e,t,r){const i=be(n),s=await(function(o,c){const l=be(o),u=be(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",(h=>u.Xn(h,c).next((d=>d?l.localDocuments.getDocuments(h,d):q.resolve(null)))))})(i.localStore,e);s!==null?(t==="pending"?await Xo(i.remoteStore):t==="acknowledged"||t==="rejected"?(Wg(i,e,r||null),$g(i,e),(function(o,c){be(be(o).mutationQueue).nr(c)})(i.localStore,e)):Te(6720,"Unknown batchState",{bu:t}),await Cs(i,s)):ae(Jo,"Cannot apply mutation batch with id: "+e)}async function GN(n,e){const t=be(n);if(cd(t),Gg(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),i=await Ey(t,r.toArray());t.gu=!0,await lp(t.remoteStore,!0);for(const s of i)od(t.remoteStore,s)}else if(e===!1&&t.gu!==!1){const r=[];let i=Promise.resolve();t.Iu.forEach(((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then((()=>(Uo(t,a),No(t.localStore,a,!0)))),Vo(t.remoteStore,a)})),await i,await Ey(t,r),(function(a){const o=be(a);o.Au.forEach(((c,l)=>{Vo(o.remoteStore,l)})),o.Vu.zr(),o.Au=new Map,o.Ru=new gt(ye.comparator)})(t),t.gu=!1,await lp(t.remoteStore,!1)}}async function Ey(n,e,t){const r=be(n),i=[],s=[];for(const a of e){let o;const c=r.Iu.get(a);if(c&&c.length!==0){o=await uf(r.localStore,er(c[0]));for(const l of c){const u=r.Tu.get(l),h=await $N(r,u);h.snapshot&&s.push(h.snapshot)}}else{const l=await Db(r.localStore,a);o=await uf(r.localStore,l),await zg(r,Jb(l),a,!1,o.resumeToken)}i.push(o)}return r.Pu.J_(s),i}function Jb(n){return OT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function qN(n){return(function(t){return be(be(t).persistence).hs()})(be(n).localStore)}async function KN(n,e,t,r){const i=be(n);if(i.gu)return void ae(Jo,"Ignoring unexpected query state notification.");const s=i.Iu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=await Fb(i.localStore,NT(s[0])),o=uu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Vt.EMPTY_BYTE_STRING);await Cs(i,a,o);break}case"rejected":await No(i.localStore,e,!0),Uo(i,e,r);break;default:Te(64155,t)}}async function YN(n,e,t){const r=cd(n);if(r.gu){for(const i of e){if(r.Iu.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){ae(Jo,"Adding an already active target "+i);continue}const s=await Db(r.localStore,i),a=await uf(r.localStore,s);await zg(r,Jb(s),a.targetId,!1,a.resumeToken),od(r.remoteStore,a)}for(const i of t)r.Iu.has(i)&&await No(r.localStore,i,!1).then((()=>{Vo(r.remoteStore,i),Uo(r,i)})).catch(As)}}function cd(n){const e=be(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=NN.bind(null,e),e.Pu.J_=AN.bind(null,e.eventManager),e.Pu.yu=SN.bind(null,e.eventManager),e}function Gg(n){const e=be(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=VN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=BN.bind(null,e),e}class Nl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sd(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Cb(this.persistence,new kb,e.initialUser,this.serializer)}Cu(e){return new kg(id.Vi,this.serializer)}Du(e){return new Vb}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Nl.provider={build:()=>new Nl};class XN extends Nl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Ae(this.persistence.referenceDelegate instanceof lf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new wb(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new kg((r=>lf.Vi(r,t)),this.serializer)}}class Zb extends Nl{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Gg(this.xu.syncEngine),await Xo(this.xu.remoteStore),await this.persistence.zi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return Cb(this.persistence,new kb,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new wb(r,e.asyncQueue,t)}Mu(e,t){const r=new rM(t,this.persistence);return new nM(e.asyncQueue,r)}Cu(e){const t=Sb(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new Cg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Bb(),Rh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Vb}}class QN extends Zb{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof t0&&(this.sharedClientState.syncEngine={So:jN.bind(null,t),Do:KN.bind(null,t),Co:YN.bind(null,t),hs:qN.bind(null,t),bo:WN.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi((async r=>{await GN(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))}Du(e){const t=Bb();if(!t0.v(t))throw new de(ne.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Sb(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new t0(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Vl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>vy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=HN.bind(null,this.syncEngine),await lp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new IN})()}createDatastore(e){const t=sd(e.databaseInfo.databaseId),r=aN(e.databaseInfo);return hN(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,s,a,o){return new dN(r,i,s,a,o)})(this.localStore,this.datastore,e.asyncQueue,(t=>vy(this.syncEngine,t,0)),(function(){return py.v()?new py:new nN})())}createSyncEngine(e,t){return(function(i,s,a,o,c,l,u){const h=new PN(i,s,a,o,c,l);return u&&(h.gu=!0),h})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=be(t);ae(ba,"RemoteStore shutting down."),r.Ea.add(5),await fu(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Vl.provider={build:()=>new Vl};class qg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Mt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const ys="FirestoreClient";class JN{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=i,this.user=mn.UNAUTHENTICATED,this.clientId=og.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async a=>{ae(ys,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(ae(ys,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ng(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function r0(n,e){n.asyncQueue.verifyOperationInProgress(),ae(ys,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await Rb(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function wy(n,e){n.asyncQueue.verifyOperationInProgress();const t=await ZN(n);ae(ys,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>my(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>my(e.remoteStore,i))),n._onlineComponents=e}async function ZN(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ae(ys,"Using user provided OfflineComponentProvider");try{await r0(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===ne.FAILED_PRECONDITION||i.code===ne.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;wo("Error using user provided cache. Falling back to memory cache: "+t),await r0(n,new Nl)}}else ae(ys,"Using default OfflineComponentProvider"),await r0(n,new XN(void 0));return n._offlineComponents}async function eI(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ae(ys,"Using user provided OnlineComponentProvider"),await wy(n,n._uninitializedComponentsProvider._online)):(ae(ys,"Using default OnlineComponentProvider"),await wy(n,new Vl))),n._onlineComponents}function e3(n){return eI(n).then((e=>e.syncEngine))}async function pf(n){const e=await eI(n),t=e.eventManager;return t.onListen=DN.bind(null,e.syncEngine),t.onUnlisten=ON.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=FN.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=MN.bind(null,e.syncEngine),t}function t3(n,e,t,r){const i=new qg(r),s=new Hg(e,i,t);return n.asyncQueue.enqueueAndForget((async()=>Vg(await pf(n),s))),()=>{i.Nu(),n.asyncQueue.enqueueAndForget((async()=>Bg(await pf(n),s)))}}function tI(n,e,t={}){const r=new Wr;return n.asyncQueue.enqueueAndForget((async()=>(function(s,a,o,c,l){const u=new qg({next:d=>{u.Nu(),a.enqueueAndForget((()=>Bg(s,h)));const p=d.docs.has(o);!p&&d.fromCache?l.reject(new de(ne.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&d.fromCache&&c&&c.source==="server"?l.reject(new de(ne.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new Hg(ou(o.path),u,{includeMetadataChanges:!0,Ka:!0});return Vg(s,h)})(await pf(n),n.asyncQueue,e,t,r))),r.promise}function n3(n,e,t={}){const r=new Wr;return n.asyncQueue.enqueueAndForget((async()=>(function(s,a,o,c,l){const u=new qg({next:d=>{u.Nu(),a.enqueueAndForget((()=>Bg(s,h))),d.fromCache&&c.source==="server"?l.reject(new de(ne.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new Hg(o,u,{includeMetadataChanges:!0,Ka:!0});return Vg(s,h)})(await pf(n),n.asyncQueue,e,t,r))),r.promise}function r3(n,e){const t=new Wr;return n.asyncQueue.enqueueAndForget((async()=>LN(await e3(n),e,t))),t.promise}function nI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const i3="ComponentProvider",Ty=new Map;function s3(n,e,t,r,i){return new PM(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,nI(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}const a3="firestore.googleapis.com",by=!0;class Iy{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new de(ne.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=a3,this.ssl=by}else this.host=e.host,this.ssl=e.ssl??by;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=_b;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Eb)throw new de(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}JO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nI(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new de(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new de(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new de(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Kg{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Iy({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new de(ne.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new de(ne.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Iy(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new $O;switch(r.type){case"firstParty":return new GO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new de(ne.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Ty.get(t);r&&(ae(i3,"Removing Datastore"),Ty.delete(t),r.terminate())})(this),Promise.resolve()}}class Ci{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ci(this.firestore,e,this._query)}}class kt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new kt(this.firestore,e,this._key)}toJSON(){return{type:kt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(iu(t,kt._jsonSchema))return new kt(e,r||null,new ye(tt.fromString(t.referencePath)))}}kt._jsonSchemaVersion="firestore/documentReference/1.0",kt._jsonSchema={type:$t("string",kt._jsonSchemaVersion),referencePath:$t("string")};class hs extends Ci{constructor(e,t,r){super(e,t,ou(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new kt(this.firestore,null,new ye(e))}withConverter(e){return new hs(this.firestore,e,this._path)}}function Ye(n,e,...t){if(n=vt(n),Zw("collection","path",e),n instanceof Kg){const r=tt.fromString(e,...t);return gx(r),new hs(n,null,r)}{if(!(n instanceof kt||n instanceof hs))throw new de(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(tt.fromString(e,...t));return gx(r),new hs(n.firestore,null,r)}}function pt(n,e,...t){if(n=vt(n),arguments.length===1&&(e=og.newId()),Zw("doc","path",e),n instanceof Kg){const r=tt.fromString(e,...t);return px(r),new kt(n,null,new ye(r))}{if(!(n instanceof kt||n instanceof hs))throw new de(ne.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(tt.fromString(e,...t));return px(r),new kt(n.firestore,n instanceof hs?n.converter:null,new ye(r))}}const Ay="AsyncQueue";class Sy{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ub(this,"async_queue_retry"),this._c=()=>{const r=Rh();r&&ae(Ay,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Rh();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Rh();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Wr;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Ss(e))throw e;ae(Ay,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Mt("INTERNAL UNHANDLED ERROR: ",ky(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Lg.createAndSchedule(this,e,t,r,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&Te(47125,{Pc:ky(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ky(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class kr extends Kg{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Sy,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Sy(e),this._firestoreClient=void 0,await e}}}function o3(n,e,t){t||(t=Zh);const r=Hf(n,"firestore");if(r.isInitialized(t)){const i=r.getImmediate({identifier:t}),s=r.getOptions(t);if(pa(s,e))return i;throw new de(ne.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new de(ne.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Eb)throw new de(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&bs(e.host)&&Kp(e.host),r.initialize({options:e,instanceIdentifier:t})}function Zo(n){if(n._terminated)throw new de(ne.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||c3(n),n._firestoreClient}function c3(n){const e=n._freezeSettings(),t=s3(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new JN(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}class lr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lr(Vt.fromBase64String(e))}catch(t){throw new de(ne.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lr(Vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(iu(e,lr._jsonSchema))return lr.fromBase64String(e.bytes)}}lr._jsonSchemaVersion="firestore/bytes/1.0",lr._jsonSchema={type:$t("string",lr._jsonSchemaVersion),bytes:$t("string")};class ld{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new de(ne.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new St(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ud{constructor(e){this._methodName=e}}class jr{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new de(ne.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new de(ne.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return De(this._lat,e._lat)||De(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jr._jsonSchemaVersion}}static fromJSON(e){if(iu(e,jr._jsonSchema))return new jr(e.latitude,e.longitude)}}jr._jsonSchemaVersion="firestore/geoPoint/1.0",jr._jsonSchema={type:$t("string",jr._jsonSchemaVersion),latitude:$t("number"),longitude:$t("number")};class Ir{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ir._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(iu(e,Ir._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ir(e.vectorValues);throw new de(ne.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ir._jsonSchemaVersion="firestore/vectorValue/1.0",Ir._jsonSchema={type:$t("string",Ir._jsonSchemaVersion),vectorValues:$t("object")};const l3=/^__.*__$/;class u3{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ki(e,this.data,this.fieldMask,t,this.fieldTransforms):new Yo(e,this.data,t,this.fieldTransforms)}}class rI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ki(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function iI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Te(40011,{dataSource:n})}}class Yg{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new Yg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return gf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(iI(this.dataSource)&&l3.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class h3{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||sd(e)}createContext(e,t,r,i=!1){return new Yg({dataSource:e,methodName:t,targetDoc:r,path:St.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function du(n){const e=n._freezeSettings(),t=sd(n._databaseId);return new h3(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Xg(n,e,t,r,i,s={}){const a=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);Jg("Data must be an object, but it was:",a,r);const o=oI(r,a);let c,l;if(s.merge)c=new jn(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=Ia(e,h,t);if(!a.contains(d))throw new de(ne.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);uI(u,d)||u.push(d)}c=new jn(u),l=a.fieldTransforms.filter((h=>c.covers(h.field)))}else c=null,l=a.fieldTransforms;return new u3(new En(o),c,l)}class hd extends ud{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hd}}class Qg extends ud{_toFieldTransform(e){return new qT(e.path,new Fo)}isEqual(e){return e instanceof Qg}}function sI(n,e,t,r){const i=n.createContext(1,e,t);Jg("Data must be an object, but it was:",i,r);const s=[],a=En.empty();ks(r,((c,l)=>{const u=lI(e,c,t);l=vt(l);const h=i.childContextForFieldPath(u);if(l instanceof hd)s.push(u);else{const d=pu(l,h);d!=null&&(s.push(u),a.set(u,d))}}));const o=new jn(s);return new rI(a,o,i.fieldTransforms)}function aI(n,e,t,r,i,s){const a=n.createContext(1,e,t),o=[Ia(e,r,t)],c=[i];if(s.length%2!=0)throw new de(ne.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)o.push(Ia(e,s[d])),c.push(s[d+1]);const l=[],u=En.empty();for(let d=o.length-1;d>=0;--d)if(!uI(l,o[d])){const p=o[d];let g=c[d];g=vt(g);const m=a.childContextForFieldPath(p);if(g instanceof hd)l.push(p);else{const _=pu(g,m);_!=null&&(l.push(p),u.set(p,_))}}const h=new jn(l);return new rI(u,h,a.fieldTransforms)}function f3(n,e,t,r=!1){return pu(t,n.createContext(r?4:3,e))}function pu(n,e){if(cI(n=vt(n)))return Jg("Unsupported field value:",e,n),oI(n,e);if(n instanceof ud)return(function(r,i){if(!iI(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,i){const s=[];let a=0;for(const o of r){let c=pu(o,i.childContextForArray(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=vt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return QM(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=st.fromDate(r);return{timestampValue:Lo(i.serializer,s)}}if(r instanceof st){const s=new st(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Lo(i.serializer,s)}}if(r instanceof jr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof lr)return{bytesValue:eb(i.serializer,r._byteString)};if(r instanceof kt){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:bg(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ir)return(function(a,o){const c=a instanceof Ir?a.toArray():a;return{mapValue:{fields:{[gg]:{stringValue:mg},[Co]:{arrayValue:{values:c.map((u=>{if(typeof u!="number")throw o.createError("VectorValues must only contain numeric values.");return yg(o.serializer,u)}))}}}}}})(r,i);if(hb(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${jf(r)}`)})(n,e)}function oI(n,e){const t={};return _T(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ks(n,((r,i)=>{const s=pu(i,e.childContextForField(r));s!=null&&(t[r]=s)})),{mapValue:{fields:t}}}function cI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof st||n instanceof jr||n instanceof lr||n instanceof kt||n instanceof ud||n instanceof Ir||hb(n))}function Jg(n,e,t){if(!cI(t)||!eT(t)){const r=jf(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Ia(n,e,t){if((e=vt(e))instanceof ld)return e._internalPath;if(typeof e=="string")return lI(n,e);throw gf("Field path arguments must be of type string or ",n,!1,void 0,t)}const d3=new RegExp("[~\\*/\\[\\]]");function lI(n,e,t){if(e.search(d3)>=0)throw gf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ld(...e.split("."))._internalPath}catch{throw gf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function gf(n,e,t,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${r}`),a&&(c+=` in document ${i}`),c+=")"),new de(ne.INVALID_ARGUMENT,o+n+c)}function uI(n,e){return n.some((t=>t.isEqual(e)))}class p3{convertValue(e,t="none"){switch(ms(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Te(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ks(e,((i,s)=>{r[i]=this.convertValue(s,t)})),r}convertVectorValue(e){const t=e.fields?.[Co].arrayValue?.values?.map((r=>Tt(r.doubleValue)));return new Ir(t)}convertGeoPoint(e){return new jr(Tt(e.latitude),Tt(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Qf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Pl(e));default:return null}}convertTimestamp(e){const t=vi(e);return new st(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=tt.fromString(e);Ae(ub(r),9688,{name:e});const i=new ya(r.get(1),r.get(3)),s=new ye(r.popFirst(5));return i.isEqual(t)||Mt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Zg extends p3{constructor(e){super(),this.firestore=e}convertBytes(e){return new lr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new kt(this.firestore,null,t)}}function wi(){return new Qg("serverTimestamp")}const Cy="@firebase/firestore",Ry="4.12.0";function Py(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}class hI{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new kt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new g3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(Ia("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class g3 extends hI{data(){return super.data()}}function fI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new de(ne.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class em{}class tm extends em{}function an(n,e,...t){let r=[];e instanceof em&&r.push(e),r=r.concat(t),(function(s){const a=s.filter((c=>c instanceof mu)).length,o=s.filter((c=>c instanceof gu)).length;if(a>1||a>0&&o>0)throw new de(ne.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class gu extends tm{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new gu(e,t,r)}_apply(e){const t=this._parse(e);return dI(e._query,t),new Ci(e.firestore,e.converter,J0(e._query,t))}_parse(e){const t=du(e.firestore);return(function(s,a,o,c,l,u,h){let d;if(l.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new de(ne.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){Fy(h,u);const g=[];for(const m of h)g.push(Dy(c,s,m));d={arrayValue:{values:g}}}else d=Dy(c,s,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||Fy(h,u),d=f3(o,a,h,u==="in"||u==="not-in");return je.create(l,u,d)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Qt(n,e,t){const r=e,i=Ia("where",n);return gu._create(i,r,t)}class mu extends em{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new mu(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:at.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let a=i;const o=s.getFlattenedFilters();for(const c of o)dI(a,c),a=J0(a,c)})(e._query,t),new Ci(e.firestore,e.converter,J0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function m3(...n){return n.forEach((e=>_3("or",e))),mu._create("or",n)}class nm extends tm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new nm(e,t)}_apply(e){const t=(function(i,s,a){if(i.startAt!==null)throw new de(ne.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new de(ne.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ml(s,a)})(e._query,this._field,this._direction);return new Ci(e.firestore,e.converter,jM(e._query,t))}}function Ti(n,e="asc"){const t=e,r=Ia("orderBy",n);return nm._create(r,t)}class rm extends tm{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new rm(e,t,r)}_apply(e){return new Ci(e.firestore,e.converter,nf(e._query,this._limit,this._limitType))}}function Bl(n){return ZO("limit",n),rm._create("limit",n,"F")}function Dy(n,e,t){if(typeof(t=vt(t))=="string"){if(t==="")throw new de(ne.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!MT(e)&&t.indexOf("/")!==-1)throw new de(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(tt.fromString(t));if(!ye.isDocumentKey(r))throw new de(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fl(n,new ye(r))}if(t instanceof kt)return Fl(n,t._key);throw new de(ne.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jf(t)}.`)}function Fy(n,e){if(!Array.isArray(n)||n.length===0)throw new de(ne.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dI(n,e){const t=(function(i,s){for(const a of i)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new de(ne.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new de(ne.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function _3(n,e){if(!(e instanceof gu||e instanceof mu))throw new de(ne.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function im(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class x3{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=w3(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function y3(n){return new x3(n)}class v3{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vl.provider,this._offlineComponentProvider={build:t=>new Zb(t,e?.cacheSizeBytes,this.forceOwnership)}}}class E3{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vl.provider,this._offlineComponentProvider={build:t=>new QN(t,e?.cacheSizeBytes)}}}function w3(n){return new v3(n?.forceOwnership)}function T3(){return new E3}class Vc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ca extends hI{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ph(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ia("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new de(ne.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ca._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ca._jsonSchemaVersion="firestore/documentSnapshot/1.0",ca._jsonSchema={type:$t("string",ca._jsonSchemaVersion),bundleSource:$t("string","DocumentSnapshot"),bundleName:$t("string"),bundle:$t("string")};class Ph extends ca{data(e={}){return super.data(e)}}class la{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Vc(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ph(this._firestore,this._userDataWriter,r.key,r,new Vc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new de(ne.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map((o=>{const c=new Ph(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Vc(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((o=>s||o.type!==3)).map((o=>{const c=new Ph(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Vc(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,u=-1;return o.type!==0&&(l=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),u=a.indexOf(o.doc.key)),{type:b3(o.type),doc:c,oldIndex:l,newIndex:u}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new de(ne.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=la._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=og.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function b3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Te(61501,{type:n})}}la._jsonSchemaVersion="firestore/querySnapshot/1.0",la._jsonSchema={type:$t("string",la._jsonSchemaVersion),bundleSource:$t("string","QuerySnapshot"),bundleName:$t("string"),bundle:$t("string")};class I3{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=du(e)}set(e,t,r){this._verifyNotCommitted();const i=i0(e,this._firestore),s=im(i.converter,t,r),a=Xg(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,Yt.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=i0(e,this._firestore);let a;return a=typeof(t=vt(t))=="string"||t instanceof ld?aI(this._dataReader,"WriteBatch.update",s._key,t,r,i):sI(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Yt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=i0(e,this._firestore);return this._mutations=this._mutations.concat(new lu(t._key,Yt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new de(ne.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function i0(n,e){if((n=vt(n)).firestore!==e)throw new de(ne.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Ri(n){n=In(n,kt);const e=In(n.firestore,kr),t=Zo(e);return tI(t,n._key).then((r=>sm(e,n,r)))}function Oy(n){n=In(n,kt);const e=In(n.firestore,kr),t=Zo(e);return tI(t,n._key,{source:"server"}).then((r=>sm(e,n,r)))}function Nt(n){n=In(n,Ci);const e=In(n.firestore,kr),t=Zo(e),r=new Zg(e);return fI(n._query),n3(t,n._query).then((i=>new la(e,r,n,i)))}function ec(n,e,t){n=In(n,kt);const r=In(n.firestore,kr),i=im(n.converter,e,t),s=du(r);return xu(r,[Xg(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Yt.none())])}function Pa(n,e,t,...r){n=In(n,kt);const i=In(n.firestore,kr),s=du(i);let a;return a=typeof(e=vt(e))=="string"||e instanceof ld?aI(s,"updateDoc",n._key,e,t,r):sI(s,"updateDoc",n._key,e),xu(i,[a.toMutation(n._key,Yt.exists(!0))])}function _u(n){return xu(In(n.firestore,kr),[new lu(n._key,Yt.none())])}function qr(n,e){const t=In(n.firestore,kr),r=pt(n),i=im(n.converter,e),s=du(n.firestore);return xu(t,[Xg(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Yt.exists(!1))]).then((()=>r))}function fd(n,...e){n=vt(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Py(e[r])||(t=e[r++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Py(e[r])){const l=e[r];e[r]=l.next?.bind(l),e[r+1]=l.error?.bind(l),e[r+2]=l.complete?.bind(l)}let s,a,o;if(n instanceof kt)a=In(n.firestore,kr),o=ou(n._key.path),s={next:l=>{e[r]&&e[r](sm(a,n,l))},error:e[r+1],complete:e[r+2]};else{const l=In(n,Ci);a=In(l.firestore,kr),o=l._query;const u=new Zg(a);s={next:h=>{e[r]&&e[r](new la(a,u,l,h))},error:e[r+1],complete:e[r+2]},fI(n._query)}const c=Zo(a);return t3(c,o,i,s)}function xu(n,e){const t=Zo(n);return r3(t,e)}function sm(n,e,t){const r=t.docs.get(e._key),i=new Zg(n);return new ca(n,i,e._key,r,new Vc(t.hasPendingWrites,t.fromCache),e.converter)}function A3(n){return n=In(n,kr),Zo(n),new I3(n,(e=>xu(n,e)))}(function(e,t=!0){HO(jo),ga(new gs("firestore",((r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),o=new kr(new WO(r.getProvider("auth-internal")),new qO(a,r.getProvider("app-check-internal")),DM(a,i),a);return s={useFetchStreams:t,...s},o._setSettings(s),o}),"PUBLIC").setMultipleInstances(!0)),Hr(Cy,Ry,e),Hr(Cy,Ry,"esm2020")})();const S3={apiKey:"AIzaSyCxmEGkmrfRAmkxyHcni8MWitJSNYxAsEY",authDomain:"golf-handicap-tracker-b677c.firebaseapp.com",projectId:"golf-handicap-tracker-b677c",storageBucket:"golf-handicap-tracker-b677c.firebasestorage.app",messagingSenderId:"846253855684",appId:"1:846253855684:web:c5a0bc51550086f54d4a91"},pI=ow(S3),Gi=BO(pI),Ie=o3(pI,{localCache:y3({tabManager:T3()})});let s0=!1,Ac=null;function k3(n){Ac=n,P.btnRegister&&P.btnRegister.addEventListener("click",()=>{s0=!0,P.registerFields.classList.remove("hidden"),P.btnLogin.style.display="none",P.btnRegister.style.display="none",P.authSwitchBack.classList.remove("hidden");const s=document.createElement("button");s.type="submit",s.className="btn btn-primary",s.textContent="Create Account",s.id="temp-submit-register",P.authForm.appendChild(s)}),P.linkBackLogin&&P.linkBackLogin.addEventListener("click",s=>{s.preventDefault(),s0=!1,P.registerFields.classList.add("hidden"),P.btnLogin.style.display="block",P.btnRegister.style.display="block",P.authSwitchBack.classList.add("hidden");const a=document.getElementById("temp-submit-register");a&&a.remove()}),P.authForm&&P.authForm.addEventListener("submit",async s=>{s.preventDefault(),P.authError.classList.add("hidden");const a=document.getElementById("auth-email").value,o=document.getElementById("auth-password").value;try{if(s0){const c=document.getElementById("auth-name").value;if(!c)throw new Error("Please provide a display name.");const l=await wF(Gi,a,o);await IF(l.user,{displayName:c});const u=pt(Ie,"preapproved_emails",a.toLowerCase()),d=(await Ri(u)).exists();await ec(pt(Ie,"users",l.user.uid),{uid:l.user.uid,email:a,displayName:c,isApproved:d,isAdmin:!1,isCoach:!1,coaches:[],createdAt:wi()})}else await TF(Gi,a,o)}catch(c){P.authError.textContent=c.message,P.authError.classList.remove("hidden")}}),P.btnLogout&&P.btnLogout.addEventListener("click",()=>tx(Gi)),P.btnPendingLogout&&P.btnPendingLogout.addEventListener("click",()=>tx(Gi));const e=document.getElementById("link-forgot-password"),t=document.getElementById("forgot-password-section"),r=document.getElementById("forgot-password-form"),i=document.getElementById("forgot-password-msg");e&&t&&e.addEventListener("click",s=>{s.preventDefault(),t.classList.toggle("hidden")}),r&&r.addEventListener("submit",async s=>{s.preventDefault();const a=document.getElementById("forgot-email").value.trim();if(a){try{await rg(Gi,a),i.textContent=" Reset email sent! Check your inbox.",i.style.color="#10b981"}catch(o){i.textContent=" "+o.message,i.style.color="#ef4444"}i.classList.remove("hidden")}}),kF(Gi,async s=>{if(s){H.currentUser=s;try{let a=pt(Ie,"users",s.uid),o=await Oy(a),c=0;for(;!o.exists()&&c<3;)await new Promise(l=>setTimeout(l,500)),o=await Oy(a),c++;if(o.exists()){const l=o.data();{P.authOverlay.classList.add("hidden"),P.authPending.classList.add("hidden"),P.mainApp.classList.remove("hidden"),H.viewingPlayerId=s.uid,window.currentUserIsAdmin=l.isAdmin||!1,window.currentUserIsCoach=l.isCoach||!1,s.isCoach=l.isCoach||!1,s.isAdmin=l.isAdmin||!1,H.currentUser=s,P.tabBtnAdmin.classList.remove("hidden"),document.getElementById("tab-btn-coach").classList.remove("hidden");const u=document.getElementById("tab-btn-feed");u&&u.classList.remove("hidden"),Ac&&Ac()}}else P.authOverlay.classList.add("hidden"),P.mainApp.classList.add("hidden"),P.authPending.classList.remove("hidden")}catch(a){console.error("Auth read explicitly failed (forcing bypass)",a),P.authOverlay.classList.add("hidden"),P.authPending.classList.add("hidden"),P.mainApp.classList.remove("hidden"),P.loggedInUserNameEl.textContent=s.displayName||s.email,H.viewingPlayerId=s.uid,window.currentUserIsAdmin=!0,Ac&&Ac()}}else H.currentUser=null,H.viewingPlayerId=null,P.authOverlay.classList.remove("hidden"),P.mainApp.classList.add("hidden"),P.authPending.classList.add("hidden")})}let a0=null;function C3(n){return n<3?null:n===3?{use:1,adj:-2}:n===4?{use:1,adj:-1}:n===5?{use:1,adj:0}:n===6?{use:2,adj:-1}:n>=7&&n<=8?{use:2,adj:0}:n>=9&&n<=11?{use:3,adj:0}:n>=12&&n<=14?{use:4,adj:0}:n>=15&&n<=16?{use:5,adj:0}:n>=17&&n<=18?{use:6,adj:0}:{use:8,adj:0}}function am(n,e,t,r){if(!n||isNaN(n)||n===0||!e||!t)return 0;let i=Math.floor(r/18),s=r%18;t<=s&&(i+=1);let a=n-i,o=e-a+2;return Math.max(0,o)}function om(n,e,t){return t+e-(n-36)}function R3(n){if(!n||n.length===0)return{index:0,usedIds:[]};const e=n.filter(l=>l.notCounting!==!0).map(l=>{const u=113/l.slope*(l.adjustedGross-l.rating);return{id:l.id,diff:u}});if(e.length<3)return{index:0,usedIds:[]};const t=Math.min(e.length,20),r=C3(t),a=[...e.slice(0,t)].sort((l,u)=>l.diff-u.diff).slice(0,r.use);let c=a.reduce((l,u)=>l+u.diff,0)/r.use;return c+=r.adj,c>54&&(c=54),{index:Math.max(0,c).toFixed(1),usedIds:a.map(l=>l.id)}}function gI(){if(a0&&a0(),H.viewingPlayerId===null){H.currentRounds=[];return}const n=an(Ye(Ie,"whs_rounds"),Qt("uid","==",H.viewingPlayerId),Ti("date","desc"));P.loadingState&&P.loadingState.classList.remove("hidden"),P.emptyState&&P.emptyState.classList.add("hidden"),a0=fd(n,async e=>{P.loadingState&&P.loadingState.classList.add("hidden");const t=[];e.forEach(s=>{t.push({id:s.id,...s.data()})});const{index:r,usedIds:i}=R3(t);H.usedIds=i,H.handicapIndex=r,H.currentRounds=t,H.currentUser&&H.viewingPlayerId===H.currentUser.uid&&P3(r)},e=>{console.error("WHS Listen Error:",e),P.loadingState&&P.loadingState.classList.add("hidden")})}async function P3(n){if(H.currentUser)try{const e=pt(Ie,"profiles",H.currentUser.uid),t=await Ri(e);if(t.exists()){let r=t.data().indexHistory||[];const i=new Date().toISOString();(r.length===0||r[r.length-1].index!==n)&&(r.push({date:i,index:n}),r.length>50&&r.shift(),await Pa(e,{handicapIndex:n,indexHistory:r}))}else await ec(e,{handicapIndex:n,indexHistory:[{date:new Date().toISOString(),index:n}]},{merge:!0})}catch(e){console.error("Failed to update profile handicap array:",e)}}async function D3(n,e,t,r,i=null){try{const s={uid:H.currentUser.uid,course:n,rating:e,slope:t,adjustedGross:r,date:wi(),notCounting:!1};return i&&(i.putts||i.fwy||i.gir)&&(s.stats=i),await qr(Ye(Ie,"whs_rounds"),s),!0}catch(s){return console.error("Error adding document: ",s),!1}}window.deleteWhsRound=async function(n){confirm("Are you sure you want to delete this round?")&&await _u(pt(Ie,"whs_rounds",n))};window.toggleCountingRules=async function(n){const e=H.currentRounds.find(r=>r.id===n);if(!e)return;const t=e.notCounting===!0;H.currentUser&&(H.currentUser.uid===e.uid||window.currentUserIsAdmin)?await Pa(pt(Ie,"whs_rounds",n),{notCounting:!t}):alert("Permission denied")};let o0=null,Ul=null;function F3(){O3(),N3(),V3(),B3(),P.compSelect&&P.compSelect.addEventListener("change",n=>{mI(n.target.value)})}function O3(){if(!H.currentUser)return;const n=an(Ye(Ie,"competitions"),m3(Qt("visibility","==","public"),Qt("ownerId","==",H.currentUser.uid),Qt("invitedUIDs","array-contains",H.currentUser.uid)),Ti("createdAt","desc"));fd(n,e=>{P.compSelect.innerHTML='<option value="" disabled selected>-- Select a Competition --</option>',P.ocLinkComp&&(P.ocLinkComp.innerHTML='<option value="">-- No Competition Linked --</option>'),e.forEach(t=>{const r=t.data(),i=document.createElement("option");if(i.value=t.id,i.textContent=`${r.name} ${r.visibility==="private"?"":""}`,i.setAttribute("data-rules",JSON.stringify(r.rules||[])),i.setAttribute("data-name",r.name),P.compSelect.appendChild(i),P.ocLinkComp){const s=i.cloneNode(!0);P.ocLinkComp.appendChild(s)}}),Ul&&(P.compSelect.value=Ul)})}function mI(n){if(Ul=n,H.activeCompId=n,!n||!P.compSelect||P.compSelect.selectedIndex<=0){P.logCompRoundContainer&&P.logCompRoundContainer.classList.add("hidden");return}const e=P.compSelect.options[P.compSelect.selectedIndex],t=JSON.parse(e.getAttribute("data-rules")||"[]");if(H.currentCompData={name:e.getAttribute("data-name"),rules:t},P.logCompRoundContainer&&(P.logCompRoundContainer.classList.remove("hidden"),P.logCompRoundForm)){P.logCompRoundForm.reset();const r=document.getElementById("log-comp-dynamic");r&&(r.innerHTML=""),M3(t)}typeof My=="function"&&My(n)}function M3(n){const e=document.getElementById("log-comp-dynamic");e.innerHTML="",n.forEach(t=>{const r=document.createElement("div");r.className="form-group",r.innerHTML=`
            <label>${t.name}</label>
            <div style="display:flex; align-items:center;">
                <button type="button" class="btn btn-secondary stepper-minus" style="font-size:1.5rem; padding:0 15px; border-radius:12px 0 0 12px; height:50px;">-</button>
                <input type="number" class="dynamic-rule-input" data-rulename="${t.name}" data-rulepts="${t.pts}" value="0" style="text-align:center; border-radius:0; height:50px; flex:1;" readonly>
                <button type="button" class="btn btn-secondary stepper-plus" style="font-size:1.5rem; padding:0 15px; border-radius:0 12px 12px 0; height:50px;">+</button>
            </div>
        `,e.appendChild(r)}),e.querySelectorAll(".stepper-minus").forEach(t=>{t.addEventListener("click",r=>{const i=r.target.nextElementSibling,s=parseInt(i.value)||0;s>0&&(i.value=s-1)})}),e.querySelectorAll(".stepper-plus").forEach(t=>{t.addEventListener("click",r=>{const i=r.target.previousElementSibling,s=parseInt(i.value)||0;i.value=s+1})})}function My(n){o0&&o0();const e=an(Ye(Ie,"comp_rounds"),Qt("compId","==",n),Ti("date","desc"));o0=fd(e,t=>{H.currentCompRounds=[],t.forEach(r=>{H.currentCompRounds.push({id:r.id,...r.data()})}),_I(),L3()})}function _I(){if(P.compLeaderboardHead.innerHTML="",P.compLeaderboardTbody.innerHTML="",!H.currentCompRounds.length||!H.currentCompData)return;const n=document.createElement("tr");n.innerHTML='<th>Rank</th><th style="cursor:pointer" data-sort="name">Player </th><th style="cursor:pointer; background:#f0fdf4;" data-sort="pts">Pts </th><th style="cursor:pointer" data-sort="rounds">Rds </th>',H.currentCompData.rules.forEach(s=>{n.innerHTML+=`<th style="cursor:pointer" data-sort="${s.name}">${s.name} </th>`}),P.compLeaderboardHead.appendChild(n);const e={};H.currentCompRounds.forEach(s=>{if(e[s.uid]||(e[s.uid]={name:s.playerName,totalPoints:0,rounds:0,counts:{}},H.currentCompData.rules.forEach(a=>e[s.uid].counts[a.name]=0)),e[s.uid].totalPoints+=s.totalPoints||0,e[s.uid].rounds+=1,s.ruleCounts)for(const a in s.ruleCounts)e[s.uid].counts[a]!==void 0&&(e[s.uid].counts[a]+=s.ruleCounts[a])});let t=Object.values(e);const r=window.currentCompSortField||"pts",i=window.currentCompSortAsc===!0;t.sort((s,a)=>{let o,c;return r==="name"?(o=s.name.toLowerCase(),c=a.name.toLowerCase()):r==="pts"?(o=s.totalPoints,c=a.totalPoints):r==="rounds"?(o=s.rounds,c=a.rounds):(o=s.counts[r]||0,c=a.counts[r]||0),o<c?i?-1:1:o>c?i?1:-1:0}),t.forEach((s,a)=>{const o=document.createElement("tr");a===0&&(o.style.fontWeight="bold");let c=`
            <td>${a+1}</td>
            <td>${s.name}</td>
            <td style="color:#16a34a; font-weight:bold;">${s.totalPoints}</td>
            <td>${s.rounds}</td>
        `;H.currentCompData.rules.forEach(l=>{c+=`<td>${s.counts[l.name]||0}</td>`}),o.innerHTML=c,P.compLeaderboardTbody.appendChild(o)})}function L3(){P.compRecentRoundsTbody.innerHTML="";const n=H.currentUser;H.currentCompRounds.length&&H.currentCompRounds.forEach(e=>{const t=document.createElement("tr");let r=e.date;r&&r.toDate?r=r.toDate():typeof r=="string"&&(r=new Date(r));const i=r?r.toLocaleDateString():"Unknown";let s="";e.ruleCounts&&(s=Object.entries(e.ruleCounts).map(([a,o])=>`${a}:${o}`).join(", ")),t.innerHTML=`
                <td>${i}</td>
                <td>${e.playerName}</td>
                <td style="color:#16a34a; font-weight:bold;">${e.totalPoints}</td>
                <td style="font-size: 0.8rem; color:#64748b;">${s}</td>
                <td>
                    ${n&&H.currentUser.uid===e.uid||window.currentUserIsAdmin?`<button class="btn btn-danger btn-sm del-comp-round" data-id="${e.id}">X</button>`:""}
                </td>
            `,P.compRecentRoundsTbody.appendChild(t)})}function N3(){P.compLeaderboardHead.addEventListener("click",n=>{const e=n.target.closest("th");if(!e)return;const t=e.getAttribute("data-sort");t&&(window.currentCompSortField===t?window.currentCompSortAsc=!window.currentCompSortAsc:(window.currentCompSortField=t,window.currentCompSortAsc=t==="name"),_I())})}function V3(){let n=[];const e=document.getElementById("comp-rules-list"),t=document.getElementById("btn-add-rule"),r=document.getElementById("btn-show-create-comp");r&&r.addEventListener("click",()=>{P.createCompContainer.classList.remove("hidden"),r.classList.add("hidden")}),P.btnCancelComp&&P.btnCancelComp.addEventListener("click",()=>{P.createCompContainer.classList.add("hidden"),r&&r.classList.remove("hidden"),P.createCompForm.reset(),n=[],i()}),t&&t.addEventListener("click",()=>{const o=document.getElementById("new-rule-name").value.trim(),c=parseFloat(document.getElementById("new-rule-points").value)||0;o&&(n.push({name:o,pts:c}),document.getElementById("new-rule-name").value="",document.getElementById("new-rule-points").value="1",i())});function i(){if(e){if(n.length===0){e.innerHTML='<div class="empty-state" style="padding: 10px; font-size: 0.9rem;">No custom rules added yet.</div>';return}e.innerHTML=n.map((o,c)=>`
            <div style="display:flex; justify-content:space-between; align-items:center; background:white; padding:8px 12px; border-radius:6px; border:1px solid #e2e8f0;">
                <span><strong>${o.name}</strong>: ${o.pts} pts</span>
                <button type="button" class="btn-text del-rule" data-index="${c}" style="color:#ef4444; padding:0;"></button>
            </div>
        `).join(""),e.querySelectorAll(".del-rule").forEach(o=>{o.addEventListener("click",c=>{const l=parseInt(o.getAttribute("data-index"));n.splice(l,1),i()})})}}P.createCompForm&&P.createCompForm.addEventListener("submit",async o=>{o.preventDefault();const c=document.getElementById("comp-name").value.trim();if(!c)return;const l=document.getElementById("sp-round-enable").checked,u=document.getElementById("sp-hole-enable").checked,h={name:c,ownerId:H.currentUser.uid,createdAt:wi(),visibility:document.querySelector('input[name="comp-visibility"]:checked')?.value||"public",rules:n,startingPoints:{round:{enabled:l,type:document.querySelector('input[name="sp-round-type"]:checked')?.value||"fixed",value:parseFloat(document.getElementById("sp-round-value").value)||0},hole:{enabled:u,type:document.querySelector('input[name="sp-hole-type"]:checked')?.value||"fixed",value:parseFloat(document.getElementById("sp-hole-value").value)||0}}};try{const d=await qr(Ye(Ie,"competitions"),h);P.createCompForm.reset(),n=[],i(),P.createCompContainer.classList.add("hidden"),r&&r.classList.remove("hidden"),P.compSelect.value=d.id,mI(d.id)}catch(d){console.error("Error creating competition:",d),alert("Failed to create competition. Check console for details.")}});const s=document.getElementById("sp-round-enable"),a=document.getElementById("sp-hole-enable");s&&s.addEventListener("change",o=>{document.getElementById("sp-round-config").classList.toggle("hidden",!o.target.checked)}),a&&a.addEventListener("change",o=>{document.getElementById("sp-hole-config").classList.toggle("hidden",!o.target.checked)})}function B3(){P.logCompRoundForm&&(P.logCompRoundForm.addEventListener("submit",async n=>{if(n.preventDefault(),!Ul||!H.currentCompData)return;const e=document.getElementById("comp-player-select"),t=e.value,r=e.options[e.selectedIndex].text,i=parseInt(document.getElementById("comp-score").value),s=document.getElementById("comp-date").value;if(!t||isNaN(i))return;let a=0;const o={};document.querySelectorAll(".dynamic-rule-input").forEach(u=>{const h=parseInt(u.value)||0,d=parseFloat(u.getAttribute("data-rulepts"))||0,p=u.getAttribute("data-rulename");o[p]=h,a+=h*d});const c=H.currentCompData.startingPoints||{};c.round?.enabled&&(a+=c.round.value||0),c.hole?.enabled&&(a+=(c.hole.value||0)*18);const l={compId:Ul,uid:t,playerName:r,totalPoints:a,score:i,date:new Date(s),ruleCounts:o,createdAt:wi()};try{await qr(Ye(Ie,"comp_rounds"),l),P.logCompRoundForm.reset(),document.querySelectorAll(".dynamic-rule-input").forEach(u=>u.value=0)}catch(u){console.error("Error logging round:",u),alert("Failed to log round.")}}),Nt(Ye(Ie,"users")).then(n=>{const e=document.getElementById("comp-player-select");e&&n.forEach(t=>{const r=t.data();if(r.isApproved){const i=document.createElement("option");i.value=t.id,i.textContent=r.displayName||r.email,t.id===H.currentUser?.uid&&(i.selected=!0),e.appendChild(i)}})}))}const U3="type.googleapis.com/google.protobuf.Int64Value",H3="type.googleapis.com/google.protobuf.UInt64Value";function xI(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function mf(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>mf(e));if(typeof n=="function"||typeof n=="object")return xI(n,e=>mf(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Ho(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case U3:case H3:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Ho(e)):typeof n=="function"||typeof n=="object"?xI(n,e=>Ho(e)):n}const cm="functions";const Ly={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Gn extends Yr{constructor(e,t,r){super(`${cm}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Gn.prototype)}}function z3(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function _f(n,e){let t=z3(n),r=t,i;try{const s=e&&e.error;if(s){const a=s.status;if(typeof a=="string"){if(!Ly[a])return new Gn("internal","internal");t=Ly[a],r=a}const o=s.message;typeof o=="string"&&(r=o),i=s.details,i!==void 0&&(i=Ho(i))}}catch{}return t==="ok"?null:new Gn(t,r,i)}class $3{constructor(e,t,r,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Qn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(s=>this.auth=s,()=>{}),this.messaging||r.get().then(s=>this.messaging=s,()=>{}),this.appCheck||i?.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:i}}}const fp="us-central1",W3=/^data: (.*?)(?:\n|$)/;function j3(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Gn("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class G3{constructor(e,t,r,i,s=fp,a=(...o)=>fetch(...o)){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new $3(e,t,r,i),this.cancelAllRequests=new Promise(o=>{this.deleteService=()=>Promise.resolve(o())});try{const o=new URL(s);this.customDomain=o.origin+(o.pathname==="/"?"":o.pathname),this.region=fp}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function q3(n,e,t){const r=bs(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(Kp(n.emulatorOrigin+"/backends"),ew("Functions",!0))}function K3(n,e,t){const r=i=>X3(n,e,i,{});return r.stream=(i,s)=>J3(n,e,i,s),r}function yI(n){return n.emulatorOrigin&&bs(n.emulatorOrigin)?"include":void 0}async function Y3(n,e,t,r,i){t["Content-Type"]="application/json";let s;try{s=await r(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:yI(i)})}catch{return{status:0,json:null}}let a=null;try{a=await s.json()}catch{}return{status:s.status,json:a}}async function vI(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function X3(n,e,t,r){const i=n._url(e);return Q3(n,i,t,r)}async function Q3(n,e,t,r){t=mf(t);const i={data:t},s=await vI(n,r),a=r.timeout||7e4,o=j3(a),c=await Promise.race([Y3(e,i,s,n.fetchImpl,n),o.promise,n.cancelAllRequests]);if(o.cancel(),!c)throw new Gn("cancelled","Firebase Functions instance was deleted.");const l=_f(c.status,c.json);if(l)throw l;if(!c.json)throw new Gn("internal","Response is not valid JSON object.");let u=c.json.data;if(typeof u>"u"&&(u=c.json.result),typeof u>"u")throw new Gn("internal","Response is missing data field.");return{data:Ho(u)}}function J3(n,e,t,r){const i=n._url(e);return Z3(n,i,t,r||{})}async function Z3(n,e,t,r){t=mf(t);const i={data:t},s=await vI(n,r);s["Content-Type"]="application/json",s.Accept="text/event-stream";let a;try{a=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(i),headers:s,signal:r?.signal,credentials:yI(n)})}catch(d){if(d instanceof Error&&d.name==="AbortError"){const g=new Gn("cancelled","Request was cancelled.");return{data:Promise.reject(g),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(g)}}}}}}const p=_f(0,null);return{data:Promise.reject(p),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(p)}}}}}}let o,c;const l=new Promise((d,p)=>{o=d,c=p});r?.signal?.addEventListener("abort",()=>{const d=new Gn("cancelled","Request was cancelled.");c(d)});const u=a.body.getReader(),h=e6(u,o,c,r?.signal);return{stream:{[Symbol.asyncIterator](){const d=h.getReader();return{async next(){const{value:p,done:g}=await d.read();return{value:p,done:g}},async return(){return await d.cancel(),{done:!0,value:void 0}}}}},data:l}}function e6(n,e,t,r){const i=(a,o)=>{const c=a.match(W3);if(!c)return;const l=c[1];try{const u=JSON.parse(l);if("result"in u){e(Ho(u.result));return}if("message"in u){o.enqueue(Ho(u.message));return}if("error"in u){const h=_f(0,u);o.error(h),t(h);return}}catch(u){if(u instanceof Gn){o.error(u),t(u);return}}},s=new TextDecoder;return new ReadableStream({start(a){let o="";return c();async function c(){if(r?.aborted){const l=new Gn("cancelled","Request was cancelled");return a.error(l),t(l),Promise.resolve()}try{const{value:l,done:u}=await n.read();if(u){o.trim()&&i(o.trim(),a),a.close();return}if(r?.aborted){const d=new Gn("cancelled","Request was cancelled");a.error(d),t(d),await n.cancel();return}o+=s.decode(l,{stream:!0});const h=o.split(`
`);o=h.pop()||"";for(const d of h)d.trim()&&i(d.trim(),a);return c()}catch(l){const u=l instanceof Gn?l:_f(0,null);a.error(u),t(u)}}},cancel(){return n.cancel()}})}const Ny="@firebase/functions",Vy="0.13.2";const t6="auth-internal",n6="app-check-internal",r6="messaging-internal";function i6(n){const e=(t,{instanceIdentifier:r})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider(t6),a=t.getProvider(r6),o=t.getProvider(n6);return new G3(i,s,a,o,r)};ga(new gs(cm,e,"PUBLIC").setMultipleInstances(!0)),Hr(Ny,Vy,n),Hr(Ny,Vy,"esm2020")}function s6(n=cw(),e=fp){const r=Hf(vt(n),cm).getImmediate({identifier:e}),i=XP("functions");return i&&a6(r,...i),r}function a6(n,e,t){q3(vt(n),e,t)}function o6(n,e,t){return K3(vt(n),e)}i6();let Ja=null,Sc=null;function EI(){if(!document.getElementById("ai-modal-overlay")){const i=document.createElement("div");i.id="ai-modal-container",i.innerHTML=`
            <div id="ai-modal-overlay" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.65);z-index:2000;display:flex;justify-content:center;align-items:center;padding:20px;">
                <div class="card" style="width:100%;max-width:720px;max-height:90vh;display:flex;flex-direction:column;gap:0;padding:0;overflow:hidden;border-radius:16px;">
                    <div style="background:linear-gradient(135deg,#6d28d9,#8b5cf6);padding:20px 24px;display:flex;align-items:center;justify-content:space-between;">
                        <div>
                            <h2 id="ai-modal-title" style="margin:0;color:white;font-size:1.2rem;"> AI Coach</h2>
                            <p id="ai-modal-subtitle" style="margin:4px 0 0;color:rgba(255,255,255,0.75);font-size:0.82rem;">Powered by Gemini</p>
                        </div>
                        <button id="btn-close-ai-modal" style="background:rgba(255,255,255,0.15);border:none;color:white;width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;"></button>
                    </div>
                    <div id="ai-loading" class="hidden" style="padding:40px;text-align:center;">
                        <div style="width:48px;height:48px;border:4px solid #e2e8f0;border-top-color:#8b5cf6;border-radius:50%;animation:ai-spin 0.8s linear infinite;margin:0 auto 16px;"></div>
                        <p style="color:#64748b;font-size:0.95rem;">Gemini is analysing your stats...</p>
                    </div>
                    <div id="ai-response-area" class="hidden" style="flex:1;overflow-y:auto;padding:24px;">
                        <div id="ai-response-content" style="font-size:0.92rem;line-height:1.7;color:#1e293b;"></div>
                    </div>
                    <div id="ai-error-area" class="hidden" style="padding:24px;text-align:center;color:#ef4444;"><p id="ai-error-msg"></p></div>
                    <div style="padding:16px 24px;border-top:1px solid #e2e8f0;display:flex;gap:10px;background:#f8fafc;">
                        <button id="btn-regenerate-ai" class="btn btn-primary" style="flex:1;margin:0;background:#8b5cf6;border-color:#8b5cf6;"> Regenerate</button>
                        <button id="btn-close-ai-modal-2" class="btn btn-secondary" style="flex:1;margin:0;">Close</button>
                    </div>
                </div>
            </div>
            <style>
                @keyframes ai-spin { to { transform: rotate(360deg) } }
            </style>
        `,document.body.appendChild(i),P.aiModalOverlay=document.getElementById("ai-modal-overlay"),P.aiModalTitle=document.getElementById("ai-modal-title"),P.btnCloseAiModal=document.getElementById("btn-close-ai-modal")}const n=document.getElementById("btn-ai-player"),e=document.getElementById("btn-ai-coach"),t=document.getElementById("btn-regenerate-ai");if(window.currentUserIsCoach&&!window.currentUserIsAdmin){n&&n.closest("section, div")?.style&&(n.style.display="none"),e&&(e.style.display="none");const i=document.getElementById("btn-ask-ai");i&&(i.style.display="none");const s=document.getElementById("btn-coach-ai-plan");s&&(s.style.display="none");return}n&&n.addEventListener("click",()=>{Ja=H.currentUser.uid,Sc="player",Dh(Ja,Sc)}),e&&e.addEventListener("click",()=>{const i=document.getElementById("player-select").value;if(!i)return alert("Select a player first");Ja=i,Sc="coach",Dh(Ja,Sc)}),t&&t.addEventListener("click",()=>{Ja&&Dh(Ja,Sc)}),P.btnCloseAiModal&&P.btnCloseAiModal.addEventListener("click",()=>P.aiModalOverlay.classList.add("hidden"));const r=document.getElementById("btn-close-ai-modal-2");r&&r.addEventListener("click",()=>P.aiModalOverlay.classList.add("hidden"))}function c6(n){return n.replace(/^### (.+)/gm,'<h3 style="margin:16px 0 6px;color:#6d28d9;">$1</h3>').replace(/^## (.+)/gm,'<h2 style="margin:20px 0 8px;color:#4c1d95;border-bottom:2px solid #ede9fe;padding-bottom:6px;">$1</h2>').replace(/^# (.+)/gm,'<h1 style="margin:0 0 16px;color:#3b0764;">$1</h1>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/^- (.+)/gm,'<li style="margin:4px 0;">$1</li>').replace(/(<li.*<\/li>)/gs,'<ul style="padding-left:20px;margin:8px 0;">$1</ul>').replace(/\n\n/g,'</p><p style="margin:10px 0;">').replace(/^(?!<[hul])/gm,"").trim()}async function Dh(n,e){if(!P.aiModalOverlay)return;P.aiModalOverlay.classList.remove("hidden"),document.getElementById("ai-loading").classList.remove("hidden"),document.getElementById("ai-response-area").classList.add("hidden"),document.getElementById("ai-error-area").classList.add("hidden"),document.getElementById("btn-regenerate-ai").disabled=!0;const t=document.getElementById("ai-modal-title"),r=document.getElementById("ai-modal-subtitle");t&&(t.textContent=e==="player"?" Your AI Training Plan":" Lesson Plan Generator"),r&&(r.textContent="Powered by Gemini  Analysing your data...");try{const[i,s,a]=await Promise.all([Nt(an(Ye(Ie,"whs_rounds"),Qt("uid","==",n))),Nt(an(Ye(Ie,"practice_rounds"),Qt("uid","==",n))),Nt(an(Ye(Ie,"shots"),Qt("uid","==",n)))]);let o=[];i.forEach(S=>{const A=S.data(),k=113/A.slope*(A.adjustedGross-A.rating);o.push({diff:k,date:A.date?.toDate?.()||new Date(A.date),stats:A.stats||null})}),o.sort((S,A)=>A.date-S.date);const c=o.slice(0,5).map(S=>S.diff.toFixed(1)),l=o.slice(0,10).map(S=>S.diff);let u="insufficient data to determine trend";if(l.length>=4){const S=Math.floor(l.length/2),A=l.slice(0,S).reduce((oe,ie)=>oe+ie,0)/S,k=l.slice(S).reduce((oe,ie)=>oe+ie,0)/S,D=A-k;D<-.5?u=`IMPROVING (differential has dropped ${Math.abs(D).toFixed(1)} strokes recently)`:D>.5?u=`DECLINING (differential has increased ${D.toFixed(1)} strokes recently  needs attention)`:u="STABLE (no significant change)"}const h=o.filter(S=>S.stats?.putts).map(S=>S.stats.putts),d=o.filter(S=>S.stats?.fwy).map(S=>S.stats.fwy),p=o.filter(S=>S.stats?.gir).map(S=>S.stats.gir),g=S=>S.length?(S.reduce((A,k)=>A+k,0)/S.length).toFixed(1):null,m=[];g(h)&&m.push({name:"Putting",value:+g(h),benchmark:32,higherIsBad:!0}),g(d)&&m.push({name:"Fairways Hit",value:+g(d),benchmark:7,higherIsBad:!1}),g(p)&&m.push({name:"Greens in Regulation",value:+g(p),benchmark:9,higherIsBad:!1});const _=m.length?m.sort((S,A)=>{const k=S.higherIsBad?S.value-S.benchmark:S.benchmark-S.value;return(A.higherIsBad?A.value-A.benchmark:A.benchmark-A.value)-k})[0]:null;let E=[];s.forEach(S=>{const A=S.data();E.push(`${A.drillName} (score: ${A.score})`)});let I={};a.forEach(S=>{const A=S.data();A.curve&&(I[A.curve]=(I[A.curve]||0)+1)});const v=Object.entries(I).sort((S,A)=>A[1]-S[1])[0];let R=e==="player"?`You are an elite PGA Tour-level golf coach. Analyse the following player data and generate a highly specific, actionable 45-minute solo practice plan. Focus on their single biggest weakness, not generic advice.

`:`You are a senior Director of Coaching at an elite golf academy. A junior coach needs a detailed 60-minute in-person lesson plan for their student. Base it strictly on the data below and be specific.

`;R+=`${e==="player"?"**Player Stats:**":"**Student Stats:**"}
`,R+=`- Recent Differentials (newest first): [${c.join(", ")}]
`,R+=`- Trend: ${u}
`,R+=`- Avg Putts/Round: ${g(h)||"Not tracked yet"}
`,R+=`- Avg Fairways Hit: ${g(d)?g(d)+"/14":"Not tracked yet"}
`,R+=`- Avg GIR: ${g(p)?g(p)+"/18":"Not tracked yet"}
`,_&&(R+=`- **Identified Weakest Area: ${_.name}** (avg ${_.value} vs benchmark ~${_.benchmark})
`),v&&(R+=`- Most common miss: ${v[0]} (${v[1]} shots)
`),R+=`
**Practice Drills Logged (recent):**
`,R+=E.length?E.slice(0,6).join(", "):"No drills logged yet.",R+=`

`,e==="player"?R+=`Generate a 45-minute practice plan with:
1. Exactly which area to focus on and why (cite the stats)
2. 3 specific drills with exact reps/constraints
3. How to measure success before leaving the range

Format with clear Markdown headers and bullet points.`:R+=`Generate a 60-minute lesson plan with:
1. The single biggest leak identified from the data (cite exactly why)
2. Three blocks: Warm-up/Discovery (10 min), Skill Acquisition (35 min), Pressure Testing (15 min)
3. 23 discovery questions to ask the student at the start
4. Specific drills for each block with constraints

Format with clear Markdown headers. Be concise and practical.`;const F=s6(),w=(await o6(F,"askAiCoach")({prompt:R})).data.answer||"No response received.",T=c6(w);document.getElementById("ai-loading").classList.add("hidden"),document.getElementById("ai-response-area").classList.remove("hidden"),document.getElementById("ai-response-content").innerHTML=`<p style="margin:10px 0;">${T}</p>`,r&&(r.textContent="Powered by Gemini  Tap Regenerate for a fresh plan")}catch(i){console.error("Gemini API error:",i),document.getElementById("ai-loading").classList.add("hidden"),document.getElementById("ai-error-area").classList.remove("hidden"),document.getElementById("ai-error-msg").textContent=` ${i.message}`}finally{document.getElementById("btn-regenerate-ai").disabled=!1}}let c0=null,cr=null;const xf={bunker_game:{name:"Bunker Game (Par 18)",desc:"Hit 9 bunker shots. Focus on getting up-and-down. 1 pt for holed, 2 pts for up & down, 3 pts for bogey+.",inputs:[{id:"holed",label:"Holed (1 pt)",type:"number",multiplier:1,default:0},{id:"up_down",label:"Up & Down (2 pts)",type:"number",multiplier:2,default:0},{id:"missed",label:"Bogey+ (3 pts)",type:"number",multiplier:3,default:0}],scoringMath:"lower_is_better"},inside_30:{name:"Inside 30 Yards (Proximity)",desc:"9 shots from 30 yards. Reward proximity with structured points. Stay inside the circle!",inputs:[{id:"holed",label:"Holed (1 pt)",type:"number",multiplier:1,default:0},{id:"in_1_club",label:"Inside 1 Club (2 pts)",type:"number",multiplier:2,default:0},{id:"in_2_clubs",label:"Inside 2 Clubs (3 pts)",type:"number",multiplier:3,default:0},{id:"missed",label:"Outside 2 Clubs (5 pts)",type:"number",multiplier:5,default:0}],scoringMath:"lower_is_better"},putting_9:{name:"Putting (9 Holes)",desc:"A 9-hole putting course challenge. 1 pt for a 1-putt, 2 pts for a 2-putt, 4 pts for a 3-putt catastrophe.",inputs:[{id:"putts_1",label:"1-Putts (1 pt)",type:"number",multiplier:1,default:0},{id:"putts_2",label:"2-Putts (2 pts)",type:"number",multiplier:2,default:0},{id:"putts_3",label:"3+ Putts (4 pts)",type:"number",multiplier:4,default:0}],scoringMath:"lower_is_better"},up_down:{name:"Up & Down Challenge",desc:"Play 9 shots around the green. Chip-ins are king. Focus on making those par saves.",inputs:[{id:"birdies",label:"Holed (1 pt)",type:"number",multiplier:1,default:0},{id:"pars",label:"Up & Down (2 pts)",type:"number",multiplier:2,default:0},{id:"bogeys",label:"Bogey+ (3 pts)",type:"number",multiplier:3,default:0}],scoringMath:"lower_is_better"},putting_369:{name:"3-6-9 Putting Ladder",desc:"Hit 3 balls from 3ft, 6ft, and 9ft. 1 pt for a make, 0 for a miss. Max score 9.",inputs:[{id:"putts_3ft",label:"Makes from 3ft (1 pt)",type:"number",multiplier:1,default:0},{id:"putts_6ft",label:"Makes from 6ft (1 pt)",type:"number",multiplier:1,default:0},{id:"putts_9ft",label:"Makes from 9ft (1 pt)",type:"number",multiplier:1,default:0}],scoringMath:"higher_is_better"}};function l6(){u6(),f6();const n=document.getElementById("btn-ask-ai");n&&n.addEventListener("click",EI);const e=document.getElementById("drill-date");e&&(e.valueAsDate=new Date),P.practiceSelect&&P.practiceSelect.addEventListener("change",t=>{const r=t.target.value;if(!r){P.logPracticeContainer.classList.add("hidden"),cr=null,Bc();return}cr=xf[r],P.logPracticeContainer.classList.remove("hidden"),h6(),Bc()}),P.btnCancelPractice&&P.btnCancelPractice.addEventListener("click",()=>{P.logPracticeContainer.classList.add("hidden"),P.practiceSelect.value="",cr=null,Bc()}),P.logPracticeForm&&P.logPracticeForm.addEventListener("submit",async t=>{if(t.preventDefault(),!H.currentUser||!cr)return;const r=P.practiceSelect.value;let i={},s=parseInt(P.drillLiveTotalEl.textContent)||0;cr.inputs.forEach(o=>{const c=document.getElementById("drill-input-"+o.id);c&&(i[o.id]=parseInt(c.value)||0)});const a=P.btnSavePractice||t.target.querySelector('button[type="submit"]');a.disabled=!0,a.textContent="Saving...";try{await qr(Ye(Ie,"practice_rounds"),{uid:H.currentUser.uid,playerName:H.currentUser.displayName||H.currentUser.email,drillId:r,drillName:cr.name,score:s,data:i,date:e&&e.value?new Date(e.value):new Date}),P.logPracticeForm.reset(),P.logPracticeContainer.classList.add("hidden"),P.practiceSelect.value="",cr=null,Bc()}catch(o){console.error("Error logging practice: ",o),alert("Failed to save practice record.")}finally{a.disabled=!1,a.textContent="Save Practice Session"}}),P.btnEmailCoach&&P.btnEmailCoach.addEventListener("click",()=>{const t=H.currentPracticeRounds.map(r=>`${new Date(r.date?.toDate?.()||r.date).toLocaleDateString()} - ${r.drillName}: ${r.score}`).join(`
`);window.location.href=`mailto:?subject=Golf Practice Logs&body=Here are my recent practice sessions:

${encodeURIComponent(t)}`}),P.btnExportPractice&&P.btnExportPractice.addEventListener("click",()=>{const t=`Date,Drill,Score
`+H.currentPracticeRounds.map(a=>`${new Date(a.date?.toDate?.()||a.date).toLocaleDateString()},${a.drillName},${a.score}`).join(`
`),r=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(r),s=document.createElement("a");s.setAttribute("hidden",""),s.setAttribute("href",i),s.setAttribute("download","golf_practice.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}),P.practiceRecentTbody&&P.practiceRecentTbody.addEventListener("click",async t=>{if(t.target.classList.contains("del-prac-round")){const r=t.target.getAttribute("data-id");if(confirm("Are you sure you want to delete this practice session?"))try{await _u(pt(Ie,"practice_rounds",r))}catch(i){console.error("Failed to delete round",i)}}})}function u6(){if(P.practiceSelect){P.practiceSelect.innerHTML='<option value="" disabled selected>-- Select a Drill --</option>';for(const[n,e]of Object.entries(xf)){const t=document.createElement("option");t.value=n,t.textContent=e.name,P.practiceSelect.appendChild(t)}}}function h6(){const n=document.getElementById("practice-dynamic-inputs");if(!n||!cr)return;n.innerHTML="";const e=document.createElement("p");e.style.fontSize="0.95rem",e.style.color="#475569",e.style.marginBottom="18px",e.style.lineHeight="1.5",e.textContent=cr.desc,n.appendChild(e),cr.inputs.forEach(t=>{const r=document.createElement("div");r.className="form-group",r.style.marginBottom="12px";const i=document.createElement("label");i.textContent=t.label,i.htmlFor="drill-input-"+t.id,i.style.display="block",i.style.marginBottom="4px";const s=document.createElement("input");s.type=t.type,s.id="drill-input-"+t.id,s.className="drill-outcome-field",s.value=t.default||0,s.min=0,s.required=!0,s.style.width="100%",s.addEventListener("input",By),r.appendChild(i),r.appendChild(s),n.appendChild(r)}),By()}function By(){if(!cr||!P.drillLiveTotalEl)return;let n=0;cr.inputs.forEach(e=>{const t=document.getElementById("drill-input-"+e.id);if(t){const r=parseInt(t.value)||0;n+=r*(e.multiplier||1)}}),P.drillLiveTotalEl.textContent=n}function f6(){if(!H.currentUser)return;c0&&c0();const n=an(Ye(Ie,"practice_rounds"),Qt("uid","==",H.currentUser.uid),Ti("date","desc"));c0=fd(n,e=>{H.currentPracticeRounds=[],e.forEach(t=>{H.currentPracticeRounds.push({id:t.id,...t.data()})}),Bc(),d6()})}function Bc(){if(!P.practiceDashboardResults)return;P.practiceDashboardResults.innerHTML="";const n=P.practiceSelect?P.practiceSelect.value:null;if(!H.currentPracticeRounds.length){P.practiceDashboardResults.innerHTML='<p class="empty-text">No practice records found.</p>';return}if(!n){P.practiceDashboardResults.innerHTML='<p class="empty-text">Select a specific drill from the dropdown above to view personal high scores and averages.</p>';return}const e=H.currentPracticeRounds.filter(o=>o.drillId===n);if(!e.length){P.practiceDashboardResults.innerHTML=`<p class="empty-text">No records logged for <strong>${xf[n].name}</strong> yet.</p>`;return}const t=xf[n];let r=e[0].score,i=0;e.forEach(o=>{t.scoringMath==="lower_is_better"?o.score<r&&(r=o.score):o.score>r&&(r=o.score),i+=o.score});const s=(i/e.length).toFixed(1),a=`
        <h3 style="margin-top:0; font-size:1.1rem; color: #1e293b; border-bottom: 2px solid var(--secondary-color); padding-bottom:10px;">
            Personal Stats: ${t.name}
        </h3>
        <div style="display:flex; justify-content:space-around; margin-top:20px;">
            <div style="text-align:center;">
                <div style="font-size:2rem; font-weight:800; color:var(--primary-color);">${r}</div>
                <div style="font-size:0.8rem; color:#64748b; font-weight:bold; text-transform:uppercase;">Personal Best</div>
            </div>
            <div style="text-align:center;">
                <div style="font-size:2rem; font-weight:800; color:#1e293b;">${s}</div>
                <div style="font-size:0.8rem; color:#64748b; font-weight:bold; text-transform:uppercase;">Average</div>
            </div>
            <div style="text-align:center;">
                <div style="font-size:2rem; font-weight:800; color:#1e293b;">${e.length}</div>
                <div style="font-size:0.8rem; color:#64748b; font-weight:bold; text-transform:uppercase;">Sessions</div>
            </div>
        </div>
    `;P.practiceDashboardResults.innerHTML=a}function d6(){if(!P.practiceRecentTbody)return;if(P.practiceRecentTbody.innerHTML="",!H.currentPracticeRounds.length){P.practiceRecentTbody.innerHTML='<tr><td colspan="4" class="empty-text">No practice history.</td></tr>';return}const n=H.currentUser;H.currentPracticeRounds.forEach(e=>{const t=document.createElement("tr");let r=e.date;r&&r.toDate?r=r.toDate():typeof r=="string"&&(r=new Date(r));const i=r?r.toLocaleDateString():"Unknown";t.innerHTML=`
            <td>${i}</td>
            <td><strong>${e.drillName}</strong></td>
            <td style="color:var(--primary-color); font-weight:bold; font-size:1.2rem;">${e.score}</td>
            <td>
                ${n&&H.currentUser.uid===e.uid?`<button class="btn btn-danger btn-sm del-prac-round" data-id="${e.id}">X</button>`:""}
            </td>
        `,P.practiceRecentTbody.appendChild(t)})}const yn={"Keperra  Old Course (9 holes)":{"Yellow (Men)":{rating:70,slope:124,par:36,pars:[5,4,4,3,5,3,4,3,5],strokeIndex:[9,10,13,14,15,18,8,17,7]},"Blue (Men)":{rating:71,slope:125,par:36,pars:[5,4,4,3,5,3,4,3,5],strokeIndex:[9,10,13,14,15,18,8,17,7]}},"Keperra  North Course (9 holes)":{"Yellow (Men)":{rating:71,slope:124,par:36,pars:[4,5,3,5,4,4,4,3,4],strokeIndex:[2,15,11,12,13,7,3,9,1]},"Blue (Men)":{rating:72,slope:131,par:36,pars:[4,5,3,5,4,4,4,3,4],strokeIndex:[2,15,11,12,13,7,3,9,1]}},"Keperra  West Course (9 holes)":{"Yellow (Men)":{rating:68,slope:121,par:35,pars:[4,4,4,4,5,4,3,4,3],strokeIndex:[14,1,6,2,5,3,16,18,13]},"Blue (Men)":{rating:69,slope:128,par:35,pars:[4,4,4,4,5,4,3,4,3],strokeIndex:[14,1,6,2,5,3,16,18,13]}},"Keperra  Old + North (Par 72)":{"Yellow (Men)":{rating:70.5,slope:124,par:72,pars:[5,4,4,3,5,3,4,3,5,4,5,3,5,4,4,4,3,4],strokeIndex:[9,10,13,14,15,18,8,17,7,4,16,6,12,11,3,2,5,1]},"Blue (Men)":{rating:71.5,slope:128,par:72,pars:[5,4,4,3,5,3,4,3,5,4,5,3,5,4,4,4,3,4],strokeIndex:[9,10,13,14,15,18,8,17,7,4,16,6,12,11,3,2,5,1]}},"Keperra  North + West (Par 71)":{"Yellow (Men)":{rating:69.5,slope:123,par:71,pars:[4,5,3,5,4,4,4,3,4,4,4,4,4,5,4,3,4,3],strokeIndex:[2,15,11,12,13,7,3,9,1,16,5,10,6,8,4,17,18,14]},"Blue (Men)":{rating:70.5,slope:130,par:71,pars:[4,5,3,5,4,4,4,3,4,4,4,4,4,5,4,3,4,3],strokeIndex:[2,15,11,12,13,7,3,9,1,16,5,10,6,8,4,17,18,14]}},"Keperra  West + Old (Par 71)":{"Yellow (Men)":{rating:69,slope:122,par:71,pars:[4,4,4,4,5,4,3,4,3,5,4,4,3,5,3,4,3,5],strokeIndex:[14,1,6,2,5,3,16,18,13,8,10,9,12,11,17,7,15,4]},"Blue (Men)":{rating:70,slope:127,par:71,pars:[4,4,4,4,5,4,3,4,3,5,4,4,3,5,3,4,3,5],strokeIndex:[14,1,6,2,5,3,16,18,13,8,10,9,12,11,17,7,15,4]}},"Ashgrove GC":{"White (Men 1-9)":{rating:33,slope:115,par:35,pars:[]}},"McLeod GC":{"Blue (Men)":{rating:69,slope:126,par:0,pars:[]}},"Bulimba Course":{"White (Men)":{rating:49,slope:65,par:0,pars:[]}},"Custom Course":{"Custom Tee":{rating:72,slope:113,par:0,pars:[]}}},Uy={hiChange:!0,friendRound:!1,coachNote:!0,drillAssign:!0};async function p6(){const n=document.getElementById("notif-permission-banner");n&&Notification.permission!=="granted"&&n.classList.remove("hidden");const e=document.getElementById("btn-enable-notifs");e&&e.addEventListener("click",async()=>{await Notification.requestPermission()==="granted"&&n.classList.add("hidden")}),await g6();const t=document.getElementById("btn-save-notif-prefs"),r=document.getElementById("notif-prefs-msg");t&&t.addEventListener("click",async()=>{const o={hiChange:document.getElementById("notif-hi-change")?.checked??!0,friendRound:document.getElementById("notif-friend-round")?.checked??!1,coachNote:document.getElementById("notif-coach-note")?.checked??!0,drillAssign:document.getElementById("notif-drill-assign")?.checked??!0};try{await ec(pt(Ie,"users",H.currentUser.uid,"prefs","notifications"),o),r&&(r.textContent=" Preferences saved.",r.style.color="#10b981",r.classList.remove("hidden"),setTimeout(()=>r.classList.add("hidden"),3e3))}catch(c){r&&(r.textContent=` ${c.message}`,r.style.color="#ef4444",r.classList.remove("hidden"))}});const i=document.getElementById("settings-account-info");if(i&&H.currentUser){const o=H.currentUser;i.innerHTML=`
            <p><strong>Name:</strong> ${o.displayName||"Not set"}</p>
            <p><strong>Email:</strong> ${o.email}</p>
            <p><strong>UID:</strong> <span style="font-family:monospace;font-size:0.8rem;">${o.uid}</span></p>
        `}const s=document.getElementById("btn-change-password"),a=document.getElementById("settings-pw-msg");s&&a&&s.addEventListener("click",async()=>{try{await rg(Gi,H.currentUser.email),a.textContent=" Password reset email sent. Check your inbox.",a.style.color="#10b981"}catch(o){a.textContent=` ${o.message}`,a.style.color="#ef4444"}a.classList.remove("hidden")})}async function g6(){try{const n=await Ri(pt(Ie,"users",H.currentUser.uid,"prefs","notifications")),e=n.exists()?{...Uy,...n.data()}:Uy,t=(r,i)=>{const s=document.getElementById(r);s&&(s.checked=i)};t("notif-hi-change",e.hiChange),t("notif-friend-round",e.friendRound),t("notif-coach-note",e.coachNote),t("notif-drill-assign",e.drillAssign)}catch(n){console.warn("Could not load notification prefs:",n)}}function m6(){_6(),x6(),y6(),b6(),v6(),E6(),A6(),typeof updateModeVisibility=="function"&&updateModeVisibility(),P.ocCourseSelect&&P.ocCourseSelect.value&&P.ocCourseSelect.dispatchEvent(new Event("change"))}function _6(){P.btnModeSimple&&P.btnModeDetailed&&(P.btnModeSimple.addEventListener("click",()=>{H.currentTrackingMode="simple",P.btnModeSimple.classList.add("active"),P.btnModeSimple.style.background="white",P.btnModeSimple.style.color="black",P.btnModeDetailed.classList.remove("active"),P.btnModeDetailed.style.background="transparent",P.btnModeDetailed.style.color="#64748b",P.ocModeDesc&&(P.ocModeDesc.textContent="Simple: fairway, GIR, putts per hole"),n()}),P.btnModeDetailed.addEventListener("click",()=>{H.currentTrackingMode="detailed",P.btnModeDetailed.classList.add("active"),P.btnModeDetailed.style.background="white",P.btnModeDetailed.style.color="black",P.btnModeSimple.classList.remove("active"),P.btnModeSimple.style.background="transparent",P.btnModeSimple.style.color="#64748b",P.ocModeDesc&&(P.ocModeDesc.textContent="Detailed: Tracking ball flight, start line, curve, & outcomes"),n()}));function n(){const e=document.getElementById("btn-oc-track-shot"),t=document.getElementById("oncourse-wizard");H.currentTrackingMode==="simple"?(e&&e.classList.add("hidden"),t&&t.classList.add("hidden")):e&&e.classList.remove("hidden")}P.btnRound9&&P.btnRound18&&(P.btnRound9.addEventListener("click",()=>{H.currentRoundHoles=9,P.btnRound9.classList.add("active"),P.btnRound9.style.background="var(--primary-color)",P.btnRound9.style.color="white",P.btnRound18.classList.remove("active"),P.btnRound18.style.background="white",P.btnRound18.style.color="#64748b";const e=document.getElementById("oc-keperra-18h-group");e&&e.classList.add("hidden")}),P.btnRound18.addEventListener("click",()=>{H.currentRoundHoles=18,P.btnRound18.classList.add("active"),P.btnRound18.style.background="var(--primary-color)",P.btnRound18.style.color="white",P.btnRound9.classList.remove("active"),P.btnRound9.style.background="white",P.btnRound9.style.color="#64748b";const e=document.getElementById("oc-keperra-18h-group");e&&e.classList.remove("hidden")}))}function x6(){P.ocCourseSelect&&P.ocCourseSelect.addEventListener("change",()=>{const n=P.ocCourseSelect.value;if(H.currentRoundCourseName=n,P.ocTeeSelect&&yn[n]){P.ocTeeSelect.innerHTML="";for(const e in yn[n]){const t=document.createElement("option");t.value=e,t.textContent=e,P.ocTeeSelect.appendChild(t)}P.ocTeeSelect.dispatchEvent(new Event("change"))}}),P.ocTeeSelect&&P.ocTeeSelect.addEventListener("change",async()=>{const n=P.ocCourseSelect.value,e=P.ocTeeSelect.value;if(yn[n]&&yn[n][e]){const t=yn[n][e],r=t.par>0?t.par:'<input type="number" id="oc-manual-par" style="width:50px; display:inline;" class="form-control form-control-sm" placeholder="Par">';if(P.ocCourseInfoLine&&(P.ocCourseInfoLine.innerHTML=`Par: ${r} | CR: <input type="number" id="oc-manual-cr" value="${t.rating||0}" style="width:60px; display:inline;"> | SR: <input type="number" id="oc-manual-sr" value="${t.slope||0}" style="width:60px; display:inline;">`),H.currentCoursePars=t.pars||[],H.currentUser){const i=await wI(H.currentUser.uid);if(i!==void 0&&t.par>0){const s=Math.round(i*((t.slope||113)/113)+((t.rating||72)-(t.par||72)));P.ocDailyHandicapLine&&(P.ocDailyHandicapLine.innerHTML=`Your Daily Handicap: <strong><input type="number" id="oc-manual-dh" value="${s}" style="width:60px; display:inline; font-weight:bold; color:var(--primary-color);"></strong>`)}else P.ocDailyHandicapLine&&(P.ocDailyHandicapLine.innerHTML='Your Daily Handicap: <input type="number" id="oc-manual-dh" value="0" style="width:60px; display:inline; font-weight:bold;">')}updateModeVisibility()}})}function y6(){P.btnOcAddPlayer&&P.ocPlayerSelect&&P.btnOcAddPlayer.addEventListener("click",()=>{const n=P.ocPlayerSelect.options[P.ocPlayerSelect.selectedIndex];if(n.value){if(H.liveRoundGroups.find(e=>e.uid===n.value)){alert("Player already added.");return}H.liveRoundGroups=[...H.liveRoundGroups,{uid:n.value,name:n.text,scores:{},compStats:{},simpleStats:{}}]}})}function v6(){P.btnOcStart&&P.btnOcStart.addEventListener("click",async()=>{if(H.liveRoundGroups.length===0){alert("Please add at least one player to track.");return}const e=P.ocCourseSelect.value;let t=document.getElementById("oc-manual-par");const r=t?parseInt(t.value):yn[e]?.[P.ocTeeSelect.value]?.par||0;if(!r){alert("Please specify a valid total Par for this course.");return}const i=P.ocLinkComp?P.ocLinkComp.value:null;if(i){H.currentLiveCompId=i;const a=P.ocLinkComp.options[P.ocLinkComp.selectedIndex];try{H.currentLiveCompRules=JSON.parse(a.getAttribute("data-rules")||"[]")}catch{}}else H.currentLiveCompId=null,H.currentLiveCompRules=[];H.currentHole=1,H.activeRoundId=`round_${Date.now()}`,H.currentHoleShots=[];const s=yn[e]?.[P.ocTeeSelect.value]||{};for(let a of H.liveRoundGroups){const o=await wI(a.uid);a.handicapIndex=o,a.dailyHandicap=Math.round(o*((s.slope||113)/113)+((s.rating||72)-r))}document.body.classList.add("round-active"),document.getElementById("oncourse-setup").classList.add("hidden"),document.getElementById("oncourse-hub").classList.remove("hidden"),yr(),w6()});const n=document.getElementById("btn-oc-abort-round");n&&n.addEventListener("click",lm)}function E6(){const n=document.getElementById("btn-oc-discard");n&&n.addEventListener("click",async()=>{if(confirm("Are you sure you want to discard this round and ALL recorded shots?"))try{const e=A3(Ie),t=an(Ye(Ie,"shots"),Qt("roundId","==",H.activeRoundId));(await Nt(t)).forEach(s=>e.delete(s.ref));const i=pt(Ie,"whs_rounds",H.activeRoundId);e.delete(i),await e.commit(),typeof zo<"u"&&zo("Round & Shots discarded "),lm()}catch{alert("Failed to discard round data cleanly.")}})}function lm(){document.body.classList.remove("round-active"),document.getElementById("oncourse-setup").classList.remove("hidden"),document.getElementById("oncourse-hub").classList.add("hidden"),document.getElementById("oc-finish-modal").classList.add("hidden"),H.liveRoundGroups=[],H.currentHole=1,H.currentLiveCompId=null,H.currentLiveCompRules=[],H.currentHoleShots=[],H.activeRoundId=null,P.ocAddedPlayersList&&(P.ocAddedPlayersList.innerHTML="")}async function wI(n){if(H.currentUser&&n===H.currentUser.uid&&window.currentHandicapIndex!==void 0)return window.currentHandicapIndex;try{const e=pt(Ie,"profiles",n),t=await Ri(e);if(t.exists()&&t.data().handicapIndex!==void 0)return parseFloat(t.data().handicapIndex)}catch{}return 0}function yr(){const n=document.getElementById("oc-hole-display"),e=document.getElementById("oc-par-display"),t=document.getElementById("oc-hole-dots");n&&(n.textContent=`Hole ${H.currentHole}`);const r=H.currentCoursePars[H.currentHole-1]||0;if(e&&(e.textContent=r>0?`Par ${r}`:"Par ?"),t){t.innerHTML="";const s=H.currentRoundHoles||9;for(let a=1;a<=s;a++){const o=document.createElement("div");o.className="hole-dot",a<H.currentHole?o.classList.add("done"):a===H.currentHole&&o.classList.add("current"),t.appendChild(o)}}H.currentUser&&(H.currentHoleShots=[]);const i=document.getElementById("oc-group-scores");i&&(i.innerHTML="",H.liveRoundGroups.forEach((s,a)=>{const o=document.createElement("div");o.style.cssText="margin-bottom:20px; background:#f8fafc; padding:15px; border-radius:12px;";const c=document.createElement("h3");c.style.cssText="margin-top:0; margin-bottom:10px; font-size:1.3rem;",c.textContent=s.name,o.appendChild(c);const l=document.createElement("div");if(l.className="mobile-grid three-cols",l.style.marginBottom="15px",r!==3){const m=document.createElement("button");m.className="btn-grid",m.innerHTML='Fwy<br><span style="font-size:1.5rem">'+(s.simpleStats[H.currentHole]?.fwy===!0?"":s.simpleStats[H.currentHole]?.fwy===!1?"":"")+"</span>",s.simpleStats[H.currentHole]?.fwy===!0?m.classList.add("btn-good"):s.simpleStats[H.currentHole]?.fwy===!1&&m.classList.add("btn-bad"),m.addEventListener("click",()=>{s.simpleStats[H.currentHole]||(s.simpleStats[H.currentHole]={}),s.simpleStats[H.currentHole].fwy=!s.simpleStats[H.currentHole].fwy,yr()}),l.appendChild(m)}else l.appendChild(document.createElement("div"));const u=document.createElement("button");u.className="btn-grid",u.innerHTML='GIR<br><span style="font-size:1.5rem">'+(s.simpleStats[H.currentHole]?.gir===!0?"":s.simpleStats[H.currentHole]?.gir===!1?"":"")+"</span>",s.simpleStats[H.currentHole]?.gir===!0?u.classList.add("btn-good"):s.simpleStats[H.currentHole]?.gir===!1&&u.classList.add("btn-bad"),u.addEventListener("click",()=>{s.simpleStats[H.currentHole]||(s.simpleStats[H.currentHole]={}),s.simpleStats[H.currentHole].gir=!s.simpleStats[H.currentHole].gir,yr()}),l.appendChild(u);const h=s.simpleStats[H.currentHole]?.putts||0,d=document.createElement("div");d.style.cssText="display:flex; flex-direction:column; align-items:center;",d.innerHTML=`
             <div style="font-size:0.9rem; font-weight:bold; margin-bottom:5px; color:#64748b;">Putts</div>
             <div style="display:flex; align-items:center;">
                 <button class="btn-minus-putt" style="width:34px; height:34px; border-radius:50%; border:1px solid #cbd5e1; background:white;">-</button>
                 <span style="width:30px; text-align:center; font-weight:bold; font-size:1.2rem;">${h}</span>
                 <button class="btn-plus-putt" style="width:34px; height:34px; border-radius:50%; border:1px solid #cbd5e1; background:white;">+</button>
             </div>
        `,d.querySelector(".btn-plus-putt").addEventListener("click",()=>{s.simpleStats[H.currentHole]||(s.simpleStats[H.currentHole]={}),s.simpleStats[H.currentHole].putts=(s.simpleStats[H.currentHole].putts||0)+1,yr()}),d.querySelector(".btn-minus-putt").addEventListener("click",()=>{s.simpleStats[H.currentHole]?.putts>0&&(s.simpleStats[H.currentHole].putts--,yr())}),l.appendChild(d),o.appendChild(l);const p=s.scores[H.currentHole]||0,g=document.createElement("div");g.style.cssText="display:flex; align-items:center; background:white; border-radius:12px; border:2px solid #e2e8f0; padding:10px;",g.innerHTML=`
             <div style="font-weight:bold; font-size:1.1rem; flex:1;">Total Strokes</div>
             <button class="btn-score-minus" style="width:40px; height:40px; border-radius:50%; border:1px solid #cbd5e1; background:white;">-</button>
             <span style="width:40px; text-align:center; font-size:1.5rem; font-weight:bold; margin:0 10px; color:var(--primary-color);">${p}</span>
             <button class="btn-score-plus" style="width:40px; height:40px; border-radius:50%; background:var(--primary-color); color:white; border:none;">+</button>
        `,g.querySelector(".btn-score-plus").addEventListener("click",()=>{s.scores[H.currentHole]=(s.scores[H.currentHole]||0)+1,yr()}),g.querySelector(".btn-score-minus").addEventListener("click",()=>{s.scores[H.currentHole]>0&&(s.scores[H.currentHole]--,yr())}),o.appendChild(g),i.appendChild(o)}))}function w6(){const n=document.getElementById("btn-oc-prev-hole"),e=document.getElementById("btn-oc-next-hole");n&&(n.replaceWith(n.cloneNode(!0)),document.getElementById("btn-oc-prev-hole").addEventListener("click",()=>{H.currentHole>1&&(H.currentHole--,yr())})),e&&(e.replaceWith(e.cloneNode(!0)),document.getElementById("btn-oc-next-hole").addEventListener("click",()=>{H.currentHole<(H.currentRoundHoles||9)?(H.currentHole++,yr()):(document.getElementById("oc-finish-modal").classList.remove("hidden"),document.getElementById("oc-finish-holes").value=H.currentRoundHoles)}));const t=document.getElementById("btn-oc-finish");t&&t.addEventListener("click",()=>{document.getElementById("oc-finish-modal").classList.remove("hidden"),document.getElementById("oc-finish-holes").value=H.currentHole});const r=document.getElementById("btn-oc-cancel-finish");r&&r.addEventListener("click",()=>document.getElementById("oc-finish-modal").classList.add("hidden"));const i=document.getElementById("btn-oc-save-whs");i&&i.addEventListener("click",T6)}async function T6(){const n=document.getElementById("oc-finish-holes").value,e=document.getElementById("oc-manual-cr"),t=document.getElementById("oc-manual-sr"),r=document.getElementById("oc-manual-par"),i=e?parseFloat(e.value):72,s=t?parseFloat(t.value):113,a=r?parseFloat(r.value):72,o=H.currentRoundCourseName,c=P.ocTeeSelect.value,l=yn[o]?.[c]||{};try{for(let u of H.liveRoundGroups){let h=0,d=0;for(const E in u.scores){const I=u.scores[E];if(h+=I,l.pars&&l.strokeIndex){const v=parseInt(E)-1,R=l.pars[v],F=l.strokeIndex[v];R&&F&&(d+=am(I,R,F,u.dailyHandicap))}}const p=om(d,u.dailyHandicap,a);let g=0,m=0,_=0;for(const E in u.simpleStats)u.simpleStats[E].putts&&(g+=u.simpleStats[E].putts),u.simpleStats[E].gir&&(m+=1),u.simpleStats[E].fwy&&(_+=1);await qr(Ye(Ie,"whs_rounds"),{uid:u.uid,course:H.currentRoundCourseName+` (${n}H)`,rating:i,slope:s,adjustedGross:p,totalGross:h,totalStableford:d,dailyHandicap:u.dailyHandicap,date:wi(),isLiveTracked:!0,liveRoundsMode:H.currentTrackingMode,stats:{putts:g,gir:m,fwy:_}})}alert("Scores Saved successfully."),lm()}catch(u){console.error(u),alert("Failed to save.")}}function b6(){const n=document.getElementById("btn-oc-track-shot"),e=document.getElementById("oncourse-wizard"),t=document.getElementById("btn-wizard-cancel");n&&n.addEventListener("click",()=>{e.classList.remove("hidden");const i=(H.currentHoleShots?.length||0)+1;H.currentShotData={hole:H.currentHole,shotNumber:i,roundId:H.activeRoundId,timestamp:new Date().toISOString()},r("wizard-step-club",`Hole ${H.currentHole} - Shot ${i}`);const s=document.getElementById("detailed-shot-inputs");s?s.scrollIntoView({behavior:"smooth",block:"start"}):e.scrollIntoView({behavior:"smooth",block:"start"})}),P.btnWizardPrev&&P.btnWizardPrev.addEventListener("click",()=>{if(H.currentShotData.shotNumber>1){const i=H.currentShotData.shotNumber-1,s=H.currentHoleShots.find(a=>a.shotNumber===i);s&&(H.currentShotData={...s},r("wizard-step-club",`Hole ${H.currentHole} - Shot ${i}`))}}),P.btnWizardNext&&P.btnWizardNext.addEventListener("click",()=>{const i=H.currentShotData.shotNumber+1,s=H.currentHoleShots.find(a=>a.shotNumber===i);s?(H.currentShotData={...s},r("wizard-step-club",`Hole ${H.currentHole} - Shot ${i}`)):(H.currentShotData={hole:H.currentHole,shotNumber:i,roundId:H.activeRoundId,timestamp:new Date().toISOString()},r("wizard-step-club",`Hole ${H.currentHole} - Shot ${i}`))}),t&&t.addEventListener("click",()=>e.classList.add("hidden"));function r(i,s){document.querySelectorAll(".wizard-step").forEach(c=>c.classList.add("hidden"));const a=document.getElementById(i);a&&a.classList.remove("hidden");const o=document.getElementById("wizard-title");o&&(o.textContent=s),P.btnWizardDelete&&(H.currentShotData?.id?P.btnWizardDelete.classList.remove("hidden"):P.btnWizardDelete.classList.add("hidden"))}P.btnWizardDelete&&P.btnWizardDelete.addEventListener("click",I6),document.querySelectorAll(".wizard-step .btn-grid").forEach(i=>{i.addEventListener("click",s=>{const a=s.target.closest(".btn-grid"),o=a.getAttribute("data-val"),c=a.getAttribute("data-traj"),l=a.getAttribute("data-line"),u=a.getAttribute("data-curve"),h=a.getAttribute("data-dist"),d=a.getAttribute("data-out"),p=a.getAttribute("data-pline"),g=a.getAttribute("data-pdist");o?(H.currentShotData.club=o,o==="Putter"?r("wizard-step-putt","Putting"):r("wizard-step-line","Start Line & Curve")):c?(H.currentShotData.trajectory=c,r("wizard-step-line","Start Line & Curve")):l||u?(l&&(H.currentShotData.line=l),u&&(H.currentShotData.curve=u),H.currentShotData.line&&H.currentShotData.curve&&r("wizard-step-outcome","Shot Result")):h||d?(h&&(H.currentShotData.distanceControl=h),d&&(H.currentShotData.outcome=d),H.currentShotData.distanceControl&&H.currentShotData.outcome&&Hy()):(p||g)&&(p&&(H.currentShotData.puttLine=p),g&&(H.currentShotData.puttDistance=g),H.currentShotData.puttLine&&H.currentShotData.puttDistance&&Hy())})})}async function Hy(){if(!H.currentUser)return;document.getElementById("oncourse-wizard").classList.add("hidden");const n={uid:H.currentUser.uid,...H.currentShotData};try{if(H.currentShotData.id){await Pa(pt(Ie,"shots",H.currentShotData.id),n);const e=H.currentHoleShots.findIndex(t=>t.id===H.currentShotData.id);e!==-1&&(H.currentHoleShots[e]={...n,id:H.currentShotData.id})}else{const e=await qr(Ye(Ie,"shots"),n);H.currentHoleShots.push({...n,id:e.id});const t=H.liveRoundGroups.find(r=>r.uid===H.currentUser.uid);t&&(t.scores[H.currentHole]=(t.scores[H.currentHole]||0)+1,yr())}zo("Shot Logged ")}catch{zo("Error saving shot.")}}async function I6(){if(!(!H.currentUser||!H.currentShotData.id)&&confirm("Are you sure you want to delete this shot?")){document.getElementById("oncourse-wizard").classList.add("hidden");try{await _u(pt(Ie,"shots",H.currentShotData.id)),H.currentHoleShots=H.currentHoleShots.filter(e=>e.id!==H.currentShotData.id);const n=H.liveRoundGroups.find(e=>e.uid===H.currentUser.uid);n&&(n.scores[H.currentHole]=Math.max(0,(n.scores[H.currentHole]||0)-1),yr()),zo("Shot Deleted "),H.currentShotData={}}catch(n){console.error(n),zo("Error deleting shot.")}}}function zo(n){const e=document.createElement("div");e.textContent=n,e.style.cssText="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#10b981; color:white; padding:12px 24px; border-radius:30px; font-weight:bold; z-index:9999;",document.body.appendChild(e),setTimeout(()=>e.remove(),2e3)}function A6(){P.btnOcReviewRound&&P.btnOcReviewRound.addEventListener("click",async()=>{if(!P.reviewRoundModal||!P.reviewContent)return;P.reviewRoundModal.classList.remove("hidden"),P.reviewContent.innerHTML='<p style="text-align:center; padding:20px; color:#64748b;">Generating detailed review...</p>';const n=H.currentRoundCourseName,e=P.ocTeeSelect.value,t=yn[n]?.[e]||{},r=document.getElementById("oc-manual-par"),i=r?parseFloat(r.value):t.par||72,s=an(Ye(Ie,"shots"),Qt("roundId","==",H.activeRoundId));let a=[];try{(await Nt(s)).forEach(c=>a.push(c.data())),a.sort((c,l)=>c.hole-l.hole||c.shotNumber-l.shotNumber)}catch(o){console.error("Error fetching shots for review:",o)}P.reviewContent.innerHTML="",H.liveRoundGroups.forEach(o=>{let c=0,l=0;const u=a.filter(g=>g.uid===o.uid);for(let g=1;g<=(H.currentRoundHoles||9);g++){const m=o.scores[g]||0;if(c+=m,t.pars&&t.strokeIndex){const _=g-1,E=t.pars[_],I=t.strokeIndex[_];E&&I&&m>0&&(l+=am(m,E,I,o.dailyHandicap))}}const h=om(l,o.dailyHandicap,i),d=document.createElement("div");d.className="card",d.style.cssText="padding:15px; background:white; border:1px solid #e2e8f0; border-radius:12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);";let p="";u.length>0&&(p=`<details style="margin-top:10px; border-top:1px solid #f1f5f9; padding-top:10px;">
                        <summary style="cursor:pointer; font-size:0.85rem; color:var(--secondary-color); font-weight:600;">View Shot History (${u.length})</summary>
                        <div style="font-size:0.8rem; margin-top:8px; color:#475569;">
                            ${u.map(g=>`<div>H${g.hole} S${g.shotNumber}: ${g.club||"Club"}  ${g.outcome||"Result"}</div>`).join("")}
                        </div>
                    </details>`),d.innerHTML=`
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                        <strong style="font-size:1.15rem; color:var(--primary-color);">${o.name}</strong>
                        <span style="font-size:0.85rem; background:#f1f5f9; padding:2px 8px; border-radius:12px; color:#64748b;">DH: ${o.dailyHandicap}</span>
                    </div>
                    <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; text-align:center; background:#f8fafc; padding:10px; border-radius:8px;">
                        <div>
                            <div style="font-size:0.7rem; color:#94a3b8; text-transform:uppercase; font-weight:700;">Gross</div>
                            <div style="font-size:1.25rem; font-weight:800; color:#1e293b;">${c}</div>
                        </div>
                        <div>
                            <div style="font-size:0.7rem; color:#94a3b8; text-transform:uppercase; font-weight:700;">Pts</div>
                            <div style="font-size:1.25rem; font-weight:800; color:var(--primary-color);">${l}</div>
                        </div>
                        <div>
                            <div style="font-size:0.7rem; color:#94a3b8; text-transform:uppercase; font-weight:700;">AGS</div>
                            <div style="font-size:1.25rem; font-weight:800; color:#334155;">${h||c}</div>
                        </div>
                    </div>
                    ${p}
                `,P.reviewContent.appendChild(d)})}),P.btnCloseReview&&P.btnCloseReview.addEventListener("click",()=>P.reviewRoundModal.classList.add("hidden")),P.btnReviewFinished&&P.btnReviewFinished.addEventListener("click",()=>P.reviewRoundModal.classList.add("hidden"))}function S6(){const n=document.getElementById("btn-feed-search"),e=document.getElementById("feed-search-input");!n||!e||(n.addEventListener("click",async()=>{const t=e.value.trim().toLowerCase();if(!t)return;const r=document.getElementById("feed-search-results");r.textContent="Searching...";try{if(!H.allUsersCache){const s=await Nt(Ye(Ie,"users"));H.allUsersCache=[],s.forEach(a=>H.allUsersCache.push({uid:a.id,...a.data()}))}const i=[];if(H.allUsersCache.forEach(s=>{if(s.uid===H.currentUser.uid||!s.isApproved)return;(s.displayName||"").toLowerCase().includes(t)&&i.push(s)}),!i.length){r.textContent="No players found.";return}r.innerHTML="",i.forEach(s=>{const a=document.createElement("div");a.style.cssText="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f1f5f9;",a.innerHTML=`
                    <span style="font-weight:600;">${s.displayName||s.email}</span>
                    <button data-uid="${s.uid}" class="btn btn-primary btn-sm follow-btn" style="width:auto;margin:0;">Follow</button>
                `,a.querySelector(".follow-btn").addEventListener("click",async o=>{const c=o.target.dataset.uid;await k6(c),o.target.textContent=" Following",o.target.disabled=!0,dp(),pp()}),r.appendChild(a)})}catch{r.textContent="Error searching. Try again."}}),dp(),pp())}async function k6(n){const e=H.currentUser.uid;await ec(pt(Ie,"users",e,"following",n),{followedAt:new Date().toISOString()})}async function C6(n){const e=H.currentUser.uid;await _u(pt(Ie,"users",e,"following",n)),dp(),pp()}async function dp(){const n=document.getElementById("feed-following-list");if(!n)return;const e=H.currentUser.uid,t=await Nt(Ye(Ie,"users",e,"following"));if(n.innerHTML="",t.empty){n.innerHTML='<li style="color:#94a3b8;">Not following anyone yet.</li>';return}for(const r of t.docs){const i=r.id,s=await Ri(pt(Ie,"users",i)),a=s.exists()&&s.data().displayName||i,o=document.createElement("li");o.style.cssText="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f1f5f9;",o.innerHTML=`<span>${a}</span><button data-uid="${i}" class="btn btn-secondary btn-sm unfollow-btn" style="width:auto;margin:0;font-size:0.78rem;">Unfollow</button>`,o.querySelector(".unfollow-btn").addEventListener("click",c=>C6(c.target.dataset.uid)),n.appendChild(o)}}async function pp(){const n=document.getElementById("feed-activity-list");if(!n)return;const e=H.currentUser.uid;n.innerHTML='<p style="color:#94a3b8;">Loading...</p>';const t=await Nt(Ye(Ie,"users",e,"following"));if(t.empty){n.innerHTML='<p style="color:#94a3b8;">Follow some players to see their recent rounds here.</p>';return}const i=t.docs.map(o=>o.id).slice(0,10),s=await Nt(an(Ye(Ie,"whs_rounds"),Qt("uid","in",i),Ti("date","desc"),Bl(20)));if(s.empty){n.innerHTML='<p style="color:#94a3b8;">No recent rounds from people you follow.</p>';return}const a={};for(const o of i){const c=await Ri(pt(Ie,"users",o));a[o]=c.exists()&&c.data().displayName||o}n.innerHTML="",s.forEach(o=>{const c=o.data(),l=(113/c.slope*(c.adjustedGross-c.rating)).toFixed(1),u=c.date?.toDate?c.date.toDate().toLocaleDateString("en-AU"):new Date(c.date).toLocaleDateString("en-AU"),h=document.createElement("div");h.style.cssText="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:14px 16px;",h.innerHTML=`
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
                <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#3867d6,#4b7bec);color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.9rem;">
                    ${(a[c.uid]||"?")[0].toUpperCase()}
                </div>
                <div>
                    <strong>${a[c.uid]||"Unknown"}</strong>
                    <span style="color:#94a3b8;font-size:0.8rem;margin-left:8px;">${u}</span>
                </div>
            </div>
            <div style="font-size:0.88rem;color:#475569;">
                 <strong>${c.course}</strong> &nbsp;&nbsp; Score: <strong>${c.adjustedGross}</strong> &nbsp;&nbsp; Diff: <strong>${l}</strong>
            </div>
        `,n.appendChild(h)})}var TI=1252,R6=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],um={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},hm=function(n){R6.indexOf(n)!=-1&&(TI=um[0]=n)};function P6(){hm(1252)}var Tr=function(n){hm(n)};function bI(){Tr(1200),P6()}function zy(n){for(var e=[],t=0,r=n.length;t<r;++t)e[t]=n.charCodeAt(t);return e}function D6(n){for(var e=[],t=0;t<n.length>>1;++t)e[t]=String.fromCharCode(n.charCodeAt(2*t)+(n.charCodeAt(2*t+1)<<8));return e.join("")}function II(n){for(var e=[],t=0;t<n.length>>1;++t)e[t]=String.fromCharCode(n.charCodeAt(2*t+1)+(n.charCodeAt(2*t)<<8));return e.join("")}var Uc=function(n){var e=n.charCodeAt(0),t=n.charCodeAt(1);return e==255&&t==254?D6(n.slice(2)):e==254&&t==255?II(n.slice(2)):e==65279?n.slice(1):n},ih=function(e){return String.fromCharCode(e)},$y=function(e){return String.fromCharCode(e)},Hl,is="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Wy(n){for(var e="",t=0,r=0,i=0,s=0,a=0,o=0,c=0,l=0;l<n.length;)t=n.charCodeAt(l++),s=t>>2,r=n.charCodeAt(l++),a=(t&3)<<4|r>>4,i=n.charCodeAt(l++),o=(r&15)<<2|i>>6,c=i&63,isNaN(r)?o=c=64:isNaN(i)&&(c=64),e+=is.charAt(s)+is.charAt(a)+is.charAt(o)+is.charAt(c);return e}function nr(n){var e="",t=0,r=0,i=0,s=0,a=0,o=0,c=0;n=n.replace(/[^\w\+\/\=]/g,"");for(var l=0;l<n.length;)s=is.indexOf(n.charAt(l++)),a=is.indexOf(n.charAt(l++)),t=s<<2|a>>4,e+=String.fromCharCode(t),o=is.indexOf(n.charAt(l++)),r=(a&15)<<4|o>>2,o!==64&&(e+=String.fromCharCode(r)),c=is.indexOf(n.charAt(l++)),i=(o&3)<<6|c,c!==64&&(e+=String.fromCharCode(i));return e}var Ke=(function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node})(),Da=(function(){if(typeof Buffer<"u"){var n=!Buffer.from;if(!n)try{Buffer.from("foo","utf8")}catch{n=!0}return n?function(e,t){return t?new Buffer(e,t):new Buffer(e)}:Buffer.from.bind(Buffer)}return function(){}})();function vs(n){return Ke?Buffer.alloc?Buffer.alloc(n):new Buffer(n):typeof Uint8Array<"u"?new Uint8Array(n):new Array(n)}function jy(n){return Ke?Buffer.allocUnsafe?Buffer.allocUnsafe(n):new Buffer(n):typeof Uint8Array<"u"?new Uint8Array(n):new Array(n)}var vr=function(e){return Ke?Da(e,"binary"):e.split("").map(function(t){return t.charCodeAt(0)&255})};function Fa(n){if(Array.isArray(n))return n.map(function(r){return String.fromCharCode(r)}).join("");for(var e=[],t=0;t<n.length;++t)e[t]=String.fromCharCode(n[t]);return e.join("")}function fm(n){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(n instanceof ArrayBuffer)return fm(new Uint8Array(n));for(var e=new Array(n.length),t=0;t<n.length;++t)e[t]=n[t];return e}var Ji=Ke?function(n){return Buffer.concat(n.map(function(e){return Buffer.isBuffer(e)?e:Da(e)}))}:function(n){if(typeof Uint8Array<"u"){var e=0,t=0;for(e=0;e<n.length;++e)t+=n[e].length;var r=new Uint8Array(t),i=0;for(e=0,t=0;e<n.length;t+=i,++e)if(i=n[e].length,n[e]instanceof Uint8Array)r.set(n[e],t);else{if(typeof n[e]=="string")throw"wtf";r.set(new Uint8Array(n[e]),t)}return r}return[].concat.apply([],n.map(function(s){return Array.isArray(s)?s:[].slice.call(s)}))};function F6(n){for(var e=[],t=0,r=n.length+250,i=vs(n.length+255),s=0;s<n.length;++s){var a=n.charCodeAt(s);if(a<128)i[t++]=a;else if(a<2048)i[t++]=192|a>>6&31,i[t++]=128|a&63;else if(a>=55296&&a<57344){a=(a&1023)+64;var o=n.charCodeAt(++s)&1023;i[t++]=240|a>>8&7,i[t++]=128|a>>2&63,i[t++]=128|o>>6&15|(a&3)<<4,i[t++]=128|o&63}else i[t++]=224|a>>12&15,i[t++]=128|a>>6&63,i[t++]=128|a&63;t>r&&(e.push(i.slice(0,t)),t=0,i=vs(65535),r=65530)}return e.push(i.slice(0,t)),Ji(e)}var Vn=/\u0000/g,Hc=/[\u0001-\u0006]/g;function go(n){for(var e="",t=n.length-1;t>=0;)e+=n.charAt(t--);return e}function br(n,e){var t=""+n;return t.length>=e?t:Rt("0",e-t.length)+t}function dm(n,e){var t=""+n;return t.length>=e?t:Rt(" ",e-t.length)+t}function yf(n,e){var t=""+n;return t.length>=e?t:t+Rt(" ",e-t.length)}function O6(n,e){var t=""+Math.round(n);return t.length>=e?t:Rt("0",e-t.length)+t}function M6(n,e){var t=""+n;return t.length>=e?t:Rt("0",e-t.length)+t}var Gy=Math.pow(2,32);function Za(n,e){if(n>Gy||n<-Gy)return O6(n,e);var t=Math.round(n);return M6(t,e)}function vf(n,e){return e=e||0,n.length>=7+e&&(n.charCodeAt(e)|32)===103&&(n.charCodeAt(e+1)|32)===101&&(n.charCodeAt(e+2)|32)===110&&(n.charCodeAt(e+3)|32)===101&&(n.charCodeAt(e+4)|32)===114&&(n.charCodeAt(e+5)|32)===97&&(n.charCodeAt(e+6)|32)===108}var qy=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],l0=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function L6(n){return n||(n={}),n[0]="General",n[1]="0",n[2]="0.00",n[3]="#,##0",n[4]="#,##0.00",n[9]="0%",n[10]="0.00%",n[11]="0.00E+00",n[12]="# ?/?",n[13]="# ??/??",n[14]="m/d/yy",n[15]="d-mmm-yy",n[16]="d-mmm",n[17]="mmm-yy",n[18]="h:mm AM/PM",n[19]="h:mm:ss AM/PM",n[20]="h:mm",n[21]="h:mm:ss",n[22]="m/d/yy h:mm",n[37]="#,##0 ;(#,##0)",n[38]="#,##0 ;[Red](#,##0)",n[39]="#,##0.00;(#,##0.00)",n[40]="#,##0.00;[Red](#,##0.00)",n[45]="mm:ss",n[46]="[h]:mm:ss",n[47]="mmss.0",n[48]="##0.0E+0",n[49]="@",n[56]='"/ "hh""mm""ss" "',n}var Ne={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},Ky={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},N6={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Ef(n,e,t){for(var r=n<0?-1:1,i=n*r,s=0,a=1,o=0,c=1,l=0,u=0,h=Math.floor(i);l<e&&(h=Math.floor(i),o=h*a+s,u=h*l+c,!(i-h<5e-8));)i=1/(i-h),s=a,a=o,c=l,l=u;if(u>e&&(l>e?(u=c,o=s):(u=l,o=a)),!t)return[0,r*o,u];var d=Math.floor(r*o/u);return[d,r*o-d*u,u]}function na(n,e,t){if(n>2958465||n<0)return null;var r=n|0,i=Math.floor(86400*(n-r)),s=0,a=[],o={D:r,T:i,u:86400*(n-r)-i,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(o.u)<1e-6&&(o.u=0),e&&e.date1904&&(r+=1462),o.u>.9999&&(o.u=0,++i==86400&&(o.T=i=0,++r,++o.D)),r===60)a=t?[1317,10,29]:[1900,2,29],s=3;else if(r===0)a=t?[1317,8,29]:[1900,1,0],s=6;else{r>60&&--r;var c=new Date(1900,0,1);c.setDate(c.getDate()+r-1),a=[c.getFullYear(),c.getMonth()+1,c.getDate()],s=c.getDay(),r<60&&(s=(s+6)%7),t&&(s=$6(c,a))}return o.y=a[0],o.m=a[1],o.d=a[2],o.S=i%60,i=Math.floor(i/60),o.M=i%60,i=Math.floor(i/60),o.H=i,o.q=s,o}var AI=new Date(1899,11,31,0,0,0),V6=AI.getTime(),B6=new Date(1900,2,1,0,0,0);function SI(n,e){var t=n.getTime();return e?t-=1461*24*60*60*1e3:n>=B6&&(t+=1440*60*1e3),(t-(V6+(n.getTimezoneOffset()-AI.getTimezoneOffset())*6e4))/(1440*60*1e3)}function pm(n){return n.indexOf(".")==-1?n:n.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function U6(n){return n.indexOf("E")==-1?n:n.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function H6(n){var e=n<0?12:11,t=pm(n.toFixed(12));return t.length<=e||(t=n.toPrecision(10),t.length<=e)?t:n.toExponential(5)}function z6(n){var e=pm(n.toFixed(11));return e.length>(n<0?12:11)||e==="0"||e==="-0"?n.toPrecision(6):e}function zl(n){var e=Math.floor(Math.log(Math.abs(n))*Math.LOG10E),t;return e>=-4&&e<=-1?t=n.toPrecision(10+e):Math.abs(e)<=9?t=H6(n):e===10?t=n.toFixed(10).substr(0,12):t=z6(n),pm(U6(t.toUpperCase()))}function Aa(n,e){switch(typeof n){case"string":return n;case"boolean":return n?"TRUE":"FALSE";case"number":return(n|0)===n?n.toString(10):zl(n);case"undefined":return"";case"object":if(n==null)return"";if(n instanceof Date)return ur(14,SI(n,e&&e.date1904),e)}throw new Error("unsupported value in General format: "+n)}function $6(n,e){e[0]-=581;var t=n.getDay();return n<60&&(t=(t+6)%7),t}function W6(n,e,t,r){var i="",s=0,a=0,o=t.y,c,l=0;switch(n){case 98:o=t.y+543;case 121:switch(e.length){case 1:case 2:c=o%100,l=2;break;default:c=o%1e4,l=4;break}break;case 109:switch(e.length){case 1:case 2:c=t.m,l=e.length;break;case 3:return l0[t.m-1][1];case 5:return l0[t.m-1][0];default:return l0[t.m-1][2]}break;case 100:switch(e.length){case 1:case 2:c=t.d,l=e.length;break;case 3:return qy[t.q][0];default:return qy[t.q][1]}break;case 104:switch(e.length){case 1:case 2:c=1+(t.H+11)%12,l=e.length;break;default:throw"bad hour format: "+e}break;case 72:switch(e.length){case 1:case 2:c=t.H,l=e.length;break;default:throw"bad hour format: "+e}break;case 77:switch(e.length){case 1:case 2:c=t.M,l=e.length;break;default:throw"bad minute format: "+e}break;case 115:if(e!="s"&&e!="ss"&&e!=".0"&&e!=".00"&&e!=".000")throw"bad second format: "+e;return t.u===0&&(e=="s"||e=="ss")?br(t.S,e.length):(r>=2?a=r===3?1e3:100:a=r===1?10:1,s=Math.round(a*(t.S+t.u)),s>=60*a&&(s=0),e==="s"?s===0?"0":""+s/a:(i=br(s,2+r),e==="ss"?i.substr(0,2):"."+i.substr(2,e.length-1)));case 90:switch(e){case"[h]":case"[hh]":c=t.D*24+t.H;break;case"[m]":case"[mm]":c=(t.D*24+t.H)*60+t.M;break;case"[s]":case"[ss]":c=((t.D*24+t.H)*60+t.M)*60+Math.round(t.S+t.u);break;default:throw"bad abstime format: "+e}l=e.length===3?1:2;break;case 101:c=o,l=1;break}var u=l>0?br(c,l):"";return u}function ss(n){var e=3;if(n.length<=e)return n;for(var t=n.length%e,r=n.substr(0,t);t!=n.length;t+=e)r+=(r.length>0?",":"")+n.substr(t,e);return r}var kI=/%/g;function j6(n,e,t){var r=e.replace(kI,""),i=e.length-r.length;return mi(n,r,t*Math.pow(10,2*i))+Rt("%",i)}function G6(n,e,t){for(var r=e.length-1;e.charCodeAt(r-1)===44;)--r;return mi(n,e.substr(0,r),t/Math.pow(10,3*(e.length-r)))}function CI(n,e){var t,r=n.indexOf("E")-n.indexOf(".")-1;if(n.match(/^#+0.0E\+0$/)){if(e==0)return"0.0E+0";if(e<0)return"-"+CI(n,-e);var i=n.indexOf(".");i===-1&&(i=n.indexOf("E"));var s=Math.floor(Math.log(e)*Math.LOG10E)%i;if(s<0&&(s+=i),t=(e/Math.pow(10,s)).toPrecision(r+1+(i+s)%i),t.indexOf("e")===-1){var a=Math.floor(Math.log(e)*Math.LOG10E);for(t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(a-t.length+s):t+="E+"+(a-s);t.substr(0,2)==="0.";)t=t.charAt(0)+t.substr(2,i)+"."+t.substr(2+i),t=t.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,c,l,u){return c+l+u.substr(0,(i+s)%i)+"."+u.substr(s)+"E"})}else t=e.toExponential(r);return n.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),n.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}var RI=/# (\?+)( ?)\/( ?)(\d+)/;function q6(n,e,t){var r=parseInt(n[4],10),i=Math.round(e*r),s=Math.floor(i/r),a=i-s*r,o=r;return t+(s===0?"":""+s)+" "+(a===0?Rt(" ",n[1].length+1+n[4].length):dm(a,n[1].length)+n[2]+"/"+n[3]+br(o,n[4].length))}function K6(n,e,t){return t+(e===0?"":""+e)+Rt(" ",n[1].length+2+n[4].length)}var PI=/^#*0*\.([0#]+)/,DI=/\).*[0#]/,FI=/\(###\) ###\\?-####/;function On(n){for(var e="",t,r=0;r!=n.length;++r)switch(t=n.charCodeAt(r)){case 35:break;case 63:e+=" ";break;case 48:e+="0";break;default:e+=String.fromCharCode(t)}return e}function Yy(n,e){var t=Math.pow(10,e);return""+Math.round(n*t)/t}function Xy(n,e){var t=n-Math.floor(n),r=Math.pow(10,e);return e<(""+Math.round(t*r)).length?0:Math.round(t*r)}function Y6(n,e){return e<(""+Math.round((n-Math.floor(n))*Math.pow(10,e))).length?1:0}function X6(n){return n<2147483647&&n>-2147483648?""+(n>=0?n|0:n-1|0):""+Math.floor(n)}function ar(n,e,t){if(n.charCodeAt(0)===40&&!e.match(DI)){var r=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?ar("n",r,t):"("+ar("n",r,-t)+")"}if(e.charCodeAt(e.length-1)===44)return G6(n,e,t);if(e.indexOf("%")!==-1)return j6(n,e,t);if(e.indexOf("E")!==-1)return CI(e,t);if(e.charCodeAt(0)===36)return"$"+ar(n,e.substr(e.charAt(1)==" "?2:1),t);var i,s,a,o,c=Math.abs(t),l=t<0?"-":"";if(e.match(/^00+$/))return l+Za(c,e.length);if(e.match(/^[#?]+$/))return i=Za(t,0),i==="0"&&(i=""),i.length>e.length?i:On(e.substr(0,e.length-i.length))+i;if(s=e.match(RI))return q6(s,c,l);if(e.match(/^#+0+$/))return l+Za(c,e.length-e.indexOf("0"));if(s=e.match(PI))return i=Yy(t,s[1].length).replace(/^([^\.]+)$/,"$1."+On(s[1])).replace(/\.$/,"."+On(s[1])).replace(/\.(\d*)$/,function(g,m){return"."+m+Rt("0",On(s[1]).length-m.length)}),e.indexOf("0.")!==-1?i:i.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),s=e.match(/^(0*)\.(#*)$/))return l+Yy(c,s[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,s[1].length?"0.":".");if(s=e.match(/^#{1,3},##0(\.?)$/))return l+ss(Za(c,0));if(s=e.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+ar(n,e,-t):ss(""+(Math.floor(t)+Y6(t,s[1].length)))+"."+br(Xy(t,s[1].length),s[1].length);if(s=e.match(/^#,#*,#0/))return ar(n,e.replace(/^#,#*,/,""),t);if(s=e.match(/^([0#]+)(\\?-([0#]+))+$/))return i=go(ar(n,e.replace(/[\\-]/g,""),t)),a=0,go(go(e.replace(/\\/g,"")).replace(/[0#]/g,function(g){return a<i.length?i.charAt(a++):g==="0"?"0":""}));if(e.match(FI))return i=ar(n,"##########",t),"("+i.substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var u="";if(s=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(s[4].length,7),o=Ef(c,Math.pow(10,a)-1,!1),i=""+l,u=mi("n",s[1],o[1]),u.charAt(u.length-1)==" "&&(u=u.substr(0,u.length-1)+"0"),i+=u+s[2]+"/"+s[3],u=yf(o[2],a),u.length<s[4].length&&(u=On(s[4].substr(s[4].length-u.length))+u),i+=u,i;if(s=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(Math.max(s[1].length,s[4].length),7),o=Ef(c,Math.pow(10,a)-1,!0),l+(o[0]||(o[1]?"":"0"))+" "+(o[1]?dm(o[1],a)+s[2]+"/"+s[3]+yf(o[2],a):Rt(" ",2*a+1+s[2].length+s[3].length));if(s=e.match(/^[#0?]+$/))return i=Za(t,0),e.length<=i.length?i:On(e.substr(0,e.length-i.length))+i;if(s=e.match(/^([#0?]+)\.([#0]+)$/)){i=""+t.toFixed(Math.min(s[2].length,10)).replace(/([^0])0+$/,"$1"),a=i.indexOf(".");var h=e.indexOf(".")-a,d=e.length-i.length-h;return On(e.substr(0,h)+i+e.substr(e.length-d))}if(s=e.match(/^00,000\.([#0]*0)$/))return a=Xy(t,s[1].length),t<0?"-"+ar(n,e,-t):ss(X6(t)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(g){return"00,"+(g.length<3?br(0,3-g.length):"")+g})+"."+br(a,s[1].length);switch(e){case"###,##0.00":return ar(n,"#,##0.00",t);case"###,###":case"##,###":case"#,###":var p=ss(Za(c,0));return p!=="0"?l+p:"";case"###,###.00":return ar(n,"###,##0.00",t).replace(/^0\./,".");case"#,###.00":return ar(n,"#,##0.00",t).replace(/^0\./,".")}throw new Error("unsupported format |"+e+"|")}function Q6(n,e,t){for(var r=e.length-1;e.charCodeAt(r-1)===44;)--r;return mi(n,e.substr(0,r),t/Math.pow(10,3*(e.length-r)))}function J6(n,e,t){var r=e.replace(kI,""),i=e.length-r.length;return mi(n,r,t*Math.pow(10,2*i))+Rt("%",i)}function OI(n,e){var t,r=n.indexOf("E")-n.indexOf(".")-1;if(n.match(/^#+0.0E\+0$/)){if(e==0)return"0.0E+0";if(e<0)return"-"+OI(n,-e);var i=n.indexOf(".");i===-1&&(i=n.indexOf("E"));var s=Math.floor(Math.log(e)*Math.LOG10E)%i;if(s<0&&(s+=i),t=(e/Math.pow(10,s)).toPrecision(r+1+(i+s)%i),!t.match(/[Ee]/)){var a=Math.floor(Math.log(e)*Math.LOG10E);t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(a-t.length+s):t+="E+"+(a-s),t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,c,l,u){return c+l+u.substr(0,(i+s)%i)+"."+u.substr(s)+"E"})}else t=e.toExponential(r);return n.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),n.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}function Or(n,e,t){if(n.charCodeAt(0)===40&&!e.match(DI)){var r=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Or("n",r,t):"("+Or("n",r,-t)+")"}if(e.charCodeAt(e.length-1)===44)return Q6(n,e,t);if(e.indexOf("%")!==-1)return J6(n,e,t);if(e.indexOf("E")!==-1)return OI(e,t);if(e.charCodeAt(0)===36)return"$"+Or(n,e.substr(e.charAt(1)==" "?2:1),t);var i,s,a,o,c=Math.abs(t),l=t<0?"-":"";if(e.match(/^00+$/))return l+br(c,e.length);if(e.match(/^[#?]+$/))return i=""+t,t===0&&(i=""),i.length>e.length?i:On(e.substr(0,e.length-i.length))+i;if(s=e.match(RI))return K6(s,c,l);if(e.match(/^#+0+$/))return l+br(c,e.length-e.indexOf("0"));if(s=e.match(PI))return i=(""+t).replace(/^([^\.]+)$/,"$1."+On(s[1])).replace(/\.$/,"."+On(s[1])),i=i.replace(/\.(\d*)$/,function(g,m){return"."+m+Rt("0",On(s[1]).length-m.length)}),e.indexOf("0.")!==-1?i:i.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),s=e.match(/^(0*)\.(#*)$/))return l+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,s[1].length?"0.":".");if(s=e.match(/^#{1,3},##0(\.?)$/))return l+ss(""+c);if(s=e.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Or(n,e,-t):ss(""+t)+"."+Rt("0",s[1].length);if(s=e.match(/^#,#*,#0/))return Or(n,e.replace(/^#,#*,/,""),t);if(s=e.match(/^([0#]+)(\\?-([0#]+))+$/))return i=go(Or(n,e.replace(/[\\-]/g,""),t)),a=0,go(go(e.replace(/\\/g,"")).replace(/[0#]/g,function(g){return a<i.length?i.charAt(a++):g==="0"?"0":""}));if(e.match(FI))return i=Or(n,"##########",t),"("+i.substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var u="";if(s=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(s[4].length,7),o=Ef(c,Math.pow(10,a)-1,!1),i=""+l,u=mi("n",s[1],o[1]),u.charAt(u.length-1)==" "&&(u=u.substr(0,u.length-1)+"0"),i+=u+s[2]+"/"+s[3],u=yf(o[2],a),u.length<s[4].length&&(u=On(s[4].substr(s[4].length-u.length))+u),i+=u,i;if(s=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return a=Math.min(Math.max(s[1].length,s[4].length),7),o=Ef(c,Math.pow(10,a)-1,!0),l+(o[0]||(o[1]?"":"0"))+" "+(o[1]?dm(o[1],a)+s[2]+"/"+s[3]+yf(o[2],a):Rt(" ",2*a+1+s[2].length+s[3].length));if(s=e.match(/^[#0?]+$/))return i=""+t,e.length<=i.length?i:On(e.substr(0,e.length-i.length))+i;if(s=e.match(/^([#0]+)\.([#0]+)$/)){i=""+t.toFixed(Math.min(s[2].length,10)).replace(/([^0])0+$/,"$1"),a=i.indexOf(".");var h=e.indexOf(".")-a,d=e.length-i.length-h;return On(e.substr(0,h)+i+e.substr(e.length-d))}if(s=e.match(/^00,000\.([#0]*0)$/))return t<0?"-"+Or(n,e,-t):ss(""+t).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(g){return"00,"+(g.length<3?br(0,3-g.length):"")+g})+"."+br(0,s[1].length);switch(e){case"###,###":case"##,###":case"#,###":var p=ss(""+c);return p!=="0"?l+p:"";default:if(e.match(/\.[0#?]*$/))return Or(n,e.slice(0,e.lastIndexOf(".")),t)+On(e.slice(e.lastIndexOf(".")))}throw new Error("unsupported format |"+e+"|")}function mi(n,e,t){return(t|0)===t?Or(n,e,t):ar(n,e,t)}function Z6(n){for(var e=[],t=!1,r=0,i=0;r<n.length;++r)switch(n.charCodeAt(r)){case 34:t=!t;break;case 95:case 42:case 92:++r;break;case 59:e[e.length]=n.substr(i,r-i),i=r+1}if(e[e.length]=n.substr(i),t===!0)throw new Error("Format |"+n+"| unterminated string ");return e}var MI=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function tc(n){for(var e=0,t="",r="";e<n.length;)switch(t=n.charAt(e)){case"G":vf(n,e)&&(e+=6),e++;break;case'"':for(;n.charCodeAt(++e)!==34&&e<n.length;);++e;break;case"\\":e+=2;break;case"_":e+=2;break;case"@":++e;break;case"B":case"b":if(n.charAt(e+1)==="1"||n.charAt(e+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(n.substr(e,3).toUpperCase()==="A/P"||n.substr(e,5).toUpperCase()==="AM/PM"||n.substr(e,5).toUpperCase()==="/")return!0;++e;break;case"[":for(r=t;n.charAt(e++)!=="]"&&e<n.length;)r+=n.charAt(e);if(r.match(MI))return!0;break;case".":case"0":case"#":for(;e<n.length&&("0#?.,E+-%".indexOf(t=n.charAt(++e))>-1||t=="\\"&&n.charAt(e+1)=="-"&&"0#".indexOf(n.charAt(e+2))>-1););break;case"?":for(;n.charAt(++e)===t;);break;case"*":++e,(n.charAt(e)==" "||n.charAt(e)=="*")&&++e;break;case"(":case")":++e;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;e<n.length&&"0123456789".indexOf(n.charAt(++e))>-1;);break;case" ":++e;break;default:++e;break}return!1}function e5(n,e,t,r){for(var i=[],s="",a=0,o="",c="t",l,u,h,d="H";a<n.length;)switch(o=n.charAt(a)){case"G":if(!vf(n,a))throw new Error("unrecognized character "+o+" in "+n);i[i.length]={t:"G",v:"General"},a+=7;break;case'"':for(s="";(h=n.charCodeAt(++a))!==34&&a<n.length;)s+=String.fromCharCode(h);i[i.length]={t:"t",v:s},++a;break;case"\\":var p=n.charAt(++a),g=p==="("||p===")"?p:"t";i[i.length]={t:g,v:p},++a;break;case"_":i[i.length]={t:"t",v:" "},a+=2;break;case"@":i[i.length]={t:"T",v:e},++a;break;case"B":case"b":if(n.charAt(a+1)==="1"||n.charAt(a+1)==="2"){if(l==null&&(l=na(e,t,n.charAt(a+1)==="2"),l==null))return"";i[i.length]={t:"X",v:n.substr(a,2)},c=o,a+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":o=o.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(e<0||l==null&&(l=na(e,t),l==null))return"";for(s=o;++a<n.length&&n.charAt(a).toLowerCase()===o;)s+=o;o==="m"&&c.toLowerCase()==="h"&&(o="M"),o==="h"&&(o=d),i[i.length]={t:o,v:s},c=o;break;case"A":case"a":case"":var m={t:o,v:o};if(l==null&&(l=na(e,t)),n.substr(a,3).toUpperCase()==="A/P"?(l!=null&&(m.v=l.H>=12?"P":"A"),m.t="T",d="h",a+=3):n.substr(a,5).toUpperCase()==="AM/PM"?(l!=null&&(m.v=l.H>=12?"PM":"AM"),m.t="T",a+=5,d="h"):n.substr(a,5).toUpperCase()==="/"?(l!=null&&(m.v=l.H>=12?"":""),m.t="T",a+=5,d="h"):(m.t="t",++a),l==null&&m.t==="T")return"";i[i.length]=m,c=o;break;case"[":for(s=o;n.charAt(a++)!=="]"&&a<n.length;)s+=n.charAt(a);if(s.slice(-1)!=="]")throw'unterminated "[" block: |'+s+"|";if(s.match(MI)){if(l==null&&(l=na(e,t),l==null))return"";i[i.length]={t:"Z",v:s.toLowerCase()},c=s.charAt(1)}else s.indexOf("$")>-1&&(s=(s.match(/\$([^-\[\]]*)/)||[])[1]||"$",tc(n)||(i[i.length]={t:"t",v:s}));break;case".":if(l!=null){for(s=o;++a<n.length&&(o=n.charAt(a))==="0";)s+=o;i[i.length]={t:"s",v:s};break}case"0":case"#":for(s=o;++a<n.length&&"0#?.,E+-%".indexOf(o=n.charAt(a))>-1;)s+=o;i[i.length]={t:"n",v:s};break;case"?":for(s=o;n.charAt(++a)===o;)s+=o;i[i.length]={t:o,v:s},c=o;break;case"*":++a,(n.charAt(a)==" "||n.charAt(a)=="*")&&++a;break;case"(":case")":i[i.length]={t:r===1?"t":o,v:o},++a;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(s=o;a<n.length&&"0123456789".indexOf(n.charAt(++a))>-1;)s+=n.charAt(a);i[i.length]={t:"D",v:s};break;case" ":i[i.length]={t:o,v:o},++a;break;case"$":i[i.length]={t:"t",v:"$"},++a;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(o)===-1)throw new Error("unrecognized character "+o+" in "+n);i[i.length]={t:"t",v:o},++a;break}var _=0,E=0,I;for(a=i.length-1,c="t";a>=0;--a)switch(i[a].t){case"h":case"H":i[a].t=d,c="h",_<1&&(_=1);break;case"s":(I=i[a].v.match(/\.0+$/))&&(E=Math.max(E,I[0].length-1)),_<3&&(_=3);case"d":case"y":case"M":case"e":c=i[a].t;break;case"m":c==="s"&&(i[a].t="M",_<2&&(_=2));break;case"X":break;case"Z":_<1&&i[a].v.match(/[Hh]/)&&(_=1),_<2&&i[a].v.match(/[Mm]/)&&(_=2),_<3&&i[a].v.match(/[Ss]/)&&(_=3)}switch(_){case 0:break;case 1:l.u>=.5&&(l.u=0,++l.S),l.S>=60&&(l.S=0,++l.M),l.M>=60&&(l.M=0,++l.H);break;case 2:l.u>=.5&&(l.u=0,++l.S),l.S>=60&&(l.S=0,++l.M);break}var v="",R;for(a=0;a<i.length;++a)switch(i[a].t){case"t":case"T":case" ":case"D":break;case"X":i[a].v="",i[a].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":i[a].v=W6(i[a].t.charCodeAt(0),i[a].v,l,E),i[a].t="t";break;case"n":case"?":for(R=a+1;i[R]!=null&&((o=i[R].t)==="?"||o==="D"||(o===" "||o==="t")&&i[R+1]!=null&&(i[R+1].t==="?"||i[R+1].t==="t"&&i[R+1].v==="/")||i[a].t==="("&&(o===" "||o==="n"||o===")")||o==="t"&&(i[R].v==="/"||i[R].v===" "&&i[R+1]!=null&&i[R+1].t=="?"));)i[a].v+=i[R].v,i[R]={v:"",t:";"},++R;v+=i[a].v,a=R-1;break;case"G":i[a].t="t",i[a].v=Aa(e,t);break}var F="",O,y;if(v.length>0){v.charCodeAt(0)==40?(O=e<0&&v.charCodeAt(0)===45?-e:e,y=mi("n",v,O)):(O=e<0&&r>1?-e:e,y=mi("n",v,O),O<0&&i[0]&&i[0].t=="t"&&(y=y.substr(1),i[0].v="-"+i[0].v)),R=y.length-1;var w=i.length;for(a=0;a<i.length;++a)if(i[a]!=null&&i[a].t!="t"&&i[a].v.indexOf(".")>-1){w=a;break}var T=i.length;if(w===i.length&&y.indexOf("E")===-1){for(a=i.length-1;a>=0;--a)i[a]==null||"n?".indexOf(i[a].t)===-1||(R>=i[a].v.length-1?(R-=i[a].v.length,i[a].v=y.substr(R+1,i[a].v.length)):R<0?i[a].v="":(i[a].v=y.substr(0,R+1),R=-1),i[a].t="t",T=a);R>=0&&T<i.length&&(i[T].v=y.substr(0,R+1)+i[T].v)}else if(w!==i.length&&y.indexOf("E")===-1){for(R=y.indexOf(".")-1,a=w;a>=0;--a)if(!(i[a]==null||"n?".indexOf(i[a].t)===-1)){for(u=i[a].v.indexOf(".")>-1&&a===w?i[a].v.indexOf(".")-1:i[a].v.length-1,F=i[a].v.substr(u+1);u>=0;--u)R>=0&&(i[a].v.charAt(u)==="0"||i[a].v.charAt(u)==="#")&&(F=y.charAt(R--)+F);i[a].v=F,i[a].t="t",T=a}for(R>=0&&T<i.length&&(i[T].v=y.substr(0,R+1)+i[T].v),R=y.indexOf(".")+1,a=w;a<i.length;++a)if(!(i[a]==null||"n?(".indexOf(i[a].t)===-1&&a!==w)){for(u=i[a].v.indexOf(".")>-1&&a===w?i[a].v.indexOf(".")+1:0,F=i[a].v.substr(0,u);u<i[a].v.length;++u)R<y.length&&(F+=y.charAt(R++));i[a].v=F,i[a].t="t",T=a}}}for(a=0;a<i.length;++a)i[a]!=null&&"n?".indexOf(i[a].t)>-1&&(O=r>1&&e<0&&a>0&&i[a-1].v==="-"?-e:e,i[a].v=mi(i[a].t,i[a].v,O),i[a].t="t");var S="";for(a=0;a!==i.length;++a)i[a]!=null&&(S+=i[a].v);return S}var Qy=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Jy(n,e){if(e==null)return!1;var t=parseFloat(e[2]);switch(e[1]){case"=":if(n==t)return!0;break;case">":if(n>t)return!0;break;case"<":if(n<t)return!0;break;case"<>":if(n!=t)return!0;break;case">=":if(n>=t)return!0;break;case"<=":if(n<=t)return!0;break}return!1}function t5(n,e){var t=Z6(n),r=t.length,i=t[r-1].indexOf("@");if(r<4&&i>-1&&--r,t.length>4)throw new Error("cannot find right format for |"+t.join("|")+"|");if(typeof e!="number")return[4,t.length===4||i>-1?t[t.length-1]:"@"];switch(t.length){case 1:t=i>-1?["General","General","General",t[0]]:[t[0],t[0],t[0],"@"];break;case 2:t=i>-1?[t[0],t[0],t[0],t[1]]:[t[0],t[1],t[0],"@"];break;case 3:t=i>-1?[t[0],t[1],t[0],t[2]]:[t[0],t[1],t[2],"@"];break}var s=e>0?t[0]:e<0?t[1]:t[2];if(t[0].indexOf("[")===-1&&t[1].indexOf("[")===-1)return[r,s];if(t[0].match(/\[[=<>]/)!=null||t[1].match(/\[[=<>]/)!=null){var a=t[0].match(Qy),o=t[1].match(Qy);return Jy(e,a)?[r,t[0]]:Jy(e,o)?[r,t[1]]:[r,t[a!=null&&o!=null?2:1]]}return[r,s]}function ur(n,e,t){t==null&&(t={});var r="";switch(typeof n){case"string":n=="m/d/yy"&&t.dateNF?r=t.dateNF:r=n;break;case"number":n==14&&t.dateNF?r=t.dateNF:r=(t.table!=null?t.table:Ne)[n],r==null&&(r=t.table&&t.table[Ky[n]]||Ne[Ky[n]]),r==null&&(r=N6[n]||"General");break}if(vf(r,0))return Aa(e,t);e instanceof Date&&(e=SI(e,t.date1904));var i=t5(r,e);if(vf(i[1]))return Aa(e,t);if(e===!0)e="TRUE";else if(e===!1)e="FALSE";else if(e===""||e==null)return"";return e5(i[1],e,t,i[0])}function ua(n,e){if(typeof e!="number"){e=+e||-1;for(var t=0;t<392;++t){if(Ne[t]==null){e<0&&(e=t);continue}if(Ne[t]==n){e=t;break}}e<0&&(e=391)}return Ne[e]=n,e}function LI(){Ne=L6()}var n5={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},NI=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function r5(n){var e=typeof n=="number"?Ne[n]:n;return e=e.replace(NI,"(\\d+)"),new RegExp("^"+e+"$")}function i5(n,e,t){var r=-1,i=-1,s=-1,a=-1,o=-1,c=-1;(e.match(NI)||[]).forEach(function(h,d){var p=parseInt(t[d+1],10);switch(h.toLowerCase().charAt(0)){case"y":r=p;break;case"d":s=p;break;case"h":a=p;break;case"s":c=p;break;case"m":a>=0?o=p:i=p;break}}),c>=0&&o==-1&&i>=0&&(o=i,i=-1);var l=(""+(r>=0?r:new Date().getFullYear())).slice(-4)+"-"+("00"+(i>=1?i:1)).slice(-2)+"-"+("00"+(s>=1?s:1)).slice(-2);l.length==7&&(l="0"+l),l.length==8&&(l="20"+l);var u=("00"+(a>=0?a:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return a==-1&&o==-1&&c==-1?l:r==-1&&i==-1&&s==-1?u:l+"T"+u}var s5=(function(){var n={};n.version="1.2.0";function e(){for(var y=0,w=new Array(256),T=0;T!=256;++T)y=T,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,w[T]=y;return typeof Int32Array<"u"?new Int32Array(w):w}var t=e();function r(y){var w=0,T=0,S=0,A=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(S=0;S!=256;++S)A[S]=y[S];for(S=0;S!=256;++S)for(T=y[S],w=256+S;w<4096;w+=256)T=A[w]=T>>>8^y[T&255];var k=[];for(S=1;S!=16;++S)k[S-1]=typeof Int32Array<"u"?A.subarray(S*256,S*256+256):A.slice(S*256,S*256+256);return k}var i=r(t),s=i[0],a=i[1],o=i[2],c=i[3],l=i[4],u=i[5],h=i[6],d=i[7],p=i[8],g=i[9],m=i[10],_=i[11],E=i[12],I=i[13],v=i[14];function R(y,w){for(var T=w^-1,S=0,A=y.length;S<A;)T=T>>>8^t[(T^y.charCodeAt(S++))&255];return~T}function F(y,w){for(var T=w^-1,S=y.length-15,A=0;A<S;)T=v[y[A++]^T&255]^I[y[A++]^T>>8&255]^E[y[A++]^T>>16&255]^_[y[A++]^T>>>24]^m[y[A++]]^g[y[A++]]^p[y[A++]]^d[y[A++]]^h[y[A++]]^u[y[A++]]^l[y[A++]]^c[y[A++]]^o[y[A++]]^a[y[A++]]^s[y[A++]]^t[y[A++]];for(S+=15;A<S;)T=T>>>8^t[(T^y[A++])&255];return~T}function O(y,w){for(var T=w^-1,S=0,A=y.length,k=0,D=0;S<A;)k=y.charCodeAt(S++),k<128?T=T>>>8^t[(T^k)&255]:k<2048?(T=T>>>8^t[(T^(192|k>>6&31))&255],T=T>>>8^t[(T^(128|k&63))&255]):k>=55296&&k<57344?(k=(k&1023)+64,D=y.charCodeAt(S++)&1023,T=T>>>8^t[(T^(240|k>>8&7))&255],T=T>>>8^t[(T^(128|k>>2&63))&255],T=T>>>8^t[(T^(128|D>>6&15|(k&3)<<4))&255],T=T>>>8^t[(T^(128|D&63))&255]):(T=T>>>8^t[(T^(224|k>>12&15))&255],T=T>>>8^t[(T^(128|k>>6&63))&255],T=T>>>8^t[(T^(128|k&63))&255]);return~T}return n.table=t,n.bstr=R,n.buf=F,n.str=O,n})(),Qe=(function(){var e={};e.version="1.2.1";function t(C,V){for(var L=C.split("/"),N=V.split("/"),B=0,U=0,J=Math.min(L.length,N.length);B<J;++B){if(U=L[B].length-N[B].length)return U;if(L[B]!=N[B])return L[B]<N[B]?-1:1}return L.length-N.length}function r(C){if(C.charAt(C.length-1)=="/")return C.slice(0,-1).indexOf("/")===-1?C:r(C.slice(0,-1));var V=C.lastIndexOf("/");return V===-1?C:C.slice(0,V+1)}function i(C){if(C.charAt(C.length-1)=="/")return i(C.slice(0,-1));var V=C.lastIndexOf("/");return V===-1?C:C.slice(V+1)}function s(C,V){typeof V=="string"&&(V=new Date(V));var L=V.getHours();L=L<<6|V.getMinutes(),L=L<<5|V.getSeconds()>>>1,C.write_shift(2,L);var N=V.getFullYear()-1980;N=N<<4|V.getMonth()+1,N=N<<5|V.getDate(),C.write_shift(2,N)}function a(C){var V=C.read_shift(2)&65535,L=C.read_shift(2)&65535,N=new Date,B=L&31;L>>>=5;var U=L&15;L>>>=4,N.setMilliseconds(0),N.setFullYear(L+1980),N.setMonth(U-1),N.setDate(B);var J=V&31;V>>>=5;var re=V&63;return V>>>=6,N.setHours(V),N.setMinutes(re),N.setSeconds(J<<1),N}function o(C){un(C,0);for(var V={},L=0;C.l<=C.length-4;){var N=C.read_shift(2),B=C.read_shift(2),U=C.l+B,J={};N===21589&&(L=C.read_shift(1),L&1&&(J.mtime=C.read_shift(4)),B>5&&(L&2&&(J.atime=C.read_shift(4)),L&4&&(J.ctime=C.read_shift(4))),J.mtime&&(J.mt=new Date(J.mtime*1e3))),C.l=U,V[N]=J}return V}var c;function l(){return c||(c={})}function u(C,V){if(C[0]==80&&C[1]==75)return Fi(C,V);if((C[0]|32)==109&&(C[1]|32)==105)return yd(C,V);if(C.length<512)throw new Error("CFB file size "+C.length+" < 512");var L=3,N=512,B=0,U=0,J=0,re=0,X=0,Z=[],ee=C.slice(0,512);un(ee,0);var ce=h(ee);switch(L=ce[0],L){case 3:N=512;break;case 4:N=4096;break;case 0:if(ce[1]==0)return Fi(C,V);default:throw new Error("Major Version: Expected 3 or 4 saw "+L)}N!==512&&(ee=C.slice(0,N),un(ee,28));var pe=C.slice(0,N);d(ee,L);var Ee=ee.read_shift(4,"i");if(L===3&&Ee!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Ee);ee.l+=4,J=ee.read_shift(4,"i"),ee.l+=4,ee.chk("00100000","Mini Stream Cutoff Size: "),re=ee.read_shift(4,"i"),B=ee.read_shift(4,"i"),X=ee.read_shift(4,"i"),U=ee.read_shift(4,"i");for(var le=-1,ve=0;ve<109&&(le=ee.read_shift(4,"i"),!(le<0));++ve)Z[ve]=le;var Fe=p(C,N);_(X,U,Fe,N,Z);var ut=I(Fe,J,Z,N);ut[J].name="!Directory",B>0&&re!==D&&(ut[re].name="!MiniFAT"),ut[Z[0]].name="!FAT",ut.fat_addrs=Z,ut.ssz=N;var ht={},jt=[],ei=[],ti=[];v(J,ut,Fe,jt,B,ht,ei,re),g(ei,ti,jt),jt.shift();var Mi={FileIndex:ei,FullPaths:ti};return V&&V.raw&&(Mi.raw={header:pe,sectors:Fe}),Mi}function h(C){if(C[C.l]==80&&C[C.l+1]==75)return[0,0];C.chk(oe,"Header Signature: "),C.l+=16;var V=C.read_shift(2,"u");return[C.read_shift(2,"u"),V]}function d(C,V){var L=9;switch(C.l+=2,L=C.read_shift(2)){case 9:if(V!=3)throw new Error("Sector Shift: Expected 9 saw "+L);break;case 12:if(V!=4)throw new Error("Sector Shift: Expected 12 saw "+L);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+L)}C.chk("0600","Mini Sector Shift: "),C.chk("000000000000","Reserved: ")}function p(C,V){for(var L=Math.ceil(C.length/V)-1,N=[],B=1;B<L;++B)N[B-1]=C.slice(B*V,(B+1)*V);return N[L-1]=C.slice(L*V),N}function g(C,V,L){for(var N=0,B=0,U=0,J=0,re=0,X=L.length,Z=[],ee=[];N<X;++N)Z[N]=ee[N]=N,V[N]=L[N];for(;re<ee.length;++re)N=ee[re],B=C[N].L,U=C[N].R,J=C[N].C,Z[N]===N&&(B!==-1&&Z[B]!==B&&(Z[N]=Z[B]),U!==-1&&Z[U]!==U&&(Z[N]=Z[U])),J!==-1&&(Z[J]=N),B!==-1&&N!=Z[N]&&(Z[B]=Z[N],ee.lastIndexOf(B)<re&&ee.push(B)),U!==-1&&N!=Z[N]&&(Z[U]=Z[N],ee.lastIndexOf(U)<re&&ee.push(U));for(N=1;N<X;++N)Z[N]===N&&(U!==-1&&Z[U]!==U?Z[N]=Z[U]:B!==-1&&Z[B]!==B&&(Z[N]=Z[B]));for(N=1;N<X;++N)if(C[N].type!==0){if(re=N,re!=Z[re])do re=Z[re],V[N]=V[re]+"/"+V[N];while(re!==0&&Z[re]!==-1&&re!=Z[re]);Z[N]=-1}for(V[0]+="/",N=1;N<X;++N)C[N].type!==2&&(V[N]+="/")}function m(C,V,L){for(var N=C.start,B=C.size,U=[],J=N;L&&B>0&&J>=0;)U.push(V.slice(J*k,J*k+k)),B-=k,J=ea(L,J*4);return U.length===0?qt(0):Ji(U).slice(0,C.size)}function _(C,V,L,N,B){var U=D;if(C===D){if(V!==0)throw new Error("DIFAT chain shorter than expected")}else if(C!==-1){var J=L[C],re=(N>>>2)-1;if(!J)return;for(var X=0;X<re&&(U=ea(J,X*4))!==D;++X)B.push(U);_(ea(J,N-4),V-1,L,N,B)}}function E(C,V,L,N,B){var U=[],J=[];B||(B=[]);var re=N-1,X=0,Z=0;for(X=V;X>=0;){B[X]=!0,U[U.length]=X,J.push(C[X]);var ee=L[Math.floor(X*4/N)];if(Z=X*4&re,N<4+Z)throw new Error("FAT boundary crossed: "+X+" 4 "+N);if(!C[ee])break;X=ea(C[ee],Z)}return{nodes:U,data:cv([J])}}function I(C,V,L,N){var B=C.length,U=[],J=[],re=[],X=[],Z=N-1,ee=0,ce=0,pe=0,Ee=0;for(ee=0;ee<B;++ee)if(re=[],pe=ee+V,pe>=B&&(pe-=B),!J[pe]){X=[];var le=[];for(ce=pe;ce>=0;){le[ce]=!0,J[ce]=!0,re[re.length]=ce,X.push(C[ce]);var ve=L[Math.floor(ce*4/N)];if(Ee=ce*4&Z,N<4+Ee)throw new Error("FAT boundary crossed: "+ce+" 4 "+N);if(!C[ve]||(ce=ea(C[ve],Ee),le[ce]))break}U[pe]={nodes:re,data:cv([X])}}return U}function v(C,V,L,N,B,U,J,re){for(var X=0,Z=N.length?2:0,ee=V[C].data,ce=0,pe=0,Ee;ce<ee.length;ce+=128){var le=ee.slice(ce,ce+128);un(le,64),pe=le.read_shift(2),Ee=ym(le,0,pe-Z),N.push(Ee);var ve={name:Ee,type:le.read_shift(1),color:le.read_shift(1),L:le.read_shift(4,"i"),R:le.read_shift(4,"i"),C:le.read_shift(4,"i"),clsid:le.read_shift(16),state:le.read_shift(4,"i"),start:0,size:0},Fe=le.read_shift(2)+le.read_shift(2)+le.read_shift(2)+le.read_shift(2);Fe!==0&&(ve.ct=R(le,le.l-8));var ut=le.read_shift(2)+le.read_shift(2)+le.read_shift(2)+le.read_shift(2);ut!==0&&(ve.mt=R(le,le.l-8)),ve.start=le.read_shift(4,"i"),ve.size=le.read_shift(4,"i"),ve.size<0&&ve.start<0&&(ve.size=ve.type=0,ve.start=D,ve.name=""),ve.type===5?(X=ve.start,B>0&&X!==D&&(V[X].name="!StreamData")):ve.size>=4096?(ve.storage="fat",V[ve.start]===void 0&&(V[ve.start]=E(L,ve.start,V.fat_addrs,V.ssz)),V[ve.start].name=ve.name,ve.content=V[ve.start].data.slice(0,ve.size)):(ve.storage="minifat",ve.size<0?ve.size=0:X!==D&&ve.start!==D&&V[X]&&(ve.content=m(ve,V[X].data,(V[re]||{}).data))),ve.content&&un(ve.content,0),U[Ee]=ve,J.push(ve)}}function R(C,V){return new Date((Xn(C,V+4)/1e7*Math.pow(2,32)+Xn(C,V)/1e7-11644473600)*1e3)}function F(C,V){return l(),u(c.readFileSync(C),V)}function O(C,V){var L=V&&V.type;switch(L||Ke&&Buffer.isBuffer(C)&&(L="buffer"),L||"base64"){case"file":return F(C,V);case"base64":return u(vr(nr(C)),V);case"binary":return u(vr(C),V)}return u(C,V)}function y(C,V){var L=V||{},N=L.root||"Root Entry";if(C.FullPaths||(C.FullPaths=[]),C.FileIndex||(C.FileIndex=[]),C.FullPaths.length!==C.FileIndex.length)throw new Error("inconsistent CFB structure");C.FullPaths.length===0&&(C.FullPaths[0]=N+"/",C.FileIndex[0]={name:N,type:5}),L.CLSID&&(C.FileIndex[0].clsid=L.CLSID),w(C)}function w(C){var V="Sh33tJ5";if(!Qe.find(C,"/"+V)){var L=qt(4);L[0]=55,L[1]=L[3]=50,L[2]=54,C.FileIndex.push({name:V,type:2,content:L,size:4,L:69,R:69,C:69}),C.FullPaths.push(C.FullPaths[0]+V),T(C)}}function T(C,V){y(C);for(var L=!1,N=!1,B=C.FullPaths.length-1;B>=0;--B){var U=C.FileIndex[B];switch(U.type){case 0:N?L=!0:(C.FileIndex.pop(),C.FullPaths.pop());break;case 1:case 2:case 5:N=!0,isNaN(U.R*U.L*U.C)&&(L=!0),U.R>-1&&U.L>-1&&U.R==U.L&&(L=!0);break;default:L=!0;break}}if(!(!L&&!V)){var J=new Date(1987,1,19),re=0,X=Object.create?Object.create(null):{},Z=[];for(B=0;B<C.FullPaths.length;++B)X[C.FullPaths[B]]=!0,C.FileIndex[B].type!==0&&Z.push([C.FullPaths[B],C.FileIndex[B]]);for(B=0;B<Z.length;++B){var ee=r(Z[B][0]);N=X[ee],N||(Z.push([ee,{name:i(ee).replace("/",""),type:1,clsid:ue,ct:J,mt:J,content:null}]),X[ee]=!0)}for(Z.sort(function(Ee,le){return t(Ee[0],le[0])}),C.FullPaths=[],C.FileIndex=[],B=0;B<Z.length;++B)C.FullPaths[B]=Z[B][0],C.FileIndex[B]=Z[B][1];for(B=0;B<Z.length;++B){var ce=C.FileIndex[B],pe=C.FullPaths[B];if(ce.name=i(pe).replace("/",""),ce.L=ce.R=ce.C=-(ce.color=1),ce.size=ce.content?ce.content.length:0,ce.start=0,ce.clsid=ce.clsid||ue,B===0)ce.C=Z.length>1?1:-1,ce.size=0,ce.type=5;else if(pe.slice(-1)=="/"){for(re=B+1;re<Z.length&&r(C.FullPaths[re])!=pe;++re);for(ce.C=re>=Z.length?-1:re,re=B+1;re<Z.length&&r(C.FullPaths[re])!=r(pe);++re);ce.R=re>=Z.length?-1:re,ce.type=1}else r(C.FullPaths[B+1]||"")==r(pe)&&(ce.R=B+1),ce.type=2}}}function S(C,V){var L=V||{};if(L.fileType=="mad")return vd(C,L);if(T(C),L.fileType==="zip")return cn(C,L);var N=(function(Ee){for(var le=0,ve=0,Fe=0;Fe<Ee.FileIndex.length;++Fe){var ut=Ee.FileIndex[Fe];if(ut.content){var ht=ut.content.length;ht>0&&(ht<4096?le+=ht+63>>6:ve+=ht+511>>9)}}for(var jt=Ee.FullPaths.length+3>>2,ei=le+7>>3,ti=le+127>>7,Mi=ei+ve+jt+ti,Cr=Mi+127>>7,Ha=Cr<=109?0:Math.ceil((Cr-109)/127);Mi+Cr+Ha+127>>7>Cr;)Ha=++Cr<=109?0:Math.ceil((Cr-109)/127);var gr=[1,Ha,Cr,ti,jt,ve,le,0];return Ee.FileIndex[0].size=le<<6,gr[7]=(Ee.FileIndex[0].start=gr[0]+gr[1]+gr[2]+gr[3]+gr[4]+gr[5])+(gr[6]+7>>3),gr})(C),B=qt(N[7]<<9),U=0,J=0;{for(U=0;U<8;++U)B.write_shift(1,ie[U]);for(U=0;U<8;++U)B.write_shift(2,0);for(B.write_shift(2,62),B.write_shift(2,3),B.write_shift(2,65534),B.write_shift(2,9),B.write_shift(2,6),U=0;U<3;++U)B.write_shift(2,0);for(B.write_shift(4,0),B.write_shift(4,N[2]),B.write_shift(4,N[0]+N[1]+N[2]+N[3]-1),B.write_shift(4,0),B.write_shift(4,4096),B.write_shift(4,N[3]?N[0]+N[1]+N[2]-1:D),B.write_shift(4,N[3]),B.write_shift(-4,N[1]?N[0]-1:D),B.write_shift(4,N[1]),U=0;U<109;++U)B.write_shift(-4,U<N[2]?N[1]+U:-1)}if(N[1])for(J=0;J<N[1];++J){for(;U<236+J*127;++U)B.write_shift(-4,U<N[2]?N[1]+U:-1);B.write_shift(-4,J===N[1]-1?D:J+1)}var re=function(Ee){for(J+=Ee;U<J-1;++U)B.write_shift(-4,U+1);Ee&&(++U,B.write_shift(-4,D))};for(J=U=0,J+=N[1];U<J;++U)B.write_shift(-4,he.DIFSECT);for(J+=N[2];U<J;++U)B.write_shift(-4,he.FATSECT);re(N[3]),re(N[4]);for(var X=0,Z=0,ee=C.FileIndex[0];X<C.FileIndex.length;++X)ee=C.FileIndex[X],ee.content&&(Z=ee.content.length,!(Z<4096)&&(ee.start=J,re(Z+511>>9)));for(re(N[6]+7>>3);B.l&511;)B.write_shift(-4,he.ENDOFCHAIN);for(J=U=0,X=0;X<C.FileIndex.length;++X)ee=C.FileIndex[X],ee.content&&(Z=ee.content.length,!(!Z||Z>=4096)&&(ee.start=J,re(Z+63>>6)));for(;B.l&511;)B.write_shift(-4,he.ENDOFCHAIN);for(U=0;U<N[4]<<2;++U){var ce=C.FullPaths[U];if(!ce||ce.length===0){for(X=0;X<17;++X)B.write_shift(4,0);for(X=0;X<3;++X)B.write_shift(4,-1);for(X=0;X<12;++X)B.write_shift(4,0);continue}ee=C.FileIndex[U],U===0&&(ee.start=ee.size?ee.start-1:D);var pe=U===0&&L.root||ee.name;if(Z=2*(pe.length+1),B.write_shift(64,pe,"utf16le"),B.write_shift(2,Z),B.write_shift(1,ee.type),B.write_shift(1,ee.color),B.write_shift(-4,ee.L),B.write_shift(-4,ee.R),B.write_shift(-4,ee.C),ee.clsid)B.write_shift(16,ee.clsid,"hex");else for(X=0;X<4;++X)B.write_shift(4,0);B.write_shift(4,ee.state||0),B.write_shift(4,0),B.write_shift(4,0),B.write_shift(4,0),B.write_shift(4,0),B.write_shift(4,ee.start),B.write_shift(4,ee.size),B.write_shift(4,0)}for(U=1;U<C.FileIndex.length;++U)if(ee=C.FileIndex[U],ee.size>=4096)if(B.l=ee.start+1<<9,Ke&&Buffer.isBuffer(ee.content))ee.content.copy(B,B.l,0,ee.size),B.l+=ee.size+511&-512;else{for(X=0;X<ee.size;++X)B.write_shift(1,ee.content[X]);for(;X&511;++X)B.write_shift(1,0)}for(U=1;U<C.FileIndex.length;++U)if(ee=C.FileIndex[U],ee.size>0&&ee.size<4096)if(Ke&&Buffer.isBuffer(ee.content))ee.content.copy(B,B.l,0,ee.size),B.l+=ee.size+63&-64;else{for(X=0;X<ee.size;++X)B.write_shift(1,ee.content[X]);for(;X&63;++X)B.write_shift(1,0)}if(Ke)B.l=B.length;else for(;B.l<B.length;)B.write_shift(1,0);return B}function A(C,V){var L=C.FullPaths.map(function(X){return X.toUpperCase()}),N=L.map(function(X){var Z=X.split("/");return Z[Z.length-(X.slice(-1)=="/"?2:1)]}),B=!1;V.charCodeAt(0)===47?(B=!0,V=L[0].slice(0,-1)+V):B=V.indexOf("/")!==-1;var U=V.toUpperCase(),J=B===!0?L.indexOf(U):N.indexOf(U);if(J!==-1)return C.FileIndex[J];var re=!U.match(Hc);for(U=U.replace(Vn,""),re&&(U=U.replace(Hc,"!")),J=0;J<L.length;++J)if((re?L[J].replace(Hc,"!"):L[J]).replace(Vn,"")==U||(re?N[J].replace(Hc,"!"):N[J]).replace(Vn,"")==U)return C.FileIndex[J];return null}var k=64,D=-2,oe="d0cf11e0a1b11ae1",ie=[208,207,17,224,161,177,26,225],ue="00000000000000000000000000000000",he={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:D,FREESECT:-1,HEADER_SIGNATURE:oe,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:ue,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Oe(C,V,L){l();var N=S(C,L);c.writeFileSync(V,N)}function K(C){for(var V=new Array(C.length),L=0;L<C.length;++L)V[L]=String.fromCharCode(C[L]);return V.join("")}function Se(C,V){var L=S(C,V);switch(V&&V.type||"buffer"){case"file":return l(),c.writeFileSync(V.filename,L),L;case"binary":return typeof L=="string"?L:K(L);case"base64":return Wy(typeof L=="string"?L:K(L));case"buffer":if(Ke)return Buffer.isBuffer(L)?L:Da(L);case"array":return typeof L=="string"?vr(L):L}return L}var Ce;function z(C){try{var V=C.InflateRaw,L=new V;if(L._processChunk(new Uint8Array([3,0]),L._finishFlushFlag),L.bytesRead)Ce=C;else throw new Error("zlib does not expose bytesRead")}catch(N){console.error("cannot use native zlib: "+(N.message||N))}}function Q(C,V){if(!Ce)return Ds(C,V);var L=Ce.InflateRaw,N=new L,B=N._processChunk(C.slice(C.l),N._finishFlushFlag);return C.l+=N.bytesRead,B}function G(C){return Ce?Ce.deflateRawSync(C):Be(C)}var j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],se=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],ge=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function we(C){var V=(C<<1|C<<11)&139536|(C<<5|C<<15)&558144;return(V>>16|V>>8|V)&255}for(var me=typeof Uint8Array<"u",fe=me?new Uint8Array(256):[],Ge=0;Ge<256;++Ge)fe[Ge]=we(Ge);function W(C,V){var L=fe[C&255];return V<=8?L>>>8-V:(L=L<<8|fe[C>>8&255],V<=16?L>>>16-V:(L=L<<8|fe[C>>16&255],L>>>24-V))}function mt(C,V){var L=V&7,N=V>>>3;return(C[N]|(L<=6?0:C[N+1]<<8))>>>L&3}function qe(C,V){var L=V&7,N=V>>>3;return(C[N]|(L<=5?0:C[N+1]<<8))>>>L&7}function nt(C,V){var L=V&7,N=V>>>3;return(C[N]|(L<=4?0:C[N+1]<<8))>>>L&15}function Ve(C,V){var L=V&7,N=V>>>3;return(C[N]|(L<=3?0:C[N+1]<<8))>>>L&31}function xe(C,V){var L=V&7,N=V>>>3;return(C[N]|(L<=1?0:C[N+1]<<8))>>>L&127}function Et(C,V,L){var N=V&7,B=V>>>3,U=(1<<L)-1,J=C[B]>>>N;return L<8-N||(J|=C[B+1]<<8-N,L<16-N)||(J|=C[B+2]<<16-N,L<24-N)||(J|=C[B+3]<<24-N),J&U}function rt(C,V,L){var N=V&7,B=V>>>3;return N<=5?C[B]|=(L&7)<<N:(C[B]|=L<<N&255,C[B+1]=(L&7)>>8-N),V+3}function lt(C,V,L){var N=V&7,B=V>>>3;return L=(L&1)<<N,C[B]|=L,V+1}function Un(C,V,L){var N=V&7,B=V>>>3;return L<<=N,C[B]|=L&255,L>>>=8,C[B+1]=L,V+8}function Ps(C,V,L){var N=V&7,B=V>>>3;return L<<=N,C[B]|=L&255,L>>>=8,C[B+1]=L&255,C[B+2]=L>>>8,V+16}function fr(C,V){var L=C.length,N=2*L>V?2*L:V+5,B=0;if(L>=V)return C;if(Ke){var U=jy(N);if(C.copy)C.copy(U);else for(;B<C.length;++B)U[B]=C[B];return U}else if(me){var J=new Uint8Array(N);if(J.set)J.set(C);else for(;B<L;++B)J[B]=C[B];return J}return C.length=N,C}function Pn(C){for(var V=new Array(C),L=0;L<C;++L)V[L]=0;return V}function Dn(C,V,L){var N=1,B=0,U=0,J=0,re=0,X=C.length,Z=me?new Uint16Array(32):Pn(32);for(U=0;U<32;++U)Z[U]=0;for(U=X;U<L;++U)C[U]=0;X=C.length;var ee=me?new Uint16Array(X):Pn(X);for(U=0;U<X;++U)Z[B=C[U]]++,N<B&&(N=B),ee[U]=0;for(Z[0]=0,U=1;U<=N;++U)Z[U+16]=re=re+Z[U-1]<<1;for(U=0;U<X;++U)re=C[U],re!=0&&(ee[U]=Z[re+16]++);var ce=0;for(U=0;U<X;++U)if(ce=C[U],ce!=0)for(re=W(ee[U],N)>>N-ce,J=(1<<N+4-ce)-1;J>=0;--J)V[re|J<<ce]=ce&15|U<<4;return N}var dr=me?new Uint16Array(512):Pn(512),Di=me?new Uint16Array(32):Pn(32);if(!me){for(var Wt=0;Wt<512;++Wt)dr[Wt]=0;for(Wt=0;Wt<32;++Wt)Di[Wt]=0}(function(){for(var C=[],V=0;V<32;V++)C.push(5);Dn(C,Di,32);var L=[];for(V=0;V<=143;V++)L.push(8);for(;V<=255;V++)L.push(9);for(;V<=279;V++)L.push(7);for(;V<=287;V++)L.push(8);Dn(L,dr,288)})();var rr=(function(){for(var V=me?new Uint8Array(32768):[],L=0,N=0;L<ge.length-1;++L)for(;N<ge[L+1];++N)V[N]=L;for(;N<32768;++N)V[N]=29;var B=me?new Uint8Array(259):[];for(L=0,N=0;L<se.length-1;++L)for(;N<se[L+1];++N)B[N]=L;function U(re,X){for(var Z=0;Z<re.length;){var ee=Math.min(65535,re.length-Z),ce=Z+ee==re.length;for(X.write_shift(1,+ce),X.write_shift(2,ee),X.write_shift(2,~ee&65535);ee-- >0;)X[X.l++]=re[Z++]}return X.l}function J(re,X){for(var Z=0,ee=0,ce=me?new Uint16Array(32768):[];ee<re.length;){var pe=Math.min(65535,re.length-ee);if(pe<10){for(Z=rt(X,Z,+(ee+pe==re.length)),Z&7&&(Z+=8-(Z&7)),X.l=Z/8|0,X.write_shift(2,pe),X.write_shift(2,~pe&65535);pe-- >0;)X[X.l++]=re[ee++];Z=X.l*8;continue}Z=rt(X,Z,+(ee+pe==re.length)+2);for(var Ee=0;pe-- >0;){var le=re[ee];Ee=(Ee<<5^le)&32767;var ve=-1,Fe=0;if((ve=ce[Ee])&&(ve|=ee&-32768,ve>ee&&(ve-=32768),ve<ee))for(;re[ve+Fe]==re[ee+Fe]&&Fe<250;)++Fe;if(Fe>2){le=B[Fe],le<=22?Z=Un(X,Z,fe[le+1]>>1)-1:(Un(X,Z,3),Z+=5,Un(X,Z,fe[le-23]>>5),Z+=3);var ut=le<8?0:le-4>>2;ut>0&&(Ps(X,Z,Fe-se[le]),Z+=ut),le=V[ee-ve],Z=Un(X,Z,fe[le]>>3),Z-=3;var ht=le<4?0:le-2>>1;ht>0&&(Ps(X,Z,ee-ve-ge[le]),Z+=ht);for(var jt=0;jt<Fe;++jt)ce[Ee]=ee&32767,Ee=(Ee<<5^re[ee])&32767,++ee;pe-=Fe-1}else le<=143?le=le+48:Z=lt(X,Z,1),Z=Un(X,Z,fe[le]),ce[Ee]=ee&32767,++ee}Z=Un(X,Z,0)-1}return X.l=(Z+7)/8|0,X.l}return function(X,Z){return X.length<8?U(X,Z):J(X,Z)}})();function Be(C){var V=qt(50+Math.floor(C.length*1.1)),L=rr(C,V);return V.slice(0,L)}var wt=me?new Uint16Array(32768):Pn(32768),Fn=me?new Uint16Array(32768):Pn(32768),_t=me?new Uint16Array(128):Pn(128),pr=1,Va=1;function Zr(C,V){var L=Ve(C,V)+257;V+=5;var N=Ve(C,V)+1;V+=5;var B=nt(C,V)+4;V+=4;for(var U=0,J=me?new Uint8Array(19):Pn(19),re=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],X=1,Z=me?new Uint8Array(8):Pn(8),ee=me?new Uint8Array(8):Pn(8),ce=J.length,pe=0;pe<B;++pe)J[j[pe]]=U=qe(C,V),X<U&&(X=U),Z[U]++,V+=3;var Ee=0;for(Z[0]=0,pe=1;pe<=X;++pe)ee[pe]=Ee=Ee+Z[pe-1]<<1;for(pe=0;pe<ce;++pe)(Ee=J[pe])!=0&&(re[pe]=ee[Ee]++);var le=0;for(pe=0;pe<ce;++pe)if(le=J[pe],le!=0){Ee=fe[re[pe]]>>8-le;for(var ve=(1<<7-le)-1;ve>=0;--ve)_t[Ee|ve<<le]=le&7|pe<<3}var Fe=[];for(X=1;Fe.length<L+N;)switch(Ee=_t[xe(C,V)],V+=Ee&7,Ee>>>=3){case 16:for(U=3+mt(C,V),V+=2,Ee=Fe[Fe.length-1];U-- >0;)Fe.push(Ee);break;case 17:for(U=3+qe(C,V),V+=3;U-- >0;)Fe.push(0);break;case 18:for(U=11+xe(C,V),V+=7;U-- >0;)Fe.push(0);break;default:Fe.push(Ee),X<Ee&&(X=Ee);break}var ut=Fe.slice(0,L),ht=Fe.slice(L);for(pe=L;pe<286;++pe)ut[pe]=0;for(pe=N;pe<30;++pe)ht[pe]=0;return pr=Dn(ut,wt,286),Va=Dn(ht,Fn,30),V}function Iu(C,V){if(C[0]==3&&!(C[1]&3))return[vs(V),2];for(var L=0,N=0,B=jy(V||1<<18),U=0,J=B.length>>>0,re=0,X=0;(N&1)==0;){if(N=qe(C,L),L+=3,N>>>1)N>>1==1?(re=9,X=5):(L=Zr(C,L),re=pr,X=Va);else{L&7&&(L+=8-(L&7));var Z=C[L>>>3]|C[(L>>>3)+1]<<8;if(L+=32,Z>0)for(!V&&J<U+Z&&(B=fr(B,U+Z),J=B.length);Z-- >0;)B[U++]=C[L>>>3],L+=8;continue}for(;;){!V&&J<U+32767&&(B=fr(B,U+32767),J=B.length);var ee=Et(C,L,re),ce=N>>>1==1?dr[ee]:wt[ee];if(L+=ce&15,ce>>>=4,(ce>>>8&255)===0)B[U++]=ce;else{if(ce==256)break;ce-=257;var pe=ce<8?0:ce-4>>2;pe>5&&(pe=0);var Ee=U+se[ce];pe>0&&(Ee+=Et(C,L,pe),L+=pe),ee=Et(C,L,X),ce=N>>>1==1?Di[ee]:Fn[ee],L+=ce&15,ce>>>=4;var le=ce<4?0:ce-2>>1,ve=ge[ce];for(le>0&&(ve+=Et(C,L,le),L+=le),!V&&J<Ee&&(B=fr(B,Ee+100),J=B.length);U<Ee;)B[U]=B[U-ve],++U}}}return V?[B,L+7>>>3]:[B.slice(0,U),L+7>>>3]}function Ds(C,V){var L=C.slice(C.l||0),N=Iu(L,V);return C.l+=N[1],N[0]}function ic(C,V){if(C)typeof console<"u"&&console.error(V);else throw new Error(V)}function Fi(C,V){var L=C;un(L,0);var N=[],B=[],U={FileIndex:N,FullPaths:B};y(U,{root:V.root});for(var J=L.length-4;(L[J]!=80||L[J+1]!=75||L[J+2]!=5||L[J+3]!=6)&&J>=0;)--J;L.l=J+4,L.l+=4;var re=L.read_shift(2);L.l+=6;var X=L.read_shift(4);for(L.l=X,J=0;J<re;++J){L.l+=20;var Z=L.read_shift(4),ee=L.read_shift(4),ce=L.read_shift(2),pe=L.read_shift(2),Ee=L.read_shift(2);L.l+=8;var le=L.read_shift(4),ve=o(L.slice(L.l+ce,L.l+ce+pe));L.l+=ce+pe+Ee;var Fe=L.l;L.l=le+4,Au(L,Z,ee,U,ve),L.l=Fe}return U}function Au(C,V,L,N,B){C.l+=2;var U=C.read_shift(2),J=C.read_shift(2),re=a(C);if(U&8257)throw new Error("Unsupported ZIP encryption");for(var X=C.read_shift(4),Z=C.read_shift(4),ee=C.read_shift(4),ce=C.read_shift(2),pe=C.read_shift(2),Ee="",le=0;le<ce;++le)Ee+=String.fromCharCode(C[C.l++]);if(pe){var ve=o(C.slice(C.l,C.l+pe));(ve[21589]||{}).mt&&(re=ve[21589].mt),((B||{})[21589]||{}).mt&&(re=B[21589].mt)}C.l+=pe;var Fe=C.slice(C.l,C.l+Z);switch(J){case 8:Fe=Q(C,ee);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+J)}var ut=!1;U&8&&(X=C.read_shift(4),X==134695760&&(X=C.read_shift(4),ut=!0),Z=C.read_shift(4),ee=C.read_shift(4)),Z!=V&&ic(ut,"Bad compressed size: "+V+" != "+Z),ee!=L&&ic(ut,"Bad uncompressed size: "+L+" != "+ee),Ua(N,Ee,Fe,{unsafe:!0,mt:re})}function cn(C,V){var L=V||{},N=[],B=[],U=qt(1),J=L.compression?8:0,re=0,X=0,Z=0,ee=0,ce=0,pe=C.FullPaths[0],Ee=pe,le=C.FileIndex[0],ve=[],Fe=0;for(X=1;X<C.FullPaths.length;++X)if(Ee=C.FullPaths[X].slice(pe.length),le=C.FileIndex[X],!(!le.size||!le.content||Ee=="Sh33tJ5")){var ut=ee,ht=qt(Ee.length);for(Z=0;Z<Ee.length;++Z)ht.write_shift(1,Ee.charCodeAt(Z)&127);ht=ht.slice(0,ht.l),ve[ce]=s5.buf(le.content,0);var jt=le.content;J==8&&(jt=G(jt)),U=qt(30),U.write_shift(4,67324752),U.write_shift(2,20),U.write_shift(2,re),U.write_shift(2,J),le.mt?s(U,le.mt):U.write_shift(4,0),U.write_shift(-4,ve[ce]),U.write_shift(4,jt.length),U.write_shift(4,le.content.length),U.write_shift(2,ht.length),U.write_shift(2,0),ee+=U.length,N.push(U),ee+=ht.length,N.push(ht),ee+=jt.length,N.push(jt),U=qt(46),U.write_shift(4,33639248),U.write_shift(2,0),U.write_shift(2,20),U.write_shift(2,re),U.write_shift(2,J),U.write_shift(4,0),U.write_shift(-4,ve[ce]),U.write_shift(4,jt.length),U.write_shift(4,le.content.length),U.write_shift(2,ht.length),U.write_shift(2,0),U.write_shift(2,0),U.write_shift(2,0),U.write_shift(2,0),U.write_shift(4,0),U.write_shift(4,ut),Fe+=U.l,B.push(U),Fe+=ht.length,B.push(ht),++ce}return U=qt(22),U.write_shift(4,101010256),U.write_shift(2,0),U.write_shift(2,0),U.write_shift(2,ce),U.write_shift(2,ce),U.write_shift(4,Fe),U.write_shift(4,ee),U.write_shift(2,0),Ji([Ji(N),Ji(B),U])}var Fs={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Os(C,V){if(C.ctype)return C.ctype;var L=C.name||"",N=L.match(/\.([^\.]+)$/);return N&&Fs[N[1]]||V&&(N=(L=V).match(/[\.\\]([^\.\\])+$/),N&&Fs[N[1]])?Fs[N[1]]:"application/octet-stream"}function Ms(C){for(var V=Wy(C),L=[],N=0;N<V.length;N+=76)L.push(V.slice(N,N+76));return L.join(`\r
`)+`\r
`}function _d(C){var V=C.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Z){var ee=Z.charCodeAt(0).toString(16).toUpperCase();return"="+(ee.length==1?"0"+ee:ee)});V=V.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),V.charAt(0)==`
`&&(V="=0D"+V.slice(1)),V=V.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var L=[],N=V.split(`\r
`),B=0;B<N.length;++B){var U=N[B];if(U.length==0){L.push("");continue}for(var J=0;J<U.length;){var re=76,X=U.slice(J,J+re);X.charAt(re-1)=="="?re--:X.charAt(re-2)=="="?re-=2:X.charAt(re-3)=="="&&(re-=3),X=U.slice(J,J+re),J+=re,J<U.length&&(X+="="),L.push(X)}}return L.join(`\r
`)}function xd(C){for(var V=[],L=0;L<C.length;++L){for(var N=C[L];L<=C.length&&N.charAt(N.length-1)=="=";)N=N.slice(0,N.length-1)+C[++L];V.push(N)}for(var B=0;B<V.length;++B)V[B]=V[B].replace(/[=][0-9A-Fa-f]{2}/g,function(U){return String.fromCharCode(parseInt(U.slice(1),16))});return vr(V.join(`\r
`))}function Oi(C,V,L){for(var N="",B="",U="",J,re=0;re<10;++re){var X=V[re];if(!X||X.match(/^\s*$/))break;var Z=X.match(/^(.*?):\s*([^\s].*)$/);if(Z)switch(Z[1].toLowerCase()){case"content-location":N=Z[2].trim();break;case"content-type":U=Z[2].trim();break;case"content-transfer-encoding":B=Z[2].trim();break}}switch(++re,B.toLowerCase()){case"base64":J=vr(nr(V.slice(re).join("")));break;case"quoted-printable":J=xd(V.slice(re));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+B)}var ee=Ua(C,N.slice(L.length),J,{unsafe:!0});U&&(ee.ctype=U)}function yd(C,V){if(K(C.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var L=V&&V.root||"",N=(Ke&&Buffer.isBuffer(C)?C.toString("binary"):K(C)).split(`\r
`),B=0,U="";for(B=0;B<N.length;++B)if(U=N[B],!!/^Content-Location:/i.test(U)&&(U=U.slice(U.indexOf("file")),L||(L=U.slice(0,U.lastIndexOf("/")+1)),U.slice(0,L.length)!=L))for(;L.length>0&&(L=L.slice(0,L.length-1),L=L.slice(0,L.lastIndexOf("/")+1),U.slice(0,L.length)!=L););var J=(N[1]||"").match(/boundary="(.*?)"/);if(!J)throw new Error("MAD cannot find boundary");var re="--"+(J[1]||""),X=[],Z=[],ee={FileIndex:X,FullPaths:Z};y(ee);var ce,pe=0;for(B=0;B<N.length;++B){var Ee=N[B];Ee!==re&&Ee!==re+"--"||(pe++&&Oi(ee,N.slice(ce,B),L),ce=B)}return ee}function vd(C,V){var L=V||{},N=L.boundary||"SheetJS";N="------="+N;for(var B=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+N.slice(2)+'"',"","",""],U=C.FullPaths[0],J=U,re=C.FileIndex[0],X=1;X<C.FullPaths.length;++X)if(J=C.FullPaths[X].slice(U.length),re=C.FileIndex[X],!(!re.size||!re.content||J=="Sh33tJ5")){J=J.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Fe){return"_x"+Fe.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Fe){return"_u"+Fe.charCodeAt(0).toString(16)+"_"});for(var Z=re.content,ee=Ke&&Buffer.isBuffer(Z)?Z.toString("binary"):K(Z),ce=0,pe=Math.min(1024,ee.length),Ee=0,le=0;le<=pe;++le)(Ee=ee.charCodeAt(le))>=32&&Ee<128&&++ce;var ve=ce>=pe*4/5;B.push(N),B.push("Content-Location: "+(L.root||"file:///C:/SheetJS/")+J),B.push("Content-Transfer-Encoding: "+(ve?"quoted-printable":"base64")),B.push("Content-Type: "+Os(re,J)),B.push(""),B.push(ve?_d(ee):Ms(ee))}return B.push(N+`--\r
`),B.join(`\r
`)}function Ba(C){var V={};return y(V,C),V}function Ua(C,V,L,N){var B=N&&N.unsafe;B||y(C);var U=!B&&Qe.find(C,V);if(!U){var J=C.FullPaths[0];V.slice(0,J.length)==J?J=V:(J.slice(-1)!="/"&&(J+="/"),J=(J+V).replace("//","/")),U={name:i(V),type:2},C.FileIndex.push(U),C.FullPaths.push(J),B||Qe.utils.cfb_gc(C)}return U.content=L,U.size=L?L.length:0,N&&(N.CLSID&&(U.clsid=N.CLSID),N.mt&&(U.mt=N.mt),N.ct&&(U.ct=N.ct)),U}function Su(C,V){y(C);var L=Qe.find(C,V);if(L){for(var N=0;N<C.FileIndex.length;++N)if(C.FileIndex[N]==L)return C.FileIndex.splice(N,1),C.FullPaths.splice(N,1),!0}return!1}function sc(C,V,L){y(C);var N=Qe.find(C,V);if(N){for(var B=0;B<C.FileIndex.length;++B)if(C.FileIndex[B]==N)return C.FileIndex[B].name=i(L),C.FullPaths[B]=L,!0}return!1}function Ls(C){T(C,!0)}return e.find=A,e.read=O,e.parse=u,e.write=Se,e.writeFile=Oe,e.utils={cfb_new:Ba,cfb_add:Ua,cfb_del:Su,cfb_mov:sc,cfb_gc:Ls,ReadShift:sl,CheckField:s2,prep_blob:un,bconcat:Ji,use_zlib:z,_deflateRaw:Be,_inflateRaw:Ds,consts:he},e})();function a5(n){if(typeof Deno<"u")return Deno.readFileSync(n);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var e=File(n);e.open("r"),e.encoding="binary";var t=e.read();return e.close(),t}catch(r){if(!r.message||!r.message.match(/onstruct/))throw r}throw new Error("Cannot access file "+n)}function Kr(n){for(var e=Object.keys(n),t=[],r=0;r<e.length;++r)Object.prototype.hasOwnProperty.call(n,e[r])&&t.push(e[r]);return t}function gm(n){for(var e=[],t=Kr(n),r=0;r!==t.length;++r)e[n[t[r]]]=t[r];return e}var wf=new Date(1899,11,30,0,0,0);function Bn(n,e){var t=n.getTime(),r=wf.getTime()+(n.getTimezoneOffset()-wf.getTimezoneOffset())*6e4;return(t-r)/(1440*60*1e3)}var VI=new Date,o5=wf.getTime()+(VI.getTimezoneOffset()-wf.getTimezoneOffset())*6e4,Zy=VI.getTimezoneOffset();function dd(n){var e=new Date;return e.setTime(n*24*60*60*1e3+o5),e.getTimezoneOffset()!==Zy&&e.setTime(e.getTime()+(e.getTimezoneOffset()-Zy)*6e4),e}function c5(n){var e=0,t=0,r=!1,i=n.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!i)throw new Error("|"+n+"| is not an ISO8601 Duration");for(var s=1;s!=i.length;++s)if(i[s]){switch(t=1,s>3&&(r=!0),i[s].slice(i[s].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+i[s].slice(i[s].length-1));case"D":t*=24;case"H":t*=60;case"M":if(r)t*=60;else throw new Error("Unsupported ISO Duration Field: M")}e+=t*parseInt(i[s],10)}return e}var ev=new Date("2017-02-19T19:06:09.000Z"),BI=isNaN(ev.getFullYear())?new Date("2/19/17"):ev,l5=BI.getFullYear()==2017;function on(n,e){var t=new Date(n);if(l5)return e>0?t.setTime(t.getTime()+t.getTimezoneOffset()*60*1e3):e<0&&t.setTime(t.getTime()-t.getTimezoneOffset()*60*1e3),t;if(n instanceof Date)return n;if(BI.getFullYear()==1917&&!isNaN(t.getFullYear())){var r=t.getFullYear();return n.indexOf(""+r)>-1||t.setFullYear(t.getFullYear()+100),t}var i=n.match(/\d+/g)||["2017","2","19","0","0","0"],s=new Date(+i[0],+i[1]-1,+i[2],+i[3]||0,+i[4]||0,+i[5]||0);return n.indexOf("Z")>-1&&(s=new Date(s.getTime()-s.getTimezoneOffset()*60*1e3)),s}function Sa(n,e){if(Ke&&Buffer.isBuffer(n)){if(e){if(n[0]==255&&n[1]==254)return $c(n.slice(2).toString("utf16le"));if(n[1]==254&&n[2]==255)return $c(II(n.slice(2).toString("binary")))}return n.toString("binary")}if(typeof TextDecoder<"u")try{if(e){if(n[0]==255&&n[1]==254)return $c(new TextDecoder("utf-16le").decode(n.slice(2)));if(n[0]==254&&n[1]==255)return $c(new TextDecoder("utf-16be").decode(n.slice(2)))}var t={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(n)&&(n=new Uint8Array(n)),new TextDecoder("latin1").decode(n).replace(/[]/g,function(s){return t[s]||s})}catch{}for(var r=[],i=0;i!=n.length;++i)r.push(String.fromCharCode(n[i]));return r.join("")}function hn(n){if(typeof JSON<"u"&&!Array.isArray(n))return JSON.parse(JSON.stringify(n));if(typeof n!="object"||n==null)return n;if(n instanceof Date)return new Date(n.getTime());var e={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=hn(n[t]));return e}function Rt(n,e){for(var t="";t.length<e;)t+=n;return t}function Ar(n){var e=Number(n);if(!isNaN(e))return isFinite(e)?e:NaN;if(!/\d/.test(n))return e;var t=1,r=n.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return t*=100,""});return!isNaN(e=Number(r))||(r=r.replace(/[(](.*)[)]/,function(i,s){return t=-t,s}),!isNaN(e=Number(r)))?e/t:e}var u5=["january","february","march","april","may","june","july","august","september","october","november","december"];function $o(n){var e=new Date(n),t=new Date(NaN),r=e.getYear(),i=e.getMonth(),s=e.getDate();if(isNaN(s))return t;var a=n.toLowerCase();if(a.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(a=a.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),a.length>3&&u5.indexOf(a)==-1)return t}else if(a.match(/[a-z]/))return t;return r<0||r>8099?t:(i>0||s>1)&&r!=101?e:n.match(/[^-0-9:,\/\\]/)?t:e}var h5=(function(){var n="abacaba".split(/(:?b)/i).length==5;return function(t,r,i){if(n||typeof r=="string")return t.split(r);for(var s=t.split(r),a=[s[0]],o=1;o<s.length;++o)a.push(i),a.push(s[o]);return a}})();function UI(n){return n?n.content&&n.type?Sa(n.content,!0):n.data?Uc(n.data):n.asNodeBuffer&&Ke?Uc(n.asNodeBuffer().toString("binary")):n.asBinary?Uc(n.asBinary()):n._data&&n._data.getContent?Uc(Sa(Array.prototype.slice.call(n._data.getContent(),0))):null:null}function HI(n){if(!n)return null;if(n.data)return zy(n.data);if(n.asNodeBuffer&&Ke)return n.asNodeBuffer();if(n._data&&n._data.getContent){var e=n._data.getContent();return typeof e=="string"?zy(e):Array.prototype.slice.call(e)}return n.content&&n.type?n.content:null}function f5(n){return n&&n.name.slice(-4)===".bin"?HI(n):UI(n)}function or(n,e){for(var t=n.FullPaths||Kr(n.files),r=e.toLowerCase().replace(/[\/]/g,"\\"),i=r.replace(/\\/g,"/"),s=0;s<t.length;++s){var a=t[s].replace(/^Root Entry[\/]/,"").toLowerCase();if(r==a||i==a)return n.files?n.files[t[s]]:n.FileIndex[s]}return null}function mm(n,e){var t=or(n,e);if(t==null)throw new Error("Cannot find file "+e+" in zip");return t}function Ht(n,e,t){if(!t)return f5(mm(n,e));if(!e)return null;try{return Ht(n,e)}catch{return null}}function Jn(n,e,t){if(!t)return UI(mm(n,e));if(!e)return null;try{return Jn(n,e)}catch{return null}}function d5(n,e,t){return HI(mm(n,e))}function tv(n){for(var e=n.FullPaths||Kr(n.files),t=[],r=0;r<e.length;++r)e[r].slice(-1)!="/"&&t.push(e[r].replace(/^Root Entry[\/]/,""));return t.sort()}function p5(n,e,t){if(n.FullPaths){if(typeof t=="string"){var r;return Ke?r=Da(t):r=F6(t),Qe.utils.cfb_add(n,e,r)}Qe.utils.cfb_add(n,e,t)}else n.file(e,t)}function zI(n,e){switch(e.type){case"base64":return Qe.read(n,{type:"base64"});case"binary":return Qe.read(n,{type:"binary"});case"buffer":case"array":return Qe.read(n,{type:"buffer"})}throw new Error("Unrecognized type "+e.type)}function zc(n,e){if(n.charAt(0)=="/")return n.slice(1);var t=e.split("/");e.slice(-1)!="/"&&t.pop();for(var r=n.split("/");r.length!==0;){var i=r.shift();i===".."?t.pop():i!=="."&&t.push(i)}return t.join("/")}var $I=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,g5=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,nv=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,m5=/<[^>]*>/g,Rn=$I.match(nv)?nv:m5,_5=/<\w*:/,x5=/<(\/?)\w+:/;function Pe(n,e,t){for(var r={},i=0,s=0;i!==n.length&&!((s=n.charCodeAt(i))===32||s===10||s===13);++i);if(e||(r[0]=n.slice(0,i)),i===n.length)return r;var a=n.match(g5),o=0,c="",l=0,u="",h="",d=1;if(a)for(l=0;l!=a.length;++l){for(h=a[l],s=0;s!=h.length&&h.charCodeAt(s)!==61;++s);for(u=h.slice(0,s).trim();h.charCodeAt(s+1)==32;)++s;for(d=(i=h.charCodeAt(s+1))==34||i==39?1:0,c=h.slice(s+1+d,h.length-d),o=0;o!=u.length&&u.charCodeAt(o)!==58;++o);if(o===u.length)u.indexOf("_")>0&&(u=u.slice(0,u.indexOf("_"))),r[u]=c,r[u.toLowerCase()]=c;else{var p=(o===5&&u.slice(0,5)==="xmlns"?"xmlns":"")+u.slice(o+1);if(r[p]&&u.slice(o-3,o)=="ext")continue;r[p]=c,r[p.toLowerCase()]=c}}return r}function Qr(n){return n.replace(x5,"<$1")}var WI={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},y5=gm(WI),Ze=(function(){var n=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,e=/_x([\da-fA-F]{4})_/ig;return function t(r){var i=r+"",s=i.indexOf("<![CDATA[");if(s==-1)return i.replace(n,function(o,c){return WI[o]||String.fromCharCode(parseInt(c,o.indexOf("x")>-1?16:10))||o}).replace(e,function(o,c){return String.fromCharCode(parseInt(c,16))});var a=i.indexOf("]]>");return t(i.slice(0,s))+i.slice(s+9,a)+t(i.slice(a+3))}})(),v5=/[&<>'"]/g,E5=/[\u0000-\u001f]/g;function _m(n){var e=n+"";return e.replace(v5,function(t){return y5[t]}).replace(/\n/g,"<br/>").replace(E5,function(t){return"&#x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+";"})}var rv=(function(){var n=/&#(\d+);/g;function e(t,r){return String.fromCharCode(parseInt(r,10))}return function(r){return r.replace(n,e)}})();function bt(n){switch(n){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function u0(n){for(var e="",t=0,r=0,i=0,s=0,a=0,o=0;t<n.length;){if(r=n.charCodeAt(t++),r<128){e+=String.fromCharCode(r);continue}if(i=n.charCodeAt(t++),r>191&&r<224){a=(r&31)<<6,a|=i&63,e+=String.fromCharCode(a);continue}if(s=n.charCodeAt(t++),r<240){e+=String.fromCharCode((r&15)<<12|(i&63)<<6|s&63);continue}a=n.charCodeAt(t++),o=((r&7)<<18|(i&63)<<12|(s&63)<<6|a&63)-65536,e+=String.fromCharCode(55296+(o>>>10&1023)),e+=String.fromCharCode(56320+(o&1023))}return e}function iv(n){var e=vs(2*n.length),t,r,i=1,s=0,a=0,o;for(r=0;r<n.length;r+=i)i=1,(o=n.charCodeAt(r))<128?t=o:o<224?(t=(o&31)*64+(n.charCodeAt(r+1)&63),i=2):o<240?(t=(o&15)*4096+(n.charCodeAt(r+1)&63)*64+(n.charCodeAt(r+2)&63),i=3):(i=4,t=(o&7)*262144+(n.charCodeAt(r+1)&63)*4096+(n.charCodeAt(r+2)&63)*64+(n.charCodeAt(r+3)&63),t-=65536,a=55296+(t>>>10&1023),t=56320+(t&1023)),a!==0&&(e[s++]=a&255,e[s++]=a>>>8,a=0),e[s++]=t%256,e[s++]=t>>>8;return e.slice(0,s).toString("ucs2")}function sv(n){return Da(n,"binary").toString("utf8")}var sh="foo bar baz",dt=Ke&&(sv(sh)==u0(sh)&&sv||iv(sh)==u0(sh)&&iv)||u0,$c=Ke?function(n){return Da(n,"utf8").toString("binary")}:function(n){for(var e=[],t=0,r=0,i=0;t<n.length;)switch(r=n.charCodeAt(t++),!0){case r<128:e.push(String.fromCharCode(r));break;case r<2048:e.push(String.fromCharCode(192+(r>>6))),e.push(String.fromCharCode(128+(r&63)));break;case(r>=55296&&r<57344):r-=55296,i=n.charCodeAt(t++)-56320+(r<<10),e.push(String.fromCharCode(240+(i>>18&7))),e.push(String.fromCharCode(144+(i>>12&63))),e.push(String.fromCharCode(128+(i>>6&63))),e.push(String.fromCharCode(128+(i&63)));break;default:e.push(String.fromCharCode(224+(r>>12))),e.push(String.fromCharCode(128+(r>>6&63))),e.push(String.fromCharCode(128+(r&63)))}return e.join("")},$l=(function(){var n={};return function(t,r){var i=t+"|"+(r||"");return n[i]?n[i]:n[i]=new RegExp("<(?:\\w+:)?"+t+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+t+">",r||"")}})(),jI=(function(){var n=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(e){return[new RegExp("&"+e[0]+";","ig"),e[1]]});return function(t){for(var r=t.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),i=0;i<n.length;++i)r=r.replace(n[i][0],n[i][1]);return r}})(),w5=(function(){var n={};return function(t){return n[t]!==void 0?n[t]:n[t]=new RegExp("<(?:vt:)?"+t+">([\\s\\S]*?)</(?:vt:)?"+t+">","g")}})(),T5=/<\/?(?:vt:)?variant>/g,b5=/<(?:vt:)([^>]*)>([\s\S]*)</;function av(n,e){var t=Pe(n),r=n.match(w5(t.baseType))||[],i=[];if(r.length!=t.size){if(e.WTF)throw new Error("unexpected vector length "+r.length+" != "+t.size);return i}return r.forEach(function(s){var a=s.replace(T5,"").match(b5);a&&i.push({v:dt(a[2]),t:a[1]})}),i}var I5=/(^\s|\s$|\n)/;function A5(n){return Kr(n).map(function(e){return" "+e+'="'+n[e]+'"'}).join("")}function S5(n,e,t){return"<"+n+(t!=null?A5(t):"")+(e!=null?(e.match(I5)?' xml:space="preserve"':"")+">"+e+"</"+n:"/")+">"}function xm(n){if(Ke&&Buffer.isBuffer(n))return n.toString("utf8");if(typeof n=="string")return n;if(typeof Uint8Array<"u"&&n instanceof Uint8Array)return dt(Fa(fm(n)));throw new Error("Bad input format: expected Buffer or string")}var Wl=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,k5={CT:"http://schemas.openxmlformats.org/package/2006/content-types"},C5=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function R5(n,e){for(var t=1-2*(n[e+7]>>>7),r=((n[e+7]&127)<<4)+(n[e+6]>>>4&15),i=n[e+6]&15,s=5;s>=0;--s)i=i*256+n[e+s];return r==2047?i==0?t*(1/0):NaN:(r==0?r=-1022:(r-=1023,i+=Math.pow(2,52)),t*Math.pow(2,r-52)*i)}function P5(n,e,t){var r=(e<0||1/e==-1/0?1:0)<<7,i=0,s=0,a=r?-e:e;isFinite(a)?a==0?i=s=0:(i=Math.floor(Math.log(a)/Math.LN2),s=a*Math.pow(2,52-i),i<=-1023&&(!isFinite(s)||s<Math.pow(2,52))?i=-1022:(s-=Math.pow(2,52),i+=1023)):(i=2047,s=isNaN(e)?26985:0);for(var o=0;o<=5;++o,s/=256)n[t+o]=s&255;n[t+6]=(i&15)<<4|s&15,n[t+7]=i>>4|r}var ov=function(n){for(var e=[],t=10240,r=0;r<n[0].length;++r)if(n[0][r])for(var i=0,s=n[0][r].length;i<s;i+=t)e.push.apply(e,n[0][r].slice(i,i+t));return e},cv=Ke?function(n){return n[0].length>0&&Buffer.isBuffer(n[0][0])?Buffer.concat(n[0].map(function(e){return Buffer.isBuffer(e)?e:Da(e)})):ov(n)}:ov,lv=function(n,e,t){for(var r=[],i=e;i<t;i+=2)r.push(String.fromCharCode(pi(n,i)));return r.join("").replace(Vn,"")},ym=Ke?function(n,e,t){return Buffer.isBuffer(n)?n.toString("utf16le",e,t).replace(Vn,""):lv(n,e,t)}:lv,uv=function(n,e,t){for(var r=[],i=e;i<e+t;++i)r.push(("0"+n[i].toString(16)).slice(-2));return r.join("")},GI=Ke?function(n,e,t){return Buffer.isBuffer(n)?n.toString("hex",e,e+t):uv(n,e,t)}:uv,hv=function(n,e,t){for(var r=[],i=e;i<t;i++)r.push(String.fromCharCode(so(n,i)));return r.join("")},yu=Ke?function(e,t,r){return Buffer.isBuffer(e)?e.toString("utf8",t,r):hv(e,t,r)}:hv,qI=function(n,e){var t=Xn(n,e);return t>0?yu(n,e+4,e+4+t-1):""},KI=qI,YI=function(n,e){var t=Xn(n,e);return t>0?yu(n,e+4,e+4+t-1):""},XI=YI,QI=function(n,e){var t=2*Xn(n,e);return t>0?yu(n,e+4,e+4+t-1):""},JI=QI,ZI=function(e,t){var r=Xn(e,t);return r>0?ym(e,t+4,t+4+r):""},e2=ZI,t2=function(n,e){var t=Xn(n,e);return t>0?yu(n,e+4,e+4+t):""},n2=t2,r2=function(n,e){return R5(n,e)},Tf=r2,i2=function(e){return Array.isArray(e)||typeof Uint8Array<"u"&&e instanceof Uint8Array};Ke&&(KI=function(e,t){if(!Buffer.isBuffer(e))return qI(e,t);var r=e.readUInt32LE(t);return r>0?e.toString("utf8",t+4,t+4+r-1):""},XI=function(e,t){if(!Buffer.isBuffer(e))return YI(e,t);var r=e.readUInt32LE(t);return r>0?e.toString("utf8",t+4,t+4+r-1):""},JI=function(e,t){if(!Buffer.isBuffer(e))return QI(e,t);var r=2*e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+r-1)},e2=function(e,t){if(!Buffer.isBuffer(e))return ZI(e,t);var r=e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+r)},n2=function(e,t){if(!Buffer.isBuffer(e))return t2(e,t);var r=e.readUInt32LE(t);return e.toString("utf8",t+4,t+4+r)},Tf=function(e,t){return Buffer.isBuffer(e)?e.readDoubleLE(t):r2(e,t)},i2=function(e){return Buffer.isBuffer(e)||Array.isArray(e)||typeof Uint8Array<"u"&&e instanceof Uint8Array});var so=function(n,e){return n[e]},pi=function(n,e){return n[e+1]*256+n[e]},D5=function(n,e){var t=n[e+1]*256+n[e];return t<32768?t:(65535-t+1)*-1},Xn=function(n,e){return n[e+3]*(1<<24)+(n[e+2]<<16)+(n[e+1]<<8)+n[e]},ea=function(n,e){return n[e+3]<<24|n[e+2]<<16|n[e+1]<<8|n[e]},F5=function(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]};function sl(n,e){var t="",r,i,s=[],a,o,c,l;switch(e){case"dbcs":if(l=this.l,Ke&&Buffer.isBuffer(this))t=this.slice(this.l,this.l+2*n).toString("utf16le");else for(c=0;c<n;++c)t+=String.fromCharCode(pi(this,l)),l+=2;n*=2;break;case"utf8":t=yu(this,this.l,this.l+n);break;case"utf16le":n*=2,t=ym(this,this.l,this.l+n);break;case"wstr":return sl.call(this,n,"dbcs");case"lpstr-ansi":t=KI(this,this.l),n=4+Xn(this,this.l);break;case"lpstr-cp":t=XI(this,this.l),n=4+Xn(this,this.l);break;case"lpwstr":t=JI(this,this.l),n=4+2*Xn(this,this.l);break;case"lpp4":n=4+Xn(this,this.l),t=e2(this,this.l),n&2&&(n+=2);break;case"8lpp4":n=4+Xn(this,this.l),t=n2(this,this.l),n&3&&(n+=4-(n&3));break;case"cstr":for(n=0,t="";(a=so(this,this.l+n++))!==0;)s.push(ih(a));t=s.join("");break;case"_wstr":for(n=0,t="";(a=pi(this,this.l+n))!==0;)s.push(ih(a)),n+=2;n+=2,t=s.join("");break;case"dbcs-cont":for(t="",l=this.l,c=0;c<n;++c){if(this.lens&&this.lens.indexOf(l)!==-1)return a=so(this,l),this.l=l+1,o=sl.call(this,n-c,a?"dbcs-cont":"sbcs-cont"),s.join("")+o;s.push(ih(pi(this,l))),l+=2}t=s.join(""),n*=2;break;case"cpstr":case"sbcs-cont":for(t="",l=this.l,c=0;c!=n;++c){if(this.lens&&this.lens.indexOf(l)!==-1)return a=so(this,l),this.l=l+1,o=sl.call(this,n-c,a?"dbcs-cont":"sbcs-cont"),s.join("")+o;s.push(ih(so(this,l))),l+=1}t=s.join("");break;default:switch(n){case 1:return r=so(this,this.l),this.l++,r;case 2:return r=(e==="i"?D5:pi)(this,this.l),this.l+=2,r;case 4:case-4:return e==="i"||(this[this.l+3]&128)===0?(r=(n>0?ea:F5)(this,this.l),this.l+=4,r):(i=Xn(this,this.l),this.l+=4,i);case 8:case-8:if(e==="f")return n==8?i=Tf(this,this.l):i=Tf([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,i;n=8;case 16:t=GI(this,this.l,n);break}}return this.l+=n,t}var O5=function(n,e,t){n[t]=e&255,n[t+1]=e>>>8&255,n[t+2]=e>>>16&255,n[t+3]=e>>>24&255},M5=function(n,e,t){n[t]=e&255,n[t+1]=e>>8&255,n[t+2]=e>>16&255,n[t+3]=e>>24&255},L5=function(n,e,t){n[t]=e&255,n[t+1]=e>>>8&255};function N5(n,e,t){var r=0,i=0;if(t==="dbcs"){for(i=0;i!=e.length;++i)L5(this,e.charCodeAt(i),this.l+2*i);r=2*e.length}else if(t==="sbcs"){for(e=e.replace(/[^\x00-\x7F]/g,"_"),i=0;i!=e.length;++i)this[this.l+i]=e.charCodeAt(i)&255;r=e.length}else if(t==="hex"){for(;i<n;++i)this[this.l++]=parseInt(e.slice(2*i,2*i+2),16)||0;return this}else if(t==="utf16le"){var s=Math.min(this.l+n,this.length);for(i=0;i<Math.min(e.length,n);++i){var a=e.charCodeAt(i);this[this.l++]=a&255,this[this.l++]=a>>8}for(;this.l<s;)this[this.l++]=0;return this}else switch(n){case 1:r=1,this[this.l]=e&255;break;case 2:r=2,this[this.l]=e&255,e>>>=8,this[this.l+1]=e&255;break;case 3:r=3,this[this.l]=e&255,e>>>=8,this[this.l+1]=e&255,e>>>=8,this[this.l+2]=e&255;break;case 4:r=4,O5(this,e,this.l);break;case 8:if(r=8,t==="f"){P5(this,e,this.l);break}case 16:break;case-4:r=4,M5(this,e,this.l);break}return this.l+=r,this}function s2(n,e){var t=GI(this,this.l,n.length>>1);if(t!==n)throw new Error(e+"Expected "+n+" saw "+t);this.l+=n.length>>1}function un(n,e){n.l=e,n.read_shift=sl,n.chk=s2,n.write_shift=N5}function Cn(n,e){n.l+=e}function qt(n){var e=vs(n);return un(e,0),e}function Pi(n,e,t){if(n){var r,i,s;un(n,n.l||0);for(var a=n.length,o=0,c=0;n.l<a;){o=n.read_shift(1),o&128&&(o=(o&127)+((n.read_shift(1)&127)<<7));var l=Cf[o]||Cf[65535];for(r=n.read_shift(1),s=r&127,i=1;i<4&&r&128;++i)s+=((r=n.read_shift(1))&127)<<7*i;c=n.l+s;var u=l.f&&l.f(n,s,t);if(n.l=c,e(u,l,o))return}}}function gp(){var n=[],e=Ke?256:2048,t=function(l){var u=qt(l);return un(u,0),u},r=t(e),i=function(){r&&(r.length>r.l&&(r=r.slice(0,r.l),r.l=r.length),r.length>0&&n.push(r),r=null)},s=function(l){return r&&l<r.length-r.l?r:(i(),r=t(Math.max(l+1,e)))},a=function(){return i(),Ji(n)},o=function(l){i(),r=l,r.l==null&&(r.l=r.length),s(e)};return{next:s,push:o,end:a,_bufs:n}}function al(n,e,t){var r=hn(n);if(e.s?(r.cRel&&(r.c+=e.s.c),r.rRel&&(r.r+=e.s.r)):(r.cRel&&(r.c+=e.c),r.rRel&&(r.r+=e.r)),!t||t.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function fv(n,e,t){var r=hn(n);return r.s=al(r.s,e.s,t),r.e=al(r.e,e.s,t),r}function ol(n,e){if(n.cRel&&n.c<0)for(n=hn(n);n.c<0;)n.c+=e>8?16384:256;if(n.rRel&&n.r<0)for(n=hn(n);n.r<0;)n.r+=e>8?1048576:e>5?65536:16384;var t=Me(n);return!n.cRel&&n.cRel!=null&&(t=U5(t)),!n.rRel&&n.rRel!=null&&(t=V5(t)),t}function h0(n,e){return n.s.r==0&&!n.s.rRel&&n.e.r==(e.biff>=12?1048575:e.biff>=8?65536:16384)&&!n.e.rRel?(n.s.cRel?"":"$")+Xt(n.s.c)+":"+(n.e.cRel?"":"$")+Xt(n.e.c):n.s.c==0&&!n.s.cRel&&n.e.c==(e.biff>=12?16383:255)&&!n.e.cRel?(n.s.rRel?"":"$")+fn(n.s.r)+":"+(n.e.rRel?"":"$")+fn(n.e.r):ol(n.s,e.biff)+":"+ol(n.e,e.biff)}function vm(n){return parseInt(B5(n),10)-1}function fn(n){return""+(n+1)}function V5(n){return n.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function B5(n){return n.replace(/\$(\d+)$/,"$1")}function Em(n){for(var e=H5(n),t=0,r=0;r!==e.length;++r)t=26*t+e.charCodeAt(r)-64;return t-1}function Xt(n){if(n<0)throw new Error("invalid column "+n);var e="";for(++n;n;n=Math.floor((n-1)/26))e=String.fromCharCode((n-1)%26+65)+e;return e}function U5(n){return n.replace(/^([A-Z])/,"$$$1")}function H5(n){return n.replace(/^\$([A-Z])/,"$1")}function z5(n){return n.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Ln(n){for(var e=0,t=0,r=0;r<n.length;++r){var i=n.charCodeAt(r);i>=48&&i<=57?e=10*e+(i-48):i>=65&&i<=90&&(t=26*t+(i-64))}return{c:t-1,r:e-1}}function Me(n){for(var e=n.c+1,t="";e;e=(e-1)/26|0)t=String.fromCharCode((e-1)%26+65)+t;return t+(n.r+1)}function nc(n){var e=n.indexOf(":");return e==-1?{s:Ln(n),e:Ln(n)}:{s:Ln(n.slice(0,e)),e:Ln(n.slice(e+1))}}function Je(n,e){return typeof e>"u"||typeof e=="number"?Je(n.s,n.e):(typeof n!="string"&&(n=Me(n)),typeof e!="string"&&(e=Me(e)),n==e?n:n+":"+e)}function Ft(n){var e={s:{c:0,r:0},e:{c:0,r:0}},t=0,r=0,i=0,s=n.length;for(t=0;r<s&&!((i=n.charCodeAt(r)-64)<1||i>26);++r)t=26*t+i;for(e.s.c=--t,t=0;r<s&&!((i=n.charCodeAt(r)-48)<0||i>9);++r)t=10*t+i;if(e.s.r=--t,r===s||i!=10)return e.e.c=e.s.c,e.e.r=e.s.r,e;for(++r,t=0;r!=s&&!((i=n.charCodeAt(r)-64)<1||i>26);++r)t=26*t+i;for(e.e.c=--t,t=0;r!=s&&!((i=n.charCodeAt(r)-48)<0||i>9);++r)t=10*t+i;return e.e.r=--t,e}function dv(n,e){var t=n.t=="d"&&e instanceof Date;if(n.z!=null)try{return n.w=ur(n.z,t?Bn(e):e)}catch{}try{return n.w=ur((n.XF||{}).numFmtId||(t?14:0),t?Bn(e):e)}catch{return""+e}}function bi(n,e,t){return n==null||n.t==null||n.t=="z"?"":n.w!==void 0?n.w:(n.t=="d"&&!n.z&&t&&t.dateNF&&(n.z=t.dateNF),n.t=="e"?La[n.v]||n.v:e==null?dv(n,n.v):dv(n,e))}function Rs(n,e){var t=e&&e.sheet?e.sheet:"Sheet1",r={};return r[t]=n,{SheetNames:[t],Sheets:r}}function a2(n,e,t){var r=t||{},i=n?Array.isArray(n):r.dense,s=n||(i?[]:{}),a=0,o=0;if(s&&r.origin!=null){if(typeof r.origin=="number")a=r.origin;else{var c=typeof r.origin=="string"?Ln(r.origin):r.origin;a=c.r,o=c.c}s["!ref"]||(s["!ref"]="A1:A1")}var l={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(s["!ref"]){var u=Ft(s["!ref"]);l.s.c=u.s.c,l.s.r=u.s.r,l.e.c=Math.max(l.e.c,u.e.c),l.e.r=Math.max(l.e.r,u.e.r),a==-1&&(l.e.r=a=u.e.r+1)}for(var h=0;h!=e.length;++h)if(e[h]){if(!Array.isArray(e[h]))throw new Error("aoa_to_sheet expects an array of arrays");for(var d=0;d!=e[h].length;++d)if(!(typeof e[h][d]>"u")){var p={v:e[h][d]},g=a+h,m=o+d;if(l.s.r>g&&(l.s.r=g),l.s.c>m&&(l.s.c=m),l.e.r<g&&(l.e.r=g),l.e.c<m&&(l.e.c=m),e[h][d]&&typeof e[h][d]=="object"&&!Array.isArray(e[h][d])&&!(e[h][d]instanceof Date))p=e[h][d];else if(Array.isArray(p.v)&&(p.f=e[h][d][1],p.v=p.v[0]),p.v===null)if(p.f)p.t="n";else if(r.nullError)p.t="e",p.v=0;else if(r.sheetStubs)p.t="z";else continue;else typeof p.v=="number"?p.t="n":typeof p.v=="boolean"?p.t="b":p.v instanceof Date?(p.z=r.dateNF||Ne[14],r.cellDates?(p.t="d",p.w=ur(p.z,Bn(p.v))):(p.t="n",p.v=Bn(p.v),p.w=ur(p.z,p.v))):p.t="s";if(i)s[g]||(s[g]=[]),s[g][m]&&s[g][m].z&&(p.z=s[g][m].z),s[g][m]=p;else{var _=Me({c:m,r:g});s[_]&&s[_].z&&(p.z=s[_].z),s[_]=p}}}return l.s.c<1e7&&(s["!ref"]=Je(l)),s}function rc(n,e){return a2(null,n,e)}function $5(n){return n.read_shift(4,"i")}function Sn(n){var e=n.read_shift(4);return e===0?"":n.read_shift(e,"dbcs")}function W5(n){return{ich:n.read_shift(2),ifnt:n.read_shift(2)}}function wm(n,e){var t=n.l,r=n.read_shift(1),i=Sn(n),s=[],a={t:i,h:i};if((r&1)!==0){for(var o=n.read_shift(4),c=0;c!=o;++c)s.push(W5(n));a.r=s}else a.r=[{ich:0,ifnt:0}];return n.l=t+e,a}var j5=wm;function hr(n){var e=n.read_shift(4),t=n.read_shift(2);return t+=n.read_shift(1)<<16,n.l++,{c:e,iStyleRef:t}}function Oa(n){var e=n.read_shift(2);return e+=n.read_shift(1)<<16,n.l++,{c:-1,iStyleRef:e}}var G5=Sn;function Tm(n){var e=n.read_shift(4);return e===0||e===4294967295?"":n.read_shift(e,"dbcs")}var q5=Sn,mp=Tm;function bm(n){var e=n.slice(n.l,n.l+4),t=e[0]&1,r=e[0]&2;n.l+=4;var i=r===0?Tf([0,0,0,0,e[0]&252,e[1],e[2],e[3]],0):ea(e,0)>>2;return t?i/100:i}function o2(n){var e={s:{},e:{}};return e.s.r=n.read_shift(4),e.e.r=n.read_shift(4),e.s.c=n.read_shift(4),e.e.c=n.read_shift(4),e}var Ma=o2;function wn(n){if(n.length-n.l<8)throw"XLS Xnum Buffer underflow";return n.read_shift(8,"f")}function K5(n){var e={},t=n.read_shift(1),r=t>>>1,i=n.read_shift(1),s=n.read_shift(2,"i"),a=n.read_shift(1),o=n.read_shift(1),c=n.read_shift(1);switch(n.l++,r){case 0:e.auto=1;break;case 1:e.index=i;var l=ha[i];l&&(e.rgb=Gl(l));break;case 2:e.rgb=Gl([a,o,c]);break;case 3:e.theme=i;break}return s!=0&&(e.tint=s>0?s/32767:s/32768),e}function Y5(n){var e=n.read_shift(1);n.l++;var t={fBold:e&1,fItalic:e&2,fUnderline:e&4,fStrikeout:e&8,fOutline:e&16,fShadow:e&32,fCondense:e&64,fExtend:e&128};return t}function c2(n,e){var t={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},r=n.read_shift(4);switch(r){case 0:return"";case 4294967295:case 4294967294:return t[n.read_shift(4)]||""}if(r>400)throw new Error("Unsupported Clipboard: "+r.toString(16));return n.l-=4,n.read_shift(0,e==1?"lpstr":"lpwstr")}function X5(n){return c2(n,1)}function Q5(n){return c2(n,2)}var Im=2,zn=3,ah=11,pv=12,bf=19,oh=64,J5=65,Z5=71,eV=4108,tV=4126,rn=80,l2=81,nV=[rn,l2],rV={1:{n:"CodePage",t:Im},2:{n:"Category",t:rn},3:{n:"PresentationFormat",t:rn},4:{n:"ByteCount",t:zn},5:{n:"LineCount",t:zn},6:{n:"ParagraphCount",t:zn},7:{n:"SlideCount",t:zn},8:{n:"NoteCount",t:zn},9:{n:"HiddenCount",t:zn},10:{n:"MultimediaClipCount",t:zn},11:{n:"ScaleCrop",t:ah},12:{n:"HeadingPairs",t:eV},13:{n:"TitlesOfParts",t:tV},14:{n:"Manager",t:rn},15:{n:"Company",t:rn},16:{n:"LinksUpToDate",t:ah},17:{n:"CharacterCount",t:zn},19:{n:"SharedDoc",t:ah},22:{n:"HyperlinksChanged",t:ah},23:{n:"AppVersion",t:zn,p:"version"},24:{n:"DigSig",t:J5},26:{n:"ContentType",t:rn},27:{n:"ContentStatus",t:rn},28:{n:"Language",t:rn},29:{n:"Version",t:rn},255:{},2147483648:{n:"Locale",t:bf},2147483651:{n:"Behavior",t:bf},1919054434:{}},iV={1:{n:"CodePage",t:Im},2:{n:"Title",t:rn},3:{n:"Subject",t:rn},4:{n:"Author",t:rn},5:{n:"Keywords",t:rn},6:{n:"Comments",t:rn},7:{n:"Template",t:rn},8:{n:"LastAuthor",t:rn},9:{n:"RevNumber",t:rn},10:{n:"EditTime",t:oh},11:{n:"LastPrinted",t:oh},12:{n:"CreatedDate",t:oh},13:{n:"ModifiedDate",t:oh},14:{n:"PageCount",t:zn},15:{n:"WordCount",t:zn},16:{n:"CharCount",t:zn},17:{n:"Thumbnail",t:Z5},18:{n:"Application",t:rn},19:{n:"DocSecurity",t:zn},255:{},2147483648:{n:"Locale",t:bf},2147483651:{n:"Behavior",t:bf},1919054434:{}},gv={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},sV=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function aV(n){return n.map(function(e){return[e>>16&255,e>>8&255,e&255]})}var oV=aV([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ha=hn(oV),La={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},u2={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},mv={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function cV(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function lV(n){var e=cV();if(!n||!n.match)return e;var t={};if((n.match(Rn)||[]).forEach(function(r){var i=Pe(r);switch(i[0].replace(_5,"<")){case"<?xml":break;case"<Types":e.xmlns=i["xmlns"+(i[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":t[i.Extension]=i.ContentType;break;case"<Override":e[mv[i.ContentType]]!==void 0&&e[mv[i.ContentType]].push(i.PartName);break}}),e.xmlns!==k5.CT)throw new Error("Unknown Namespace: "+e.xmlns);return e.calcchain=e.calcchains.length>0?e.calcchains[0]:"",e.sst=e.strs.length>0?e.strs[0]:"",e.style=e.styles.length>0?e.styles[0]:"",e.defaults=t,delete e.calcchains,e}var oo={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function _p(n){var e=n.lastIndexOf("/");return n.slice(0,e+1)+"_rels/"+n.slice(e+1)+".rels"}function cl(n,e){var t={"!id":{}};if(!n)return t;e.charAt(0)!=="/"&&(e="/"+e);var r={};return(n.match(Rn)||[]).forEach(function(i){var s=Pe(i);if(s[0]==="<Relationship"){var a={};a.Type=s.Type,a.Target=s.Target,a.Id=s.Id,s.TargetMode&&(a.TargetMode=s.TargetMode);var o=s.TargetMode==="External"?s.Target:zc(s.Target,e);t[o]=a,r[s.Id]=a}}),t["!id"]=r,t}var uV="application/vnd.oasis.opendocument.spreadsheet";function hV(n,e){for(var t=xm(n),r,i;r=Wl.exec(t);)switch(r[3]){case"manifest":break;case"file-entry":if(i=Pe(r[0],!1),i.path=="/"&&i.type!==uV)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(e&&e.WTF)throw r}}var ll=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],fV=(function(){for(var n=new Array(ll.length),e=0;e<ll.length;++e){var t=ll[e],r="(?:"+t[0].slice(0,t[0].indexOf(":"))+":)"+t[0].slice(t[0].indexOf(":")+1);n[e]=new RegExp("<"+r+"[^>]*>([\\s\\S]*?)</"+r+">")}return n})();function h2(n){var e={};n=dt(n);for(var t=0;t<ll.length;++t){var r=ll[t],i=n.match(fV[t]);i!=null&&i.length>0&&(e[r[1]]=Ze(i[1])),r[2]==="date"&&e[r[1]]&&(e[r[1]]=on(e[r[1]]))}return e}var dV=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function f2(n,e,t,r){var i=[];if(typeof n=="string")i=av(n,r);else for(var s=0;s<n.length;++s)i=i.concat(n[s].map(function(u){return{v:u}}));var a=typeof e=="string"?av(e,r).map(function(u){return u.v}):e,o=0,c=0;if(a.length>0)for(var l=0;l!==i.length;l+=2){switch(c=+i[l+1].v,i[l].v){case"Worksheets":case"":case"":case" ":case"":case" ":case"Arbeitsbltter":case"alma Sayfalar":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de clculo":case"Planilhas":case"Regneark":case"Hojas de clculo":case"Werkbladen":t.Worksheets=c,t.SheetNames=a.slice(o,o+c);break;case"Named Ranges":case"Rangos con nombre":case"":case"Benannte Bereiche":case"Navngivne omrder":t.NamedRanges=c,t.DefinedNames=a.slice(o,o+c);break;case"Charts":case"Diagramme":t.Chartsheets=c,t.ChartNames=a.slice(o,o+c);break}o+=c}}function pV(n,e,t){var r={};return e||(e={}),n=dt(n),dV.forEach(function(i){var s=(n.match($l(i[0]))||[])[1];switch(i[2]){case"string":s&&(e[i[1]]=Ze(s));break;case"bool":e[i[1]]=s==="true";break;case"raw":var a=n.match(new RegExp("<"+i[0]+"[^>]*>([\\s\\S]*?)</"+i[0]+">"));a&&a.length>0&&(r[i[1]]=a[1]);break}}),r.HeadingPairs&&r.TitlesOfParts&&f2(r.HeadingPairs,r.TitlesOfParts,e,t),e}var gV=/<[^>]+>[^<]*/g;function mV(n,e){var t={},r="",i=n.match(gV);if(i)for(var s=0;s!=i.length;++s){var a=i[s],o=Pe(a);switch(o[0]){case"<?xml":break;case"<Properties":break;case"<property":r=Ze(o.name);break;case"</property>":r=null;break;default:if(a.indexOf("<vt:")===0){var c=a.split(">"),l=c[0].slice(4),u=c[1];switch(l){case"lpstr":case"bstr":case"lpwstr":t[r]=Ze(u);break;case"bool":t[r]=bt(u);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":t[r]=parseInt(u,10);break;case"r4":case"r8":case"decimal":t[r]=parseFloat(u);break;case"filetime":case"date":t[r]=on(u);break;case"cy":case"error":t[r]=Ze(u);break;default:if(l.slice(-1)=="/")break;e.WTF&&typeof console<"u"&&console.warn("Unexpected",a,l,c)}}else if(a.slice(0,2)!=="</"){if(e.WTF)throw new Error(a)}}}return t}var _V={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},f0;function xV(n,e,t){f0||(f0=gm(_V)),e=f0[e]||e,n[e]=t}function Am(n){var e=n.read_shift(4),t=n.read_shift(4);return new Date((t/1e7*Math.pow(2,32)+e/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function d2(n,e,t){var r=n.l,i=n.read_shift(0,"lpstr-cp");if(t)for(;n.l-r&3;)++n.l;return i}function p2(n,e,t){var r=n.read_shift(0,"lpwstr");return r}function g2(n,e,t){return e===31?p2(n):d2(n,e,t)}function xp(n,e,t){return g2(n,e,t===!1?0:4)}function yV(n,e){if(!e)throw new Error("VtUnalignedString must have positive length");return g2(n,e,0)}function vV(n){for(var e=n.read_shift(4),t=[],r=0;r!=e;++r){var i=n.l;t[r]=n.read_shift(0,"lpwstr").replace(Vn,""),n.l-i&2&&(n.l+=2)}return t}function EV(n){for(var e=n.read_shift(4),t=[],r=0;r!=e;++r)t[r]=n.read_shift(0,"lpstr-cp").replace(Vn,"");return t}function wV(n){var e=n.l,t=If(n,l2);n[n.l]==0&&n[n.l+1]==0&&n.l-e&2&&(n.l+=2);var r=If(n,zn);return[t,r]}function TV(n){for(var e=n.read_shift(4),t=[],r=0;r<e/2;++r)t.push(wV(n));return t}function _v(n,e){for(var t=n.read_shift(4),r={},i=0;i!=t;++i){var s=n.read_shift(4),a=n.read_shift(4);r[s]=n.read_shift(a,e===1200?"utf16le":"utf8").replace(Vn,"").replace(Hc,"!"),e===1200&&a%2&&(n.l+=2)}return n.l&3&&(n.l=n.l>>3<<2),r}function m2(n){var e=n.read_shift(4),t=n.slice(n.l,n.l+e);return n.l+=e,(e&3)>0&&(n.l+=4-(e&3)&3),t}function bV(n){var e={};return e.Size=n.read_shift(4),n.l+=e.Size+3-(e.Size-1)%4,e}function If(n,e,t){var r=n.read_shift(2),i,s=t||{};if(n.l+=2,e!==pv&&r!==e&&nV.indexOf(e)===-1&&!((e&65534)==4126&&(r&65534)==4126))throw new Error("Expected type "+e+" saw "+r);switch(e===pv?r:e){case 2:return i=n.read_shift(2,"i"),s.raw||(n.l+=2),i;case 3:return i=n.read_shift(4,"i"),i;case 11:return n.read_shift(4)!==0;case 19:return i=n.read_shift(4),i;case 30:return d2(n,r,4).replace(Vn,"");case 31:return p2(n);case 64:return Am(n);case 65:return m2(n);case 71:return bV(n);case 80:return xp(n,r,!s.raw).replace(Vn,"");case 81:return yV(n,r).replace(Vn,"");case 4108:return TV(n);case 4126:case 4127:return r==4127?vV(n):EV(n);default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+r)}}function xv(n,e){var t=n.l,r=n.read_shift(4),i=n.read_shift(4),s=[],a=0,o=0,c=-1,l={};for(a=0;a!=i;++a){var u=n.read_shift(4),h=n.read_shift(4);s[a]=[u,h+t]}s.sort(function(I,v){return I[1]-v[1]});var d={};for(a=0;a!=i;++a){if(n.l!==s[a][1]){var p=!0;if(a>0&&e)switch(e[s[a-1][0]].t){case 2:n.l+2===s[a][1]&&(n.l+=2,p=!1);break;case 80:n.l<=s[a][1]&&(n.l=s[a][1],p=!1);break;case 4108:n.l<=s[a][1]&&(n.l=s[a][1],p=!1);break}if((!e||a==0)&&n.l<=s[a][1]&&(p=!1,n.l=s[a][1]),p)throw new Error("Read Error: Expected address "+s[a][1]+" at "+n.l+" :"+a)}if(e){var g=e[s[a][0]];if(d[g.n]=If(n,g.t,{raw:!0}),g.p==="version"&&(d[g.n]=String(d[g.n]>>16)+"."+("0000"+String(d[g.n]&65535)).slice(-4)),g.n=="CodePage")switch(d[g.n]){case 0:d[g.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:Tr(o=d[g.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+d[g.n])}}else if(s[a][0]===1){if(o=d.CodePage=If(n,Im),Tr(o),c!==-1){var m=n.l;n.l=s[c][1],l=_v(n,o),n.l=m}}else if(s[a][0]===0){if(o===0){c=a,n.l=s[a+1][1];continue}l=_v(n,o)}else{var _=l[s[a][0]],E;switch(n[n.l]){case 65:n.l+=4,E=m2(n);break;case 30:n.l+=4,E=xp(n,n[n.l-4]).replace(/\u0000+$/,"");break;case 31:n.l+=4,E=xp(n,n[n.l-4]).replace(/\u0000+$/,"");break;case 3:n.l+=4,E=n.read_shift(4,"i");break;case 19:n.l+=4,E=n.read_shift(4);break;case 5:n.l+=4,E=n.read_shift(8,"f");break;case 11:n.l+=4,E=Ot(n,4);break;case 64:n.l+=4,E=on(Am(n));break;default:throw new Error("unparsed value: "+n[n.l])}d[_]=E}}return n.l=t+r,d}function yv(n,e,t){var r=n.content;if(!r)return{};un(r,0);var i,s,a,o,c=0;r.chk("feff","Byte Order: "),r.read_shift(2);var l=r.read_shift(4),u=r.read_shift(16);if(u!==Qe.utils.consts.HEADER_CLSID&&u!==t)throw new Error("Bad PropertySet CLSID "+u);if(i=r.read_shift(4),i!==1&&i!==2)throw new Error("Unrecognized #Sets: "+i);if(s=r.read_shift(16),o=r.read_shift(4),i===1&&o!==r.l)throw new Error("Length mismatch: "+o+" !== "+r.l);i===2&&(a=r.read_shift(16),c=r.read_shift(4));var h=xv(r,e),d={SystemIdentifier:l};for(var p in h)d[p]=h[p];if(d.FMTID=s,i===1)return d;if(c-r.l==2&&(r.l+=2),r.l!==c)throw new Error("Length mismatch 2: "+r.l+" !== "+c);var g;try{g=xv(r,null)}catch{}for(p in g)d[p]=g[p];return d.FMTID=[s,a],d}function ji(n,e){return n.read_shift(e),null}function IV(n,e,t){for(var r=[],i=n.l+e;n.l<i;)r.push(t(n,i-n.l));if(i!==n.l)throw new Error("Slurp error");return r}function Ot(n,e){return n.read_shift(e)===1}function zt(n){return n.read_shift(2,"u")}function _2(n,e){return IV(n,e,zt)}function AV(n){var e=n.read_shift(1),t=n.read_shift(1);return t===1?e:e===1}function vu(n,e,t){var r=n.read_shift(t&&t.biff>=12?2:1),i="sbcs-cont";if(t&&t.biff>=8,!t||t.biff==8){var s=n.read_shift(1);s&&(i="dbcs-cont")}else t.biff==12&&(i="wstr");t.biff>=2&&t.biff<=5&&(i="cpstr");var a=r?n.read_shift(r,i):"";return a}function SV(n){var e=n.read_shift(2),t=n.read_shift(1),r=t&4,i=t&8,s=1+(t&1),a=0,o,c={};i&&(a=n.read_shift(2)),r&&(o=n.read_shift(4));var l=s==2?"dbcs-cont":"sbcs-cont",u=e===0?"":n.read_shift(e,l);return i&&(n.l+=4*a),r&&(n.l+=o),c.t=u,i||(c.raw="<t>"+c.t+"</t>",c.r=c.t),c}function ka(n,e,t){var r;if(t){if(t.biff>=2&&t.biff<=5)return n.read_shift(e,"cpstr");if(t.biff>=12)return n.read_shift(e,"dbcs-cont")}var i=n.read_shift(1);return i===0?r=n.read_shift(e,"sbcs-cont"):r=n.read_shift(e,"dbcs-cont"),r}function Eu(n,e,t){var r=n.read_shift(t&&t.biff==2?1:2);return r===0?(n.l++,""):ka(n,r,t)}function Na(n,e,t){if(t.biff>5)return Eu(n,e,t);var r=n.read_shift(1);return r===0?(n.l++,""):n.read_shift(r,t.biff<=4||!n.lens?"cpstr":"sbcs-cont")}function kV(n){var e=n.read_shift(1);n.l++;var t=n.read_shift(2);return n.l+=2,[e,t]}function CV(n){var e=n.read_shift(4),t=n.l,r=!1;e>24&&(n.l+=e-24,n.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(r=!0),n.l=t);var i=n.read_shift((r?e-24:e)>>1,"utf16le").replace(Vn,"");return r&&(n.l+=24),i}function RV(n){for(var e=n.read_shift(2),t="";e-- >0;)t+="../";var r=n.read_shift(0,"lpstr-ansi");if(n.l+=2,n.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var i=n.read_shift(4);if(i===0)return t+r.replace(/\\/g,"/");var s=n.read_shift(4);if(n.read_shift(2)!=3)throw new Error("Bad FileMoniker");var a=n.read_shift(s>>1,"utf16le").replace(Vn,"");return t+a}function PV(n,e){var t=n.read_shift(16);switch(t){case"e0c9ea79f9bace118c8200aa004ba90b":return CV(n);case"0303000000000000c000000000000046":return RV(n);default:throw new Error("Unsupported Moniker "+t)}}function ch(n){var e=n.read_shift(4),t=e>0?n.read_shift(e,"utf16le").replace(Vn,""):"";return t}function DV(n,e){var t=n.l+e,r=n.read_shift(4);if(r!==2)throw new Error("Unrecognized streamVersion: "+r);var i=n.read_shift(2);n.l+=2;var s,a,o,c,l="",u,h;i&16&&(s=ch(n,t-n.l)),i&128&&(a=ch(n,t-n.l)),(i&257)===257&&(o=ch(n,t-n.l)),(i&257)===1&&(c=PV(n,t-n.l)),i&8&&(l=ch(n,t-n.l)),i&32&&(u=n.read_shift(16)),i&64&&(h=Am(n)),n.l=t;var d=a||o||c||"";d&&l&&(d+="#"+l),d||(d="#"+l),i&2&&d.charAt(0)=="/"&&d.charAt(1)!="/"&&(d="file://"+d);var p={Target:d};return u&&(p.guid=u),h&&(p.time=h),s&&(p.Tooltip=s),p}function x2(n){var e=n.read_shift(1),t=n.read_shift(1),r=n.read_shift(1),i=n.read_shift(1);return[e,t,r,i]}function y2(n,e){var t=x2(n);return t[3]=0,t}function Jr(n){var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(2);return{r:e,c:t,ixfe:r}}function FV(n){var e=n.read_shift(2),t=n.read_shift(2);return n.l+=8,{type:e,flags:t}}function OV(n,e,t){return e===0?"":Na(n,e,t)}function MV(n,e,t){var r=t.biff>8?4:2,i=n.read_shift(r),s=n.read_shift(r,"i"),a=n.read_shift(r,"i");return[i,s,a]}function v2(n){var e=n.read_shift(2),t=bm(n);return[e,t]}function LV(n,e,t){n.l+=4,e-=4;var r=n.l+e,i=vu(n,e,t),s=n.read_shift(2);if(r-=n.l,s!==r)throw new Error("Malformed AddinUdf: padding = "+r+" != "+s);return n.l+=s,i}function pd(n){var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(2),i=n.read_shift(2);return{s:{c:r,r:e},e:{c:i,r:t}}}function E2(n){var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(1),i=n.read_shift(1);return{s:{c:r,r:e},e:{c:i,r:t}}}var NV=E2;function w2(n){n.l+=4;var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(2);return n.l+=12,[t,e,r]}function VV(n){var e={};return n.l+=4,n.l+=16,e.fSharedNote=n.read_shift(2),n.l+=4,e}function BV(n){var e={};return n.l+=4,n.cf=n.read_shift(2),e}function pn(n){n.l+=2,n.l+=n.read_shift(2)}var UV={0:pn,4:pn,5:pn,6:pn,7:BV,8:pn,9:pn,10:pn,11:pn,12:pn,13:VV,14:pn,15:pn,16:pn,17:pn,18:pn,19:pn,20:pn,21:w2};function HV(n,e){for(var t=n.l+e,r=[];n.l<t;){var i=n.read_shift(2);n.l-=2;try{r.push(UV[i](n,t-n.l))}catch{return n.l=t,r}}return n.l!=t&&(n.l=t),r}function lh(n,e){var t={BIFFVer:0,dt:0};switch(t.BIFFVer=n.read_shift(2),e-=2,e>=2&&(t.dt=n.read_shift(2),n.l-=2),t.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(e>6)throw new Error("Unexpected BIFF Ver "+t.BIFFVer)}return n.read_shift(e),t}function zV(n,e){return e===0||n.read_shift(2),1200}function $V(n,e,t){if(t.enc)return n.l+=e,"";var r=n.l,i=Na(n,0,t);return n.read_shift(e+r-n.l),i}function WV(n,e,t){var r=t&&t.biff==8||e==2?n.read_shift(2):(n.l+=e,0);return{fDialog:r&16,fBelow:r&64,fRight:r&128}}function jV(n,e,t){var r=n.read_shift(4),i=n.read_shift(1)&3,s=n.read_shift(1);switch(s){case 0:s="Worksheet";break;case 1:s="Macrosheet";break;case 2:s="Chartsheet";break;case 6:s="VBAModule";break}var a=vu(n,0,t);return a.length===0&&(a="Sheet1"),{pos:r,hs:i,dt:s,name:a}}function GV(n,e){for(var t=n.l+e,r=n.read_shift(4),i=n.read_shift(4),s=[],a=0;a!=i&&n.l<t;++a)s.push(SV(n));return s.Count=r,s.Unique=i,s}function qV(n,e){var t={};return t.dsst=n.read_shift(2),n.l+=e-2,t}function KV(n){var e={};e.r=n.read_shift(2),e.c=n.read_shift(2),e.cnt=n.read_shift(2)-e.c;var t=n.read_shift(2);n.l+=4;var r=n.read_shift(1);return n.l+=3,r&7&&(e.level=r&7),r&32&&(e.hidden=!0),r&64&&(e.hpt=t/20),e}function YV(n){var e=FV(n);if(e.type!=2211)throw new Error("Invalid Future Record "+e.type);var t=n.read_shift(4);return t!==0}function XV(n){return n.read_shift(2),n.read_shift(4)}function vv(n,e,t){var r=0;t&&t.biff==2||(r=n.read_shift(2));var i=n.read_shift(2);t&&t.biff==2&&(r=1-(i>>15),i&=32767);var s={Unsynced:r&1,DyZero:(r&2)>>1,ExAsc:(r&4)>>2,ExDsc:(r&8)>>3};return[s,i]}function QV(n){var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(2),i=n.read_shift(2),s=n.read_shift(2),a=n.read_shift(2),o=n.read_shift(2),c=n.read_shift(2),l=n.read_shift(2);return{Pos:[e,t],Dim:[r,i],Flags:s,CurTab:a,FirstTab:o,Selected:c,TabRatio:l}}function JV(n,e,t){if(t&&t.biff>=2&&t.biff<5)return{};var r=n.read_shift(2);return{RTL:r&64}}function ZV(){}function eB(n,e,t){var r={dyHeight:n.read_shift(2),fl:n.read_shift(2)};switch(t&&t.biff||8){case 2:break;case 3:case 4:n.l+=2;break;default:n.l+=10;break}return r.name=vu(n,0,t),r}function tB(n){var e=Jr(n);return e.isst=n.read_shift(4),e}function nB(n,e,t){t.biffguess&&t.biff==2&&(t.biff=5);var r=n.l+e,i=Jr(n);t.biff==2&&n.l++;var s=Eu(n,r-n.l,t);return i.val=s,i}function rB(n,e,t){var r=n.read_shift(2),i=Na(n,0,t);return[r,i]}var iB=Na;function Ev(n,e,t){var r=n.l+e,i=t.biff==8||!t.biff?4:2,s=n.read_shift(i),a=n.read_shift(i),o=n.read_shift(2),c=n.read_shift(2);return n.l=r,{s:{r:s,c:o},e:{r:a,c}}}function sB(n){var e=n.read_shift(2),t=n.read_shift(2),r=v2(n);return{r:e,c:t,ixfe:r[0],rknum:r[1]}}function aB(n,e){for(var t=n.l+e-2,r=n.read_shift(2),i=n.read_shift(2),s=[];n.l<t;)s.push(v2(n));if(n.l!==t)throw new Error("MulRK read error");var a=n.read_shift(2);if(s.length!=a-i+1)throw new Error("MulRK length mismatch");return{r,c:i,C:a,rkrec:s}}function oB(n,e){for(var t=n.l+e-2,r=n.read_shift(2),i=n.read_shift(2),s=[];n.l<t;)s.push(n.read_shift(2));if(n.l!==t)throw new Error("MulBlank read error");var a=n.read_shift(2);if(s.length!=a-i+1)throw new Error("MulBlank length mismatch");return{r,c:i,C:a,ixfe:s}}function cB(n,e,t,r){var i={},s=n.read_shift(4),a=n.read_shift(4),o=n.read_shift(4),c=n.read_shift(2);return i.patternType=sV[o>>26],r.cellStyles&&(i.alc=s&7,i.fWrap=s>>3&1,i.alcV=s>>4&7,i.fJustLast=s>>7&1,i.trot=s>>8&255,i.cIndent=s>>16&15,i.fShrinkToFit=s>>20&1,i.iReadOrder=s>>22&2,i.fAtrNum=s>>26&1,i.fAtrFnt=s>>27&1,i.fAtrAlc=s>>28&1,i.fAtrBdr=s>>29&1,i.fAtrPat=s>>30&1,i.fAtrProt=s>>31&1,i.dgLeft=a&15,i.dgRight=a>>4&15,i.dgTop=a>>8&15,i.dgBottom=a>>12&15,i.icvLeft=a>>16&127,i.icvRight=a>>23&127,i.grbitDiag=a>>30&3,i.icvTop=o&127,i.icvBottom=o>>7&127,i.icvDiag=o>>14&127,i.dgDiag=o>>21&15,i.icvFore=c&127,i.icvBack=c>>7&127,i.fsxButton=c>>14&1),i}function lB(n,e,t){var r={};return r.ifnt=n.read_shift(2),r.numFmtId=n.read_shift(2),r.flags=n.read_shift(2),r.fStyle=r.flags>>2&1,e-=6,r.data=cB(n,e,r.fStyle,t),r}function uB(n){n.l+=4;var e=[n.read_shift(2),n.read_shift(2)];if(e[0]!==0&&e[0]--,e[1]!==0&&e[1]--,e[0]>7||e[1]>7)throw new Error("Bad Gutters: "+e.join("|"));return e}function wv(n,e,t){var r=Jr(n);(t.biff==2||e==9)&&++n.l;var i=AV(n);return r.val=i,r.t=i===!0||i===!1?"b":"e",r}function hB(n,e,t){t.biffguess&&t.biff==2&&(t.biff=5);var r=Jr(n),i=wn(n);return r.val=i,r}var Tv=OV;function fB(n,e,t){var r=n.l+e,i=n.read_shift(2),s=n.read_shift(2);if(t.sbcch=s,s==1025||s==14849)return[s,i];if(s<1||s>255)throw new Error("Unexpected SupBook type: "+s);for(var a=ka(n,s),o=[];r>n.l;)o.push(Eu(n));return[s,i,a,o]}function bv(n,e,t){var r=n.read_shift(2),i,s={fBuiltIn:r&1,fWantAdvise:r>>>1&1,fWantPict:r>>>2&1,fOle:r>>>3&1,fOleLink:r>>>4&1,cf:r>>>5&1023,fIcon:r>>>15&1};return t.sbcch===14849&&(i=LV(n,e-2,t)),s.body=i||n.read_shift(e-2),typeof i=="string"&&(s.Name=i),s}var dB=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function Iv(n,e,t){var r=n.l+e,i=n.read_shift(2),s=n.read_shift(1),a=n.read_shift(1),o=n.read_shift(t&&t.biff==2?1:2),c=0;(!t||t.biff>=5)&&(t.biff!=5&&(n.l+=2),c=n.read_shift(2),t.biff==5&&(n.l+=2),n.l+=4);var l=ka(n,a,t);i&32&&(l=dB[l.charCodeAt(0)]);var u=r-n.l;t&&t.biff==2&&--u;var h=r==n.l||o===0||!(u>0)?[]:KU(n,u,t,o);return{chKey:s,Name:l,itab:c,rgce:h}}function T2(n,e,t){if(t.biff<8)return pB(n,e,t);for(var r=[],i=n.l+e,s=n.read_shift(t.biff>8?4:2);s--!==0;)r.push(MV(n,t.biff>8?12:6,t));if(n.l!=i)throw new Error("Bad ExternSheet: "+n.l+" != "+i);return r}function pB(n,e,t){n[n.l+1]==3&&n[n.l]++;var r=vu(n,e,t);return r.charCodeAt(0)==3?r.slice(1):r}function gB(n,e,t){if(t.biff<8){n.l+=e;return}var r=n.read_shift(2),i=n.read_shift(2),s=ka(n,r,t),a=ka(n,i,t);return[s,a]}function mB(n,e,t){var r=E2(n);n.l++;var i=n.read_shift(1);return e-=8,[YU(n,e,t),i,r]}function Av(n,e,t){var r=NV(n);switch(t.biff){case 2:n.l++,e-=7;break;case 3:case 4:n.l+=2,e-=8;break;default:n.l+=6,e-=12}return[r,GU(n,e,t)]}function _B(n){var e=n.read_shift(4)!==0,t=n.read_shift(4)!==0,r=n.read_shift(4);return[e,t,r]}function xB(n,e,t){if(!(t.biff<8)){var r=n.read_shift(2),i=n.read_shift(2),s=n.read_shift(2),a=n.read_shift(2),o=Na(n,0,t);return t.biff<8&&n.read_shift(1),[{r,c:i},o,a,s]}}function yB(n,e,t){return xB(n,e,t)}function vB(n,e){for(var t=[],r=n.read_shift(2);r--;)t.push(pd(n));return t}function EB(n,e,t){if(t&&t.biff<8)return TB(n,e,t);var r=w2(n),i=HV(n,e-22,r[1]);return{cmo:r,ft:i}}var wB={8:function(n,e){var t=n.l+e;n.l+=10;var r=n.read_shift(2);n.l+=4,n.l+=2,n.l+=2,n.l+=2,n.l+=4;var i=n.read_shift(1);return n.l+=i,n.l=t,{fmt:r}}};function TB(n,e,t){n.l+=4;var r=n.read_shift(2),i=n.read_shift(2),s=n.read_shift(2);n.l+=2,n.l+=2,n.l+=2,n.l+=2,n.l+=2,n.l+=2,n.l+=2,n.l+=2,n.l+=2,n.l+=6,e-=36;var a=[];return a.push((wB[r]||Cn)(n,e,t)),{cmo:[i,r,s],ft:a}}function bB(n,e,t){var r=n.l,i="";try{n.l+=4;var s=(t.lastobj||{cmo:[0,0]}).cmo[1],a;[0,5,7,11,12,14].indexOf(s)==-1?n.l+=6:a=kV(n,6,t);var o=n.read_shift(2);n.read_shift(2),zt(n,2);var c=n.read_shift(2);n.l+=c;for(var l=1;l<n.lens.length-1;++l){if(n.l-r!=n.lens[l])throw new Error("TxO: bad continue record");var u=n[n.l],h=ka(n,n.lens[l+1]-n.lens[l]-1);if(i+=h,i.length>=(u?o:2*o))break}if(i.length!==o&&i.length!==o*2)throw new Error("cchText: "+o+" != "+i.length);return n.l=r+e,{t:i}}catch{return n.l=r+e,{t:i}}}function IB(n,e){var t=pd(n);n.l+=16;var r=DV(n,e-24);return[t,r]}function AB(n,e){n.read_shift(2);var t=pd(n),r=n.read_shift((e-10)/2,"dbcs-cont");return r=r.replace(Vn,""),[t,r]}function SB(n){var e=[0,0],t;return t=n.read_shift(2),e[0]=gv[t]||t,t=n.read_shift(2),e[1]=gv[t]||t,e}function kB(n){for(var e=n.read_shift(2),t=[];e-- >0;)t.push(y2(n));return t}function CB(n){for(var e=n.read_shift(2),t=[];e-- >0;)t.push(y2(n));return t}function RB(n){n.l+=2;var e={cxfs:0,crc:0};return e.cxfs=n.read_shift(2),e.crc=n.read_shift(4),e}function b2(n,e,t){if(!t.cellStyles)return Cn(n,e);var r=t&&t.biff>=12?4:2,i=n.read_shift(r),s=n.read_shift(r),a=n.read_shift(r),o=n.read_shift(r),c=n.read_shift(2);r==2&&(n.l+=2);var l={s:i,e:s,w:a,ixfe:o,flags:c};return(t.biff>=5||!t.biff)&&(l.level=c>>8&7),l}function PB(n,e){var t={};return e<32||(n.l+=16,t.header=wn(n),t.footer=wn(n),n.l+=2),t}function DB(n,e,t){var r={area:!1};if(t.biff!=5)return n.l+=e,r;var i=n.read_shift(1);return n.l+=3,i&16&&(r.area=!0),r}var FB=Jr,OB=_2,MB=Eu;function LB(n){var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(4),i={fmt:e,env:t,len:r,data:n.slice(n.l,n.l+r)};return n.l+=r,i}function NB(n,e,t){t.biffguess&&t.biff==5&&(t.biff=2);var r=Jr(n);++n.l;var i=Na(n,e-7,t);return r.t="str",r.val=i,r}function VB(n){var e=Jr(n);++n.l;var t=wn(n);return e.t="n",e.val=t,e}function BB(n){var e=Jr(n);++n.l;var t=n.read_shift(2);return e.t="n",e.val=t,e}function UB(n){var e=n.read_shift(1);return e===0?(n.l++,""):n.read_shift(e,"sbcs-cont")}function HB(n,e){n.l+=6,n.l+=2,n.l+=1,n.l+=3,n.l+=1,n.l+=e-13}function zB(n,e,t){var r=n.l+e,i=Jr(n),s=n.read_shift(2),a=ka(n,s,t);return n.l=r,i.t="str",i.val=a,i}var $B=[2,3,48,49,131,139,140,245],Sv=(function(){var n={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},e=gm({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function t(o,c){var l=[],u=vs(1);switch(c.type){case"base64":u=vr(nr(o));break;case"binary":u=vr(o);break;case"buffer":case"array":u=o;break}un(u,0);var h=u.read_shift(1),d=!!(h&136),p=!1,g=!1;switch(h){case 2:break;case 3:break;case 48:p=!0,d=!0;break;case 49:p=!0,d=!0;break;case 131:break;case 139:break;case 140:g=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+h.toString(16))}var m=0,_=521;h==2&&(m=u.read_shift(2)),u.l+=3,h!=2&&(m=u.read_shift(4)),m>1048576&&(m=1e6),h!=2&&(_=u.read_shift(2));var E=u.read_shift(2),I=c.codepage||1252;h!=2&&(u.l+=16,u.read_shift(1),u[u.l]!==0&&(I=n[u[u.l]]),u.l+=1,u.l+=2),g&&(u.l+=36);for(var v=[],R={},F=Math.min(u.length,h==2?521:_-10-(p?264:0)),O=g?32:11;u.l<F&&u[u.l]!=13;)switch(R={},R.name=Hl.utils.decode(I,u.slice(u.l,u.l+O)).replace(/[\u0000\r\n].*$/g,""),u.l+=O,R.type=String.fromCharCode(u.read_shift(1)),h!=2&&!g&&(R.offset=u.read_shift(4)),R.len=u.read_shift(1),h==2&&(R.offset=u.read_shift(2)),R.dec=u.read_shift(1),R.name.length&&v.push(R),h!=2&&(u.l+=g?13:14),R.type){case"B":(!p||R.len!=8)&&c.WTF&&console.log("Skipping "+R.name+":"+R.type);break;case"G":case"P":c.WTF&&console.log("Skipping "+R.name+":"+R.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+R.type)}if(u[u.l]!==13&&(u.l=_-1),u.read_shift(1)!==13)throw new Error("DBF Terminator not found "+u.l+" "+u[u.l]);u.l=_;var y=0,w=0;for(l[0]=[],w=0;w!=v.length;++w)l[0][w]=v[w].name;for(;m-- >0;){if(u[u.l]===42){u.l+=E;continue}for(++u.l,l[++y]=[],w=0,w=0;w!=v.length;++w){var T=u.slice(u.l,u.l+v[w].len);u.l+=v[w].len,un(T,0);var S=Hl.utils.decode(I,T);switch(v[w].type){case"C":S.trim().length&&(l[y][w]=S.replace(/\s+$/,""));break;case"D":S.length===8?l[y][w]=new Date(+S.slice(0,4),+S.slice(4,6)-1,+S.slice(6,8)):l[y][w]=S;break;case"F":l[y][w]=parseFloat(S.trim());break;case"+":case"I":l[y][w]=g?T.read_shift(-4,"i")^2147483648:T.read_shift(4,"i");break;case"L":switch(S.trim().toUpperCase()){case"Y":case"T":l[y][w]=!0;break;case"N":case"F":l[y][w]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+S+"|")}break;case"M":if(!d)throw new Error("DBF Unexpected MEMO for type "+h.toString(16));l[y][w]="##MEMO##"+(g?parseInt(S.trim(),10):T.read_shift(4));break;case"N":S=S.replace(/\u0000/g,"").trim(),S&&S!="."&&(l[y][w]=+S||0);break;case"@":l[y][w]=new Date(T.read_shift(-8,"f")-621356832e5);break;case"T":l[y][w]=new Date((T.read_shift(4)-2440588)*864e5+T.read_shift(4));break;case"Y":l[y][w]=T.read_shift(4,"i")/1e4+T.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":l[y][w]=-T.read_shift(-8,"f");break;case"B":if(p&&v[w].len==8){l[y][w]=T.read_shift(8,"f");break}case"G":case"P":T.l+=v[w].len;break;case"0":if(v[w].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+v[w].type)}}}if(h!=2&&u.l<u.length&&u[u.l++]!=26)throw new Error("DBF EOF Marker missing "+(u.l-1)+" of "+u.length+" "+u[u.l-1].toString(16));return c&&c.sheetRows&&(l=l.slice(0,c.sheetRows)),c.DBF=v,l}function r(o,c){var l=c||{};l.dateNF||(l.dateNF="yyyymmdd");var u=rc(t(o,l),l);return u["!cols"]=l.DBF.map(function(h){return{wch:h.len,DBF:h}}),delete l.DBF,u}function i(o,c){try{return Rs(r(o,c),c)}catch(l){if(c&&c.WTF)throw l}return{SheetNames:[],Sheets:{}}}var s={B:8,C:250,L:1,D:8,"?":0,"":0};function a(o,c){var l=c||{};if(+l.codepage>=0&&Tr(+l.codepage),l.type=="string")throw new Error("Cannot write DBF to JS string");var u=gp(),h=Ip(o,{header:1,raw:!0,cellDates:!0}),d=h[0],p=h.slice(1),g=o["!cols"]||[],m=0,_=0,E=0,I=1;for(m=0;m<d.length;++m){if(((g[m]||{}).DBF||{}).name){d[m]=g[m].DBF.name,++E;continue}if(d[m]!=null){if(++E,typeof d[m]=="number"&&(d[m]=d[m].toString(10)),typeof d[m]!="string")throw new Error("DBF Invalid column name "+d[m]+" |"+typeof d[m]+"|");if(d.indexOf(d[m])!==m){for(_=0;_<1024;++_)if(d.indexOf(d[m]+"_"+_)==-1){d[m]+="_"+_;break}}}}var v=Ft(o["!ref"]),R=[],F=[],O=[];for(m=0;m<=v.e.c-v.s.c;++m){var y="",w="",T=0,S=[];for(_=0;_<p.length;++_)p[_][m]!=null&&S.push(p[_][m]);if(S.length==0||d[m]==null){R[m]="?";continue}for(_=0;_<S.length;++_){switch(typeof S[_]){case"number":w="B";break;case"string":w="C";break;case"boolean":w="L";break;case"object":w=S[_]instanceof Date?"D":"C";break;default:w="C"}T=Math.max(T,String(S[_]).length),y=y&&y!=w?"C":w}T>250&&(T=250),w=((g[m]||{}).DBF||{}).type,w=="C"&&g[m].DBF.len>T&&(T=g[m].DBF.len),y=="B"&&w=="N"&&(y="N",O[m]=g[m].DBF.dec,T=g[m].DBF.len),F[m]=y=="C"||w=="N"?T:s[y]||0,I+=F[m],R[m]=y}var A=u.next(32);for(A.write_shift(4,318902576),A.write_shift(4,p.length),A.write_shift(2,296+32*E),A.write_shift(2,I),m=0;m<4;++m)A.write_shift(4,0);for(A.write_shift(4,0|(+e[TI]||3)<<8),m=0,_=0;m<d.length;++m)if(d[m]!=null){var k=u.next(32),D=(d[m].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);k.write_shift(1,D,"sbcs"),k.write_shift(1,R[m]=="?"?"C":R[m],"sbcs"),k.write_shift(4,_),k.write_shift(1,F[m]||s[R[m]]||0),k.write_shift(1,O[m]||0),k.write_shift(1,2),k.write_shift(4,0),k.write_shift(1,0),k.write_shift(4,0),k.write_shift(4,0),_+=F[m]||s[R[m]]||0}var oe=u.next(264);for(oe.write_shift(4,13),m=0;m<65;++m)oe.write_shift(4,0);for(m=0;m<p.length;++m){var ie=u.next(I);for(ie.write_shift(1,0),_=0;_<d.length;++_)if(d[_]!=null)switch(R[_]){case"L":ie.write_shift(1,p[m][_]==null?63:p[m][_]?84:70);break;case"B":ie.write_shift(8,p[m][_]||0,"f");break;case"N":var ue="0";for(typeof p[m][_]=="number"&&(ue=p[m][_].toFixed(O[_]||0)),E=0;E<F[_]-ue.length;++E)ie.write_shift(1,32);ie.write_shift(1,ue,"sbcs");break;case"D":p[m][_]?(ie.write_shift(4,("0000"+p[m][_].getFullYear()).slice(-4),"sbcs"),ie.write_shift(2,("00"+(p[m][_].getMonth()+1)).slice(-2),"sbcs"),ie.write_shift(2,("00"+p[m][_].getDate()).slice(-2),"sbcs")):ie.write_shift(8,"00000000","sbcs");break;case"C":var he=String(p[m][_]!=null?p[m][_]:"").slice(0,F[_]);for(ie.write_shift(1,he,"sbcs"),E=0;E<F[_]-he.length;++E)ie.write_shift(1,32);break}}return u.next(1).write_shift(1,26),u.end()}return{to_workbook:i,to_sheet:r,from_sheet:a}})(),WB=(function(){var n={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},e=new RegExp("\x1BN("+Kr(n).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),t=function(d,p){var g=n[p];return typeof g=="number"?$y(g):g},r=function(d,p,g){var m=p.charCodeAt(0)-32<<4|g.charCodeAt(0)-48;return m==59?d:$y(m)};n["|"]=254;function i(d,p){switch(p.type){case"base64":return s(nr(d),p);case"binary":return s(d,p);case"buffer":return s(Ke&&Buffer.isBuffer(d)?d.toString("binary"):Fa(d),p);case"array":return s(Sa(d),p)}throw new Error("Unrecognized type "+p.type)}function s(d,p){var g=d.split(/[\n\r]+/),m=-1,_=-1,E=0,I=0,v=[],R=[],F=null,O={},y=[],w=[],T=[],S=0,A;for(+p.codepage>=0&&Tr(+p.codepage);E!==g.length;++E){S=0;var k=g[E].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(e,t),D=k.replace(/;;/g,"\0").split(";").map(function(j){return j.replace(/\u0000/g,";")}),oe=D[0],ie;if(k.length>0)switch(oe){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":D[1].charAt(0)=="P"&&R.push(k.slice(3).replace(/;;/g,";"));break;case"C":var ue=!1,he=!1,Oe=!1,K=!1,Se=-1,Ce=-1;for(I=1;I<D.length;++I)switch(D[I].charAt(0)){case"A":break;case"X":_=parseInt(D[I].slice(1))-1,he=!0;break;case"Y":for(m=parseInt(D[I].slice(1))-1,he||(_=0),A=v.length;A<=m;++A)v[A]=[];break;case"K":ie=D[I].slice(1),ie.charAt(0)==='"'?ie=ie.slice(1,ie.length-1):ie==="TRUE"?ie=!0:ie==="FALSE"?ie=!1:isNaN(Ar(ie))?isNaN($o(ie).getDate())||(ie=on(ie)):(ie=Ar(ie),F!==null&&tc(F)&&(ie=dd(ie))),ue=!0;break;case"E":K=!0;var z=mo(D[I].slice(1),{r:m,c:_});v[m][_]=[v[m][_],z];break;case"S":Oe=!0,v[m][_]=[v[m][_],"S5S"];break;case"G":break;case"R":Se=parseInt(D[I].slice(1))-1;break;case"C":Ce=parseInt(D[I].slice(1))-1;break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+k)}if(ue&&(v[m][_]&&v[m][_].length==2?v[m][_][0]=ie:v[m][_]=ie,F=null),Oe){if(K)throw new Error("SYLK shared formula cannot have own formula");var Q=Se>-1&&v[Se][Ce];if(!Q||!Q[1])throw new Error("SYLK shared formula cannot find base");v[m][_][1]=O2(Q[1],{r:m-Se,c:_-Ce})}break;case"F":var G=0;for(I=1;I<D.length;++I)switch(D[I].charAt(0)){case"X":_=parseInt(D[I].slice(1))-1,++G;break;case"Y":for(m=parseInt(D[I].slice(1))-1,A=v.length;A<=m;++A)v[A]=[];break;case"M":S=parseInt(D[I].slice(1))/20;break;case"F":break;case"G":break;case"P":F=R[parseInt(D[I].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(T=D[I].slice(1).split(" "),A=parseInt(T[0],10);A<=parseInt(T[1],10);++A)S=parseInt(T[2],10),w[A-1]=S===0?{hidden:!0}:{wch:S},Wo(w[A-1]);break;case"C":_=parseInt(D[I].slice(1))-1,w[_]||(w[_]={});break;case"R":m=parseInt(D[I].slice(1))-1,y[m]||(y[m]={}),S>0?(y[m].hpt=S,y[m].hpx=ql(S)):S===0&&(y[m].hidden=!0);break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+k)}G<1&&(F=null);break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+k)}}return y.length>0&&(O["!rows"]=y),w.length>0&&(O["!cols"]=w),p&&p.sheetRows&&(v=v.slice(0,p.sheetRows)),[v,O]}function a(d,p){var g=i(d,p),m=g[0],_=g[1],E=rc(m,p);return Kr(_).forEach(function(I){E[I]=_[I]}),E}function o(d,p){return Rs(a(d,p),p)}function c(d,p,g,m){var _="C;Y"+(g+1)+";X"+(m+1)+";K";switch(d.t){case"n":_+=d.v||0,d.f&&!d.F&&(_+=";E"+R9(d.f,{r:g,c:m}));break;case"b":_+=d.v?"TRUE":"FALSE";break;case"e":_+=d.w||d.v;break;case"d":_+='"'+(d.w||d.v)+'"';break;case"s":_+='"'+d.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return _}function l(d,p){p.forEach(function(g,m){var _="F;W"+(m+1)+" "+(m+1)+" ";g.hidden?_+="0":(typeof g.width=="number"&&!g.wpx&&(g.wpx=Sf(g.width)),typeof g.wpx=="number"&&!g.wch&&(g.wch=kf(g.wpx)),typeof g.wch=="number"&&(_+=Math.round(g.wch))),_.charAt(_.length-1)!=" "&&d.push(_)})}function u(d,p){p.forEach(function(g,m){var _="F;";g.hidden?_+="M0;":g.hpt?_+="M"+20*g.hpt+";":g.hpx&&(_+="M"+20*P2(g.hpx)+";"),_.length>2&&d.push(_+"R"+(m+1))})}function h(d,p){var g=["ID;PWXL;N;E"],m=[],_=Ft(d["!ref"]),E,I=Array.isArray(d),v=`\r
`;g.push("P;PGeneral"),g.push("F;P0;DG0G8;M255"),d["!cols"]&&l(g,d["!cols"]),d["!rows"]&&u(g,d["!rows"]),g.push("B;Y"+(_.e.r-_.s.r+1)+";X"+(_.e.c-_.s.c+1)+";D"+[_.s.c,_.s.r,_.e.c,_.e.r].join(" "));for(var R=_.s.r;R<=_.e.r;++R)for(var F=_.s.c;F<=_.e.c;++F){var O=Me({r:R,c:F});E=I?(d[R]||[])[F]:d[O],!(!E||E.v==null&&(!E.f||E.F))&&m.push(c(E,d,R,F))}return g.join(v)+v+m.join(v)+v+"E"+v}return{to_workbook:o,to_sheet:a,from_sheet:h}})(),jB=(function(){function n(s,a){switch(a.type){case"base64":return e(nr(s),a);case"binary":return e(s,a);case"buffer":return e(Ke&&Buffer.isBuffer(s)?s.toString("binary"):Fa(s),a);case"array":return e(Sa(s),a)}throw new Error("Unrecognized type "+a.type)}function e(s,a){for(var o=s.split(`
`),c=-1,l=-1,u=0,h=[];u!==o.length;++u){if(o[u].trim()==="BOT"){h[++c]=[],l=0;continue}if(!(c<0)){var d=o[u].trim().split(","),p=d[0],g=d[1];++u;for(var m=o[u]||"";(m.match(/["]/g)||[]).length&1&&u<o.length-1;)m+=`
`+o[++u];switch(m=m.trim(),+p){case-1:if(m==="BOT"){h[++c]=[],l=0;continue}else if(m!=="EOD")throw new Error("Unrecognized DIF special command "+m);break;case 0:m==="TRUE"?h[c][l]=!0:m==="FALSE"?h[c][l]=!1:isNaN(Ar(g))?isNaN($o(g).getDate())?h[c][l]=g:h[c][l]=on(g):h[c][l]=Ar(g),++l;break;case 1:m=m.slice(1,m.length-1),m=m.replace(/""/g,'"'),m&&m.match(/^=".*"$/)&&(m=m.slice(2,-1)),h[c][l++]=m!==""?m:null;break}if(m==="EOD")break}}return a&&a.sheetRows&&(h=h.slice(0,a.sheetRows)),h}function t(s,a){return rc(n(s,a),a)}function r(s,a){return Rs(t(s,a),a)}var i=(function(){var s=function(c,l,u,h,d){c.push(l),c.push(u+","+h),c.push('"'+d.replace(/"/g,'""')+'"')},a=function(c,l,u,h){c.push(l+","+u),c.push(l==1?'"'+h.replace(/"/g,'""')+'"':h)};return function(c){var l=[],u=Ft(c["!ref"]),h,d=Array.isArray(c);s(l,"TABLE",0,1,"sheetjs"),s(l,"VECTORS",0,u.e.r-u.s.r+1,""),s(l,"TUPLES",0,u.e.c-u.s.c+1,""),s(l,"DATA",0,0,"");for(var p=u.s.r;p<=u.e.r;++p){a(l,-1,0,"BOT");for(var g=u.s.c;g<=u.e.c;++g){var m=Me({r:p,c:g});if(h=d?(c[p]||[])[g]:c[m],!h){a(l,1,0,"");continue}switch(h.t){case"n":var _=h.w;!_&&h.v!=null&&(_=h.v),_==null?h.f&&!h.F?a(l,1,0,"="+h.f):a(l,1,0,""):a(l,0,_,"V");break;case"b":a(l,0,h.v?1:0,h.v?"TRUE":"FALSE");break;case"s":a(l,1,0,isNaN(h.v)?h.v:'="'+h.v+'"');break;case"d":h.w||(h.w=ur(h.z||Ne[14],Bn(on(h.v)))),a(l,0,h.w,"V");break;default:a(l,1,0,"")}}}a(l,-1,0,"EOD");var E=`\r
`,I=l.join(E);return I}})();return{to_workbook:r,to_sheet:t,from_sheet:i}})(),GB=(function(){function n(h){return h.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function e(h){return h.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function t(h,d){for(var p=h.split(`
`),g=-1,m=-1,_=0,E=[];_!==p.length;++_){var I=p[_].trim().split(":");if(I[0]==="cell"){var v=Ln(I[1]);if(E.length<=v.r)for(g=E.length;g<=v.r;++g)E[g]||(E[g]=[]);switch(g=v.r,m=v.c,I[2]){case"t":E[g][m]=n(I[3]);break;case"v":E[g][m]=+I[3];break;case"vtf":var R=I[I.length-1];case"vtc":I[3]==="nl"?E[g][m]=!!+I[4]:E[g][m]=+I[4],I[2]=="vtf"&&(E[g][m]=[E[g][m],R])}}}return d&&d.sheetRows&&(E=E.slice(0,d.sheetRows)),E}function r(h,d){return rc(t(h,d),d)}function i(h,d){return Rs(r(h,d),d)}var s=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),a=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,o=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),c="--SocialCalcSpreadsheetControlSave--";function l(h){if(!h||!h["!ref"])return"";for(var d=[],p=[],g,m="",_=nc(h["!ref"]),E=Array.isArray(h),I=_.s.r;I<=_.e.r;++I)for(var v=_.s.c;v<=_.e.c;++v)if(m=Me({r:I,c:v}),g=E?(h[I]||[])[v]:h[m],!(!g||g.v==null||g.t==="z")){switch(p=["cell",m,"t"],g.t){case"s":case"str":p.push(e(g.v));break;case"n":g.f?(p[2]="vtf",p[3]="n",p[4]=g.v,p[5]=e(g.f)):(p[2]="v",p[3]=g.v);break;case"b":p[2]="vt"+(g.f?"f":"c"),p[3]="nl",p[4]=g.v?"1":"0",p[5]=e(g.f||(g.v?"TRUE":"FALSE"));break;case"d":var R=Bn(on(g.v));p[2]="vtc",p[3]="nd",p[4]=""+R,p[5]=g.w||ur(g.z||Ne[14],R);break;case"e":continue}d.push(p.join(":"))}return d.push("sheet:c:"+(_.e.c-_.s.c+1)+":r:"+(_.e.r-_.s.r+1)+":tvf:1"),d.push("valueformat:1:text-wiki"),d.join(`
`)}function u(h){return[s,a,o,a,l(h),c].join(`
`)}return{to_workbook:i,to_sheet:r,from_sheet:u}})(),jl=(function(){function n(u,h,d,p,g){g.raw?h[d][p]=u:u===""||(u==="TRUE"?h[d][p]=!0:u==="FALSE"?h[d][p]=!1:isNaN(Ar(u))?isNaN($o(u).getDate())?h[d][p]=u:h[d][p]=on(u):h[d][p]=Ar(u))}function e(u,h){var d=h||{},p=[];if(!u||u.length===0)return p;for(var g=u.split(/[\r\n]/),m=g.length-1;m>=0&&g[m].length===0;)--m;for(var _=10,E=0,I=0;I<=m;++I)E=g[I].indexOf(" "),E==-1?E=g[I].length:E++,_=Math.max(_,E);for(I=0;I<=m;++I){p[I]=[];var v=0;for(n(g[I].slice(0,_).trim(),p,I,v,d),v=1;v<=(g[I].length-_)/10+1;++v)n(g[I].slice(_+(v-1)*10,_+v*10).trim(),p,I,v,d)}return d.sheetRows&&(p=p.slice(0,d.sheetRows)),p}var t={44:",",9:"	",59:";",124:"|"},r={44:3,9:2,59:1,124:0};function i(u){for(var h={},d=!1,p=0,g=0;p<u.length;++p)(g=u.charCodeAt(p))==34?d=!d:!d&&g in t&&(h[g]=(h[g]||0)+1);g=[];for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&g.push([h[p],p]);if(!g.length){h=r;for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&g.push([h[p],p])}return g.sort(function(m,_){return m[0]-_[0]||r[m[1]]-r[_[1]]}),t[g.pop()[1]]||44}function s(u,h){var d=h||{},p="",g=d.dense?[]:{},m={s:{c:0,r:0},e:{c:0,r:0}};u.slice(0,4)=="sep="?u.charCodeAt(5)==13&&u.charCodeAt(6)==10?(p=u.charAt(4),u=u.slice(7)):u.charCodeAt(5)==13||u.charCodeAt(5)==10?(p=u.charAt(4),u=u.slice(6)):p=i(u.slice(0,1024)):d&&d.FS?p=d.FS:p=i(u.slice(0,1024));var _=0,E=0,I=0,v=0,R=0,F=p.charCodeAt(0),O=!1,y=0,w=u.charCodeAt(0);u=u.replace(/\r\n/mg,`
`);var T=d.dateNF!=null?r5(d.dateNF):null;function S(){var A=u.slice(v,R),k={};if(A.charAt(0)=='"'&&A.charAt(A.length-1)=='"'&&(A=A.slice(1,-1).replace(/""/g,'"')),A.length===0)k.t="z";else if(d.raw)k.t="s",k.v=A;else if(A.trim().length===0)k.t="s",k.v=A;else if(A.charCodeAt(0)==61)A.charCodeAt(1)==34&&A.charCodeAt(A.length-1)==34?(k.t="s",k.v=A.slice(2,-1).replace(/""/g,'"')):D9(A)?(k.t="n",k.f=A.slice(1)):(k.t="s",k.v=A);else if(A=="TRUE")k.t="b",k.v=!0;else if(A=="FALSE")k.t="b",k.v=!1;else if(!isNaN(I=Ar(A)))k.t="n",d.cellText!==!1&&(k.w=A),k.v=I;else if(!isNaN($o(A).getDate())||T&&A.match(T)){k.z=d.dateNF||Ne[14];var D=0;T&&A.match(T)&&(A=i5(A,d.dateNF,A.match(T)||[]),D=1),d.cellDates?(k.t="d",k.v=on(A,D)):(k.t="n",k.v=Bn(on(A,D))),d.cellText!==!1&&(k.w=ur(k.z,k.v instanceof Date?Bn(k.v):k.v)),d.cellNF||delete k.z}else k.t="s",k.v=A;if(k.t=="z"||(d.dense?(g[_]||(g[_]=[]),g[_][E]=k):g[Me({c:E,r:_})]=k),v=R+1,w=u.charCodeAt(v),m.e.c<E&&(m.e.c=E),m.e.r<_&&(m.e.r=_),y==F)++E;else if(E=0,++_,d.sheetRows&&d.sheetRows<=_)return!0}e:for(;R<u.length;++R)switch(y=u.charCodeAt(R)){case 34:w===34&&(O=!O);break;case F:case 10:case 13:if(!O&&S())break e;break}return R-v>0&&S(),g["!ref"]=Je(m),g}function a(u,h){return!(h&&h.PRN)||h.FS||u.slice(0,4)=="sep="||u.indexOf("	")>=0||u.indexOf(",")>=0||u.indexOf(";")>=0?s(u,h):rc(e(u,h),h)}function o(u,h){var d="",p=h.type=="string"?[0,0,0,0]:Om(u,h);switch(h.type){case"base64":d=nr(u);break;case"binary":d=u;break;case"buffer":h.codepage==65001?d=u.toString("utf8"):h.codepage&&typeof Hl<"u"||(d=Ke&&Buffer.isBuffer(u)?u.toString("binary"):Fa(u));break;case"array":d=Sa(u);break;case"string":d=u;break;default:throw new Error("Unrecognized type "+h.type)}return p[0]==239&&p[1]==187&&p[2]==191?d=dt(d.slice(3)):h.type!="string"&&h.type!="buffer"&&h.codepage==65001?d=dt(d):h.type=="binary"&&typeof Hl<"u",d.slice(0,19)=="socialcalc:version:"?GB.to_sheet(h.type=="string"?d:dt(d),h):a(d,h)}function c(u,h){return Rs(o(u,h),h)}function l(u){for(var h=[],d=Ft(u["!ref"]),p,g=Array.isArray(u),m=d.s.r;m<=d.e.r;++m){for(var _=[],E=d.s.c;E<=d.e.c;++E){var I=Me({r:m,c:E});if(p=g?(u[m]||[])[E]:u[I],!p||p.v==null){_.push("          ");continue}for(var v=(p.w||(bi(p),p.w)||"").slice(0,10);v.length<10;)v+=" ";_.push(v+(E===0?" ":""))}h.push(_.join(""))}return h.join(`
`)}return{to_workbook:c,to_sheet:o,from_sheet:l}})();function qB(n,e){var t=e||{},r=!!t.WTF;t.WTF=!0;try{var i=WB.to_workbook(n,t);return t.WTF=r,i}catch(s){if(t.WTF=r,!s.message.match(/SYLK bad record ID/)&&r)throw s;return jl.to_workbook(n,e)}}var ul=(function(){function n(z,Q,G){if(z){un(z,z.l||0);for(var j=G.Enum||Se;z.l<z.length;){var se=z.read_shift(2),ge=j[se]||j[65535],we=z.read_shift(2),me=z.l+we,fe=ge.f&&ge.f(z,we,G);if(z.l=me,Q(fe,ge,se))return}}}function e(z,Q){switch(Q.type){case"base64":return t(vr(nr(z)),Q);case"binary":return t(vr(z),Q);case"buffer":case"array":return t(z,Q)}throw"Unsupported type "+Q.type}function t(z,Q){if(!z)return z;var G=Q||{},j=G.dense?[]:{},se="Sheet1",ge="",we=0,me={},fe=[],Ge=[],W={s:{r:0,c:0},e:{r:0,c:0}},mt=G.sheetRows||0;if(z[2]==0&&(z[3]==8||z[3]==9)&&z.length>=16&&z[14]==5&&z[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(z[2]==2)G.Enum=Se,n(z,function(xe,Et,rt){switch(rt){case 0:G.vers=xe,xe>=4096&&(G.qpro=!0);break;case 6:W=xe;break;case 204:xe&&(ge=xe);break;case 222:ge=xe;break;case 15:case 51:G.qpro||(xe[1].v=xe[1].v.slice(1));case 13:case 14:case 16:rt==14&&(xe[2]&112)==112&&(xe[2]&15)>1&&(xe[2]&15)<15&&(xe[1].z=G.dateNF||Ne[14],G.cellDates&&(xe[1].t="d",xe[1].v=dd(xe[1].v))),G.qpro&&xe[3]>we&&(j["!ref"]=Je(W),me[se]=j,fe.push(se),j=G.dense?[]:{},W={s:{r:0,c:0},e:{r:0,c:0}},we=xe[3],se=ge||"Sheet"+(we+1),ge="");var lt=G.dense?(j[xe[0].r]||[])[xe[0].c]:j[Me(xe[0])];if(lt){lt.t=xe[1].t,lt.v=xe[1].v,xe[1].z!=null&&(lt.z=xe[1].z),xe[1].f!=null&&(lt.f=xe[1].f);break}G.dense?(j[xe[0].r]||(j[xe[0].r]=[]),j[xe[0].r][xe[0].c]=xe[1]):j[Me(xe[0])]=xe[1];break}},G);else if(z[2]==26||z[2]==14)G.Enum=Ce,z[2]==14&&(G.qpro=!0,z.l=0),n(z,function(xe,Et,rt){switch(rt){case 204:se=xe;break;case 22:xe[1].v=xe[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(xe[3]>we&&(j["!ref"]=Je(W),me[se]=j,fe.push(se),j=G.dense?[]:{},W={s:{r:0,c:0},e:{r:0,c:0}},we=xe[3],se="Sheet"+(we+1)),mt>0&&xe[0].r>=mt)break;G.dense?(j[xe[0].r]||(j[xe[0].r]=[]),j[xe[0].r][xe[0].c]=xe[1]):j[Me(xe[0])]=xe[1],W.e.c<xe[0].c&&(W.e.c=xe[0].c),W.e.r<xe[0].r&&(W.e.r=xe[0].r);break;case 27:xe[14e3]&&(Ge[xe[14e3][0]]=xe[14e3][1]);break;case 1537:Ge[xe[0]]=xe[1],xe[0]==we&&(se=xe[1]);break}},G);else throw new Error("Unrecognized LOTUS BOF "+z[2]);if(j["!ref"]=Je(W),me[ge||se]=j,fe.push(ge||se),!Ge.length)return{SheetNames:fe,Sheets:me};for(var qe={},nt=[],Ve=0;Ve<Ge.length;++Ve)me[fe[Ve]]?(nt.push(Ge[Ve]||fe[Ve]),qe[Ge[Ve]]=me[Ge[Ve]]||me[fe[Ve]]):(nt.push(Ge[Ve]),qe[Ge[Ve]]={"!ref":"A1"});return{SheetNames:nt,Sheets:qe}}function r(z,Q){var G=Q||{};if(+G.codepage>=0&&Tr(+G.codepage),G.type=="string")throw new Error("Cannot write WK1 to JS string");var j=gp(),se=Ft(z["!ref"]),ge=Array.isArray(z),we=[];_r(j,0,s(1030)),_r(j,6,c(se));for(var me=Math.min(se.e.r,8191),fe=se.s.r;fe<=me;++fe)for(var Ge=fn(fe),W=se.s.c;W<=se.e.c;++W){fe===se.s.r&&(we[W]=Xt(W));var mt=we[W]+Ge,qe=ge?(z[fe]||[])[W]:z[mt];if(!(!qe||qe.t=="z"))if(qe.t=="n")(qe.v|0)==qe.v&&qe.v>=-32768&&qe.v<=32767?_r(j,13,p(fe,W,qe.v)):_r(j,14,m(fe,W,qe.v));else{var nt=bi(qe);_r(j,15,h(fe,W,nt.slice(0,239)))}}return _r(j,1),j.end()}function i(z,Q){var G=Q||{};if(+G.codepage>=0&&Tr(+G.codepage),G.type=="string")throw new Error("Cannot write WK3 to JS string");var j=gp();_r(j,0,a(z));for(var se=0,ge=0;se<z.SheetNames.length;++se)(z.Sheets[z.SheetNames[se]]||{})["!ref"]&&_r(j,27,K(z.SheetNames[se],ge++));var we=0;for(se=0;se<z.SheetNames.length;++se){var me=z.Sheets[z.SheetNames[se]];if(!(!me||!me["!ref"])){for(var fe=Ft(me["!ref"]),Ge=Array.isArray(me),W=[],mt=Math.min(fe.e.r,8191),qe=fe.s.r;qe<=mt;++qe)for(var nt=fn(qe),Ve=fe.s.c;Ve<=fe.e.c;++Ve){qe===fe.s.r&&(W[Ve]=Xt(Ve));var xe=W[Ve]+nt,Et=Ge?(me[qe]||[])[Ve]:me[xe];if(!(!Et||Et.t=="z"))if(Et.t=="n")_r(j,23,S(qe,Ve,we,Et.v));else{var rt=bi(Et);_r(j,22,y(qe,Ve,we,rt.slice(0,239)))}}++we}}return _r(j,1),j.end()}function s(z){var Q=qt(2);return Q.write_shift(2,z),Q}function a(z){var Q=qt(26);Q.write_shift(2,4096),Q.write_shift(2,4),Q.write_shift(4,0);for(var G=0,j=0,se=0,ge=0;ge<z.SheetNames.length;++ge){var we=z.SheetNames[ge],me=z.Sheets[we];if(!(!me||!me["!ref"])){++se;var fe=nc(me["!ref"]);G<fe.e.r&&(G=fe.e.r),j<fe.e.c&&(j=fe.e.c)}}return G>8191&&(G=8191),Q.write_shift(2,G),Q.write_shift(1,se),Q.write_shift(1,j),Q.write_shift(2,0),Q.write_shift(2,0),Q.write_shift(1,1),Q.write_shift(1,2),Q.write_shift(4,0),Q.write_shift(4,0),Q}function o(z,Q,G){var j={s:{c:0,r:0},e:{c:0,r:0}};return Q==8&&G.qpro?(j.s.c=z.read_shift(1),z.l++,j.s.r=z.read_shift(2),j.e.c=z.read_shift(1),z.l++,j.e.r=z.read_shift(2),j):(j.s.c=z.read_shift(2),j.s.r=z.read_shift(2),Q==12&&G.qpro&&(z.l+=2),j.e.c=z.read_shift(2),j.e.r=z.read_shift(2),Q==12&&G.qpro&&(z.l+=2),j.s.c==65535&&(j.s.c=j.e.c=j.s.r=j.e.r=0),j)}function c(z){var Q=qt(8);return Q.write_shift(2,z.s.c),Q.write_shift(2,z.s.r),Q.write_shift(2,z.e.c),Q.write_shift(2,z.e.r),Q}function l(z,Q,G){var j=[{c:0,r:0},{t:"n",v:0},0,0];return G.qpro&&G.vers!=20768?(j[0].c=z.read_shift(1),j[3]=z.read_shift(1),j[0].r=z.read_shift(2),z.l+=2):(j[2]=z.read_shift(1),j[0].c=z.read_shift(2),j[0].r=z.read_shift(2)),j}function u(z,Q,G){var j=z.l+Q,se=l(z,Q,G);if(se[1].t="s",G.vers==20768){z.l++;var ge=z.read_shift(1);return se[1].v=z.read_shift(ge,"utf8"),se}return G.qpro&&z.l++,se[1].v=z.read_shift(j-z.l,"cstr"),se}function h(z,Q,G){var j=qt(7+G.length);j.write_shift(1,255),j.write_shift(2,Q),j.write_shift(2,z),j.write_shift(1,39);for(var se=0;se<j.length;++se){var ge=G.charCodeAt(se);j.write_shift(1,ge>=128?95:ge)}return j.write_shift(1,0),j}function d(z,Q,G){var j=l(z,Q,G);return j[1].v=z.read_shift(2,"i"),j}function p(z,Q,G){var j=qt(7);return j.write_shift(1,255),j.write_shift(2,Q),j.write_shift(2,z),j.write_shift(2,G,"i"),j}function g(z,Q,G){var j=l(z,Q,G);return j[1].v=z.read_shift(8,"f"),j}function m(z,Q,G){var j=qt(13);return j.write_shift(1,255),j.write_shift(2,Q),j.write_shift(2,z),j.write_shift(8,G,"f"),j}function _(z,Q,G){var j=z.l+Q,se=l(z,Q,G);if(se[1].v=z.read_shift(8,"f"),G.qpro)z.l=j;else{var ge=z.read_shift(2);R(z.slice(z.l,z.l+ge),se),z.l+=ge}return se}function E(z,Q,G){var j=Q&32768;return Q&=-32769,Q=(j?z:0)+(Q>=8192?Q-16384:Q),(j?"":"$")+(G?Xt(Q):fn(Q))}var I={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},v=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function R(z,Q){un(z,0);for(var G=[],j=0,se="",ge="",we="",me="";z.l<z.length;){var fe=z[z.l++];switch(fe){case 0:G.push(z.read_shift(8,"f"));break;case 1:ge=E(Q[0].c,z.read_shift(2),!0),se=E(Q[0].r,z.read_shift(2),!1),G.push(ge+se);break;case 2:{var Ge=E(Q[0].c,z.read_shift(2),!0),W=E(Q[0].r,z.read_shift(2),!1);ge=E(Q[0].c,z.read_shift(2),!0),se=E(Q[0].r,z.read_shift(2),!1),G.push(Ge+W+":"+ge+se)}break;case 3:if(z.l<z.length){console.error("WK1 premature formula end");return}break;case 4:G.push("("+G.pop()+")");break;case 5:G.push(z.read_shift(2));break;case 6:{for(var mt="";fe=z[z.l++];)mt+=String.fromCharCode(fe);G.push('"'+mt.replace(/"/g,'""')+'"')}break;case 8:G.push("-"+G.pop());break;case 23:G.push("+"+G.pop());break;case 22:G.push("NOT("+G.pop()+")");break;case 20:case 21:me=G.pop(),we=G.pop(),G.push(["AND","OR"][fe-20]+"("+we+","+me+")");break;default:if(fe<32&&v[fe])me=G.pop(),we=G.pop(),G.push(we+v[fe]+me);else if(I[fe]){if(j=I[fe][1],j==69&&(j=z[z.l++]),j>G.length){console.error("WK1 bad formula parse 0x"+fe.toString(16)+":|"+G.join("|")+"|");return}var qe=G.slice(-j);G.length-=j,G.push(I[fe][0]+"("+qe.join(",")+")")}else return fe<=7?console.error("WK1 invalid opcode "+fe.toString(16)):fe<=24?console.error("WK1 unsupported op "+fe.toString(16)):fe<=30?console.error("WK1 invalid opcode "+fe.toString(16)):fe<=115?console.error("WK1 unsupported function opcode "+fe.toString(16)):console.error("WK1 unrecognized opcode "+fe.toString(16))}}G.length==1?Q[1].f=""+G[0]:console.error("WK1 bad formula parse |"+G.join("|")+"|")}function F(z){var Q=[{c:0,r:0},{t:"n",v:0},0];return Q[0].r=z.read_shift(2),Q[3]=z[z.l++],Q[0].c=z[z.l++],Q}function O(z,Q){var G=F(z);return G[1].t="s",G[1].v=z.read_shift(Q-4,"cstr"),G}function y(z,Q,G,j){var se=qt(6+j.length);se.write_shift(2,z),se.write_shift(1,G),se.write_shift(1,Q),se.write_shift(1,39);for(var ge=0;ge<j.length;++ge){var we=j.charCodeAt(ge);se.write_shift(1,we>=128?95:we)}return se.write_shift(1,0),se}function w(z,Q){var G=F(z);G[1].v=z.read_shift(2);var j=G[1].v>>1;if(G[1].v&1)switch(j&7){case 0:j=(j>>3)*5e3;break;case 1:j=(j>>3)*500;break;case 2:j=(j>>3)/20;break;case 3:j=(j>>3)/200;break;case 4:j=(j>>3)/2e3;break;case 5:j=(j>>3)/2e4;break;case 6:j=(j>>3)/16;break;case 7:j=(j>>3)/64;break}return G[1].v=j,G}function T(z,Q){var G=F(z),j=z.read_shift(4),se=z.read_shift(4),ge=z.read_shift(2);if(ge==65535)return j===0&&se===3221225472?(G[1].t="e",G[1].v=15):j===0&&se===3489660928?(G[1].t="e",G[1].v=42):G[1].v=0,G;var we=ge&32768;return ge=(ge&32767)-16446,G[1].v=(1-we*2)*(se*Math.pow(2,ge+32)+j*Math.pow(2,ge)),G}function S(z,Q,G,j){var se=qt(14);if(se.write_shift(2,z),se.write_shift(1,G),se.write_shift(1,Q),j==0)return se.write_shift(4,0),se.write_shift(4,0),se.write_shift(2,65535),se;var ge=0,we=0,me=0,fe=0;return j<0&&(ge=1,j=-j),we=Math.log2(j)|0,j/=Math.pow(2,we-31),fe=j>>>0,(fe&2147483648)==0&&(j/=2,++we,fe=j>>>0),j-=fe,fe|=2147483648,fe>>>=0,j*=Math.pow(2,32),me=j>>>0,se.write_shift(4,me),se.write_shift(4,fe),we+=16383+(ge?32768:0),se.write_shift(2,we),se}function A(z,Q){var G=T(z);return z.l+=Q-14,G}function k(z,Q){var G=F(z),j=z.read_shift(4);return G[1].v=j>>6,G}function D(z,Q){var G=F(z),j=z.read_shift(8,"f");return G[1].v=j,G}function oe(z,Q){var G=D(z);return z.l+=Q-10,G}function ie(z,Q){return z[z.l+Q-1]==0?z.read_shift(Q,"cstr"):""}function ue(z,Q){var G=z[z.l++];G>Q-1&&(G=Q-1);for(var j="";j.length<G;)j+=String.fromCharCode(z[z.l++]);return j}function he(z,Q,G){if(!(!G.qpro||Q<21)){var j=z.read_shift(1);z.l+=17,z.l+=1,z.l+=2;var se=z.read_shift(Q-21,"cstr");return[j,se]}}function Oe(z,Q){for(var G={},j=z.l+Q;z.l<j;){var se=z.read_shift(2);if(se==14e3){for(G[se]=[0,""],G[se][0]=z.read_shift(2);z[z.l];)G[se][1]+=String.fromCharCode(z[z.l]),z.l++;z.l++}}return G}function K(z,Q){var G=qt(5+z.length);G.write_shift(2,14e3),G.write_shift(2,Q);for(var j=0;j<z.length;++j){var se=z.charCodeAt(j);G[G.l++]=se>127?95:se}return G[G.l++]=0,G}var Se={0:{n:"BOF",f:zt},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:o},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:d},14:{n:"NUMBER",f:g},15:{n:"LABEL",f:u},16:{n:"FORMULA",f:_},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:u},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:ie},222:{n:"SHEETNAMELP",f:ue},65535:{n:""}},Ce={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:O},23:{n:"NUMBER17",f:T},24:{n:"NUMBER18",f:w},25:{n:"FORMULA19",f:A},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Oe},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:k},38:{n:"??"},39:{n:"NUMBER27",f:D},40:{n:"FORMULA28",f:oe},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:ie},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:he},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:r,book_to_wk3:i,to_workbook:e}})();function KB(n){var e={},t=n.match(Rn),r=0,i=!1;if(t)for(;r!=t.length;++r){var s=Pe(t[r]);switch(s[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!s.val)break;case"<shadow>":case"<shadow/>":e.shadow=1;break;case"</shadow>":break;case"<charset":if(s.val=="1")break;e.cp=um[parseInt(s.val,10)];break;case"<outline":if(!s.val)break;case"<outline>":case"<outline/>":e.outline=1;break;case"</outline>":break;case"<rFont":e.name=s.val;break;case"<sz":e.sz=s.val;break;case"<strike":if(!s.val)break;case"<strike>":case"<strike/>":e.strike=1;break;case"</strike>":break;case"<u":if(!s.val)break;switch(s.val){case"double":e.uval="double";break;case"singleAccounting":e.uval="single-accounting";break;case"doubleAccounting":e.uval="double-accounting";break}case"<u>":case"<u/>":e.u=1;break;case"</u>":break;case"<b":if(s.val=="0")break;case"<b>":case"<b/>":e.b=1;break;case"</b>":break;case"<i":if(s.val=="0")break;case"<i>":case"<i/>":e.i=1;break;case"</i>":break;case"<color":s.rgb&&(e.color=s.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":e.family=s.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":e.valign=s.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(s[0].charCodeAt(1)!==47&&!i)throw new Error("Unrecognized rich format "+s[0])}}return e}var YB=(function(){var n=$l("t"),e=$l("rPr");function t(s){var a=s.match(n);if(!a)return{t:"s",v:""};var o={t:"s",v:Ze(a[1])},c=s.match(e);return c&&(o.s=KB(c[1])),o}var r=/<(?:\w+:)?r>/g,i=/<\/(?:\w+:)?r>/;return function(a){return a.replace(r,"").split(i).map(t).filter(function(o){return o.v})}})(),XB=(function(){var e=/(\r\n|\n)/g;function t(i,s,a){var o=[];i.u&&o.push("text-decoration: underline;"),i.uval&&o.push("text-underline-style:"+i.uval+";"),i.sz&&o.push("font-size:"+i.sz+"pt;"),i.outline&&o.push("text-effect: outline;"),i.shadow&&o.push("text-shadow: auto;"),s.push('<span style="'+o.join("")+'">'),i.b&&(s.push("<b>"),a.push("</b>")),i.i&&(s.push("<i>"),a.push("</i>")),i.strike&&(s.push("<s>"),a.push("</s>"));var c=i.valign||"";return c=="superscript"||c=="super"?c="sup":c=="subscript"&&(c="sub"),c!=""&&(s.push("<"+c+">"),a.push("</"+c+">")),a.push("</span>"),i}function r(i){var s=[[],i.v,[]];return i.v?(i.s&&t(i.s,s[0],s[2]),s[0].join("")+s[1].replace(e,"<br/>")+s[2].join("")):""}return function(s){return s.map(r).join("")}})(),QB=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,JB=/<(?:\w+:)?r>/,ZB=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function Sm(n,e){var t=e?e.cellHTML:!0,r={};return n?(n.match(/^\s*<(?:\w+:)?t[^>]*>/)?(r.t=Ze(dt(n.slice(n.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),r.r=dt(n),t&&(r.h=_m(r.t))):n.match(JB)&&(r.r=dt(n),r.t=Ze(dt((n.replace(ZB,"").match(QB)||[]).join("").replace(Rn,""))),t&&(r.h=XB(YB(r.r)))),r):{t:""}}var e8=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,t8=/<(?:\w+:)?(?:si|sstItem)>/g,n8=/<\/(?:\w+:)?(?:si|sstItem)>/;function r8(n,e){var t=[],r="";if(!n)return t;var i=n.match(e8);if(i){r=i[2].replace(t8,"").split(n8);for(var s=0;s!=r.length;++s){var a=Sm(r[s].trim(),e);a!=null&&(t[t.length]=a)}i=Pe(i[1]),t.Count=i.count,t.Unique=i.uniqueCount}return t}function i8(n){return[n.read_shift(4),n.read_shift(4)]}function s8(n,e){var t=[],r=!1;return Pi(n,function(s,a,o){switch(o){case 159:t.Count=s[0],t.Unique=s[1];break;case 19:t.push(s);break;case 160:return!0;case 35:r=!0;break;case 36:r=!1;break;default:if(a.T,!r||e.WTF)throw new Error("Unexpected record 0x"+o.toString(16))}}),t}function I2(n){for(var e=[],t=n.split(""),r=0;r<t.length;++r)e[r]=t[r].charCodeAt(0);return e}function _i(n,e){var t={};return t.Major=n.read_shift(2),t.Minor=n.read_shift(2),e>=4&&(n.l+=e-4),t}function a8(n){var e={};return e.id=n.read_shift(0,"lpp4"),e.R=_i(n,4),e.U=_i(n,4),e.W=_i(n,4),e}function o8(n){for(var e=n.read_shift(4),t=n.l+e-4,r={},i=n.read_shift(4),s=[];i-- >0;)s.push({t:n.read_shift(4),v:n.read_shift(0,"lpp4")});if(r.name=n.read_shift(0,"lpp4"),r.comps=s,n.l!=t)throw new Error("Bad DataSpaceMapEntry: "+n.l+" != "+t);return r}function c8(n){var e=[];n.l+=4;for(var t=n.read_shift(4);t-- >0;)e.push(o8(n));return e}function l8(n){var e=[];n.l+=4;for(var t=n.read_shift(4);t-- >0;)e.push(n.read_shift(0,"lpp4"));return e}function u8(n){var e={};return n.read_shift(4),n.l+=4,e.id=n.read_shift(0,"lpp4"),e.name=n.read_shift(0,"lpp4"),e.R=_i(n,4),e.U=_i(n,4),e.W=_i(n,4),e}function h8(n){var e=u8(n);if(e.ename=n.read_shift(0,"8lpp4"),e.blksz=n.read_shift(4),e.cmode=n.read_shift(4),n.read_shift(4)!=4)throw new Error("Bad !Primary record");return e}function A2(n,e){var t=n.l+e,r={};r.Flags=n.read_shift(4)&63,n.l+=4,r.AlgID=n.read_shift(4);var i=!1;switch(r.AlgID){case 26126:case 26127:case 26128:i=r.Flags==36;break;case 26625:i=r.Flags==4;break;case 0:i=r.Flags==16||r.Flags==4||r.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+r.AlgID}if(!i)throw new Error("Encryption Flags/AlgID mismatch");return r.AlgIDHash=n.read_shift(4),r.KeySize=n.read_shift(4),r.ProviderType=n.read_shift(4),n.l+=8,r.CSPName=n.read_shift(t-n.l>>1,"utf16le"),n.l=t,r}function S2(n,e){var t={},r=n.l+e;return n.l+=4,t.Salt=n.slice(n.l,n.l+16),n.l+=16,t.Verifier=n.slice(n.l,n.l+16),n.l+=16,n.read_shift(4),t.VerifierHash=n.slice(n.l,r),n.l=r,t}function f8(n){var e=_i(n);switch(e.Minor){case 2:return[e.Minor,d8(n)];case 3:return[e.Minor,p8()];case 4:return[e.Minor,g8(n)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+e.Minor)}function d8(n){var e=n.read_shift(4);if((e&63)!=36)throw new Error("EncryptionInfo mismatch");var t=n.read_shift(4),r=A2(n,t),i=S2(n,n.length-n.l);return{t:"Std",h:r,v:i}}function p8(){throw new Error("File is password-protected: ECMA-376 Extensible")}function g8(n){var e=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];n.l+=4;var t=n.read_shift(n.length-n.l,"utf8"),r={};return t.replace(Rn,function(s){var a=Pe(s);switch(Qr(a[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":e.forEach(function(o){r[o]=a[o]});break;case"<dataIntegrity":r.encryptedHmacKey=a.encryptedHmacKey,r.encryptedHmacValue=a.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":r.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":r.uri=a.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":r.encs.push(a);break;default:throw a[0]}}),r}function m8(n,e){var t={},r=t.EncryptionVersionInfo=_i(n,4);if(e-=4,r.Minor!=2)throw new Error("unrecognized minor version code: "+r.Minor);if(r.Major>4||r.Major<2)throw new Error("unrecognized major version code: "+r.Major);t.Flags=n.read_shift(4),e-=4;var i=n.read_shift(4);return e-=4,t.EncryptionHeader=A2(n,i),e-=i,t.EncryptionVerifier=S2(n,e),t}function _8(n){var e={},t=e.EncryptionVersionInfo=_i(n,4);if(t.Major!=1||t.Minor!=1)throw"unrecognized version code "+t.Major+" : "+t.Minor;return e.Salt=n.read_shift(16),e.EncryptedVerifier=n.read_shift(16),e.EncryptedVerifierHash=n.read_shift(16),e}function x8(n){var e=0,t,r=I2(n),i=r.length+1,s,a,o,c,l;for(t=vs(i),t[0]=r.length,s=1;s!=i;++s)t[s]=r[s-1];for(s=i-1;s>=0;--s)a=t[s],o=(e&16384)===0?0:1,c=e<<1&32767,l=o|c,e=l^a;return e^52811}var k2=(function(){var n=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],e=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],t=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],r=function(a){return(a/2|a*128)&255},i=function(a,o){return r(a^o)},s=function(a){for(var o=e[a.length-1],c=104,l=a.length-1;l>=0;--l)for(var u=a[l],h=0;h!=7;++h)u&64&&(o^=t[c]),u*=2,--c;return o};return function(a){for(var o=I2(a),c=s(o),l=o.length,u=vs(16),h=0;h!=16;++h)u[h]=0;var d,p,g;for((l&1)===1&&(d=c>>8,u[l]=i(n[0],d),--l,d=c&255,p=o[o.length-1],u[l]=i(p,d));l>0;)--l,d=c>>8,u[l]=i(o[l],d),--l,d=c&255,u[l]=i(o[l],d);for(l=15,g=15-o.length;g>0;)d=c>>8,u[l]=i(n[g],d),--l,--g,d=c&255,u[l]=i(o[l],d),--l,--g;return u}})(),y8=function(n,e,t,r,i){i||(i=e),r||(r=k2(n));var s,a;for(s=0;s!=e.length;++s)a=e[s],a^=r[t],a=(a>>5|a<<3)&255,i[s]=a,++t;return[i,t,r]},v8=function(n){var e=0,t=k2(n);return function(r){var i=y8("",r,e,t);return e=i[1],i[0]}};function E8(n,e,t,r){var i={key:zt(n),verificationBytes:zt(n)};return t.password&&(i.verifier=x8(t.password)),r.valid=i.verificationBytes===i.verifier,r.valid&&(r.insitu=v8(t.password)),i}function w8(n,e,t){var r=t||{};return r.Info=n.read_shift(2),n.l-=2,r.Info===1?r.Data=_8(n):r.Data=m8(n,e),r}function T8(n,e,t){var r={Type:t.biff>=8?n.read_shift(2):0};return r.Type?w8(n,e-2,r):E8(n,t.biff>=8?e:e-2,t,r),r}var b8=(function(){function n(i,s){switch(s.type){case"base64":return e(nr(i),s);case"binary":return e(i,s);case"buffer":return e(Ke&&Buffer.isBuffer(i)?i.toString("binary"):Fa(i),s);case"array":return e(Sa(i),s)}throw new Error("Unrecognized type "+s.type)}function e(i,s){var a=s||{},o=a.dense?[]:{},c=i.match(/\\trowd.*?\\row\b/g);if(!c.length)throw new Error("RTF missing table");var l={s:{c:0,r:0},e:{c:0,r:c.length-1}};return c.forEach(function(u,h){Array.isArray(o)&&(o[h]=[]);for(var d=/\\\w+\b/g,p=0,g,m=-1;g=d.exec(u);){switch(g[0]){case"\\cell":var _=u.slice(p,d.lastIndex-g[0].length);if(_[0]==" "&&(_=_.slice(1)),++m,_.length){var E={v:_,t:"s"};Array.isArray(o)?o[h][m]=E:o[Me({r:h,c:m})]=E}break}p=d.lastIndex}m>l.e.c&&(l.e.c=m)}),o["!ref"]=Je(l),o}function t(i,s){return Rs(n(i,s),s)}function r(i){for(var s=["{\\rtf1\\ansi"],a=Ft(i["!ref"]),o,c=Array.isArray(i),l=a.s.r;l<=a.e.r;++l){s.push("\\trowd\\trautofit1");for(var u=a.s.c;u<=a.e.c;++u)s.push("\\cellx"+(u+1));for(s.push("\\pard\\intbl"),u=a.s.c;u<=a.e.c;++u){var h=Me({r:l,c:u});o=c?(i[l]||[])[u]:i[h],!(!o||o.v==null&&(!o.f||o.F))&&(s.push(" "+(o.w||(bi(o),o.w))),s.push("\\cell"))}s.push("\\pard\\intbl\\row")}return s.join("")+"}"}return{to_workbook:t,to_sheet:n,from_sheet:r}})();function I8(n){var e=n.slice(n[0]==="#"?1:0).slice(0,6);return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function Gl(n){for(var e=0,t=1;e!=3;++e)t=t*256+(n[e]>255?255:n[e]<0?0:n[e]);return t.toString(16).toUpperCase().slice(1)}function A8(n){var e=n[0]/255,t=n[1]/255,r=n[2]/255,i=Math.max(e,t,r),s=Math.min(e,t,r),a=i-s;if(a===0)return[0,0,e];var o=0,c=0,l=i+s;switch(c=a/(l>1?2-l:l),i){case e:o=((t-r)/a+6)%6;break;case t:o=(r-e)/a+2;break;case r:o=(e-t)/a+4;break}return[o/6,c,l/2]}function S8(n){var e=n[0],t=n[1],r=n[2],i=t*2*(r<.5?r:1-r),s=r-i/2,a=[s,s,s],o=6*e,c;if(t!==0)switch(o|0){case 0:case 6:c=i*o,a[0]+=i,a[1]+=c;break;case 1:c=i*(2-o),a[0]+=c,a[1]+=i;break;case 2:c=i*(o-2),a[1]+=i,a[2]+=c;break;case 3:c=i*(4-o),a[1]+=c,a[2]+=i;break;case 4:c=i*(o-4),a[2]+=i,a[0]+=c;break;case 5:c=i*(6-o),a[2]+=c,a[0]+=i;break}for(var l=0;l!=3;++l)a[l]=Math.round(a[l]*255);return a}function Af(n,e){if(e===0)return n;var t=A8(I8(n));return e<0?t[2]=t[2]*(1+e):t[2]=1-(1-t[2])*(1-e),Gl(S8(t))}var C2=6,k8=15,C8=1,Mn=C2;function Sf(n){return Math.floor((n+Math.round(128/Mn)/256)*Mn)}function kf(n){return Math.floor((n-5)/Mn*100+.5)/100}function yp(n){return Math.round((n*Mn+5)/Mn*256)/256}function d0(n){return yp(kf(Sf(n)))}function km(n){var e=Math.abs(n-d0(n)),t=Mn;if(e>.005)for(Mn=C8;Mn<k8;++Mn)Math.abs(n-d0(n))<=e&&(e=Math.abs(n-d0(n)),t=Mn);Mn=t}function Wo(n){n.width?(n.wpx=Sf(n.width),n.wch=kf(n.wpx),n.MDW=Mn):n.wpx?(n.wch=kf(n.wpx),n.width=yp(n.wch),n.MDW=Mn):typeof n.wch=="number"&&(n.width=yp(n.wch),n.wpx=Sf(n.width),n.MDW=Mn),n.customWidth&&delete n.customWidth}var R8=96,R2=R8;function P2(n){return n*96/R2}function ql(n){return n*R2/96}var P8={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function D8(n,e,t,r){e.Borders=[];var i={},s=!1;(n[0].match(Rn)||[]).forEach(function(a){var o=Pe(a);switch(Qr(o[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":i={},o.diagonalUp&&(i.diagonalUp=bt(o.diagonalUp)),o.diagonalDown&&(i.diagonalDown=bt(o.diagonalDown)),e.Borders.push(i);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+o[0]+" in borders")}})}function F8(n,e,t,r){e.Fills=[];var i={},s=!1;(n[0].match(Rn)||[]).forEach(function(a){var o=Pe(a);switch(Qr(o[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":i={},e.Fills.push(i);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":e.Fills.push(i),i={};break;case"<patternFill":case"<patternFill>":o.patternType&&(i.patternType=o.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":i.bgColor||(i.bgColor={}),o.indexed&&(i.bgColor.indexed=parseInt(o.indexed,10)),o.theme&&(i.bgColor.theme=parseInt(o.theme,10)),o.tint&&(i.bgColor.tint=parseFloat(o.tint)),o.rgb&&(i.bgColor.rgb=o.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":i.fgColor||(i.fgColor={}),o.theme&&(i.fgColor.theme=parseInt(o.theme,10)),o.tint&&(i.fgColor.tint=parseFloat(o.tint)),o.rgb!=null&&(i.fgColor.rgb=o.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+o[0]+" in fills")}})}function O8(n,e,t,r){e.Fonts=[];var i={},s=!1;(n[0].match(Rn)||[]).forEach(function(a){var o=Pe(a);switch(Qr(o[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":e.Fonts.push(i),i={};break;case"<name":o.val&&(i.name=dt(o.val));break;case"<name/>":case"</name>":break;case"<b":i.bold=o.val?bt(o.val):1;break;case"<b/>":i.bold=1;break;case"<i":i.italic=o.val?bt(o.val):1;break;case"<i/>":i.italic=1;break;case"<u":switch(o.val){case"none":i.underline=0;break;case"single":i.underline=1;break;case"double":i.underline=2;break;case"singleAccounting":i.underline=33;break;case"doubleAccounting":i.underline=34;break}break;case"<u/>":i.underline=1;break;case"<strike":i.strike=o.val?bt(o.val):1;break;case"<strike/>":i.strike=1;break;case"<outline":i.outline=o.val?bt(o.val):1;break;case"<outline/>":i.outline=1;break;case"<shadow":i.shadow=o.val?bt(o.val):1;break;case"<shadow/>":i.shadow=1;break;case"<condense":i.condense=o.val?bt(o.val):1;break;case"<condense/>":i.condense=1;break;case"<extend":i.extend=o.val?bt(o.val):1;break;case"<extend/>":i.extend=1;break;case"<sz":o.val&&(i.sz=+o.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":o.val&&(i.vertAlign=o.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":o.val&&(i.family=parseInt(o.val,10));break;case"<family/>":case"</family>":break;case"<scheme":o.val&&(i.scheme=o.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(o.val=="1")break;o.codepage=um[parseInt(o.val,10)];break;case"<color":if(i.color||(i.color={}),o.auto&&(i.color.auto=bt(o.auto)),o.rgb)i.color.rgb=o.rgb.slice(-6);else if(o.indexed){i.color.index=parseInt(o.indexed,10);var c=ha[i.color.index];i.color.index==81&&(c=ha[1]),c||(c=ha[1]),i.color.rgb=c[0].toString(16)+c[1].toString(16)+c[2].toString(16)}else o.theme&&(i.color.theme=parseInt(o.theme,10),o.tint&&(i.color.tint=parseFloat(o.tint)),o.theme&&t.themeElements&&t.themeElements.clrScheme&&(i.color.rgb=Af(t.themeElements.clrScheme[i.color.theme].rgb,i.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":s=!0;break;case"</AlternateContent>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+o[0]+" in fonts")}})}function M8(n,e,t){e.NumberFmt=[];for(var r=Kr(Ne),i=0;i<r.length;++i)e.NumberFmt[r[i]]=Ne[r[i]];var s=n[0].match(Rn);if(s)for(i=0;i<s.length;++i){var a=Pe(s[i]);switch(Qr(a[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var o=Ze(dt(a.formatCode)),c=parseInt(a.numFmtId,10);if(e.NumberFmt[c]=o,c>0){if(c>392){for(c=392;c>60&&e.NumberFmt[c]!=null;--c);e.NumberFmt[c]=o}ua(o,c)}}break;case"</numFmt>":break;default:if(t.WTF)throw new Error("unrecognized "+a[0]+" in numFmts")}}}var uh=["numFmtId","fillId","fontId","borderId","xfId"],hh=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function L8(n,e,t){e.CellXf=[];var r,i=!1;(n[0].match(Rn)||[]).forEach(function(s){var a=Pe(s),o=0;switch(Qr(a[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(r=a,delete r[0],o=0;o<uh.length;++o)r[uh[o]]&&(r[uh[o]]=parseInt(r[uh[o]],10));for(o=0;o<hh.length;++o)r[hh[o]]&&(r[hh[o]]=bt(r[hh[o]]));if(e.NumberFmt&&r.numFmtId>392){for(o=392;o>60;--o)if(e.NumberFmt[r.numFmtId]==e.NumberFmt[o]){r.numFmtId=o;break}}e.CellXf.push(r);break;case"</xf>":break;case"<alignment":case"<alignment/>":var c={};a.vertical&&(c.vertical=a.vertical),a.horizontal&&(c.horizontal=a.horizontal),a.textRotation!=null&&(c.textRotation=a.textRotation),a.indent&&(c.indent=a.indent),a.wrapText&&(c.wrapText=bt(a.wrapText)),r.alignment=c;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":i=!0;break;case"</AlternateContent>":i=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(t&&t.WTF&&!i)throw new Error("unrecognized "+a[0]+" in cellXfs")}})}var N8=(function(){var e=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,t=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,r=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,i=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,s=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(o,c,l){var u={};if(!o)return u;o=o.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var h;return(h=o.match(e))&&M8(h,u,l),(h=o.match(i))&&O8(h,u,c,l),(h=o.match(r))&&F8(h,u,c,l),(h=o.match(s))&&D8(h,u,c,l),(h=o.match(t))&&L8(h,u,l),u}})();function V8(n,e){var t=n.read_shift(2),r=Sn(n);return[t,r]}function B8(n,e,t){var r={};r.sz=n.read_shift(2)/20;var i=Y5(n);i.fItalic&&(r.italic=1),i.fCondense&&(r.condense=1),i.fExtend&&(r.extend=1),i.fShadow&&(r.shadow=1),i.fOutline&&(r.outline=1),i.fStrikeout&&(r.strike=1);var s=n.read_shift(2);switch(s===700&&(r.bold=1),n.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript";break}var a=n.read_shift(1);a!=0&&(r.underline=a);var o=n.read_shift(1);o>0&&(r.family=o);var c=n.read_shift(1);switch(c>0&&(r.charset=c),n.l++,r.color=K5(n),n.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor";break}return r.name=Sn(n),r}var U8=Cn;function H8(n,e){var t=n.l+e,r=n.read_shift(2),i=n.read_shift(2);return n.l=t,{ixfe:r,numFmtId:i}}var z8=Cn;function $8(n,e,t){var r={};r.NumberFmt=[];for(var i in Ne)r.NumberFmt[i]=Ne[i];r.CellXf=[],r.Fonts=[];var s=[],a=!1;return Pi(n,function(c,l,u){switch(u){case 44:r.NumberFmt[c[0]]=c[1],ua(c[1],c[0]);break;case 43:r.Fonts.push(c),c.color.theme!=null&&e&&e.themeElements&&e.themeElements.clrScheme&&(c.color.rgb=Af(e.themeElements.clrScheme[c.color.theme].rgb,c.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:s[s.length-1]==617&&r.CellXf.push(c);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:a=!0;break;case 36:a=!1;break;case 37:s.push(u),a=!0;break;case 38:s.pop(),a=!1;break;default:if(l.T>0)s.push(u);else if(l.T<0)s.pop();else if(!a||t.WTF&&s[s.length-1]!=37)throw new Error("Unexpected record 0x"+u.toString(16))}}),r}var W8=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function j8(n,e,t){e.themeElements.clrScheme=[];var r={};(n[0].match(Rn)||[]).forEach(function(i){var s=Pe(i);switch(s[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":r.rgb=s.val;break;case"<a:sysClr":r.rgb=s.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":s[0].charAt(1)==="/"?(e.themeElements.clrScheme[W8.indexOf(s[0])]=r,r={}):r.name=s[0].slice(3,s[0].length-1);break;default:if(t&&t.WTF)throw new Error("Unrecognized "+s[0]+" in clrScheme")}})}function G8(){}function q8(){}var K8=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,Y8=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,X8=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function Q8(n,e,t){e.themeElements={};var r;[["clrScheme",K8,j8],["fontScheme",Y8,G8],["fmtScheme",X8,q8]].forEach(function(i){if(!(r=n.match(i[1])))throw new Error(i[0]+" not found in themeElements");i[2](r,e,t)})}var J8=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function D2(n,e){(!n||n.length===0)&&(n=Z8());var t,r={};if(!(t=n.match(J8)))throw new Error("themeElements not found in theme");return Q8(t[0],r,e),r.raw=n,r}function Z8(n,e){var t=[$I];return t[t.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',t[t.length]="<a:themeElements>",t[t.length]='<a:clrScheme name="Office">',t[t.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',t[t.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',t[t.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',t[t.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',t[t.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',t[t.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',t[t.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',t[t.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',t[t.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',t[t.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',t[t.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',t[t.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',t[t.length]="</a:clrScheme>",t[t.length]='<a:fontScheme name="Office">',t[t.length]="<a:majorFont>",t[t.length]='<a:latin typeface="Cambria"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface=" "/>',t[t.length]='<a:font script="Hang" typeface=" "/>',t[t.length]='<a:font script="Hans" typeface=""/>',t[t.length]='<a:font script="Hant" typeface=""/>',t[t.length]='<a:font script="Arab" typeface="Times New Roman"/>',t[t.length]='<a:font script="Hebr" typeface="Times New Roman"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="MoolBoran"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Times New Roman"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:majorFont>",t[t.length]="<a:minorFont>",t[t.length]='<a:latin typeface="Calibri"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface=" "/>',t[t.length]='<a:font script="Hang" typeface=" "/>',t[t.length]='<a:font script="Hans" typeface=""/>',t[t.length]='<a:font script="Hant" typeface=""/>',t[t.length]='<a:font script="Arab" typeface="Arial"/>',t[t.length]='<a:font script="Hebr" typeface="Arial"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="DaunPenh"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Arial"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:minorFont>",t[t.length]="</a:fontScheme>",t[t.length]='<a:fmtScheme name="Office">',t[t.length]="<a:fillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="1"/>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="0"/>',t[t.length]="</a:gradFill>",t[t.length]="</a:fillStyleLst>",t[t.length]="<a:lnStyleLst>",t[t.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]="</a:lnStyleLst>",t[t.length]="<a:effectStyleLst>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',t[t.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',t[t.length]="</a:effectStyle>",t[t.length]="</a:effectStyleLst>",t[t.length]="<a:bgFillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]="</a:bgFillStyleLst>",t[t.length]="</a:fmtScheme>",t[t.length]="</a:themeElements>",t[t.length]="<a:objectDefaults>",t[t.length]="<a:spDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',t[t.length]="</a:spDef>",t[t.length]="<a:lnDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',t[t.length]="</a:lnDef>",t[t.length]="</a:objectDefaults>",t[t.length]="<a:extraClrSchemeLst/>",t[t.length]="</a:theme>",t.join("")}function e9(n,e,t){var r=n.l+e,i=n.read_shift(4);if(i!==124226){if(!t.cellStyles){n.l=r;return}var s=n.slice(n.l);n.l=r;var a;try{a=zI(s,{type:"array"})}catch{return}var o=Jn(a,"theme/theme/theme1.xml",!0);if(o)return D2(o,t)}}function t9(n){return n.read_shift(4)}function n9(n){var e={};switch(e.xclrType=n.read_shift(2),e.nTintShade=n.read_shift(2),e.xclrType){case 0:n.l+=4;break;case 1:e.xclrValue=r9(n,4);break;case 2:e.xclrValue=x2(n);break;case 3:e.xclrValue=t9(n);break;case 4:n.l+=4;break}return n.l+=8,e}function r9(n,e){return Cn(n,e)}function i9(n,e){return Cn(n,e)}function s9(n){var e=n.read_shift(2),t=n.read_shift(2)-4,r=[e];switch(e){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:r[1]=n9(n);break;case 6:r[1]=i9(n,t);break;case 14:case 15:r[1]=n.read_shift(t===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+e+" "+t)}return r}function a9(n,e){var t=n.l+e;n.l+=2;var r=n.read_shift(2);n.l+=2;for(var i=n.read_shift(2),s=[];i-- >0;)s.push(s9(n,t-n.l));return{ixfe:r,ext:s}}function o9(n,e){e.forEach(function(t){t[0]})}function c9(n,e){return{flags:n.read_shift(4),version:n.read_shift(4),name:Sn(n)}}function l9(n){for(var e=[],t=n.read_shift(4);t-- >0;)e.push([n.read_shift(4),n.read_shift(4)]);return e}function u9(n){return n.l+=4,n.read_shift(4)!=0}function h9(n,e,t){var r={Types:[],Cell:[],Value:[]},i=t||{},s=[],a=!1,o=2;return Pi(n,function(c,l,u){switch(u){case 335:r.Types.push({name:c.name});break;case 51:c.forEach(function(h){o==1?r.Cell.push({type:r.Types[h[0]-1].name,index:h[1]}):o==0&&r.Value.push({type:r.Types[h[0]-1].name,index:h[1]})});break;case 337:o=c?1:0;break;case 338:o=2;break;case 35:s.push(u),a=!0;break;case 36:s.pop(),a=!1;break;default:if(!l.T){if(!a||i.WTF&&s[s.length-1]!=35)throw new Error("Unexpected record 0x"+u.toString(16))}}}),r}function f9(n,e,t){var r={Types:[],Cell:[],Value:[]};if(!n)return r;var i=!1,s=2,a;return n.replace(Rn,function(o){var c=Pe(o);switch(Qr(c[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":r.Types.push({name:c.name});break;case"</metadataType>":break;case"<futureMetadata":for(var l=0;l<r.Types.length;++l)r.Types[l].name==c.name&&(a=r.Types[l]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":s==1?r.Cell.push({type:r.Types[c.t-1].name,index:+c.v}):s==0&&r.Value.push({type:r.Types[c.t-1].name,index:+c.v});break;case"</rc>":break;case"<cellMetadata":s=1;break;case"</cellMetadata>":s=2;break;case"<valueMetadata":s=0;break;case"</valueMetadata>":s=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;case"<rvb":if(!a)break;a.offsets||(a.offsets=[]),a.offsets.push(+c.i);break;default:if(!i&&t.WTF)throw new Error("unrecognized "+c[0]+" in metadata")}return o}),r}function d9(n){var e=[];if(!n)return e;var t=1;return(n.match(Rn)||[]).forEach(function(r){var i=Pe(r);switch(i[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete i[0],i.i?t=i.i:i.i=t,e.push(i);break}}),e}function p9(n){var e={};e.i=n.read_shift(4);var t={};t.r=n.read_shift(4),t.c=n.read_shift(4),e.r=Me(t);var r=n.read_shift(1);return r&2&&(e.l="1"),r&8&&(e.a="1"),e}function g9(n,e,t){var r=[];return Pi(n,function(s,a,o){switch(o){case 63:r.push(s);break;default:if(!a.T)throw new Error("Unexpected record 0x"+o.toString(16))}}),r}function m9(n,e,t,r){if(!n)return n;var i=r||{},s=!1;Pi(n,function(o,c,l){switch(l){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:s=!0;break;case 36:s=!1;break;default:if(!c.T){if(!s||i.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}},i)}function _9(n,e){if(!n)return"??";var t=(n.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return e["!id"][t].Target}function kv(n,e,t,r){var i=Array.isArray(n),s;e.forEach(function(a){var o=Ln(a.ref);if(i?(n[o.r]||(n[o.r]=[]),s=n[o.r][o.c]):s=n[a.ref],!s){s={t:"z"},i?n[o.r][o.c]=s:n[a.ref]=s;var c=Ft(n["!ref"]||"BDWGO1000001:A1");c.s.r>o.r&&(c.s.r=o.r),c.e.r<o.r&&(c.e.r=o.r),c.s.c>o.c&&(c.s.c=o.c),c.e.c<o.c&&(c.e.c=o.c);var l=Je(c);l!==n["!ref"]&&(n["!ref"]=l)}s.c||(s.c=[]);var u={a:a.author,t:a.t,r:a.r,T:t};a.h&&(u.h=a.h);for(var h=s.c.length-1;h>=0;--h){if(!t&&s.c[h].T)return;t&&!s.c[h].T&&s.c.splice(h,1)}if(t&&r){for(h=0;h<r.length;++h)if(u.a==r[h].id){u.a=r[h].name||u.a;break}}s.c.push(u)})}function x9(n,e){if(n.match(/<(?:\w+:)?comments *\/>/))return[];var t=[],r=[],i=n.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);i&&i[1]&&i[1].split(/<\/\w*:?author>/).forEach(function(a){if(!(a===""||a.trim()==="")){var o=a.match(/<(?:\w+:)?author[^>]*>(.*)/);o&&t.push(o[1])}});var s=n.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return s&&s[1]&&s[1].split(/<\/\w*:?comment>/).forEach(function(a){if(!(a===""||a.trim()==="")){var o=a.match(/<(?:\w+:)?comment[^>]*>/);if(o){var c=Pe(o[0]),l={author:c.authorId&&t[c.authorId]||"sheetjsghost",ref:c.ref,guid:c.guid},u=Ln(c.ref);if(!(e.sheetRows&&e.sheetRows<=u.r)){var h=a.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),d=!!h&&!!h[1]&&Sm(h[1])||{r:"",t:"",h:""};l.r=d.r,d.r=="<t></t>"&&(d.t=d.h=""),l.t=(d.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.cellHTML&&(l.h=d.h),r.push(l)}}}}),r}function y9(n,e){var t=[],r=!1,i={},s=0;return n.replace(Rn,function(o,c){var l=Pe(o);switch(Qr(l[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":i={author:l.personId,guid:l.id,ref:l.ref,T:1};break;case"</threadedComment>":i.t!=null&&t.push(i);break;case"<text>":case"<text":s=c+o.length;break;case"</text>":i.t=n.slice(s,c).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":r=!0;break;case"</mentions>":r=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":r=!0;break;case"</ext>":r=!1;break;default:if(!r&&e.WTF)throw new Error("unrecognized "+l[0]+" in threaded comments")}return o}),t}function v9(n,e){var t=[],r=!1;return n.replace(Rn,function(s){var a=Pe(s);switch(Qr(a[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":t.push({name:a.displayname,id:a.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":r=!0;break;case"</ext>":r=!1;break;default:if(!r&&e.WTF)throw new Error("unrecognized "+a[0]+" in threaded comments")}return s}),t}function E9(n){var e={};e.iauthor=n.read_shift(4);var t=Ma(n);return e.rfx=t.s,e.ref=Me(t.s),n.l+=16,e}var w9=Sn;function T9(n,e){var t=[],r=[],i={},s=!1;return Pi(n,function(o,c,l){switch(l){case 632:r.push(o);break;case 635:i=o;break;case 637:i.t=o.t,i.h=o.h,i.r=o.r;break;case 636:if(i.author=r[i.iauthor],delete i.iauthor,e.sheetRows&&i.rfx&&e.sheetRows<=i.rfx.r)break;i.t||(i.t=""),delete i.rfx,t.push(i);break;case 3072:break;case 35:s=!0;break;case 36:s=!1;break;case 37:break;case 38:break;default:if(!c.T){if(!s||e.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}}),t}var b9="application/vnd.ms-office.vbaProject";function I9(n){var e=Qe.utils.cfb_new({root:"R"});return n.FullPaths.forEach(function(t,r){if(!(t.slice(-1)==="/"||!t.match(/_VBA_PROJECT_CUR/))){var i=t.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");Qe.utils.cfb_add(e,i,n.FileIndex[r].content)}}),Qe.write(e)}function A9(){return{"!type":"dialog"}}function S9(){return{"!type":"dialog"}}function k9(){return{"!type":"macro"}}function C9(){return{"!type":"macro"}}var mo=(function(){var n=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,e={r:0,c:0};function t(r,i,s,a){var o=!1,c=!1;s.length==0?c=!0:s.charAt(0)=="["&&(c=!0,s=s.slice(1,-1)),a.length==0?o=!0:a.charAt(0)=="["&&(o=!0,a=a.slice(1,-1));var l=s.length>0?parseInt(s,10)|0:0,u=a.length>0?parseInt(a,10)|0:0;return o?u+=e.c:--u,c?l+=e.r:--l,i+(o?"":"$")+Xt(u)+(c?"":"$")+fn(l)}return function(i,s){return e=s,i.replace(n,t)}})(),F2=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,R9=(function(){return function(e,t){return e.replace(F2,function(r,i,s,a,o,c){var l=Em(a)-(s?0:t.c),u=vm(c)-(o?0:t.r),h=u==0?"":o?u+1:"["+u+"]",d=l==0?"":s?l+1:"["+l+"]";return i+"R"+h+"C"+d})}})();function O2(n,e){return n.replace(F2,function(t,r,i,s,a,o){return r+(i=="$"?i+s:Xt(Em(s)+e.c))+(a=="$"?a+o:fn(vm(o)+e.r))})}function P9(n,e,t){var r=nc(e),i=r.s,s=Ln(t),a={r:s.r-i.r,c:s.c-i.c};return O2(n,a)}function D9(n){return n.length!=1}function Cv(n){return n.replace(/_xlfn\./g,"")}function Bt(n){n.l+=1}function Es(n,e){var t=n.read_shift(2);return[t&16383,t>>14&1,t>>15&1]}function M2(n,e,t){var r=2;if(t){if(t.biff>=2&&t.biff<=5)return L2(n);t.biff==12&&(r=4)}var i=n.read_shift(r),s=n.read_shift(r),a=Es(n),o=Es(n);return{s:{r:i,c:a[0],cRel:a[1],rRel:a[2]},e:{r:s,c:o[0],cRel:o[1],rRel:o[2]}}}function L2(n){var e=Es(n),t=Es(n),r=n.read_shift(1),i=n.read_shift(1);return{s:{r:e[0],c:r,cRel:e[1],rRel:e[2]},e:{r:t[0],c:i,cRel:t[1],rRel:t[2]}}}function F9(n,e,t){if(t.biff<8)return L2(n);var r=n.read_shift(t.biff==12?4:2),i=n.read_shift(t.biff==12?4:2),s=Es(n),a=Es(n);return{s:{r,c:s[0],cRel:s[1],rRel:s[2]},e:{r:i,c:a[0],cRel:a[1],rRel:a[2]}}}function N2(n,e,t){if(t&&t.biff>=2&&t.biff<=5)return O9(n);var r=n.read_shift(t&&t.biff==12?4:2),i=Es(n);return{r,c:i[0],cRel:i[1],rRel:i[2]}}function O9(n){var e=Es(n),t=n.read_shift(1);return{r:e[0],c:t,cRel:e[1],rRel:e[2]}}function M9(n){var e=n.read_shift(2),t=n.read_shift(2);return{r:e,c:t&255,fQuoted:!!(t&16384),cRel:t>>15,rRel:t>>15}}function L9(n,e,t){var r=t&&t.biff?t.biff:8;if(r>=2&&r<=5)return N9(n);var i=n.read_shift(r>=12?4:2),s=n.read_shift(2),a=(s&16384)>>14,o=(s&32768)>>15;if(s&=16383,o==1)for(;i>524287;)i-=1048576;if(a==1)for(;s>8191;)s=s-16384;return{r:i,c:s,cRel:a,rRel:o}}function N9(n){var e=n.read_shift(2),t=n.read_shift(1),r=(e&32768)>>15,i=(e&16384)>>14;return e&=16383,r==1&&e>=8192&&(e=e-16384),i==1&&t>=128&&(t=t-256),{r:e,c:t,cRel:i,rRel:r}}function V9(n,e,t){var r=(n[n.l++]&96)>>5,i=M2(n,t.biff>=2&&t.biff<=5?6:8,t);return[r,i]}function B9(n,e,t){var r=(n[n.l++]&96)>>5,i=n.read_shift(2,"i"),s=8;if(t)switch(t.biff){case 5:n.l+=12,s=6;break;case 12:s=12;break}var a=M2(n,s,t);return[r,i,a]}function U9(n,e,t){var r=(n[n.l++]&96)>>5;return n.l+=t&&t.biff>8?12:t.biff<8?6:8,[r]}function H9(n,e,t){var r=(n[n.l++]&96)>>5,i=n.read_shift(2),s=8;if(t)switch(t.biff){case 5:n.l+=12,s=6;break;case 12:s=12;break}return n.l+=s,[r,i]}function z9(n,e,t){var r=(n[n.l++]&96)>>5,i=F9(n,e-1,t);return[r,i]}function $9(n,e,t){var r=(n[n.l++]&96)>>5;return n.l+=t.biff==2?6:t.biff==12?14:7,[r]}function Rv(n){var e=n[n.l+1]&1,t=1;return n.l+=4,[e,t]}function W9(n,e,t){n.l+=2;for(var r=n.read_shift(t&&t.biff==2?1:2),i=[],s=0;s<=r;++s)i.push(n.read_shift(t&&t.biff==2?1:2));return i}function j9(n,e,t){var r=n[n.l+1]&255?1:0;return n.l+=2,[r,n.read_shift(t&&t.biff==2?1:2)]}function G9(n,e,t){var r=n[n.l+1]&255?1:0;return n.l+=2,[r,n.read_shift(t&&t.biff==2?1:2)]}function q9(n){var e=n[n.l+1]&255?1:0;return n.l+=2,[e,n.read_shift(2)]}function K9(n,e,t){var r=n[n.l+1]&255?1:0;return n.l+=t&&t.biff==2?3:4,[r]}function V2(n){var e=n.read_shift(1),t=n.read_shift(1);return[e,t]}function Y9(n){return n.read_shift(2),V2(n)}function X9(n){return n.read_shift(2),V2(n)}function Q9(n,e,t){var r=(n[n.l]&96)>>5;n.l+=1;var i=N2(n,0,t);return[r,i]}function J9(n,e,t){var r=(n[n.l]&96)>>5;n.l+=1;var i=L9(n,0,t);return[r,i]}function Z9(n,e,t){var r=(n[n.l]&96)>>5;n.l+=1;var i=n.read_shift(2);t&&t.biff==5&&(n.l+=12);var s=N2(n,0,t);return[r,i,s]}function eU(n,e,t){var r=(n[n.l]&96)>>5;n.l+=1;var i=n.read_shift(t&&t.biff<=3?1:2);return[t7[i],H2[i],r]}function tU(n,e,t){var r=n[n.l++],i=n.read_shift(1),s=t&&t.biff<=3?[r==88?-1:0,n.read_shift(1)]:nU(n);return[i,(s[0]===0?H2:e7)[s[1]]]}function nU(n){return[n[n.l+1]>>7,n.read_shift(2)&32767]}function rU(n,e,t){n.l+=t&&t.biff==2?3:4}function iU(n,e,t){if(n.l++,t&&t.biff==12)return[n.read_shift(4,"i"),0];var r=n.read_shift(2),i=n.read_shift(t&&t.biff==2?1:2);return[r,i]}function sU(n){return n.l++,La[n.read_shift(1)]}function aU(n){return n.l++,n.read_shift(2)}function oU(n){return n.l++,n.read_shift(1)!==0}function cU(n){return n.l++,wn(n)}function lU(n,e,t){return n.l++,vu(n,e-1,t)}function uU(n,e){var t=[n.read_shift(1)];if(e==12)switch(t[0]){case 2:t[0]=4;break;case 4:t[0]=16;break;case 0:t[0]=1;break;case 1:t[0]=2;break}switch(t[0]){case 4:t[1]=Ot(n,1)?"TRUE":"FALSE",e!=12&&(n.l+=7);break;case 37:case 16:t[1]=La[n[n.l]],n.l+=e==12?4:8;break;case 0:n.l+=8;break;case 1:t[1]=wn(n);break;case 2:t[1]=Na(n,0,{biff:e>0&&e<8?2:e});break;default:throw new Error("Bad SerAr: "+t[0])}return t}function hU(n,e,t){for(var r=n.read_shift(t.biff==12?4:2),i=[],s=0;s!=r;++s)i.push((t.biff==12?Ma:pd)(n));return i}function fU(n,e,t){var r=0,i=0;t.biff==12?(r=n.read_shift(4),i=n.read_shift(4)):(i=1+n.read_shift(1),r=1+n.read_shift(2)),t.biff>=2&&t.biff<8&&(--r,--i==0&&(i=256));for(var s=0,a=[];s!=r&&(a[s]=[]);++s)for(var o=0;o!=i;++o)a[s][o]=uU(n,t.biff);return a}function dU(n,e,t){var r=n.read_shift(1)>>>5&3,i=!t||t.biff>=8?4:2,s=n.read_shift(i);switch(t.biff){case 2:n.l+=5;break;case 3:case 4:n.l+=8;break;case 5:n.l+=12;break}return[r,0,s]}function pU(n,e,t){if(t.biff==5)return gU(n);var r=n.read_shift(1)>>>5&3,i=n.read_shift(2),s=n.read_shift(4);return[r,i,s]}function gU(n){var e=n.read_shift(1)>>>5&3,t=n.read_shift(2,"i");n.l+=8;var r=n.read_shift(2);return n.l+=12,[e,t,r]}function mU(n,e,t){var r=n.read_shift(1)>>>5&3;n.l+=t&&t.biff==2?3:4;var i=n.read_shift(t&&t.biff==2?1:2);return[r,i]}function _U(n,e,t){var r=n.read_shift(1)>>>5&3,i=n.read_shift(t&&t.biff==2?1:2);return[r,i]}function xU(n,e,t){var r=n.read_shift(1)>>>5&3;return n.l+=4,t.biff<8&&n.l--,t.biff==12&&(n.l+=2),[r]}function yU(n,e,t){var r=(n[n.l++]&96)>>5,i=n.read_shift(2),s=4;if(t)switch(t.biff){case 5:s=15;break;case 12:s=6;break}return n.l+=s,[r,i]}var vU=Cn,EU=Cn,wU=Cn;function wu(n,e,t){return n.l+=2,[M9(n)]}function Cm(n){return n.l+=6,[]}var TU=wu,bU=Cm,IU=Cm,AU=wu;function B2(n){return n.l+=2,[zt(n),n.read_shift(2)&1]}var SU=wu,kU=B2,CU=Cm,RU=wu,PU=wu,DU=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function FU(n){n.l+=2;var e=n.read_shift(2),t=n.read_shift(2),r=n.read_shift(4),i=n.read_shift(2),s=n.read_shift(2),a=DU[t>>2&31];return{ixti:e,coltype:t&3,rt:a,idx:r,c:i,C:s}}function OU(n){return n.l+=2,[n.read_shift(4)]}function MU(n,e,t){return n.l+=5,n.l+=2,n.l+=t.biff==2?1:4,["PTGSHEET"]}function LU(n,e,t){return n.l+=t.biff==2?4:5,["PTGENDSHEET"]}function NU(n){var e=n.read_shift(1)>>>5&3,t=n.read_shift(2);return[e,t]}function VU(n){var e=n.read_shift(1)>>>5&3,t=n.read_shift(2);return[e,t]}function BU(n){return n.l+=4,[0,0]}var Pv={1:{n:"PtgExp",f:iU},2:{n:"PtgTbl",f:wU},3:{n:"PtgAdd",f:Bt},4:{n:"PtgSub",f:Bt},5:{n:"PtgMul",f:Bt},6:{n:"PtgDiv",f:Bt},7:{n:"PtgPower",f:Bt},8:{n:"PtgConcat",f:Bt},9:{n:"PtgLt",f:Bt},10:{n:"PtgLe",f:Bt},11:{n:"PtgEq",f:Bt},12:{n:"PtgGe",f:Bt},13:{n:"PtgGt",f:Bt},14:{n:"PtgNe",f:Bt},15:{n:"PtgIsect",f:Bt},16:{n:"PtgUnion",f:Bt},17:{n:"PtgRange",f:Bt},18:{n:"PtgUplus",f:Bt},19:{n:"PtgUminus",f:Bt},20:{n:"PtgPercent",f:Bt},21:{n:"PtgParen",f:Bt},22:{n:"PtgMissArg",f:Bt},23:{n:"PtgStr",f:lU},26:{n:"PtgSheet",f:MU},27:{n:"PtgEndSheet",f:LU},28:{n:"PtgErr",f:sU},29:{n:"PtgBool",f:oU},30:{n:"PtgInt",f:aU},31:{n:"PtgNum",f:cU},32:{n:"PtgArray",f:$9},33:{n:"PtgFunc",f:eU},34:{n:"PtgFuncVar",f:tU},35:{n:"PtgName",f:dU},36:{n:"PtgRef",f:Q9},37:{n:"PtgArea",f:V9},38:{n:"PtgMemArea",f:mU},39:{n:"PtgMemErr",f:vU},40:{n:"PtgMemNoMem",f:EU},41:{n:"PtgMemFunc",f:_U},42:{n:"PtgRefErr",f:xU},43:{n:"PtgAreaErr",f:U9},44:{n:"PtgRefN",f:J9},45:{n:"PtgAreaN",f:z9},46:{n:"PtgMemAreaN",f:NU},47:{n:"PtgMemNoMemN",f:VU},57:{n:"PtgNameX",f:pU},58:{n:"PtgRef3d",f:Z9},59:{n:"PtgArea3d",f:B9},60:{n:"PtgRefErr3d",f:yU},61:{n:"PtgAreaErr3d",f:H9},255:{}},UU={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},HU={1:{n:"PtgElfLel",f:B2},2:{n:"PtgElfRw",f:RU},3:{n:"PtgElfCol",f:TU},6:{n:"PtgElfRwV",f:PU},7:{n:"PtgElfColV",f:AU},10:{n:"PtgElfRadical",f:SU},11:{n:"PtgElfRadicalS",f:CU},13:{n:"PtgElfColS",f:bU},15:{n:"PtgElfColSV",f:IU},16:{n:"PtgElfRadicalLel",f:kU},25:{n:"PtgList",f:FU},29:{n:"PtgSxName",f:OU},255:{}},zU={0:{n:"PtgAttrNoop",f:BU},1:{n:"PtgAttrSemi",f:K9},2:{n:"PtgAttrIf",f:G9},4:{n:"PtgAttrChoose",f:W9},8:{n:"PtgAttrGoto",f:j9},16:{n:"PtgAttrSum",f:rU},32:{n:"PtgAttrBaxcel",f:Rv},33:{n:"PtgAttrBaxcel",f:Rv},64:{n:"PtgAttrSpace",f:Y9},65:{n:"PtgAttrSpaceSemi",f:X9},128:{n:"PtgAttrIfError",f:q9},255:{}};function Tu(n,e,t,r){if(r.biff<8)return Cn(n,e);for(var i=n.l+e,s=[],a=0;a!==t.length;++a)switch(t[a][0]){case"PtgArray":t[a][1]=fU(n,0,r),s.push(t[a][1]);break;case"PtgMemArea":t[a][2]=hU(n,t[a][1],r),s.push(t[a][2]);break;case"PtgExp":r&&r.biff==12&&(t[a][1][1]=n.read_shift(4),s.push(t[a][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+t[a][0]}return e=i-n.l,e!==0&&s.push(Cn(n,e)),s}function bu(n,e,t){for(var r=n.l+e,i,s,a=[];r!=n.l;)e=r-n.l,s=n[n.l],i=Pv[s]||Pv[UU[s]],(s===24||s===25)&&(i=(s===24?HU:zU)[n[n.l+1]]),!i||!i.f?Cn(n,e):a.push([i.n,i.f(n,e,t)]);return a}function $U(n){for(var e=[],t=0;t<n.length;++t){for(var r=n[t],i=[],s=0;s<r.length;++s){var a=r[s];a?a[0]===2?i.push('"'+a[1].replace(/"/g,'""')+'"'):i.push(a[1]):i.push("")}e.push(i.join(","))}return e.join(";")}var WU={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function jU(n,e){if(!n&&!(e&&e.biff<=5&&e.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(n)?"'"+n+"'":n}function U2(n,e,t){if(!n)return"SH33TJSERR0";if(t.biff>8&&(!n.XTI||!n.XTI[e]))return n.SheetNames[e];if(!n.XTI)return"SH33TJSERR6";var r=n.XTI[e];if(t.biff<8)return e>1e4&&(e-=65536),e<0&&(e=-e),e==0?"":n.XTI[e-1];if(!r)return"SH33TJSERR1";var i="";if(t.biff>8)switch(n[r[0]][0]){case 357:return i=r[1]==-1?"#REF":n.SheetNames[r[1]],r[1]==r[2]?i:i+":"+n.SheetNames[r[2]];case 358:return t.SID!=null?n.SheetNames[t.SID]:"SH33TJSSAME"+n[r[0]][0];default:return"SH33TJSSRC"+n[r[0]][0]}switch(n[r[0]][0][0]){case 1025:return i=r[1]==-1?"#REF":n.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?i:i+":"+n.SheetNames[r[2]];case 14849:return n[r[0]].slice(1).map(function(s){return s.Name}).join(";;");default:return n[r[0]][0][3]?(i=r[1]==-1?"#REF":n[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?i:i+":"+n[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function Dv(n,e,t){var r=U2(n,e,t);return r=="#REF"?r:jU(r,t)}function vn(n,e,t,r,i){var s=i&&i.biff||8,a={s:{c:0,r:0}},o=[],c,l,u,h=0,d=0,p,g="";if(!n[0]||!n[0][0])return"";for(var m=-1,_="",E=0,I=n[0].length;E<I;++E){var v=n[0][E];switch(v[0]){case"PtgUminus":o.push("-"+o.pop());break;case"PtgUplus":o.push("+"+o.pop());break;case"PtgPercent":o.push(o.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(c=o.pop(),l=o.pop(),m>=0){switch(n[0][m][1][0]){case 0:_=Rt(" ",n[0][m][1][1]);break;case 1:_=Rt("\r",n[0][m][1][1]);break;default:if(_="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+n[0][m][1][0])}l=l+_,m=-1}o.push(l+WU[v[0]]+c);break;case"PtgIsect":c=o.pop(),l=o.pop(),o.push(l+" "+c);break;case"PtgUnion":c=o.pop(),l=o.pop(),o.push(l+","+c);break;case"PtgRange":c=o.pop(),l=o.pop(),o.push(l+":"+c);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":u=al(v[1][1],a,i),o.push(ol(u,s));break;case"PtgRefN":u=t?al(v[1][1],t,i):v[1][1],o.push(ol(u,s));break;case"PtgRef3d":h=v[1][1],u=al(v[1][2],a,i),g=Dv(r,h,i),o.push(g+"!"+ol(u,s));break;case"PtgFunc":case"PtgFuncVar":var R=v[1][0],F=v[1][1];R||(R=0),R&=127;var O=R==0?[]:o.slice(-R);o.length-=R,F==="User"&&(F=O.shift()),o.push(F+"("+O.join(",")+")");break;case"PtgBool":o.push(v[1]?"TRUE":"FALSE");break;case"PtgInt":o.push(v[1]);break;case"PtgNum":o.push(String(v[1]));break;case"PtgStr":o.push('"'+v[1].replace(/"/g,'""')+'"');break;case"PtgErr":o.push(v[1]);break;case"PtgAreaN":p=fv(v[1][1],t?{s:t}:a,i),o.push(h0(p,i));break;case"PtgArea":p=fv(v[1][1],a,i),o.push(h0(p,i));break;case"PtgArea3d":h=v[1][1],p=v[1][2],g=Dv(r,h,i),o.push(g+"!"+h0(p,i));break;case"PtgAttrSum":o.push("SUM("+o.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":d=v[1][2];var y=(r.names||[])[d-1]||(r[0]||[])[d],w=y?y.Name:"SH33TJSNAME"+String(d);w&&w.slice(0,6)=="_xlfn."&&!i.xlfn&&(w=w.slice(6)),o.push(w);break;case"PtgNameX":var T=v[1][1];d=v[1][2];var S;if(i.biff<=5)T<0&&(T=-T),r[T]&&(S=r[T][d]);else{var A="";if(((r[T]||[])[0]||[])[0]==14849||(((r[T]||[])[0]||[])[0]==1025?r[T][d]&&r[T][d].itab>0&&(A=r.SheetNames[r[T][d].itab-1]+"!"):A=r.SheetNames[d-1]+"!"),r[T]&&r[T][d])A+=r[T][d].Name;else if(r[0]&&r[0][d])A+=r[0][d].Name;else{var k=(U2(r,T,i)||"").split(";;");k[d-1]?A=k[d-1]:A+="SH33TJSERRX"}o.push(A);break}S||(S={Name:"SH33TJSERRY"}),o.push(S.Name);break;case"PtgParen":var D="(",oe=")";if(m>=0){switch(_="",n[0][m][1][0]){case 2:D=Rt(" ",n[0][m][1][1])+D;break;case 3:D=Rt("\r",n[0][m][1][1])+D;break;case 4:oe=Rt(" ",n[0][m][1][1])+oe;break;case 5:oe=Rt("\r",n[0][m][1][1])+oe;break;default:if(i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+n[0][m][1][0])}m=-1}o.push(D+o.pop()+oe);break;case"PtgRefErr":o.push("#REF!");break;case"PtgRefErr3d":o.push("#REF!");break;case"PtgExp":u={c:v[1][1],r:v[1][0]};var ie={c:t.c,r:t.r};if(r.sharedf[Me(u)]){var ue=r.sharedf[Me(u)];o.push(vn(ue,a,ie,r,i))}else{var he=!1;for(c=0;c!=r.arrayf.length;++c)if(l=r.arrayf[c],!(u.c<l[0].s.c||u.c>l[0].e.c)&&!(u.r<l[0].s.r||u.r>l[0].e.r)){o.push(vn(l[1],a,ie,r,i)),he=!0;break}he||o.push(v[1])}break;case"PtgArray":o.push("{"+$U(v[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":m=E;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":o.push("");break;case"PtgAreaErr":o.push("#REF!");break;case"PtgAreaErr3d":o.push("#REF!");break;case"PtgList":o.push("Table"+v[1].idx+"[#"+v[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(v));default:throw new Error("Unrecognized Formula Token: "+String(v))}var Oe=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(i.biff!=3&&m>=0&&Oe.indexOf(n[0][E][0])==-1){v=n[0][m];var K=!0;switch(v[1][0]){case 4:K=!1;case 0:_=Rt(" ",v[1][1]);break;case 5:K=!1;case 1:_=Rt("\r",v[1][1]);break;default:if(_="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+v[1][0])}o.push((K?_:"")+o.pop()+(K?"":_)),m=-1}}if(o.length>1&&i.WTF)throw new Error("bad formula stack");return o[0]}function GU(n,e,t){var r=n.l+e,i=t.biff==2?1:2,s,a=n.read_shift(i);if(a==65535)return[[],Cn(n,e-2)];var o=bu(n,a,t);return e!==a+i&&(s=Tu(n,e-a-i,o,t)),n.l=r,[o,s]}function qU(n,e,t){var r=n.l+e,i=t.biff==2?1:2,s,a=n.read_shift(i);if(a==65535)return[[],Cn(n,e-2)];var o=bu(n,a,t);return e!==a+i&&(s=Tu(n,e-a-i,o,t)),n.l=r,[o,s]}function KU(n,e,t,r){var i=n.l+e,s=bu(n,r,t),a;return i!==n.l&&(a=Tu(n,i-n.l,s,t)),[s,a]}function YU(n,e,t){var r=n.l+e,i,s=n.read_shift(2),a=bu(n,s,t);return s==65535?[[],Cn(n,e-2)]:(e!==s+2&&(i=Tu(n,r-s-2,a,t)),[a,i])}function XU(n){var e;if(pi(n,n.l+6)!==65535)return[wn(n),"n"];switch(n[n.l]){case 0:return n.l+=8,["String","s"];case 1:return e=n[n.l+2]===1,n.l+=8,[e,"b"];case 2:return e=n[n.l+2],n.l+=8,[e,"e"];case 3:return n.l+=8,["","s"]}return[]}function p0(n,e,t){var r=n.l+e,i=Jr(n);t.biff==2&&++n.l;var s=XU(n),a=n.read_shift(1);t.biff!=2&&(n.read_shift(1),t.biff>=5&&n.read_shift(4));var o=qU(n,r-n.l,t);return{cell:i,val:s[0],formula:o,shared:a>>3&1,tt:s[1]}}function gd(n,e,t){var r=n.read_shift(4),i=bu(n,r,t),s=n.read_shift(4),a=s>0?Tu(n,s,i,t):null;return[i,a]}var QU=gd,md=gd,JU=gd,ZU=gd,e7={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},H2={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},t7={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Fv(n){return n.slice(0,3)=="of:"&&(n=n.slice(3)),n.charCodeAt(0)==61&&(n=n.slice(1),n.charCodeAt(0)==61&&(n=n.slice(1))),n=n.replace(/COM\.MICROSOFT\./g,""),n=n.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(e,t){return t.replace(/\./g,"")}),n=n.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),n.replace(/[;~]/g,",").replace(/\|/g,";")}function g0(n){var e=n.split(":"),t=e[0].split(".")[0];return[t,e[0].split(".")[1]+(e.length>1?":"+(e[1].split(".")[1]||e[1].split(".")[0]):"")]}var hl={},_o={};function fl(n,e){if(n){var t=[.7,.7,.75,.75,.3,.3];e=="xlml"&&(t=[1,1,1,1,.5,.5]),n.left==null&&(n.left=t[0]),n.right==null&&(n.right=t[1]),n.top==null&&(n.top=t[2]),n.bottom==null&&(n.bottom=t[3]),n.header==null&&(n.header=t[4]),n.footer==null&&(n.footer=t[5])}}function z2(n,e,t,r,i,s){try{r.cellNF&&(n.z=Ne[e])}catch(o){if(r.WTF)throw o}if(!(n.t==="z"&&!r.cellStyles)){if(n.t==="d"&&typeof n.v=="string"&&(n.v=on(n.v)),(!r||r.cellText!==!1)&&n.t!=="z")try{if(Ne[e]==null&&ua(n5[e]||"General",e),n.t==="e")n.w=n.w||La[n.v];else if(e===0)if(n.t==="n")(n.v|0)===n.v?n.w=n.v.toString(10):n.w=zl(n.v);else if(n.t==="d"){var a=Bn(n.v);(a|0)===a?n.w=a.toString(10):n.w=zl(a)}else{if(n.v===void 0)return"";n.w=Aa(n.v,_o)}else n.t==="d"?n.w=ur(e,Bn(n.v),_o):n.w=ur(e,n.v,_o)}catch(o){if(r.WTF)throw o}if(r.cellStyles&&t!=null)try{n.s=s.Fills[t],n.s.fgColor&&n.s.fgColor.theme&&!n.s.fgColor.rgb&&(n.s.fgColor.rgb=Af(i.themeElements.clrScheme[n.s.fgColor.theme].rgb,n.s.fgColor.tint||0),r.WTF&&(n.s.fgColor.raw_rgb=i.themeElements.clrScheme[n.s.fgColor.theme].rgb)),n.s.bgColor&&n.s.bgColor.theme&&(n.s.bgColor.rgb=Af(i.themeElements.clrScheme[n.s.bgColor.theme].rgb,n.s.bgColor.tint||0),r.WTF&&(n.s.bgColor.raw_rgb=i.themeElements.clrScheme[n.s.bgColor.theme].rgb))}catch(o){if(r.WTF&&s.Fills)throw o}}}function n7(n,e){var t=Ft(e);t.s.r<=t.e.r&&t.s.c<=t.e.c&&t.s.r>=0&&t.s.c>=0&&(n["!ref"]=Je(t))}var r7=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,i7=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,s7=/<(?:\w:)?hyperlink [^>]*>/mg,a7=/"(\w*:\w*)"/,o7=/<(?:\w:)?col\b[^>]*[\/]?>/g,c7=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,l7=/<(?:\w:)?pageMargins[^>]*\/>/g,$2=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,u7=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,h7=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function f7(n,e,t,r,i,s,a){if(!n)return n;r||(r={"!id":{}});var o=e.dense?[]:{},c={s:{r:2e6,c:2e6},e:{r:0,c:0}},l="",u="",h=n.match(i7);h?(l=n.slice(0,h.index),u=n.slice(h.index+h[0].length)):l=u=n;var d=l.match($2);d?Rm(d[0],o,i,t):(d=l.match(u7))&&d7(d[0],d[1]||"",o,i,t);var p=(l.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(p>0){var g=l.slice(p,p+50).match(a7);g&&n7(o,g[1])}var m=l.match(h7);m&&m[1]&&y7(m[1],i);var _=[];if(e.cellStyles){var E=l.match(o7);E&&m7(_,E)}h&&v7(h[1],o,e,c,s,a);var I=u.match(c7);I&&(o["!autofilter"]=_7(I[0]));var v=[],R=u.match(r7);if(R)for(p=0;p!=R.length;++p)v[p]=Ft(R[p].slice(R[p].indexOf('"')+1));var F=u.match(s7);F&&p7(o,F,r);var O=u.match(l7);if(O&&(o["!margins"]=g7(Pe(O[0]))),!o["!ref"]&&c.e.c>=c.s.c&&c.e.r>=c.s.r&&(o["!ref"]=Je(c)),e.sheetRows>0&&o["!ref"]){var y=Ft(o["!ref"]);e.sheetRows<=+y.e.r&&(y.e.r=e.sheetRows-1,y.e.r>c.e.r&&(y.e.r=c.e.r),y.e.r<y.s.r&&(y.s.r=y.e.r),y.e.c>c.e.c&&(y.e.c=c.e.c),y.e.c<y.s.c&&(y.s.c=y.e.c),o["!fullref"]=o["!ref"],o["!ref"]=Je(y))}return _.length>0&&(o["!cols"]=_),v.length>0&&(o["!merges"]=v),o}function Rm(n,e,t,r){var i=Pe(n);t.Sheets[r]||(t.Sheets[r]={}),i.codeName&&(t.Sheets[r].CodeName=Ze(dt(i.codeName)))}function d7(n,e,t,r,i){Rm(n.slice(0,n.indexOf(">")),t,r,i)}function p7(n,e,t){for(var r=Array.isArray(n),i=0;i!=e.length;++i){var s=Pe(dt(e[i]),!0);if(!s.ref)return;var a=((t||{})["!id"]||[])[s.id];a?(s.Target=a.Target,s.location&&(s.Target+="#"+Ze(s.location))):(s.Target="#"+Ze(s.location),a={Target:s.Target,TargetMode:"Internal"}),s.Rel=a,s.tooltip&&(s.Tooltip=s.tooltip,delete s.tooltip);for(var o=Ft(s.ref),c=o.s.r;c<=o.e.r;++c)for(var l=o.s.c;l<=o.e.c;++l){var u=Me({c:l,r:c});r?(n[c]||(n[c]=[]),n[c][l]||(n[c][l]={t:"z",v:void 0}),n[c][l].l=s):(n[u]||(n[u]={t:"z",v:void 0}),n[u].l=s)}}}function g7(n){var e={};return["left","right","top","bottom","header","footer"].forEach(function(t){n[t]&&(e[t]=parseFloat(n[t]))}),e}function m7(n,e){for(var t=!1,r=0;r!=e.length;++r){var i=Pe(e[r],!0);i.hidden&&(i.hidden=bt(i.hidden));var s=parseInt(i.min,10)-1,a=parseInt(i.max,10)-1;for(i.outlineLevel&&(i.level=+i.outlineLevel||0),delete i.min,delete i.max,i.width=+i.width,!t&&i.width&&(t=!0,km(i.width)),Wo(i);s<=a;)n[s++]=hn(i)}}function _7(n){var e={ref:(n.match(/ref="([^"]*)"/)||[])[1]};return e}var x7=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function y7(n,e){e.Views||(e.Views=[{}]),(n.match(x7)||[]).forEach(function(t,r){var i=Pe(t);e.Views[r]||(e.Views[r]={}),+i.zoomScale&&(e.Views[r].zoom=+i.zoomScale),bt(i.rightToLeft)&&(e.Views[r].RTL=!0)})}var v7=(function(){var n=/<(?:\w+:)?c[ \/>]/,e=/<\/(?:\w+:)?row>/,t=/r=["']([^"']*)["']/,r=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,i=/ref=["']([^"']*)["']/,s=$l("v"),a=$l("f");return function(c,l,u,h,d,p){for(var g=0,m="",_=[],E=[],I=0,v=0,R=0,F="",O,y,w=0,T=0,S,A,k=0,D=0,oe=Array.isArray(p.CellXf),ie,ue=[],he=[],Oe=Array.isArray(l),K=[],Se={},Ce=!1,z=!!u.sheetStubs,Q=c.split(e),G=0,j=Q.length;G!=j;++G){m=Q[G].trim();var se=m.length;if(se!==0){var ge=0;e:for(g=0;g<se;++g)switch(m[g]){case">":if(m[g-1]!="/"){++g;break e}if(u&&u.cellStyles){if(y=Pe(m.slice(ge,g),!0),w=y.r!=null?parseInt(y.r,10):w+1,T=-1,u.sheetRows&&u.sheetRows<w)continue;Se={},Ce=!1,y.ht&&(Ce=!0,Se.hpt=parseFloat(y.ht),Se.hpx=ql(Se.hpt)),y.hidden=="1"&&(Ce=!0,Se.hidden=!0),y.outlineLevel!=null&&(Ce=!0,Se.level=+y.outlineLevel),Ce&&(K[w-1]=Se)}break;case"<":ge=g;break}if(ge>=g)break;if(y=Pe(m.slice(ge,g),!0),w=y.r!=null?parseInt(y.r,10):w+1,T=-1,!(u.sheetRows&&u.sheetRows<w)){h.s.r>w-1&&(h.s.r=w-1),h.e.r<w-1&&(h.e.r=w-1),u&&u.cellStyles&&(Se={},Ce=!1,y.ht&&(Ce=!0,Se.hpt=parseFloat(y.ht),Se.hpx=ql(Se.hpt)),y.hidden=="1"&&(Ce=!0,Se.hidden=!0),y.outlineLevel!=null&&(Ce=!0,Se.level=+y.outlineLevel),Ce&&(K[w-1]=Se)),_=m.slice(g).split(n);for(var we=0;we!=_.length&&_[we].trim().charAt(0)=="<";++we);for(_=_.slice(we),g=0;g!=_.length;++g)if(m=_[g].trim(),m.length!==0){if(E=m.match(t),I=g,v=0,R=0,m="<c "+(m.slice(0,1)=="<"?">":"")+m,E!=null&&E.length===2){for(I=0,F=E[1],v=0;v!=F.length&&!((R=F.charCodeAt(v)-64)<1||R>26);++v)I=26*I+R;--I,T=I}else++T;for(v=0;v!=m.length&&m.charCodeAt(v)!==62;++v);if(++v,y=Pe(m.slice(0,v),!0),y.r||(y.r=Me({r:w-1,c:T})),F=m.slice(v),O={t:""},(E=F.match(s))!=null&&E[1]!==""&&(O.v=Ze(E[1])),u.cellFormula){if((E=F.match(a))!=null&&E[1]!==""){if(O.f=Ze(dt(E[1])).replace(/\r\n/g,`
`),u.xlfn||(O.f=Cv(O.f)),E[0].indexOf('t="array"')>-1)O.F=(F.match(i)||[])[1],O.F.indexOf(":")>-1&&ue.push([Ft(O.F),O.F]);else if(E[0].indexOf('t="shared"')>-1){A=Pe(E[0]);var me=Ze(dt(E[1]));u.xlfn||(me=Cv(me)),he[parseInt(A.si,10)]=[A,me,y.r]}}else(E=F.match(/<f[^>]*\/>/))&&(A=Pe(E[0]),he[A.si]&&(O.f=P9(he[A.si][1],he[A.si][2],y.r)));var fe=Ln(y.r);for(v=0;v<ue.length;++v)fe.r>=ue[v][0].s.r&&fe.r<=ue[v][0].e.r&&fe.c>=ue[v][0].s.c&&fe.c<=ue[v][0].e.c&&(O.F=ue[v][1])}if(y.t==null&&O.v===void 0)if(O.f||O.F)O.v=0,O.t="n";else if(z)O.t="z";else continue;else O.t=y.t||"n";switch(h.s.c>T&&(h.s.c=T),h.e.c<T&&(h.e.c=T),O.t){case"n":if(O.v==""||O.v==null){if(!z)continue;O.t="z"}else O.v=parseFloat(O.v);break;case"s":if(typeof O.v>"u"){if(!z)continue;O.t="z"}else S=hl[parseInt(O.v,10)],O.v=S.t,O.r=S.r,u.cellHTML&&(O.h=S.h);break;case"str":O.t="s",O.v=O.v!=null?dt(O.v):"",u.cellHTML&&(O.h=_m(O.v));break;case"inlineStr":E=F.match(r),O.t="s",E!=null&&(S=Sm(E[1]))?(O.v=S.t,u.cellHTML&&(O.h=S.h)):O.v="";break;case"b":O.v=bt(O.v);break;case"d":u.cellDates?O.v=on(O.v,1):(O.v=Bn(on(O.v,1)),O.t="n");break;case"e":(!u||u.cellText!==!1)&&(O.w=O.v),O.v=u2[O.v];break}if(k=D=0,ie=null,oe&&y.s!==void 0&&(ie=p.CellXf[y.s],ie!=null&&(ie.numFmtId!=null&&(k=ie.numFmtId),u.cellStyles&&ie.fillId!=null&&(D=ie.fillId))),z2(O,k,D,u,d,p),u.cellDates&&oe&&O.t=="n"&&tc(Ne[k])&&(O.t="d",O.v=dd(O.v)),y.cm&&u.xlmeta){var Ge=(u.xlmeta.Cell||[])[+y.cm-1];Ge&&Ge.type=="XLDAPR"&&(O.D=!0)}if(Oe){var W=Ln(y.r);l[W.r]||(l[W.r]=[]),l[W.r][W.c]=O}else l[y.r]=O}}}}K.length>0&&(l["!rows"]=K)}})();function E7(n,e){var t={},r=n.l+e;t.r=n.read_shift(4),n.l+=4;var i=n.read_shift(2);n.l+=1;var s=n.read_shift(1);return n.l=r,s&7&&(t.level=s&7),s&16&&(t.hidden=!0),s&32&&(t.hpt=i/20),t}var w7=Ma;function T7(){}function b7(n,e){var t={},r=n[n.l];return++n.l,t.above=!(r&64),t.left=!(r&128),n.l+=18,t.name=G5(n),t}function I7(n){var e=hr(n);return[e]}function A7(n){var e=Oa(n);return[e]}function S7(n){var e=hr(n),t=n.read_shift(1);return[e,t,"b"]}function k7(n){var e=Oa(n),t=n.read_shift(1);return[e,t,"b"]}function C7(n){var e=hr(n),t=n.read_shift(1);return[e,t,"e"]}function R7(n){var e=Oa(n),t=n.read_shift(1);return[e,t,"e"]}function P7(n){var e=hr(n),t=n.read_shift(4);return[e,t,"s"]}function D7(n){var e=Oa(n),t=n.read_shift(4);return[e,t,"s"]}function F7(n){var e=hr(n),t=wn(n);return[e,t,"n"]}function W2(n){var e=Oa(n),t=wn(n);return[e,t,"n"]}function O7(n){var e=hr(n),t=bm(n);return[e,t,"n"]}function M7(n){var e=Oa(n),t=bm(n);return[e,t,"n"]}function L7(n){var e=hr(n),t=wm(n);return[e,t,"is"]}function N7(n){var e=hr(n),t=Sn(n);return[e,t,"str"]}function V7(n){var e=Oa(n),t=Sn(n);return[e,t,"str"]}function B7(n,e,t){var r=n.l+e,i=hr(n);i.r=t["!row"];var s=n.read_shift(1),a=[i,s,"b"];if(t.cellFormula){n.l+=2;var o=md(n,r-n.l,t);a[3]=vn(o,null,i,t.supbooks,t)}else n.l=r;return a}function U7(n,e,t){var r=n.l+e,i=hr(n);i.r=t["!row"];var s=n.read_shift(1),a=[i,s,"e"];if(t.cellFormula){n.l+=2;var o=md(n,r-n.l,t);a[3]=vn(o,null,i,t.supbooks,t)}else n.l=r;return a}function H7(n,e,t){var r=n.l+e,i=hr(n);i.r=t["!row"];var s=wn(n),a=[i,s,"n"];if(t.cellFormula){n.l+=2;var o=md(n,r-n.l,t);a[3]=vn(o,null,i,t.supbooks,t)}else n.l=r;return a}function z7(n,e,t){var r=n.l+e,i=hr(n);i.r=t["!row"];var s=Sn(n),a=[i,s,"str"];if(t.cellFormula){n.l+=2;var o=md(n,r-n.l,t);a[3]=vn(o,null,i,t.supbooks,t)}else n.l=r;return a}var $7=Ma;function W7(n,e){var t=n.l+e,r=Ma(n),i=Tm(n),s=Sn(n),a=Sn(n),o=Sn(n);n.l=t;var c={rfx:r,relId:i,loc:s,display:o};return a&&(c.Tooltip=a),c}function j7(){}function G7(n,e,t){var r=n.l+e,i=o2(n),s=n.read_shift(1),a=[i];if(a[2]=s,t.cellFormula){var o=QU(n,r-n.l,t);a[1]=o}else n.l=r;return a}function q7(n,e,t){var r=n.l+e,i=Ma(n),s=[i];if(t.cellFormula){var a=ZU(n,r-n.l,t);s[1]=a,n.l=r}else n.l=r;return s}var K7=["left","right","top","bottom","header","footer"];function Y7(n){var e={};return K7.forEach(function(t){e[t]=wn(n)}),e}function X7(n){var e=n.read_shift(2);return n.l+=28,{RTL:e&32}}function Q7(){}function J7(){}function Z7(n,e,t,r,i,s,a){if(!n)return n;var o=e||{};r||(r={"!id":{}});var c=o.dense?[]:{},l,u={s:{r:2e6,c:2e6},e:{r:0,c:0}},h=!1,d=!1,p,g,m,_,E,I,v,R,F,O=[];o.biff=12,o["!row"]=0;var y=0,w=!1,T=[],S={},A=o.supbooks||i.supbooks||[[]];if(A.sharedf=S,A.arrayf=T,A.SheetNames=i.SheetNames||i.Sheets.map(function(Oe){return Oe.name}),!o.supbooks&&(o.supbooks=A,i.Names))for(var k=0;k<i.Names.length;++k)A[0][k+1]=i.Names[k];var D=[],oe=[],ie=!1;Cf[16]={n:"BrtShortReal",f:W2};var ue;if(Pi(n,function(K,Se,Ce){if(!d)switch(Ce){case 148:l=K;break;case 0:p=K,o.sheetRows&&o.sheetRows<=p.r&&(d=!0),R=fn(_=p.r),o["!row"]=p.r,(K.hidden||K.hpt||K.level!=null)&&(K.hpt&&(K.hpx=ql(K.hpt)),oe[K.r]=K);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(g={t:K[2]},K[2]){case"n":g.v=K[1];break;case"s":v=hl[K[1]],g.v=v.t,g.r=v.r;break;case"b":g.v=!!K[1];break;case"e":g.v=K[1],o.cellText!==!1&&(g.w=La[g.v]);break;case"str":g.t="s",g.v=K[1];break;case"is":g.t="s",g.v=K[1].t;break}if((m=a.CellXf[K[0].iStyleRef])&&z2(g,m.numFmtId,null,o,s,a),E=K[0].c==-1?E+1:K[0].c,o.dense?(c[_]||(c[_]=[]),c[_][E]=g):c[Xt(E)+R]=g,o.cellFormula){for(w=!1,y=0;y<T.length;++y){var z=T[y];p.r>=z[0].s.r&&p.r<=z[0].e.r&&E>=z[0].s.c&&E<=z[0].e.c&&(g.F=Je(z[0]),w=!0)}!w&&K.length>3&&(g.f=K[3])}if(u.s.r>p.r&&(u.s.r=p.r),u.s.c>E&&(u.s.c=E),u.e.r<p.r&&(u.e.r=p.r),u.e.c<E&&(u.e.c=E),o.cellDates&&m&&g.t=="n"&&tc(Ne[m.numFmtId])){var Q=na(g.v);Q&&(g.t="d",g.v=new Date(Q.y,Q.m-1,Q.d,Q.H,Q.M,Q.S,Q.u))}ue&&(ue.type=="XLDAPR"&&(g.D=!0),ue=void 0);break;case 1:case 12:if(!o.sheetStubs||h)break;g={t:"z",v:void 0},E=K[0].c==-1?E+1:K[0].c,o.dense?(c[_]||(c[_]=[]),c[_][E]=g):c[Xt(E)+R]=g,u.s.r>p.r&&(u.s.r=p.r),u.s.c>E&&(u.s.c=E),u.e.r<p.r&&(u.e.r=p.r),u.e.c<E&&(u.e.c=E),ue&&(ue.type=="XLDAPR"&&(g.D=!0),ue=void 0);break;case 176:O.push(K);break;case 49:ue=((o.xlmeta||{}).Cell||[])[K-1];break;case 494:var G=r["!id"][K.relId];for(G?(K.Target=G.Target,K.loc&&(K.Target+="#"+K.loc),K.Rel=G):K.relId==""&&(K.Target="#"+K.loc),_=K.rfx.s.r;_<=K.rfx.e.r;++_)for(E=K.rfx.s.c;E<=K.rfx.e.c;++E)o.dense?(c[_]||(c[_]=[]),c[_][E]||(c[_][E]={t:"z",v:void 0}),c[_][E].l=K):(I=Me({c:E,r:_}),c[I]||(c[I]={t:"z",v:void 0}),c[I].l=K);break;case 426:if(!o.cellFormula)break;T.push(K),F=o.dense?c[_][E]:c[Xt(E)+R],F.f=vn(K[1],u,{r:p.r,c:E},A,o),F.F=Je(K[0]);break;case 427:if(!o.cellFormula)break;S[Me(K[0].s)]=K[1],F=o.dense?c[_][E]:c[Xt(E)+R],F.f=vn(K[1],u,{r:p.r,c:E},A,o);break;case 60:if(!o.cellStyles)break;for(;K.e>=K.s;)D[K.e--]={width:K.w/256,hidden:!!(K.flags&1),level:K.level},ie||(ie=!0,km(K.w/256)),Wo(D[K.e+1]);break;case 161:c["!autofilter"]={ref:Je(K)};break;case 476:c["!margins"]=K;break;case 147:i.Sheets[t]||(i.Sheets[t]={}),K.name&&(i.Sheets[t].CodeName=K.name),(K.above||K.left)&&(c["!outline"]={above:K.above,left:K.left});break;case 137:i.Views||(i.Views=[{}]),i.Views[0]||(i.Views[0]={}),K.RTL&&(i.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:h=!0;break;case 36:h=!1;break;case 37:h=!0;break;case 38:h=!1;break;default:if(!Se.T){if(!h||o.WTF)throw new Error("Unexpected record 0x"+Ce.toString(16))}}},o),delete o.supbooks,delete o["!row"],!c["!ref"]&&(u.s.r<2e6||l&&(l.e.r>0||l.e.c>0||l.s.r>0||l.s.c>0))&&(c["!ref"]=Je(l||u)),o.sheetRows&&c["!ref"]){var he=Ft(c["!ref"]);o.sheetRows<=+he.e.r&&(he.e.r=o.sheetRows-1,he.e.r>u.e.r&&(he.e.r=u.e.r),he.e.r<he.s.r&&(he.s.r=he.e.r),he.e.c>u.e.c&&(he.e.c=u.e.c),he.e.c<he.s.c&&(he.s.c=he.e.c),c["!fullref"]=c["!ref"],c["!ref"]=Je(he))}return O.length>0&&(c["!merges"]=O),D.length>0&&(c["!cols"]=D),oe.length>0&&(c["!rows"]=oe),c}function eH(n){var e=[],t=n.match(/^<c:numCache>/),r;(n.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(s){var a=s.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);a&&(e[+a[1]]=t?+a[2]:a[2])});var i=Ze((n.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(n.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(s){r=s.replace(/<.*?>/g,"")}),[e,i,r]}function tH(n,e,t,r,i,s){var a=s||{"!type":"chart"};if(!n)return s;var o=0,c=0,l="A",u={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(n.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(h){var d=eH(h);u.s.r=u.s.c=0,u.e.c=o,l=Xt(o),d[0].forEach(function(p,g){a[l+fn(g)]={t:"n",v:p,z:d[1]},c=g}),u.e.r<c&&(u.e.r=c),++o}),o>0&&(a["!ref"]=Je(u)),a}function nH(n,e,t,r,i){if(!n)return n;r||(r={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},a,o=n.match($2);return o&&Rm(o[0],s,i,t),(a=n.match(/drawing r:id="(.*?)"/))&&(s["!rel"]=a[1]),r["!id"][s["!rel"]]&&(s["!drawel"]=r["!id"][s["!rel"]]),s}function rH(n,e){n.l+=10;var t=Sn(n);return{name:t}}function iH(n,e,t,r,i){if(!n)return n;r||(r={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},a=!1;return Pi(n,function(c,l,u){switch(u){case 550:s["!rel"]=c;break;case 651:i.Sheets[t]||(i.Sheets[t]={}),c.name&&(i.Sheets[t].CodeName=c.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:a=!0;break;case 36:a=!1;break;case 37:break;case 38:break;default:if(!(l.T>0)){if(!(l.T<0)){if(!a||e.WTF)throw new Error("Unexpected record 0x"+u.toString(16))}}}},e),r["!id"][s["!rel"]]&&(s["!drawel"]=r["!id"][s["!rel"]]),s}var j2=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],sH=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],aH=[],oH=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function Ov(n,e){for(var t=0;t!=n.length;++t)for(var r=n[t],i=0;i!=e.length;++i){var s=e[i];if(r[s[0]]==null)r[s[0]]=s[1];else switch(s[2]){case"bool":typeof r[s[0]]=="string"&&(r[s[0]]=bt(r[s[0]]));break;case"int":typeof r[s[0]]=="string"&&(r[s[0]]=parseInt(r[s[0]],10));break}}}function Mv(n,e){for(var t=0;t!=e.length;++t){var r=e[t];if(n[r[0]]==null)n[r[0]]=r[1];else switch(r[2]){case"bool":typeof n[r[0]]=="string"&&(n[r[0]]=bt(n[r[0]]));break;case"int":typeof n[r[0]]=="string"&&(n[r[0]]=parseInt(n[r[0]],10));break}}}function G2(n){Mv(n.WBProps,j2),Mv(n.CalcPr,oH),Ov(n.WBView,sH),Ov(n.Sheets,aH),_o.date1904=bt(n.WBProps.date1904)}var cH="][*?/\\".split("");function lH(n,e){if(n.length>31)throw new Error("Sheet names cannot exceed 31 chars");var t=!0;return cH.forEach(function(r){if(n.indexOf(r)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),t}var uH=/<\w+:workbook/;function hH(n,e){if(!n)throw new Error("Could not find file");var t={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},r=!1,i="xmlns",s={},a=0;if(n.replace(Rn,function(c,l){var u=Pe(c);switch(Qr(u[0])){case"<?xml":break;case"<workbook":c.match(uH)&&(i="xmlns"+c.match(/<(\w+):/)[1]),t.xmlns=u[i];break;case"</workbook>":break;case"<fileVersion":delete u[0],t.AppVersion=u;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":j2.forEach(function(h){if(u[h[0]]!=null)switch(h[2]){case"bool":t.WBProps[h[0]]=bt(u[h[0]]);break;case"int":t.WBProps[h[0]]=parseInt(u[h[0]],10);break;default:t.WBProps[h[0]]=u[h[0]]}}),u.codeName&&(t.WBProps.CodeName=dt(u.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete u[0],t.WBView.push(u);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(u.state){case"hidden":u.Hidden=1;break;case"veryHidden":u.Hidden=2;break;default:u.Hidden=0}delete u.state,u.name=Ze(dt(u.name)),delete u[0],t.Sheets.push(u);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":r=!0;break;case"</definedNames>":r=!1;break;case"<definedName":s={},s.Name=dt(u.name),u.comment&&(s.Comment=u.comment),u.localSheetId&&(s.Sheet=+u.localSheetId),bt(u.hidden||"0")&&(s.Hidden=!0),a=l+c.length;break;case"</definedName>":s.Ref=Ze(dt(n.slice(a,l))),t.Names.push(s);break;case"<definedName/>":break;case"<calcPr":delete u[0],t.CalcPr=u;break;case"<calcPr/>":delete u[0],t.CalcPr=u;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":r=!0;break;case"</ext>":r=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":r=!0;break;case"</AlternateContent>":r=!1;break;case"<revisionPtr":break;default:if(!r&&e.WTF)throw new Error("unrecognized "+u[0]+" in workbook")}return c}),C5.indexOf(t.xmlns)===-1)throw new Error("Unknown Namespace: "+t.xmlns);return G2(t),t}function fH(n,e){var t={};return t.Hidden=n.read_shift(4),t.iTabID=n.read_shift(4),t.strRelID=mp(n),t.name=Sn(n),t}function dH(n,e){var t={},r=n.read_shift(4);t.defaultThemeVersion=n.read_shift(4);var i=e>8?Sn(n):"";return i.length>0&&(t.CodeName=i),t.autoCompressPictures=!!(r&65536),t.backupFile=!!(r&64),t.checkCompatibility=!!(r&4096),t.date1904=!!(r&1),t.filterPrivacy=!!(r&8),t.hidePivotFieldList=!!(r&1024),t.promptedSolutions=!!(r&16),t.publishItems=!!(r&2048),t.refreshAllConnections=!!(r&262144),t.saveExternalLinkValues=!!(r&128),t.showBorderUnselectedTables=!!(r&4),t.showInkAnnotation=!!(r&32),t.showObjects=["all","placeholders","none"][r>>13&3],t.showPivotChartFilter=!!(r&32768),t.updateLinks=["userSet","never","always"][r>>8&3],t}function pH(n,e){var t={};return n.read_shift(4),t.ArchID=n.read_shift(4),n.l+=e-8,t}function gH(n,e,t){var r=n.l+e;n.l+=4,n.l+=1;var i=n.read_shift(4),s=q5(n),a=JU(n,0,t),o=Tm(n);n.l=r;var c={Name:s,Ptg:a};return i<268435455&&(c.Sheet=i),o&&(c.Comment=o),c}function mH(n,e){var t={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},r=[],i=!1;e||(e={}),e.biff=12;var s=[],a=[[]];return a.SheetNames=[],a.XTI=[],Cf[16]={n:"BrtFRTArchID$",f:pH},Pi(n,function(c,l,u){switch(u){case 156:a.SheetNames.push(c.name),t.Sheets.push(c);break;case 153:t.WBProps=c;break;case 39:c.Sheet!=null&&(e.SID=c.Sheet),c.Ref=vn(c.Ptg,null,null,a,e),delete e.SID,delete c.Ptg,s.push(c);break;case 1036:break;case 357:case 358:case 355:case 667:a[0].length?a.push([u,c]):a[0]=[u,c],a[a.length-1].XTI=[];break;case 362:a.length===0&&(a[0]=[],a[0].XTI=[]),a[a.length-1].XTI=a[a.length-1].XTI.concat(c),a.XTI=a.XTI.concat(c);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:r.push(u),i=!0;break;case 36:r.pop(),i=!1;break;case 37:r.push(u),i=!0;break;case 38:r.pop(),i=!1;break;case 16:break;default:if(!l.T){if(!i||e.WTF&&r[r.length-1]!=37&&r[r.length-1]!=35)throw new Error("Unexpected record 0x"+u.toString(16))}}},e),G2(t),t.Names=s,t.supbooks=a,t}function _H(n,e,t){return e.slice(-4)===".bin"?mH(n,t):hH(n,t)}function xH(n,e,t,r,i,s,a,o){return e.slice(-4)===".bin"?Z7(n,r,t,i,s,a,o):f7(n,r,t,i,s,a,o)}function yH(n,e,t,r,i,s,a,o){return e.slice(-4)===".bin"?iH(n,r,t,i,s):nH(n,r,t,i,s)}function vH(n,e,t,r,i,s,a,o){return e.slice(-4)===".bin"?k9():C9()}function EH(n,e,t,r,i,s,a,o){return e.slice(-4)===".bin"?A9():S9()}function wH(n,e,t,r){return e.slice(-4)===".bin"?$8(n,t,r):N8(n,t,r)}function TH(n,e,t){return D2(n,t)}function bH(n,e,t){return e.slice(-4)===".bin"?s8(n,t):r8(n,t)}function IH(n,e,t){return e.slice(-4)===".bin"?T9(n,t):x9(n,t)}function AH(n,e,t){return e.slice(-4)===".bin"?g9(n):d9(n)}function SH(n,e,t,r){return t.slice(-4)===".bin"?m9(n,e,t,r):void 0}function kH(n,e,t){return e.slice(-4)===".bin"?h9(n,e,t):f9(n,e,t)}var q2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,K2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function mr(n,e){var t=n.split(/\s+/),r=[];if(r[0]=t[0],t.length===1)return r;var i=n.match(q2),s,a,o,c;if(i)for(c=0;c!=i.length;++c)s=i[c].match(K2),(a=s[1].indexOf(":"))===-1?r[s[1]]=s[2].slice(1,s[2].length-1):(s[1].slice(0,6)==="xmlns:"?o="xmlns"+s[1].slice(6):o=s[1].slice(a+1),r[o]=s[2].slice(1,s[2].length-1));return r}function CH(n){var e=n.split(/\s+/),t={};if(e.length===1)return t;var r=n.match(q2),i,s,a,o;if(r)for(o=0;o!=r.length;++o)i=r[o].match(K2),(s=i[1].indexOf(":"))===-1?t[i[1]]=i[2].slice(1,i[2].length-1):(i[1].slice(0,6)==="xmlns:"?a="xmlns"+i[1].slice(6):a=i[1].slice(s+1),t[a]=i[2].slice(1,i[2].length-1));return t}var dl;function RH(n,e){var t=dl[n]||Ze(n);return t==="General"?Aa(e):ur(t,e)}function PH(n,e,t,r){var i=r;switch((t[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":i=bt(r);break;case"i2":case"int":i=parseInt(r,10);break;case"r4":case"float":i=parseFloat(r);break;case"date":case"dateTime.tz":i=on(r);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+t[0])}n[Ze(e)]=i}function DH(n,e,t){if(n.t!=="z"){if(!t||t.cellText!==!1)try{n.t==="e"?n.w=n.w||La[n.v]:e==="General"?n.t==="n"?(n.v|0)===n.v?n.w=n.v.toString(10):n.w=zl(n.v):n.w=Aa(n.v):n.w=RH(e||"General",n.v)}catch(s){if(t.WTF)throw s}try{var r=dl[e]||e||"General";if(t.cellNF&&(n.z=r),t.cellDates&&n.t=="n"&&tc(r)){var i=na(n.v);i&&(n.t="d",n.v=new Date(i.y,i.m-1,i.d,i.H,i.M,i.S,i.u))}}catch(s){if(t.WTF)throw s}}}function FH(n,e,t){if(t.cellStyles&&e.Interior){var r=e.Interior;r.Pattern&&(r.patternType=P8[r.Pattern]||r.Pattern)}n[e.ID]=e}function OH(n,e,t,r,i,s,a,o,c,l){var u="General",h=r.StyleID,d={};l=l||{};var p=[],g=0;for(h===void 0&&o&&(h=o.StyleID),h===void 0&&a&&(h=a.StyleID);s[h]!==void 0&&(s[h].nf&&(u=s[h].nf),s[h].Interior&&p.push(s[h].Interior),!!s[h].Parent);)h=s[h].Parent;switch(t.Type){case"Boolean":r.t="b",r.v=bt(n);break;case"String":r.t="s",r.r=rv(Ze(n)),r.v=n.indexOf("<")>-1?Ze(e||n).replace(/<.*?>/g,""):r.r;break;case"DateTime":n.slice(-1)!="Z"&&(n+="Z"),r.v=(on(n)-new Date(Date.UTC(1899,11,30)))/(1440*60*1e3),r.v!==r.v?r.v=Ze(n):r.v<60&&(r.v=r.v-1),(!u||u=="General")&&(u="yyyy-mm-dd");case"Number":r.v===void 0&&(r.v=+n),r.t||(r.t="n");break;case"Error":r.t="e",r.v=u2[n],l.cellText!==!1&&(r.w=n);break;default:n==""&&e==""?r.t="z":(r.t="s",r.v=rv(e||n));break}if(DH(r,u,l),l.cellFormula!==!1)if(r.Formula){var m=Ze(r.Formula);m.charCodeAt(0)==61&&(m=m.slice(1)),r.f=mo(m,i),delete r.Formula,r.ArrayRange=="RC"?r.F=mo("RC:RC",i):r.ArrayRange&&(r.F=mo(r.ArrayRange,i),c.push([Ft(r.F),r.F]))}else for(g=0;g<c.length;++g)i.r>=c[g][0].s.r&&i.r<=c[g][0].e.r&&i.c>=c[g][0].s.c&&i.c<=c[g][0].e.c&&(r.F=c[g][1]);l.cellStyles&&(p.forEach(function(_){!d.patternType&&_.patternType&&(d.patternType=_.patternType)}),r.s=d),r.StyleID!==void 0&&(r.ixfe=r.StyleID)}function MH(n){n.t=n.v||"",n.t=n.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),n.v=n.w=n.ixfe=void 0}function m0(n,e){var t=e||{};LI();var r=Uc(xm(n));(t.type=="binary"||t.type=="array"||t.type=="base64")&&(r=dt(r));var i=r.slice(0,1024).toLowerCase(),s=!1;if(i=i.replace(/".*?"/g,""),(i.indexOf(">")&1023)>Math.min(i.indexOf(",")&1023,i.indexOf(";")&1023)){var a=hn(t);return a.type="string",jl.to_workbook(r,a)}if(i.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(Et){i.indexOf("<"+Et)>=0&&(s=!0)}),s)return WH(r,t);dl={"General Number":"General","General Date":Ne[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":Ne[15],"Short Date":Ne[14],"Long Time":Ne[19],"Medium Time":Ne[18],"Short Time":Ne[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Ne[2],Standard:Ne[4],Percent:Ne[10],Scientific:Ne[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var o,c=[],l,u={},h=[],d=t.dense?[]:{},p="",g={},m={},_=mr('<Data ss:Type="String">'),E=0,I=0,v=0,R={s:{r:2e6,c:2e6},e:{r:0,c:0}},F={},O={},y="",w=0,T=[],S={},A={},k=0,D=[],oe=[],ie={},ue=[],he,Oe=!1,K=[],Se=[],Ce={},z=0,Q=0,G={Sheets:[],WBProps:{date1904:!1}},j={};Wl.lastIndex=0,r=r.replace(/<!--([\s\S]*?)-->/mg,"");for(var se="";o=Wl.exec(r);)switch(o[3]=(se=o[3]).toLowerCase()){case"data":if(se=="data"){if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&c.push([o[3],!0]);break}if(c[c.length-1][1])break;o[1]==="/"?OH(r.slice(E,o.index),y,_,c[c.length-1][0]=="comment"?ie:g,{c:I,r:v},F,ue[I],m,K,t):(y="",_=mr(o[0]),E=o.index+o[0].length);break;case"cell":if(o[1]==="/")if(oe.length>0&&(g.c=oe),(!t.sheetRows||t.sheetRows>v)&&g.v!==void 0&&(t.dense?(d[v]||(d[v]=[]),d[v][I]=g):d[Xt(I)+fn(v)]=g),g.HRef&&(g.l={Target:Ze(g.HRef)},g.HRefScreenTip&&(g.l.Tooltip=g.HRefScreenTip),delete g.HRef,delete g.HRefScreenTip),(g.MergeAcross||g.MergeDown)&&(z=I+(parseInt(g.MergeAcross,10)|0),Q=v+(parseInt(g.MergeDown,10)|0),T.push({s:{c:I,r:v},e:{c:z,r:Q}})),!t.sheetStubs)g.MergeAcross?I=z+1:++I;else if(g.MergeAcross||g.MergeDown){for(var ge=I;ge<=z;++ge)for(var we=v;we<=Q;++we)(ge>I||we>v)&&(t.dense?(d[we]||(d[we]=[]),d[we][ge]={t:"z"}):d[Xt(ge)+fn(we)]={t:"z"});I=z+1}else++I;else g=CH(o[0]),g.Index&&(I=+g.Index-1),I<R.s.c&&(R.s.c=I),I>R.e.c&&(R.e.c=I),o[0].slice(-2)==="/>"&&++I,oe=[];break;case"row":o[1]==="/"||o[0].slice(-2)==="/>"?(v<R.s.r&&(R.s.r=v),v>R.e.r&&(R.e.r=v),o[0].slice(-2)==="/>"&&(m=mr(o[0]),m.Index&&(v=+m.Index-1)),I=0,++v):(m=mr(o[0]),m.Index&&(v=+m.Index-1),Ce={},(m.AutoFitHeight=="0"||m.Height)&&(Ce.hpx=parseInt(m.Height,10),Ce.hpt=P2(Ce.hpx),Se[v]=Ce),m.Hidden=="1"&&(Ce.hidden=!0,Se[v]=Ce));break;case"worksheet":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"));h.push(p),R.s.r<=R.e.r&&R.s.c<=R.e.c&&(d["!ref"]=Je(R),t.sheetRows&&t.sheetRows<=R.e.r&&(d["!fullref"]=d["!ref"],R.e.r=t.sheetRows-1,d["!ref"]=Je(R))),T.length&&(d["!merges"]=T),ue.length>0&&(d["!cols"]=ue),Se.length>0&&(d["!rows"]=Se),u[p]=d}else R={s:{r:2e6,c:2e6},e:{r:0,c:0}},v=I=0,c.push([o[3],!1]),l=mr(o[0]),p=Ze(l.Name),d=t.dense?[]:{},T=[],K=[],Se=[],j={name:p,Hidden:0},G.Sheets.push(j);break;case"table":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"))}else{if(o[0].slice(-2)=="/>")break;c.push([o[3],!1]),ue=[],Oe=!1}break;case"style":o[1]==="/"?FH(F,O,t):O=mr(o[0]);break;case"numberformat":O.nf=Ze(mr(o[0]).Format||"General"),dl[O.nf]&&(O.nf=dl[O.nf]);for(var me=0;me!=392&&Ne[me]!=O.nf;++me);if(me==392){for(me=57;me!=392;++me)if(Ne[me]==null){ua(O.nf,me);break}}break;case"column":if(c[c.length-1][0]!=="table")break;if(he=mr(o[0]),he.Hidden&&(he.hidden=!0,delete he.Hidden),he.Width&&(he.wpx=parseInt(he.Width,10)),!Oe&&he.wpx>10){Oe=!0,Mn=C2;for(var fe=0;fe<ue.length;++fe)ue[fe]&&Wo(ue[fe])}Oe&&Wo(he),ue[he.Index-1||ue.length]=he;for(var Ge=0;Ge<+he.Span;++Ge)ue[ue.length]=hn(he);break;case"namedrange":if(o[1]==="/")break;G.Names||(G.Names=[]);var W=Pe(o[0]),mt={Name:W.Name,Ref:mo(W.RefersTo.slice(1),{r:0,c:0})};G.Sheets.length>0&&(mt.Sheet=G.Sheets.length-1),G.Names.push(mt);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(o[0].slice(-2)==="/>")break;o[1]==="/"?y+=r.slice(w,o.index):w=o.index+o[0].length;break;case"interior":if(!t.cellStyles)break;O.Interior=mr(o[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(o[0].slice(-2)==="/>")break;o[1]==="/"?xV(S,se,r.slice(k,o.index)):k=o.index+o[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"))}else c.push([o[3],!1]);break;case"comment":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"));MH(ie),oe.push(ie)}else c.push([o[3],!1]),l=mr(o[0]),ie={a:l.Author};break;case"autofilter":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"))}else if(o[0].charAt(o[0].length-2)!=="/"){var qe=mr(o[0]);d["!autofilter"]={ref:mo(qe.Range).replace(/\$/g,"")},c.push([o[3],!0])}break;case"name":break;case"datavalidation":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&c.push([o[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(o[1]==="/"){if((l=c.pop())[0]!==o[3])throw new Error("Bad state: "+l.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&c.push([o[3],!0]);break;case"null":break;default:if(c.length==0&&o[3]=="document"||c.length==0&&o[3]=="uof")return Hv(r,t);var nt=!0;switch(c[c.length-1][0]){case"officedocumentsettings":switch(o[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:nt=!1}break;case"componentoptions":switch(o[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:nt=!1}break;case"excelworkbook":switch(o[3]){case"date1904":G.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:nt=!1}break;case"workbookoptions":switch(o[3]){case"owcversion":break;case"height":break;case"width":break;default:nt=!1}break;case"worksheetoptions":switch(o[3]){case"visible":if(o[0].slice(-2)!=="/>")if(o[1]==="/")switch(r.slice(k,o.index)){case"SheetHidden":j.Hidden=1;break;case"SheetVeryHidden":j.Hidden=2;break}else k=o.index+o[0].length;break;case"header":d["!margins"]||fl(d["!margins"]={},"xlml"),isNaN(+Pe(o[0]).Margin)||(d["!margins"].header=+Pe(o[0]).Margin);break;case"footer":d["!margins"]||fl(d["!margins"]={},"xlml"),isNaN(+Pe(o[0]).Margin)||(d["!margins"].footer=+Pe(o[0]).Margin);break;case"pagemargins":var Ve=Pe(o[0]);d["!margins"]||fl(d["!margins"]={},"xlml"),isNaN(+Ve.Top)||(d["!margins"].top=+Ve.Top),isNaN(+Ve.Left)||(d["!margins"].left=+Ve.Left),isNaN(+Ve.Right)||(d["!margins"].right=+Ve.Right),isNaN(+Ve.Bottom)||(d["!margins"].bottom=+Ve.Bottom);break;case"displayrighttoleft":G.Views||(G.Views=[]),G.Views[0]||(G.Views[0]={}),G.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":d["!outline"]||(d["!outline"]={}),d["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":d["!outline"]||(d["!outline"]={}),d["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:nt=!1}break;case"pivottable":case"pivotcache":switch(o[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:nt=!1}break;case"pagebreaks":switch(o[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:nt=!1}break;case"autofilter":switch(o[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:nt=!1}break;case"querytable":switch(o[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:nt=!1}break;case"datavalidation":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:nt=!1}break;case"sorting":case"conditionalformatting":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:nt=!1}break;case"mapinfo":case"schema":case"data":switch(o[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:nt=!1}break;case"smarttags":break;default:nt=!1;break}if(nt||o[3].match(/!\[CDATA/))break;if(!c[c.length-1][1])throw"Unrecognized tag: "+o[3]+"|"+c.join("|");if(c[c.length-1][0]==="customdocumentproperties"){if(o[0].slice(-2)==="/>")break;o[1]==="/"?PH(A,se,D,r.slice(k,o.index)):(D=o,k=o.index+o[0].length);break}if(t.WTF)throw"Unrecognized tag: "+o[3]+"|"+c.join("|")}var xe={};return!t.bookSheets&&!t.bookProps&&(xe.Sheets=u),xe.SheetNames=h,xe.Workbook=G,xe.SSF=hn(Ne),xe.Props=S,xe.Custprops=A,xe}function vp(n,e){switch(Fm(e=e||{}),e.type||"base64"){case"base64":return m0(nr(n),e);case"binary":case"buffer":case"file":return m0(n,e);case"array":return m0(Fa(n),e)}}function LH(n){var e={},t=n.content;if(t.l=28,e.AnsiUserType=t.read_shift(0,"lpstr-ansi"),e.AnsiClipboardFormat=X5(t),t.length-t.l<=4)return e;var r=t.read_shift(4);if(r==0||r>40||(t.l-=4,e.Reserved1=t.read_shift(0,"lpstr-ansi"),t.length-t.l<=4)||(r=t.read_shift(4),r!==1907505652)||(e.UnicodeClipboardFormat=Q5(t),r=t.read_shift(4),r==0||r>40))return e;t.l-=4,e.Reserved2=t.read_shift(0,"lpwstr")}var NH=[60,1084,2066,2165,2175];function VH(n,e,t,r,i){var s=r,a=[],o=t.slice(t.l,t.l+s);if(i&&i.enc&&i.enc.insitu&&o.length>0)switch(n){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:i.enc.insitu(o)}a.push(o),t.l+=s;for(var c=pi(t,t.l),l=Ep[c],u=0;l!=null&&NH.indexOf(c)>-1;)s=pi(t,t.l+2),u=t.l+4,c==2066?u+=4:(c==2165||c==2175)&&(u+=12),o=t.slice(u,t.l+4+s),a.push(o),t.l+=4+s,l=Ep[c=pi(t,t.l)];var h=Ji(a);un(h,0);var d=0;h.lens=[];for(var p=0;p<a.length;++p)h.lens.push(d),d+=a[p].length;if(h.length<r)throw"XLS Record 0x"+n.toString(16)+" Truncated: "+h.length+" < "+r;return e.f(h,h.length,i)}function Dr(n,e,t){if(n.t!=="z"&&n.XF){var r=0;try{r=n.z||n.XF.numFmtId||0,e.cellNF&&(n.z=Ne[r])}catch(s){if(e.WTF)throw s}if(!e||e.cellText!==!1)try{n.t==="e"?n.w=n.w||La[n.v]:r===0||r=="General"?n.t==="n"?(n.v|0)===n.v?n.w=n.v.toString(10):n.w=zl(n.v):n.w=Aa(n.v):n.w=ur(r,n.v,{date1904:!!t,dateNF:e&&e.dateNF})}catch(s){if(e.WTF)throw s}if(e.cellDates&&r&&n.t=="n"&&tc(Ne[r]||String(r))){var i=na(n.v);i&&(n.t="d",n.v=new Date(i.y,i.m-1,i.d,i.H,i.M,i.S,i.u))}}}function fh(n,e,t){return{v:n,ixfe:e,t}}function BH(n,e){var t={opts:{}},r={},i=e.dense?[]:{},s={},a={},o=null,c=[],l="",u={},h,d="",p,g,m,_,E={},I=[],v,R,F=[],O=[],y={Sheets:[],WBProps:{date1904:!1},Views:[{}]},w={},T=function(Be){return Be<8?ha[Be]:Be<64&&O[Be-8]||ha[Be]},S=function(Be,wt,Fn){var _t=wt.XF.data;if(!(!_t||!_t.patternType||!Fn||!Fn.cellStyles)){wt.s={},wt.s.patternType=_t.patternType;var pr;(pr=Gl(T(_t.icvFore)))&&(wt.s.fgColor={rgb:pr}),(pr=Gl(T(_t.icvBack)))&&(wt.s.bgColor={rgb:pr})}},A=function(Be,wt,Fn){if(!(Ce>1)&&!(Fn.sheetRows&&Be.r>=Fn.sheetRows)){if(Fn.cellStyles&&wt.XF&&wt.XF.data&&S(Be,wt,Fn),delete wt.ixfe,delete wt.XF,h=Be,d=Me(Be),(!a||!a.s||!a.e)&&(a={s:{r:0,c:0},e:{r:0,c:0}}),Be.r<a.s.r&&(a.s.r=Be.r),Be.c<a.s.c&&(a.s.c=Be.c),Be.r+1>a.e.r&&(a.e.r=Be.r+1),Be.c+1>a.e.c&&(a.e.c=Be.c+1),Fn.cellFormula&&wt.f){for(var _t=0;_t<I.length;++_t)if(!(I[_t][0].s.c>Be.c||I[_t][0].s.r>Be.r)&&!(I[_t][0].e.c<Be.c||I[_t][0].e.r<Be.r)){wt.F=Je(I[_t][0]),(I[_t][0].s.c!=Be.c||I[_t][0].s.r!=Be.r)&&delete wt.f,wt.f&&(wt.f=""+vn(I[_t][1],a,Be,K,k));break}}Fn.dense?(i[Be.r]||(i[Be.r]=[]),i[Be.r][Be.c]=wt):i[d]=wt}},k={enc:!1,sbcch:0,snames:[],sharedf:E,arrayf:I,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!e&&!!e.cellStyles,WTF:!!e&&!!e.wtf};e.password&&(k.password=e.password);var D,oe=[],ie=[],ue=[],he=[],Oe=!1,K=[];K.SheetNames=k.snames,K.sharedf=k.sharedf,K.arrayf=k.arrayf,K.names=[],K.XTI=[];var Se=0,Ce=0,z=0,Q=[],G=[],j;k.codepage=1200,Tr(1200);for(var se=!1;n.l<n.length-1;){var ge=n.l,we=n.read_shift(2);if(we===0&&Se===10)break;var me=n.l===n.length?0:n.read_shift(2),fe=Ep[we];if(fe&&fe.f){if(e.bookSheets&&Se===133&&we!==133)break;if(Se=we,fe.r===2||fe.r==12){var Ge=n.read_shift(2);if(me-=2,!k.enc&&Ge!==we&&((Ge&255)<<8|Ge>>8)!==we)throw new Error("rt mismatch: "+Ge+"!="+we);fe.r==12&&(n.l+=10,me-=10)}var W={};if(we===10?W=fe.f(n,me,k):W=VH(we,fe,n,me,k),Ce==0&&[9,521,1033,2057].indexOf(Se)===-1)continue;switch(we){case 34:t.opts.Date1904=y.WBProps.date1904=W;break;case 134:t.opts.WriteProtect=!0;break;case 47:if(k.enc||(n.l=0),k.enc=W,!e.password)throw new Error("File is password-protected");if(W.valid==null)throw new Error("Encryption scheme unsupported");if(!W.valid)throw new Error("Password is incorrect");break;case 92:k.lastuser=W;break;case 66:var mt=Number(W);switch(mt){case 21010:mt=1200;break;case 32768:mt=1e4;break;case 32769:mt=1252;break}Tr(k.codepage=mt),se=!0;break;case 317:k.rrtabid=W;break;case 25:k.winlocked=W;break;case 439:t.opts.RefreshAll=W;break;case 12:t.opts.CalcCount=W;break;case 16:t.opts.CalcDelta=W;break;case 17:t.opts.CalcIter=W;break;case 13:t.opts.CalcMode=W;break;case 14:t.opts.CalcPrecision=W;break;case 95:t.opts.CalcSaveRecalc=W;break;case 15:k.CalcRefMode=W;break;case 2211:t.opts.FullCalc=W;break;case 129:W.fDialog&&(i["!type"]="dialog"),W.fBelow||((i["!outline"]||(i["!outline"]={})).above=!0),W.fRight||((i["!outline"]||(i["!outline"]={})).left=!0);break;case 224:F.push(W);break;case 430:K.push([W]),K[K.length-1].XTI=[];break;case 35:case 547:K[K.length-1].push(W);break;case 24:case 536:j={Name:W.Name,Ref:vn(W.rgce,a,null,K,k)},W.itab>0&&(j.Sheet=W.itab-1),K.names.push(j),K[0]||(K[0]=[],K[0].XTI=[]),K[K.length-1].push(W),W.Name=="_xlnm._FilterDatabase"&&W.itab>0&&W.rgce&&W.rgce[0]&&W.rgce[0][0]&&W.rgce[0][0][0]=="PtgArea3d"&&(G[W.itab-1]={ref:Je(W.rgce[0][0][1][2])});break;case 22:k.ExternCount=W;break;case 23:K.length==0&&(K[0]=[],K[0].XTI=[]),K[K.length-1].XTI=K[K.length-1].XTI.concat(W),K.XTI=K.XTI.concat(W);break;case 2196:if(k.biff<8)break;j!=null&&(j.Comment=W[1]);break;case 18:i["!protect"]=W;break;case 19:W!==0&&k.WTF&&console.error("Password verifier: "+W);break;case 133:s[W.pos]=W,k.snames.push(W.name);break;case 10:{if(--Ce)break;if(a.e){if(a.e.r>0&&a.e.c>0){if(a.e.r--,a.e.c--,i["!ref"]=Je(a),e.sheetRows&&e.sheetRows<=a.e.r){var qe=a.e.r;a.e.r=e.sheetRows-1,i["!fullref"]=i["!ref"],i["!ref"]=Je(a),a.e.r=qe}a.e.r++,a.e.c++}oe.length>0&&(i["!merges"]=oe),ie.length>0&&(i["!objects"]=ie),ue.length>0&&(i["!cols"]=ue),he.length>0&&(i["!rows"]=he),y.Sheets.push(w)}l===""?u=i:r[l]=i,i=e.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(k.biff===8&&(k.biff={9:2,521:3,1033:4}[we]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[W.BIFFVer]||8),k.biffguess=W.BIFFVer==0,W.BIFFVer==0&&W.dt==4096&&(k.biff=5,se=!0,Tr(k.codepage=28591)),k.biff==8&&W.BIFFVer==0&&W.dt==16&&(k.biff=2),Ce++)break;if(i=e.dense?[]:{},k.biff<8&&!se&&(se=!0,Tr(k.codepage=e.codepage||1252)),k.biff<5||W.BIFFVer==0&&W.dt==4096){l===""&&(l="Sheet1"),a={s:{r:0,c:0},e:{r:0,c:0}};var nt={pos:n.l-me,name:l};s[nt.pos]=nt,k.snames.push(l)}else l=(s[ge]||{name:""}).name;W.dt==32&&(i["!type"]="chart"),W.dt==64&&(i["!type"]="macro"),oe=[],ie=[],k.arrayf=I=[],ue=[],he=[],Oe=!1,w={Hidden:(s[ge]||{hs:0}).hs,name:l}}break;case 515:case 3:case 2:i["!type"]=="chart"&&(e.dense?(i[W.r]||[])[W.c]:i[Me({c:W.c,r:W.r})])&&++W.c,v={ixfe:W.ixfe,XF:F[W.ixfe]||{},v:W.val,t:"n"},z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:W.c,r:W.r},v,e);break;case 5:case 517:v={ixfe:W.ixfe,XF:F[W.ixfe],v:W.val,t:W.t},z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:W.c,r:W.r},v,e);break;case 638:v={ixfe:W.ixfe,XF:F[W.ixfe],v:W.rknum,t:"n"},z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:W.c,r:W.r},v,e);break;case 189:for(var Ve=W.c;Ve<=W.C;++Ve){var xe=W.rkrec[Ve-W.c][0];v={ixfe:xe,XF:F[xe],v:W.rkrec[Ve-W.c][1],t:"n"},z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:Ve,r:W.r},v,e)}break;case 6:case 518:case 1030:{if(W.val=="String"){o=W;break}if(v=fh(W.val,W.cell.ixfe,W.tt),v.XF=F[v.ixfe],e.cellFormula){var Et=W.formula;if(Et&&Et[0]&&Et[0][0]&&Et[0][0][0]=="PtgExp"){var rt=Et[0][0][1][0],lt=Et[0][0][1][1],Un=Me({r:rt,c:lt});E[Un]?v.f=""+vn(W.formula,a,W.cell,K,k):v.F=((e.dense?(i[rt]||[])[lt]:i[Un])||{}).F}else v.f=""+vn(W.formula,a,W.cell,K,k)}z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A(W.cell,v,e),o=W}break;case 7:case 519:if(o)o.val=W,v=fh(W,o.cell.ixfe,"s"),v.XF=F[v.ixfe],e.cellFormula&&(v.f=""+vn(o.formula,a,o.cell,K,k)),z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A(o.cell,v,e),o=null;else throw new Error("String record expects Formula");break;case 33:case 545:{I.push(W);var Ps=Me(W[0].s);if(p=e.dense?(i[W[0].s.r]||[])[W[0].s.c]:i[Ps],e.cellFormula&&p){if(!o||!Ps||!p)break;p.f=""+vn(W[1],a,W[0],K,k),p.F=Je(W[0])}}break;case 1212:{if(!e.cellFormula)break;if(d){if(!o)break;E[Me(o.cell)]=W[0],p=e.dense?(i[o.cell.r]||[])[o.cell.c]:i[Me(o.cell)],(p||{}).f=""+vn(W[0],a,h,K,k)}}break;case 253:v=fh(c[W.isst].t,W.ixfe,"s"),c[W.isst].h&&(v.h=c[W.isst].h),v.XF=F[v.ixfe],z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:W.c,r:W.r},v,e);break;case 513:e.sheetStubs&&(v={ixfe:W.ixfe,XF:F[W.ixfe],t:"z"},z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:W.c,r:W.r},v,e));break;case 190:if(e.sheetStubs)for(var fr=W.c;fr<=W.C;++fr){var Pn=W.ixfe[fr-W.c];v={ixfe:Pn,XF:F[Pn],t:"z"},z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:fr,r:W.r},v,e)}break;case 214:case 516:case 4:v=fh(W.val,W.ixfe,"s"),v.XF=F[v.ixfe],z>0&&(v.z=Q[v.ixfe>>8&63]),Dr(v,e,t.opts.Date1904),A({c:W.c,r:W.r},v,e);break;case 0:case 512:Ce===1&&(a=W);break;case 252:c=W;break;case 1054:if(k.biff==4){Q[z++]=W[1];for(var Dn=0;Dn<z+163&&Ne[Dn]!=W[1];++Dn);Dn>=163&&ua(W[1],z+163)}else ua(W[1],W[0]);break;case 30:{Q[z++]=W;for(var dr=0;dr<z+163&&Ne[dr]!=W;++dr);dr>=163&&ua(W,z+163)}break;case 229:oe=oe.concat(W);break;case 93:ie[W.cmo[0]]=k.lastobj=W;break;case 438:k.lastobj.TxO=W;break;case 127:k.lastobj.ImData=W;break;case 440:for(_=W[0].s.r;_<=W[0].e.r;++_)for(m=W[0].s.c;m<=W[0].e.c;++m)p=e.dense?(i[_]||[])[m]:i[Me({c:m,r:_})],p&&(p.l=W[1]);break;case 2048:for(_=W[0].s.r;_<=W[0].e.r;++_)for(m=W[0].s.c;m<=W[0].e.c;++m)p=e.dense?(i[_]||[])[m]:i[Me({c:m,r:_})],p&&p.l&&(p.l.Tooltip=W[1]);break;case 28:{if(k.biff<=5&&k.biff>=2)break;p=e.dense?(i[W[0].r]||[])[W[0].c]:i[Me(W[0])];var Di=ie[W[2]];p||(e.dense?(i[W[0].r]||(i[W[0].r]=[]),p=i[W[0].r][W[0].c]={t:"z"}):p=i[Me(W[0])]={t:"z"},a.e.r=Math.max(a.e.r,W[0].r),a.s.r=Math.min(a.s.r,W[0].r),a.e.c=Math.max(a.e.c,W[0].c),a.s.c=Math.min(a.s.c,W[0].c)),p.c||(p.c=[]),g={a:W[1],t:Di.TxO.t},p.c.push(g)}break;case 2173:o9(F[W.ixfe],W.ext);break;case 125:{if(!k.cellStyles)break;for(;W.e>=W.s;)ue[W.e--]={width:W.w/256,level:W.level||0,hidden:!!(W.flags&1)},Oe||(Oe=!0,km(W.w/256)),Wo(ue[W.e+1])}break;case 520:{var Wt={};W.level!=null&&(he[W.r]=Wt,Wt.level=W.level),W.hidden&&(he[W.r]=Wt,Wt.hidden=!0),W.hpt&&(he[W.r]=Wt,Wt.hpt=W.hpt,Wt.hpx=ql(W.hpt))}break;case 38:case 39:case 40:case 41:i["!margins"]||fl(i["!margins"]={}),i["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[we]]=W;break;case 161:i["!margins"]||fl(i["!margins"]={}),i["!margins"].header=W.header,i["!margins"].footer=W.footer;break;case 574:W.RTL&&(y.Views[0].RTL=!0);break;case 146:O=W;break;case 2198:D=W;break;case 140:R=W;break;case 442:l?w.CodeName=W||w.name:y.WBProps.CodeName=W||"ThisWorkbook";break}}else fe||console.error("Missing Info for XLS Record 0x"+we.toString(16)),n.l+=me}return t.SheetNames=Kr(s).sort(function(rr,Be){return Number(rr)-Number(Be)}).map(function(rr){return s[rr].name}),e.bookSheets||(t.Sheets=r),!t.SheetNames.length&&u["!ref"]?(t.SheetNames.push("Sheet1"),t.Sheets&&(t.Sheets.Sheet1=u)):t.Preamble=u,t.Sheets&&G.forEach(function(rr,Be){t.Sheets[t.SheetNames[Be]]["!autofilter"]=rr}),t.Strings=c,t.SSF=hn(Ne),k.enc&&(t.Encryption=k.enc),D&&(t.Themes=D),t.Metadata={},R!==void 0&&(t.Metadata.Country=R),K.names.length>0&&(y.Names=K.names),t.Workbook=y,t}var Lv={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function UH(n,e,t){var r=Qe.find(n,"/!DocumentSummaryInformation");if(r&&r.size>0)try{var i=yv(r,rV,Lv.DSI);for(var s in i)e[s]=i[s]}catch(l){if(t.WTF)throw l}var a=Qe.find(n,"/!SummaryInformation");if(a&&a.size>0)try{var o=yv(a,iV,Lv.SI);for(var c in o)e[c]==null&&(e[c]=o[c])}catch(l){if(t.WTF)throw l}e.HeadingPairs&&e.TitlesOfParts&&(f2(e.HeadingPairs,e.TitlesOfParts,e,t),delete e.HeadingPairs,delete e.TitlesOfParts)}function Y2(n,e){e||(e={}),Fm(e),bI(),e.codepage&&hm(e.codepage);var t,r;if(n.FullPaths){if(Qe.find(n,"/encryption"))throw new Error("File is password-protected");t=Qe.find(n,"!CompObj"),r=Qe.find(n,"/Workbook")||Qe.find(n,"/Book")}else{switch(e.type){case"base64":n=vr(nr(n));break;case"binary":n=vr(n);break;case"buffer":break;case"array":Array.isArray(n)||(n=Array.prototype.slice.call(n));break}un(n,0),r={content:n}}var i,s;if(t&&LH(t),e.bookProps&&!e.bookSheets)i={};else{var a=Ke?"buffer":"array";if(r&&r.content)i=BH(r.content,e);else if((s=Qe.find(n,"PerfectOffice_MAIN"))&&s.content)i=ul.to_workbook(s.content,(e.type=a,e));else if((s=Qe.find(n,"NativeContent_MAIN"))&&s.content)i=ul.to_workbook(s.content,(e.type=a,e));else throw(s=Qe.find(n,"MN0"))&&s.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");e.bookVBA&&n.FullPaths&&Qe.find(n,"/_VBA_PROJECT_CUR/VBA/dir")&&(i.vbaraw=I9(n))}var o={};return n.FullPaths&&UH(n,o,e),i.Props=i.Custprops=o,e.bookFiles&&(i.cfb=n),i}var Cf={0:{f:E7},1:{f:I7},2:{f:O7},3:{f:C7},4:{f:S7},5:{f:F7},6:{f:N7},7:{f:P7},8:{f:z7},9:{f:H7},10:{f:B7},11:{f:U7},12:{f:A7},13:{f:M7},14:{f:R7},15:{f:k7},16:{f:W2},17:{f:V7},18:{f:D7},19:{f:wm},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:gH},40:{},42:{},43:{f:B8},44:{f:V8},45:{f:U8},46:{f:z8},47:{f:H8},48:{},49:{f:$5},50:{},51:{f:l9},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:b2},62:{f:L7},63:{f:p9},64:{f:Q7},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:Cn,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:X7},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:b7},148:{f:w7,p:16},151:{f:j7},152:{},153:{f:dH},154:{},155:{},156:{f:fH},157:{},158:{},159:{T:1,f:i8},160:{T:-1},161:{T:1,f:Ma},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:$7},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:c9},336:{T:-1},337:{f:u9,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:mp},357:{},358:{},359:{},360:{T:1},361:{},362:{f:T2},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:G7},427:{f:q7},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:Y7},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:T7},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:W7},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:mp},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:w9},633:{T:1},634:{T:-1},635:{T:1,f:E9},636:{T:-1},637:{f:j5},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:rH},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:J7},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},Ep={6:{f:p0},10:{f:ji},12:{f:zt},13:{f:zt},14:{f:Ot},15:{f:Ot},16:{f:wn},17:{f:Ot},18:{f:Ot},19:{f:zt},20:{f:Tv},21:{f:Tv},23:{f:T2},24:{f:Iv},25:{f:Ot},26:{},27:{},28:{f:yB},29:{},34:{f:Ot},35:{f:bv},38:{f:wn},39:{f:wn},40:{f:wn},41:{f:wn},42:{f:Ot},43:{f:Ot},47:{f:T8},49:{f:eB},51:{f:zt},60:{},61:{f:QV},64:{f:Ot},65:{f:ZV},66:{f:zt},77:{},80:{},81:{},82:{},85:{f:zt},89:{},90:{},91:{},92:{f:$V},93:{f:EB},94:{},95:{f:Ot},96:{},97:{},99:{f:Ot},125:{f:b2},128:{f:uB},129:{f:WV},130:{f:zt},131:{f:Ot},132:{f:Ot},133:{f:jV},134:{},140:{f:SB},141:{f:zt},144:{},146:{f:CB},151:{},152:{},153:{},154:{},155:{},156:{f:zt},157:{},158:{},160:{f:OB},161:{f:PB},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:aB},190:{f:oB},193:{f:ji},197:{},198:{},199:{},200:{},201:{},202:{f:Ot},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:zt},220:{},221:{f:Ot},222:{},224:{f:lB},225:{f:zV},226:{f:ji},227:{},229:{f:vB},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:GV},253:{f:tB},255:{f:qV},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:_2},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:Ot},353:{f:ji},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:fB},431:{f:Ot},432:{},433:{},434:{},437:{},438:{f:bB},439:{f:Ot},440:{f:IB},441:{},442:{f:Eu},443:{},444:{f:zt},445:{},446:{},448:{f:ji},449:{f:XV,r:2},450:{f:ji},512:{f:Ev},513:{f:FB},515:{f:hB},516:{f:nB},517:{f:wv},519:{f:MB},520:{f:KV},523:{},545:{f:Av},549:{f:vv},566:{},574:{f:JV},638:{f:sB},659:{},1048:{},1054:{f:rB},1084:{},1212:{f:mB},2048:{f:AB},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:lh},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:ji},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:RB,r:12},2173:{f:a9,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:Ot,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:gB,r:12},2197:{},2198:{f:e9,r:12},2199:{},2200:{},2201:{},2202:{f:_B,r:12},2203:{f:ji},2204:{},2205:{},2206:{},2207:{},2211:{f:YV},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:zt},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:DB},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:kB},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:Ev},1:{},2:{f:BB},3:{f:VB},4:{f:NB},5:{f:wv},7:{f:UB},8:{},9:{f:lh},11:{},22:{f:zt},30:{f:iB},31:{},32:{},33:{f:Av},36:{},37:{f:vv},50:{f:HB},62:{},52:{},67:{},68:{f:zt},69:{},86:{},126:{},127:{f:LB},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:zB},223:{},234:{},354:{},421:{},518:{f:p0},521:{f:lh},536:{f:Iv},547:{f:bv},561:{},579:{},1030:{f:p0},1033:{f:lh},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function _r(n,e,t,r){var i=e;if(!isNaN(i)){var s=(t||[]).length||0,a=n.next(4);a.write_shift(2,i),a.write_shift(2,s),s>0&&i2(t)&&n.push(t)}}function Nv(n,e){var t=e||{},r=t.dense?[]:{};n=n.replace(/<!--.*?-->/g,"");var i=n.match(/<table/i);if(!i)throw new Error("Invalid HTML: could not find <table>");var s=n.match(/<\/table/i),a=i.index,o=s&&s.index||n.length,c=h5(n.slice(a,o),/(:?<tr[^>]*>)/i,"<tr>"),l=-1,u=0,h=0,d=0,p={s:{r:1e7,c:1e7},e:{r:0,c:0}},g=[];for(a=0;a<c.length;++a){var m=c[a].trim(),_=m.slice(0,3).toLowerCase();if(_=="<tr"){if(++l,t.sheetRows&&t.sheetRows<=l){--l;break}u=0;continue}if(!(_!="<td"&&_!="<th")){var E=m.split(/<\/t[dh]>/i);for(o=0;o<E.length;++o){var I=E[o].trim();if(I.match(/<t[dh]/i)){for(var v=I,R=0;v.charAt(0)=="<"&&(R=v.indexOf(">"))>-1;)v=v.slice(R+1);for(var F=0;F<g.length;++F){var O=g[F];O.s.c==u&&O.s.r<l&&l<=O.e.r&&(u=O.e.c+1,F=-1)}var y=Pe(I.slice(0,I.indexOf(">")));d=y.colspan?+y.colspan:1,((h=+y.rowspan)>1||d>1)&&g.push({s:{r:l,c:u},e:{r:l+(h||1)-1,c:u+d-1}});var w=y.t||y["data-t"]||"";if(!v.length){u+=d;continue}if(v=jI(v),p.s.r>l&&(p.s.r=l),p.e.r<l&&(p.e.r=l),p.s.c>u&&(p.s.c=u),p.e.c<u&&(p.e.c=u),!v.length){u+=d;continue}var T={t:"s",v};t.raw||!v.trim().length||w=="s"||(v==="TRUE"?T={t:"b",v:!0}:v==="FALSE"?T={t:"b",v:!1}:isNaN(Ar(v))?isNaN($o(v).getDate())||(T={t:"d",v:on(v)},t.cellDates||(T={t:"n",v:Bn(T.v)}),T.z=t.dateNF||Ne[14]):T={t:"n",v:Ar(v)}),t.dense?(r[l]||(r[l]=[]),r[l][u]=T):r[Me({r:l,c:u})]=T,u+=d}}}}return r["!ref"]=Je(p),g.length&&(r["!merges"]=g),r}function HH(n,e,t,r){for(var i=n["!merges"]||[],s=[],a=e.s.c;a<=e.e.c;++a){for(var o=0,c=0,l=0;l<i.length;++l)if(!(i[l].s.r>t||i[l].s.c>a)&&!(i[l].e.r<t||i[l].e.c<a)){if(i[l].s.r<t||i[l].s.c<a){o=-1;break}o=i[l].e.r-i[l].s.r+1,c=i[l].e.c-i[l].s.c+1;break}if(!(o<0)){var u=Me({r:t,c:a}),h=r.dense?(n[t]||[])[a]:n[u],d=h&&h.v!=null&&(h.h||_m(h.w||(bi(h),h.w)||""))||"",p={};o>1&&(p.rowspan=o),c>1&&(p.colspan=c),r.editable?d='<span contenteditable="true">'+d+"</span>":h&&(p["data-t"]=h&&h.t||"z",h.v!=null&&(p["data-v"]=h.v),h.z!=null&&(p["data-z"]=h.z),h.l&&(h.l.Target||"#").charAt(0)!="#"&&(d='<a href="'+h.l.Target+'">'+d+"</a>")),p.id=(r.id||"sjs")+"-"+u,s.push(S5("td",d,p))}}var g="<tr>";return g+s.join("")+"</tr>"}var zH='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',$H="</body></html>";function WH(n,e){var t=n.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!t||t.length==0)throw new Error("Invalid HTML: could not find <table>");if(t.length==1)return Rs(Nv(t[0],e),e);var r=Mm();return t.forEach(function(i,s){Lm(r,Nv(i,e),"Sheet"+(s+1))}),r}function jH(n,e,t){var r=[];return r.join("")+"<table"+(t&&t.id?' id="'+t.id+'"':"")+">"}function GH(n,e){var t=e||{},r=t.header!=null?t.header:zH,i=t.footer!=null?t.footer:$H,s=[r],a=nc(n["!ref"]);t.dense=Array.isArray(n),s.push(jH(n,a,t));for(var o=a.s.r;o<=a.e.r;++o)s.push(HH(n,a,o,t));return s.push("</table>"+i),s.join("")}function X2(n,e,t){var r=t||{},i=0,s=0;if(r.origin!=null)if(typeof r.origin=="number")i=r.origin;else{var a=typeof r.origin=="string"?Ln(r.origin):r.origin;i=a.r,s=a.c}var o=e.getElementsByTagName("tr"),c=Math.min(r.sheetRows||1e7,o.length),l={s:{r:0,c:0},e:{r:i,c:s}};if(n["!ref"]){var u=nc(n["!ref"]);l.s.r=Math.min(l.s.r,u.s.r),l.s.c=Math.min(l.s.c,u.s.c),l.e.r=Math.max(l.e.r,u.e.r),l.e.c=Math.max(l.e.c,u.e.c),i==-1&&(l.e.r=i=u.e.r+1)}var h=[],d=0,p=n["!rows"]||(n["!rows"]=[]),g=0,m=0,_=0,E=0,I=0,v=0;for(n["!cols"]||(n["!cols"]=[]);g<o.length&&m<c;++g){var R=o[g];if(Vv(R)){if(r.display)continue;p[m]={hidden:!0}}var F=R.children;for(_=E=0;_<F.length;++_){var O=F[_];if(!(r.display&&Vv(O))){var y=O.hasAttribute("data-v")?O.getAttribute("data-v"):O.hasAttribute("v")?O.getAttribute("v"):jI(O.innerHTML),w=O.getAttribute("data-z")||O.getAttribute("z");for(d=0;d<h.length;++d){var T=h[d];T.s.c==E+s&&T.s.r<m+i&&m+i<=T.e.r&&(E=T.e.c+1-s,d=-1)}v=+O.getAttribute("colspan")||1,((I=+O.getAttribute("rowspan")||1)>1||v>1)&&h.push({s:{r:m+i,c:E+s},e:{r:m+i+(I||1)-1,c:E+s+(v||1)-1}});var S={t:"s",v:y},A=O.getAttribute("data-t")||O.getAttribute("t")||"";y!=null&&(y.length==0?S.t=A||"z":r.raw||y.trim().length==0||A=="s"||(y==="TRUE"?S={t:"b",v:!0}:y==="FALSE"?S={t:"b",v:!1}:isNaN(Ar(y))?isNaN($o(y).getDate())||(S={t:"d",v:on(y)},r.cellDates||(S={t:"n",v:Bn(S.v)}),S.z=r.dateNF||Ne[14]):S={t:"n",v:Ar(y)})),S.z===void 0&&w!=null&&(S.z=w);var k="",D=O.getElementsByTagName("A");if(D&&D.length)for(var oe=0;oe<D.length&&!(D[oe].hasAttribute("href")&&(k=D[oe].getAttribute("href"),k.charAt(0)!="#"));++oe);k&&k.charAt(0)!="#"&&(S.l={Target:k}),r.dense?(n[m+i]||(n[m+i]=[]),n[m+i][E+s]=S):n[Me({c:E+s,r:m+i})]=S,l.e.c<E+s&&(l.e.c=E+s),E+=v}}++m}return h.length&&(n["!merges"]=(n["!merges"]||[]).concat(h)),l.e.r=Math.max(l.e.r,m-1+i),n["!ref"]=Je(l),m>=c&&(n["!fullref"]=Je((l.e.r=o.length-g+m-1+i,l))),n}function Q2(n,e){var t=e||{},r=t.dense?[]:{};return X2(r,n,e)}function qH(n,e){return Rs(Q2(n,e),e)}function Vv(n){var e="",t=KH(n);return t&&(e=t(n).getPropertyValue("display")),e||(e=n.style&&n.style.display),e==="none"}function KH(n){return n.ownerDocument.defaultView&&typeof n.ownerDocument.defaultView.getComputedStyle=="function"?n.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function YH(n){var e=n.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(r,i){return Array(parseInt(i,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),t=Ze(e.replace(/<[^>]*>/g,""));return[t]}var Bv={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function J2(n,e){var t=e||{},r=xm(n),i=[],s,a,o={name:""},c="",l=0,u,h,d={},p=[],g=t.dense?[]:{},m,_,E={value:""},I="",v=0,R=[],F=-1,O=-1,y={s:{r:1e6,c:1e7},e:{r:0,c:0}},w=0,T={},S=[],A={},k=0,D=0,oe=[],ie=1,ue=1,he=[],Oe={Names:[]},K={},Se=["",""],Ce=[],z={},Q="",G=0,j=!1,se=!1,ge=0;for(Wl.lastIndex=0,r=r.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");m=Wl.exec(r);)switch(m[3]=m[3].replace(/_.*$/,"")){case"table":case"":m[1]==="/"?(y.e.c>=y.s.c&&y.e.r>=y.s.r?g["!ref"]=Je(y):g["!ref"]="A1:A1",t.sheetRows>0&&t.sheetRows<=y.e.r&&(g["!fullref"]=g["!ref"],y.e.r=t.sheetRows-1,g["!ref"]=Je(y)),S.length&&(g["!merges"]=S),oe.length&&(g["!rows"]=oe),u.name=u.||u.name,typeof JSON<"u"&&JSON.stringify(u),p.push(u.name),d[u.name]=g,se=!1):m[0].charAt(m[0].length-2)!=="/"&&(u=Pe(m[0],!1),F=O=-1,y.s.r=y.s.c=1e7,y.e.r=y.e.c=0,g=t.dense?[]:{},S=[],oe=[],se=!0);break;case"table-row-group":m[1]==="/"?--w:++w;break;case"table-row":case"":if(m[1]==="/"){F+=ie,ie=1;break}if(h=Pe(m[0],!1),h.?F=h.-1:F==-1&&(F=0),ie=+h["number-rows-repeated"]||1,ie<10)for(ge=0;ge<ie;++ge)w>0&&(oe[F+ge]={level:w});O=-1;break;case"covered-table-cell":m[1]!=="/"&&++O,t.sheetStubs&&(t.dense?(g[F]||(g[F]=[]),g[F][O]={t:"z"}):g[Me({r:F,c:O})]={t:"z"}),I="",R=[];break;case"table-cell":case"":if(m[0].charAt(m[0].length-2)==="/")++O,E=Pe(m[0],!1),ue=parseInt(E["number-columns-repeated"]||"1",10),_={t:"z",v:null},E.formula&&t.cellFormula!=!1&&(_.f=Fv(Ze(E.formula))),(E.||E["value-type"])=="string"&&(_.t="s",_.v=Ze(E["string-value"]||""),t.dense?(g[F]||(g[F]=[]),g[F][O]=_):g[Me({r:F,c:O})]=_),O+=ue-1;else if(m[1]!=="/"){++O,I="",v=0,R=[],ue=1;var we=ie?F+ie-1:F;if(O>y.e.c&&(y.e.c=O),O<y.s.c&&(y.s.c=O),F<y.s.r&&(y.s.r=F),we>y.e.r&&(y.e.r=we),E=Pe(m[0],!1),Ce=[],z={},_={t:E.||E["value-type"],v:null},t.cellFormula)if(E.formula&&(E.formula=Ze(E.formula)),E["number-matrix-columns-spanned"]&&E["number-matrix-rows-spanned"]&&(k=parseInt(E["number-matrix-rows-spanned"],10)||0,D=parseInt(E["number-matrix-columns-spanned"],10)||0,A={s:{r:F,c:O},e:{r:F+k-1,c:O+D-1}},_.F=Je(A),he.push([A,_.F])),E.formula)_.f=Fv(E.formula);else for(ge=0;ge<he.length;++ge)F>=he[ge][0].s.r&&F<=he[ge][0].e.r&&O>=he[ge][0].s.c&&O<=he[ge][0].e.c&&(_.F=he[ge][1]);switch((E["number-columns-spanned"]||E["number-rows-spanned"])&&(k=parseInt(E["number-rows-spanned"],10)||0,D=parseInt(E["number-columns-spanned"],10)||0,A={s:{r:F,c:O},e:{r:F+k-1,c:O+D-1}},S.push(A)),E["number-columns-repeated"]&&(ue=parseInt(E["number-columns-repeated"],10)),_.t){case"boolean":_.t="b",_.v=bt(E["boolean-value"]);break;case"float":_.t="n",_.v=parseFloat(E.value);break;case"percentage":_.t="n",_.v=parseFloat(E.value);break;case"currency":_.t="n",_.v=parseFloat(E.value);break;case"date":_.t="d",_.v=on(E["date-value"]),t.cellDates||(_.t="n",_.v=Bn(_.v)),_.z="m/d/yy";break;case"time":_.t="n",_.v=c5(E["time-value"])/86400,t.cellDates&&(_.t="d",_.v=dd(_.v)),_.z="HH:MM:SS";break;case"number":_.t="n",_.v=parseFloat(E.);break;default:if(_.t==="string"||_.t==="text"||!_.t)_.t="s",E["string-value"]!=null&&(I=Ze(E["string-value"]),R=[]);else throw new Error("Unsupported value type "+_.t)}}else{if(j=!1,_.t==="s"&&(_.v=I||"",R.length&&(_.R=R),j=v==0),K.Target&&(_.l=K),Ce.length>0&&(_.c=Ce,Ce=[]),I&&t.cellText!==!1&&(_.w=I),j&&(_.t="z",delete _.v),(!j||t.sheetStubs)&&!(t.sheetRows&&t.sheetRows<=F))for(var me=0;me<ie;++me){if(ue=parseInt(E["number-columns-repeated"]||"1",10),t.dense)for(g[F+me]||(g[F+me]=[]),g[F+me][O]=me==0?_:hn(_);--ue>0;)g[F+me][O+ue]=hn(_);else for(g[Me({r:F+me,c:O})]=_;--ue>0;)g[Me({r:F+me,c:O+ue})]=hn(_);y.e.c<=O&&(y.e.c=O)}ue=parseInt(E["number-columns-repeated"]||"1",10),O+=ue-1,ue=0,_={},I="",R=[]}K={};break;case"document":case"document-content":case"":case"spreadsheet":case"":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(m[1]==="/"){if((s=i.pop())[0]!==m[3])throw"Bad state: "+s}else m[0].charAt(m[0].length-2)!=="/"&&i.push([m[3],!0]);break;case"annotation":if(m[1]==="/"){if((s=i.pop())[0]!==m[3])throw"Bad state: "+s;z.t=I,R.length&&(z.R=R),z.a=Q,Ce.push(z)}else m[0].charAt(m[0].length-2)!=="/"&&i.push([m[3],!1]);Q="",G=0,I="",v=0,R=[];break;case"creator":m[1]==="/"?Q=r.slice(G,m.index):G=m.index+m[0].length;break;case"meta":case"":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(m[1]==="/"){if((s=i.pop())[0]!==m[3])throw"Bad state: "+s}else m[0].charAt(m[0].length-2)!=="/"&&i.push([m[3],!1]);I="",v=0,R=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(m[1]==="/"){if(T[o.name]=c,(s=i.pop())[0]!==m[3])throw"Bad state: "+s}else m[0].charAt(m[0].length-2)!=="/"&&(c="",o=Pe(m[0],!1),i.push([m[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(i[i.length-1][0]){case"time-style":case"date-style":a=Pe(m[0],!1),c+=Bv[m[3]][a.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(i[i.length-1][0]){case"time-style":case"date-style":a=Pe(m[0],!1),c+=Bv[m[3]][a.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(m[0].slice(-2)==="/>")break;if(m[1]==="/")switch(i[i.length-1][0]){case"number-style":case"date-style":case"time-style":c+=r.slice(l,m.index);break}else l=m.index+m[0].length;break;case"named-range":a=Pe(m[0],!1),Se=g0(a["cell-range-address"]);var fe={Name:a.name,Ref:Se[0]+"!"+Se[1]};se&&(fe.Sheet=p.length),Oe.Names.push(fe);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"":if(["master-styles"].indexOf(i[i.length-1][0])>-1)break;if(m[1]==="/"&&(!E||!E["string-value"])){var Ge=YH(r.slice(v,m.index));I=(I.length>0?I+`
`:"")+Ge[0]}else Pe(m[0],!1),v=m.index+m[0].length;break;case"s":break;case"database-range":if(m[1]==="/")break;try{Se=g0(Pe(m[0])["target-range-address"]),d[Se[0]]["!autofilter"]={ref:Se[1]}}catch{}break;case"date":break;case"object":break;case"title":case"":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(m[1]!=="/"){if(K=Pe(m[0],!1),!K.href)break;K.Target=Ze(K.href),delete K.href,K.Target.charAt(0)=="#"&&K.Target.indexOf(".")>-1?(Se=g0(K.Target.slice(1)),K.Target="#"+Se[0]+"!"+Se[1]):K.Target.match(/^\.\.[\\\/]/)&&(K.Target=K.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(m[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case":":case":":break;default:if(t.WTF)throw new Error(m)}}var W={Sheets:d,SheetNames:p,Workbook:Oe};return t.bookSheets&&delete W.Sheets,W}function Uv(n,e){e=e||{},or(n,"META-INF/manifest.xml")&&hV(Ht(n,"META-INF/manifest.xml"),e);var t=Jn(n,"content.xml");if(!t)throw new Error("Missing content.xml in ODS / UOF file");var r=J2(dt(t),e);return or(n,"meta.xml")&&(r.Props=h2(Ht(n,"meta.xml"))),r}function Hv(n,e){return J2(n,e)}function Pm(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function wp(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):dt(Fa(n))}function Tp(n){var e=n.reduce(function(i,s){return i+s.length},0),t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(i,r),r+=i.length}),t}function zv(n){return n-=n>>1&1431655765,n=(n&858993459)+(n>>2&858993459),(n+(n>>4)&252645135)*16843009>>>24}function XH(n,e){for(var t=(n[e+15]&127)<<7|n[e+14]>>1,r=n[e+14]&1,i=e+13;i>=e;--i)r=r*256+n[i];return(n[e+15]&128?-r:r)*Math.pow(10,t-6176)}function Kl(n,e){var t=e?e[0]:0,r=n[t]&127;e:if(n[t++]>=128&&(r|=(n[t]&127)<<7,n[t++]<128||(r|=(n[t]&127)<<14,n[t++]<128)||(r|=(n[t]&127)<<21,n[t++]<128)||(r+=(n[t]&127)*Math.pow(2,28),++t,n[t++]<128)||(r+=(n[t]&127)*Math.pow(2,35),++t,n[t++]<128)||(r+=(n[t]&127)*Math.pow(2,42),++t,n[t++]<128)))break e;return e&&(e[0]=t),r}function Jt(n){var e=0,t=n[e]&127;e:if(n[e++]>=128){if(t|=(n[e]&127)<<7,n[e++]<128||(t|=(n[e]&127)<<14,n[e++]<128)||(t|=(n[e]&127)<<21,n[e++]<128))break e;t|=(n[e]&127)<<28}return t}function bn(n){for(var e=[],t=[0];t[0]<n.length;){var r=t[0],i=Kl(n,t),s=i&7;i=Math.floor(i/8);var a=0,o;if(i==0)break;switch(s){case 0:{for(var c=t[0];n[t[0]++]>=128;);o=n.slice(c,t[0])}break;case 5:a=4,o=n.slice(t[0],t[0]+a),t[0]+=a;break;case 1:a=8,o=n.slice(t[0],t[0]+a),t[0]+=a;break;case 2:a=Kl(n,t),o=n.slice(t[0],t[0]+a),t[0]+=a;break;default:throw new Error("PB Type ".concat(s," for Field ").concat(i," at offset ").concat(r))}var l={data:o,type:s};e[i]==null?e[i]=[l]:e[i].push(l)}return e}function Dm(n,e){return n?.map(function(t){return e(t.data)})||[]}function QH(n){for(var e,t=[],r=[0];r[0]<n.length;){var i=Kl(n,r),s=bn(n.slice(r[0],r[0]+i));r[0]+=i;var a={id:Jt(s[1][0].data),messages:[]};s[2].forEach(function(o){var c=bn(o.data),l=Jt(c[3][0].data);a.messages.push({meta:c,data:n.slice(r[0],r[0]+l)}),r[0]+=l}),(e=s[3])!=null&&e[0]&&(a.merge=Jt(s[3][0].data)>>>0>0),t.push(a)}return t}function JH(n,e){if(n!=0)throw new Error("Unexpected Snappy chunk type ".concat(n));for(var t=[0],r=Kl(e,t),i=[];t[0]<e.length;){var s=e[t[0]]&3;if(s==0){var a=e[t[0]++]>>2;if(a<60)++a;else{var o=a-59;a=e[t[0]],o>1&&(a|=e[t[0]+1]<<8),o>2&&(a|=e[t[0]+2]<<16),o>3&&(a|=e[t[0]+3]<<24),a>>>=0,a++,t[0]+=o}i.push(e.slice(t[0],t[0]+a)),t[0]+=a;continue}else{var c=0,l=0;if(s==1?(l=(e[t[0]]>>2&7)+4,c=(e[t[0]++]&224)<<3,c|=e[t[0]++]):(l=(e[t[0]++]>>2)+1,s==2?(c=e[t[0]]|e[t[0]+1]<<8,t[0]+=2):(c=(e[t[0]]|e[t[0]+1]<<8|e[t[0]+2]<<16|e[t[0]+3]<<24)>>>0,t[0]+=4)),i=[Tp(i)],c==0)throw new Error("Invalid offset 0");if(c>i[0].length)throw new Error("Invalid offset beyond length");if(l>=c)for(i.push(i[0].slice(-c)),l-=c;l>=i[i.length-1].length;)i.push(i[i.length-1]),l-=i[i.length-1].length;i.push(i[0].slice(-c,-c+l))}}var u=Tp(i);if(u.length!=r)throw new Error("Unexpected length: ".concat(u.length," != ").concat(r));return u}function ZH(n){for(var e=[],t=0;t<n.length;){var r=n[t++],i=n[t]|n[t+1]<<8|n[t+2]<<16;t+=3,e.push(JH(r,n.slice(t,t+i))),t+=i}if(t!==n.length)throw new Error("data is not a valid framed stream!");return Tp(e)}function ez(n,e,t,r){var i=Pm(n),s=i.getUint32(4,!0),a=(r>1?12:8)+zv(s&(r>1?3470:398))*4,o=-1,c=-1,l=NaN,u=new Date(2001,0,1);s&512&&(o=i.getUint32(a,!0),a+=4),a+=zv(s&(r>1?12288:4096))*4,s&16&&(c=i.getUint32(a,!0),a+=4),s&32&&(l=i.getFloat64(a,!0),a+=8),s&64&&(u.setTime(u.getTime()+i.getFloat64(a,!0)*1e3),a+=8);var h;switch(n[2]){case 0:break;case 2:h={t:"n",v:l};break;case 3:h={t:"s",v:e[c]};break;case 5:h={t:"d",v:u};break;case 6:h={t:"b",v:l>0};break;case 7:h={t:"n",v:l/86400};break;case 8:h={t:"e",v:0};break;case 9:if(o>-1)h={t:"s",v:t[o]};else if(c>-1)h={t:"s",v:e[c]};else if(!isNaN(l))h={t:"n",v:l};else throw new Error("Unsupported cell type ".concat(n.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(n.slice(0,4)))}return h}function tz(n,e,t){var r=Pm(n),i=r.getUint32(8,!0),s=12,a=-1,o=-1,c=NaN,l=NaN,u=new Date(2001,0,1);i&1&&(c=XH(n,s),s+=16),i&2&&(l=r.getFloat64(s,!0),s+=8),i&4&&(u.setTime(u.getTime()+r.getFloat64(s,!0)*1e3),s+=8),i&8&&(o=r.getUint32(s,!0),s+=4),i&16&&(a=r.getUint32(s,!0),s+=4);var h;switch(n[1]){case 0:break;case 2:h={t:"n",v:c};break;case 3:h={t:"s",v:e[o]};break;case 5:h={t:"d",v:u};break;case 6:h={t:"b",v:l>0};break;case 7:h={t:"n",v:l/86400};break;case 8:h={t:"e",v:0};break;case 9:if(a>-1)h={t:"s",v:t[a]};else throw new Error("Unsupported cell type ".concat(n[1]," : ").concat(i&31," : ").concat(n.slice(0,4)));break;case 10:h={t:"n",v:c};break;default:throw new Error("Unsupported cell type ".concat(n[1]," : ").concat(i&31," : ").concat(n.slice(0,4)))}return h}function nz(n,e,t){switch(n[0]){case 0:case 1:case 2:case 3:return ez(n,e,t,n[0]);case 5:return tz(n,e,t);default:throw new Error("Unsupported payload version ".concat(n[0]))}}function fs(n){var e=bn(n);return Kl(e[1][0].data)}function $v(n,e){var t=bn(e.data),r=Jt(t[1][0].data),i=t[3],s=[];return(i||[]).forEach(function(a){var o=bn(a.data),c=Jt(o[1][0].data)>>>0;switch(r){case 1:s[c]=wp(o[3][0].data);break;case 8:{var l=n[fs(o[9][0].data)][0],u=bn(l.data),h=n[fs(u[1][0].data)][0],d=Jt(h.meta[1][0].data);if(d!=2001)throw new Error("2000 unexpected reference to ".concat(d));var p=bn(h.data);s[c]=p[3].map(function(g){return wp(g.data)}).join("")}break}}),s}function rz(n,e){var t,r,i,s,a,o,c,l,u,h,d,p,g,m,_=bn(n),E=Jt(_[1][0].data)>>>0,I=Jt(_[2][0].data)>>>0,v=((r=(t=_[8])==null?void 0:t[0])==null?void 0:r.data)&&Jt(_[8][0].data)>0||!1,R,F;if((s=(i=_[7])==null?void 0:i[0])!=null&&s.data&&e!=0)R=(o=(a=_[7])==null?void 0:a[0])==null?void 0:o.data,F=(l=(c=_[6])==null?void 0:c[0])==null?void 0:l.data;else if((h=(u=_[4])==null?void 0:u[0])!=null&&h.data&&e!=1)R=(p=(d=_[4])==null?void 0:d[0])==null?void 0:p.data,F=(m=(g=_[3])==null?void 0:g[0])==null?void 0:m.data;else throw"NUMBERS Tile missing ".concat(e," cell storage");for(var O=v?4:1,y=Pm(R),w=[],T=0;T<R.length/2;++T){var S=y.getUint16(T*2,!0);S<65535&&w.push([T,S])}if(w.length!=I)throw"Expected ".concat(I," cells, found ").concat(w.length);var A=[];for(T=0;T<w.length-1;++T)A[w[T][0]]=F.subarray(w[T][1]*O,w[T+1][1]*O);return w.length>=1&&(A[w[w.length-1][0]]=F.subarray(w[w.length-1][1]*O)),{R:E,cells:A}}function iz(n,e){var t,r=bn(e.data),i=(t=r?.[7])!=null&&t[0]?Jt(r[7][0].data)>>>0>0?1:0:-1,s=Dm(r[5],function(a){return rz(a,i)});return{nrows:Jt(r[4][0].data)>>>0,data:s.reduce(function(a,o){return a[o.R]||(a[o.R]=[]),o.cells.forEach(function(c,l){if(a[o.R][l])throw new Error("Duplicate cell r=".concat(o.R," c=").concat(l));a[o.R][l]=c}),a},[])}}function sz(n,e,t){var r,i=bn(e.data),s={s:{r:0,c:0},e:{r:0,c:0}};if(s.e.r=(Jt(i[6][0].data)>>>0)-1,s.e.r<0)throw new Error("Invalid row varint ".concat(i[6][0].data));if(s.e.c=(Jt(i[7][0].data)>>>0)-1,s.e.c<0)throw new Error("Invalid col varint ".concat(i[7][0].data));t["!ref"]=Je(s);var a=bn(i[4][0].data),o=$v(n,n[fs(a[4][0].data)][0]),c=(r=a[17])!=null&&r[0]?$v(n,n[fs(a[17][0].data)][0]):[],l=bn(a[3][0].data),u=0;l[1].forEach(function(h){var d=bn(h.data),p=n[fs(d[2][0].data)][0],g=Jt(p.meta[1][0].data);if(g!=6002)throw new Error("6001 unexpected reference to ".concat(g));var m=iz(n,p);m.data.forEach(function(_,E){_.forEach(function(I,v){var R=Me({r:u+E,c:v}),F=nz(I,o,c);F&&(t[R]=F)})}),u+=m.nrows})}function az(n,e){var t=bn(e.data),r={"!ref":"A1"},i=n[fs(t[2][0].data)],s=Jt(i[0].meta[1][0].data);if(s!=6001)throw new Error("6000 unexpected reference to ".concat(s));return sz(n,i[0],r),r}function oz(n,e){var t,r=bn(e.data),i={name:(t=r[1])!=null&&t[0]?wp(r[1][0].data):"",sheets:[]},s=Dm(r[2],fs);return s.forEach(function(a){n[a].forEach(function(o){var c=Jt(o.meta[1][0].data);c==6e3&&i.sheets.push(az(n,o))})}),i}function cz(n,e){var t=Mm(),r=bn(e.data),i=Dm(r[1],fs);if(i.forEach(function(s){n[s].forEach(function(a){var o=Jt(a.meta[1][0].data);if(o==2){var c=oz(n,a);c.sheets.forEach(function(l,u){Lm(t,l,u==0?c.name:c.name+"_"+u,!0)})}})}),t.SheetNames.length==0)throw new Error("Empty NUMBERS file");return t}function _0(n){var e,t,r,i,s={},a=[];if(n.FullPaths.forEach(function(c){if(c.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),n.FileIndex.forEach(function(c){if(c.name.match(/\.iwa$/)){var l;try{l=ZH(c.content)}catch(h){return console.log("?? "+c.content.length+" "+(h.message||h))}var u;try{u=QH(l)}catch(h){return console.log("## "+(h.message||h))}u.forEach(function(h){s[h.id]=h.messages,a.push(h.id)})}}),!a.length)throw new Error("File has no messages");var o=((i=(r=(t=(e=s?.[1])==null?void 0:e[0])==null?void 0:t.meta)==null?void 0:r[1])==null?void 0:i[0].data)&&Jt(s[1][0].meta[1][0].data)==1&&s[1][0];if(o||a.forEach(function(c){s[c].forEach(function(l){var u=Jt(l.meta[1][0].data)>>>0;if(u==1)if(!o)o=l;else throw new Error("Document has multiple roots")})}),!o)throw new Error("Cannot find Document root");return cz(s,o)}function lz(n){return function(t){for(var r=0;r!=n.length;++r){var i=n[r];t[i[0]]===void 0&&(t[i[0]]=i[1]),i[2]==="n"&&(t[i[0]]=Number(t[i[0]]))}}}function Fm(n){lz([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(n)}function uz(n){return oo.WS.indexOf(n)>-1?"sheet":n==oo.CS?"chart":n==oo.DS?"dialog":n==oo.MS?"macro":n&&n.length?n:"sheet"}function hz(n,e){if(!n)return 0;try{n=e.map(function(r){return r.id||(r.id=r.strRelID),[r.name,n["!id"][r.id].Target,uz(n["!id"][r.id].Type)]})}catch{return null}return!n||n.length===0?null:n}function fz(n,e,t,r,i,s,a,o,c,l,u,h){try{s[r]=cl(Jn(n,t,!0),e);var d=Ht(n,e),p;switch(o){case"sheet":p=xH(d,e,i,c,s[r],l,u,h);break;case"chart":if(p=yH(d,e,i,c,s[r],l,u,h),!p||!p["!drawel"])break;var g=zc(p["!drawel"].Target,e),m=_p(g),_=_9(Jn(n,g,!0),cl(Jn(n,m,!0),g)),E=zc(_,g),I=_p(E);p=tH(Jn(n,E,!0),E,c,cl(Jn(n,I,!0),E),l,p);break;case"macro":p=vH(d,e,i,c,s[r],l,u,h);break;case"dialog":p=EH(d,e,i,c,s[r],l,u,h);break;default:throw new Error("Unrecognized sheet type "+o)}a[r]=p;var v=[];s&&s[r]&&Kr(s[r]).forEach(function(R){var F="";if(s[r][R].Type==oo.CMNT){F=zc(s[r][R].Target,e);var O=IH(Ht(n,F,!0),F,c);if(!O||!O.length)return;kv(p,O,!1)}s[r][R].Type==oo.TCMNT&&(F=zc(s[r][R].Target,e),v=v.concat(y9(Ht(n,F,!0),c)))}),v&&v.length&&kv(p,v,!0,c.people||[])}catch(R){if(c.WTF)throw R}}function sr(n){return n.charAt(0)=="/"?n.slice(1):n}function dz(n,e){if(LI(),e=e||{},Fm(e),or(n,"META-INF/manifest.xml")||or(n,"objectdata.xml"))return Uv(n,e);if(or(n,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof _0<"u"){if(n.FileIndex)return _0(n);var t=Qe.utils.cfb_new();return tv(n).forEach(function(oe){p5(t,oe,d5(n,oe))}),_0(t)}throw new Error("Unsupported NUMBERS file")}if(!or(n,"[Content_Types].xml"))throw or(n,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):or(n,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var r=tv(n),i=lV(Jn(n,"[Content_Types].xml")),s=!1,a,o;if(i.workbooks.length===0&&(o="xl/workbook.xml",Ht(n,o,!0)&&i.workbooks.push(o)),i.workbooks.length===0){if(o="xl/workbook.bin",!Ht(n,o,!0))throw new Error("Could not find workbook");i.workbooks.push(o),s=!0}i.workbooks[0].slice(-3)=="bin"&&(s=!0);var c={},l={};if(!e.bookSheets&&!e.bookProps){if(hl=[],i.sst)try{hl=bH(Ht(n,sr(i.sst)),i.sst,e)}catch(oe){if(e.WTF)throw oe}e.cellStyles&&i.themes.length&&(c=TH(Jn(n,i.themes[0].replace(/^\//,""),!0)||"",i.themes[0],e)),i.style&&(l=wH(Ht(n,sr(i.style)),i.style,c,e))}i.links.map(function(oe){try{var ie=cl(Jn(n,_p(sr(oe))),oe);return SH(Ht(n,sr(oe)),ie,oe,e)}catch{}});var u=_H(Ht(n,sr(i.workbooks[0])),i.workbooks[0],e),h={},d="";i.coreprops.length&&(d=Ht(n,sr(i.coreprops[0]),!0),d&&(h=h2(d)),i.extprops.length!==0&&(d=Ht(n,sr(i.extprops[0]),!0),d&&pV(d,h,e)));var p={};(!e.bookSheets||e.bookProps)&&i.custprops.length!==0&&(d=Jn(n,sr(i.custprops[0]),!0),d&&(p=mV(d,e)));var g={};if((e.bookSheets||e.bookProps)&&(u.Sheets?a=u.Sheets.map(function(ie){return ie.name}):h.Worksheets&&h.SheetNames.length>0&&(a=h.SheetNames),e.bookProps&&(g.Props=h,g.Custprops=p),e.bookSheets&&typeof a<"u"&&(g.SheetNames=a),e.bookSheets?g.SheetNames:e.bookProps))return g;a={};var m={};e.bookDeps&&i.calcchain&&(m=AH(Ht(n,sr(i.calcchain)),i.calcchain));var _=0,E={},I,v;{var R=u.Sheets;h.Worksheets=R.length,h.SheetNames=[];for(var F=0;F!=R.length;++F)h.SheetNames[F]=R[F].name}var O=s?"bin":"xml",y=i.workbooks[0].lastIndexOf("/"),w=(i.workbooks[0].slice(0,y+1)+"_rels/"+i.workbooks[0].slice(y+1)+".rels").replace(/^\//,"");or(n,w)||(w="xl/_rels/workbook."+O+".rels");var T=cl(Jn(n,w,!0),w.replace(/_rels.*/,"s5s"));(i.metadata||[]).length>=1&&(e.xlmeta=kH(Ht(n,sr(i.metadata[0])),i.metadata[0],e)),(i.people||[]).length>=1&&(e.people=v9(Ht(n,sr(i.people[0])),e)),T&&(T=hz(T,u.Sheets));var S=Ht(n,"xl/worksheets/sheet.xml",!0)?1:0;e:for(_=0;_!=h.Worksheets;++_){var A="sheet";if(T&&T[_]?(I="xl/"+T[_][1].replace(/[\/]?xl\//,""),or(n,I)||(I=T[_][1]),or(n,I)||(I=w.replace(/_rels\/.*$/,"")+T[_][1]),A=T[_][2]):(I="xl/worksheets/sheet"+(_+1-S)+"."+O,I=I.replace(/sheet0\./,"sheet.")),v=I.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),e&&e.sheets!=null)switch(typeof e.sheets){case"number":if(_!=e.sheets)continue e;break;case"string":if(h.SheetNames[_].toLowerCase()!=e.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(e.sheets)){for(var k=!1,D=0;D!=e.sheets.length;++D)typeof e.sheets[D]=="number"&&e.sheets[D]==_&&(k=1),typeof e.sheets[D]=="string"&&e.sheets[D].toLowerCase()==h.SheetNames[_].toLowerCase()&&(k=1);if(!k)continue e}}fz(n,I,v,h.SheetNames[_],_,E,a,A,e,u,c,l)}return g={Directory:i,Workbook:u,Props:h,Custprops:p,Deps:m,Sheets:a,SheetNames:h.SheetNames,Strings:hl,Styles:l,Themes:c,SSF:hn(Ne)},e&&e.bookFiles&&(n.files?(g.keys=r,g.files=n.files):(g.keys=[],g.files={},n.FullPaths.forEach(function(oe,ie){oe=oe.replace(/^Root Entry[\/]/,""),g.keys.push(oe),g.files[oe]=n.FileIndex[ie]}))),e&&e.bookVBA&&(i.vba.length>0?g.vbaraw=Ht(n,sr(i.vba[0]),!0):i.defaults&&i.defaults.bin===b9&&(g.vbaraw=Ht(n,"xl/vbaProject.bin",!0))),g}function pz(n,e){var t=e||{},r="Workbook",i=Qe.find(n,r);try{if(r="/!DataSpaces/Version",i=Qe.find(n,r),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+r);if(a8(i.content),r="/!DataSpaces/DataSpaceMap",i=Qe.find(n,r),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+r);var s=c8(i.content);if(s.length!==1||s[0].comps.length!==1||s[0].comps[0].t!==0||s[0].name!=="StrongEncryptionDataSpace"||s[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+r);if(r="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",i=Qe.find(n,r),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+r);var a=l8(i.content);if(a.length!=1||a[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+r);if(r="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",i=Qe.find(n,r),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+r);h8(i.content)}catch{}if(r="/EncryptionInfo",i=Qe.find(n,r),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+r);var o=f8(i.content);if(r="/EncryptedPackage",i=Qe.find(n,r),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+r);if(o[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(o[1],i.content,t.password||"",t);if(o[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(o[1],i.content,t.password||"",t);throw new Error("File is password-protected")}function Om(n,e){var t="";switch((e||{}).type||"base64"){case"buffer":return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]];case"base64":t=nr(n.slice(0,12));break;case"binary":t=n;break;case"array":return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]];default:throw new Error("Unrecognized type "+(e&&e.type||"undefined"))}return[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3),t.charCodeAt(4),t.charCodeAt(5),t.charCodeAt(6),t.charCodeAt(7)]}function gz(n,e){return Qe.find(n,"EncryptedPackage")?pz(n,e):Y2(n,e)}function mz(n,e){var t,r=n,i=e||{};return i.type||(i.type=Ke&&Buffer.isBuffer(n)?"buffer":"base64"),t=zI(r,i),dz(t,i)}function Z2(n,e){var t=0;e:for(;t<n.length;)switch(n.charCodeAt(t)){case 10:case 13:case 32:++t;break;case 60:return vp(n.slice(t),e);default:break e}return jl.to_workbook(n,e)}function _z(n,e){var t="",r=Om(n,e);switch(e.type){case"base64":t=nr(n);break;case"binary":t=n;break;case"buffer":t=n.toString("binary");break;case"array":t=Sa(n);break;default:throw new Error("Unrecognized type "+e.type)}return r[0]==239&&r[1]==187&&r[2]==191&&(t=dt(t)),e.type="binary",Z2(t,e)}function xz(n,e){var t=n;return e.type=="base64"&&(t=nr(t)),t=Hl.utils.decode(1200,t.slice(2),"str"),e.type="binary",Z2(t,e)}function yz(n){return n.match(/[^\x00-\x7F]/)?$c(n):n}function x0(n,e,t,r){return r?(t.type="string",jl.to_workbook(n,t)):jl.to_workbook(e,t)}function bp(n,e){bI();var t=e||{};if(typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer)return bp(new Uint8Array(n),(t=hn(t),t.type="array",t));typeof Uint8Array<"u"&&n instanceof Uint8Array&&!t.type&&(t.type=typeof Deno<"u"?"buffer":"array");var r=n,i=[0,0,0,0],s=!1;if(t.cellStyles&&(t.cellNF=!0,t.sheetStubs=!0),_o={},t.dateNF&&(_o.dateNF=t.dateNF),t.type||(t.type=Ke&&Buffer.isBuffer(n)?"buffer":"base64"),t.type=="file"&&(t.type=Ke?"buffer":"binary",r=a5(n),typeof Uint8Array<"u"&&!Ke&&(t.type="array")),t.type=="string"&&(s=!0,t.type="binary",t.codepage=65001,r=yz(n)),t.type=="array"&&typeof Uint8Array<"u"&&n instanceof Uint8Array&&typeof ArrayBuffer<"u"){var a=new ArrayBuffer(3),o=new Uint8Array(a);if(o.foo="bar",!o.foo)return t=hn(t),t.type="array",bp(fm(r),t)}switch((i=Om(r,t))[0]){case 208:if(i[1]===207&&i[2]===17&&i[3]===224&&i[4]===161&&i[5]===177&&i[6]===26&&i[7]===225)return gz(Qe.read(r,t),t);break;case 9:if(i[1]<=8)return Y2(r,t);break;case 60:return vp(r,t);case 73:if(i[1]===73&&i[2]===42&&i[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(i[1]===68)return qB(r,t);break;case 84:if(i[1]===65&&i[2]===66&&i[3]===76)return jB.to_workbook(r,t);break;case 80:return i[1]===75&&i[2]<9&&i[3]<9?mz(r,t):x0(n,r,t,s);case 239:return i[3]===60?vp(r,t):x0(n,r,t,s);case 255:if(i[1]===254)return xz(r,t);if(i[1]===0&&i[2]===2&&i[3]===0)return ul.to_workbook(r,t);break;case 0:if(i[1]===0&&(i[2]>=2&&i[3]===0||i[2]===0&&(i[3]===8||i[3]===9)))return ul.to_workbook(r,t);break;case 3:case 131:case 139:case 140:return Sv.to_workbook(r,t);case 123:if(i[1]===92&&i[2]===114&&i[3]===116)return b8.to_workbook(r,t);break;case 10:case 13:case 32:return _z(r,t);case 137:if(i[1]===80&&i[2]===78&&i[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return $B.indexOf(i[0])>-1&&i[2]<=12&&i[3]<=31?Sv.to_workbook(r,t):x0(n,r,t,s)}function vz(n,e,t,r,i,s,a,o){var c=fn(t),l=o.defval,u=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),h=!0,d=i===1?[]:{};if(i!==1)if(Object.defineProperty)try{Object.defineProperty(d,"__rowNum__",{value:t,enumerable:!1})}catch{d.__rowNum__=t}else d.__rowNum__=t;if(!a||n[t])for(var p=e.s.c;p<=e.e.c;++p){var g=a?n[t][p]:n[r[p]+c];if(g===void 0||g.t===void 0){if(l===void 0)continue;s[p]!=null&&(d[s[p]]=l);continue}var m=g.v;switch(g.t){case"z":if(m==null)break;continue;case"e":m=m==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+g.t)}if(s[p]!=null){if(m==null)if(g.t=="e"&&m===null)d[s[p]]=null;else if(l!==void 0)d[s[p]]=l;else if(u&&m===null)d[s[p]]=null;else continue;else d[s[p]]=u&&(g.t!=="n"||g.t==="n"&&o.rawNumbers!==!1)?m:bi(g,m,o);m!=null&&(h=!1)}}return{row:d,isempty:h}}function Ip(n,e){if(n==null||n["!ref"]==null)return[];var t={t:"n",v:0},r=0,i=1,s=[],a=0,o="",c={s:{r:0,c:0},e:{r:0,c:0}},l=e||{},u=l.range!=null?l.range:n["!ref"];switch(l.header===1?r=1:l.header==="A"?r=2:Array.isArray(l.header)?r=3:l.header==null&&(r=0),typeof u){case"string":c=Ft(u);break;case"number":c=Ft(n["!ref"]),c.s.r=u;break;default:c=u}r>0&&(i=0);var h=fn(c.s.r),d=[],p=[],g=0,m=0,_=Array.isArray(n),E=c.s.r,I=0,v={};_&&!n[E]&&(n[E]=[]);var R=l.skipHidden&&n["!cols"]||[],F=l.skipHidden&&n["!rows"]||[];for(I=c.s.c;I<=c.e.c;++I)if(!(R[I]||{}).hidden)switch(d[I]=Xt(I),t=_?n[E][I]:n[d[I]+h],r){case 1:s[I]=I-c.s.c;break;case 2:s[I]=d[I];break;case 3:s[I]=l.header[I-c.s.c];break;default:if(t==null&&(t={w:"__EMPTY",t:"s"}),o=a=bi(t,null,l),m=v[a]||0,!m)v[a]=1;else{do o=a+"_"+m++;while(v[o]);v[a]=m,v[o]=1}s[I]=o}for(E=c.s.r+i;E<=c.e.r;++E)if(!(F[E]||{}).hidden){var O=vz(n,c,E,d,r,s,_,l);(O.isempty===!1||(r===1?l.blankrows!==!1:l.blankrows))&&(p[g++]=O.row)}return p.length=g,p}var Wv=/"/g;function Ez(n,e,t,r,i,s,a,o){for(var c=!0,l=[],u="",h=fn(t),d=e.s.c;d<=e.e.c;++d)if(r[d]){var p=o.dense?(n[t]||[])[d]:n[r[d]+h];if(p==null)u="";else if(p.v!=null){c=!1,u=""+(o.rawNumbers&&p.t=="n"?p.v:bi(p,null,o));for(var g=0,m=0;g!==u.length;++g)if((m=u.charCodeAt(g))===i||m===s||m===34||o.forceQuotes){u='"'+u.replace(Wv,'""')+'"';break}u=="ID"&&(u='"ID"')}else p.f!=null&&!p.F?(c=!1,u="="+p.f,u.indexOf(",")>=0&&(u='"'+u.replace(Wv,'""')+'"')):u="";l.push(u)}return o.blankrows===!1&&c?null:l.join(a)}function eA(n,e){var t=[],r=e??{};if(n==null||n["!ref"]==null)return"";var i=Ft(n["!ref"]),s=r.FS!==void 0?r.FS:",",a=s.charCodeAt(0),o=r.RS!==void 0?r.RS:`
`,c=o.charCodeAt(0),l=new RegExp((s=="|"?"\\|":s)+"+$"),u="",h=[];r.dense=Array.isArray(n);for(var d=r.skipHidden&&n["!cols"]||[],p=r.skipHidden&&n["!rows"]||[],g=i.s.c;g<=i.e.c;++g)(d[g]||{}).hidden||(h[g]=Xt(g));for(var m=0,_=i.s.r;_<=i.e.r;++_)(p[_]||{}).hidden||(u=Ez(n,i,_,h,a,c,s,r),u!=null&&(r.strip&&(u=u.replace(l,"")),(u||r.blankrows!==!1)&&t.push((m++?o:"")+u)));return delete r.dense,t.join("")}function wz(n,e){e||(e={}),e.FS="	",e.RS=`
`;var t=eA(n,e);return t}function Tz(n){var e="",t,r="";if(n==null||n["!ref"]==null)return[];var i=Ft(n["!ref"]),s="",a=[],o,c=[],l=Array.isArray(n);for(o=i.s.c;o<=i.e.c;++o)a[o]=Xt(o);for(var u=i.s.r;u<=i.e.r;++u)for(s=fn(u),o=i.s.c;o<=i.e.c;++o)if(e=a[o]+s,t=l?(n[u]||[])[o]:n[e],r="",t!==void 0){if(t.F!=null){if(e=t.F,!t.f)continue;r=t.f,e.indexOf(":")==-1&&(e=e+":"+e)}if(t.f!=null)r=t.f;else{if(t.t=="z")continue;if(t.t=="n"&&t.v!=null)r=""+t.v;else if(t.t=="b")r=t.v?"TRUE":"FALSE";else if(t.w!==void 0)r="'"+t.w;else{if(t.v===void 0)continue;t.t=="s"?r="'"+t.v:r=""+t.v}}c[c.length]=e+"="+r}return c}function tA(n,e,t){var r=t||{},i=+!r.skipHeader,s=n||{},a=0,o=0;if(s&&r.origin!=null)if(typeof r.origin=="number")a=r.origin;else{var c=typeof r.origin=="string"?Ln(r.origin):r.origin;a=c.r,o=c.c}var l,u={s:{c:0,r:0},e:{c:o,r:a+e.length-1+i}};if(s["!ref"]){var h=Ft(s["!ref"]);u.e.c=Math.max(u.e.c,h.e.c),u.e.r=Math.max(u.e.r,h.e.r),a==-1&&(a=h.e.r+1,u.e.r=a+e.length-1+i)}else a==-1&&(a=0,u.e.r=e.length-1+i);var d=r.header||[],p=0;e.forEach(function(m,_){Kr(m).forEach(function(E){(p=d.indexOf(E))==-1&&(d[p=d.length]=E);var I=m[E],v="z",R="",F=Me({c:o+p,r:a+_+i});l=Yl(s,F),I&&typeof I=="object"&&!(I instanceof Date)?s[F]=I:(typeof I=="number"?v="n":typeof I=="boolean"?v="b":typeof I=="string"?v="s":I instanceof Date?(v="d",r.cellDates||(v="n",I=Bn(I)),R=r.dateNF||Ne[14]):I===null&&r.nullError&&(v="e",I=0),l?(l.t=v,l.v=I,delete l.w,delete l.R,R&&(l.z=R)):s[F]=l={t:v,v:I},R&&(l.z=R))})}),u.e.c=Math.max(u.e.c,o+d.length-1);var g=fn(a);if(i)for(p=0;p<d.length;++p)s[Xt(p+o)+g]={t:"s",v:d[p]};return s["!ref"]=Je(u),s}function bz(n,e){return tA(null,n,e)}function Yl(n,e,t){if(typeof e=="string"){if(Array.isArray(n)){var r=Ln(e);return n[r.r]||(n[r.r]=[]),n[r.r][r.c]||(n[r.r][r.c]={t:"z"})}return n[e]||(n[e]={t:"z"})}return typeof e!="number"?Yl(n,Me(e)):Yl(n,Me({r:e,c:t||0}))}function Iz(n,e){if(typeof e=="number"){if(e>=0&&n.SheetNames.length>e)return e;throw new Error("Cannot find sheet # "+e)}else if(typeof e=="string"){var t=n.SheetNames.indexOf(e);if(t>-1)return t;throw new Error("Cannot find sheet name |"+e+"|")}else throw new Error("Cannot find sheet |"+e+"|")}function Mm(){return{SheetNames:[],Sheets:{}}}function Lm(n,e,t,r){var i=1;if(!t)for(;i<=65535&&n.SheetNames.indexOf(t="Sheet"+i)!=-1;++i,t=void 0);if(!t||n.SheetNames.length>=65535)throw new Error("Too many worksheets");if(r&&n.SheetNames.indexOf(t)>=0){var s=t.match(/(^.*?)(\d+)$/);i=s&&+s[2]||0;var a=s&&s[1]||t;for(++i;i<=65535&&n.SheetNames.indexOf(t=a+i)!=-1;++i);}if(lH(t),n.SheetNames.indexOf(t)>=0)throw new Error("Worksheet with name |"+t+"| already exists!");return n.SheetNames.push(t),n.Sheets[t]=e,t}function Az(n,e,t){n.Workbook||(n.Workbook={}),n.Workbook.Sheets||(n.Workbook.Sheets=[]);var r=Iz(n,e);switch(n.Workbook.Sheets[r]||(n.Workbook.Sheets[r]={}),t){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+t)}n.Workbook.Sheets[r].Hidden=t}function Sz(n,e){return n.z=e,n}function nA(n,e,t){return e?(n.l={Target:e},t&&(n.l.Tooltip=t)):delete n.l,n}function kz(n,e,t){return nA(n,"#"+e,t)}function Cz(n,e,t){n.c||(n.c=[]),n.c.push({t:e,a:t||"SheetJS"})}function Rz(n,e,t,r){for(var i=typeof e!="string"?e:Ft(e),s=typeof e=="string"?e:Je(e),a=i.s.r;a<=i.e.r;++a)for(var o=i.s.c;o<=i.e.c;++o){var c=Yl(n,a,o);c.t="n",c.F=s,delete c.v,a==i.s.r&&o==i.s.c&&(c.f=t,r&&(c.D=!0))}return n}var Pz={encode_col:Xt,encode_row:fn,encode_cell:Me,encode_range:Je,decode_col:Em,decode_row:vm,split_cell:z5,decode_cell:Ln,decode_range:nc,format_cell:bi,sheet_add_aoa:a2,sheet_add_json:tA,sheet_add_dom:X2,aoa_to_sheet:rc,json_to_sheet:bz,table_to_sheet:Q2,table_to_book:qH,sheet_to_csv:eA,sheet_to_txt:wz,sheet_to_json:Ip,sheet_to_html:GH,sheet_to_formulae:Tz,sheet_to_row_object_array:Ip,sheet_get_cell:Yl,book_new:Mm,book_append_sheet:Lm,book_set_sheet_visibility:Az,cell_set_number_format:Sz,cell_set_hyperlink:nA,cell_set_internal_link:kz,cell_add_comment:Cz,sheet_set_array_formula:Rz,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function Dz(){const n=document.getElementById("tab-admin");n&&(n.innerHTML=`
            <header class="header" style="background: linear-gradient(135deg, #d35400 0%, #e67e22 100%);">
                <div class="header-content">
                    <div class="branding">
                        <h1>Admin Dashboard</h1>
                        <p>Manage Users & Pre-Approved Emails</p>
                    </div>
                </div>
            </header>
            <div class="dashboard-grid">
                <section class="card two-span">
                    <h2>Registered Users</h2>
                    <p class="section-desc">Toggle approval status to grant or revoke app access.</p>
                    <div style="overflow-x: auto;">
                        <table class="leaderboard-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Display Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Approved?</th>
                                    <th>Coach?</th>
                                </tr>
                            </thead>
                            <tbody id="admin-users-list"></tbody>
                        </table>
                    </div>
                </section>
                <section class="card two-span">
                    <h2>Pre-Approved Emails</h2>
                    <p class="section-desc">Add emails here to automatically grant users access on registration.</p>
                    <form id="admin-preapprove-form" class="round-form" style="display: flex; gap: 10px; align-items: flex-end; margin-bottom: 20px;">
                        <div class="form-group" style="flex: 1; margin: 0;">
                            <label for="admin-new-email">Email Address</label>
                            <input type="email" id="admin-new-email" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="height: 42px;">Add Email</button>
                    </form>
                    <div style="overflow-x: auto;">
                        <table class="leaderboard-table" style="width: 100%;">
                            <thead>
                                <tr><th>Email Address</th><th>Configuration</th></tr>
                            </thead>
                            <tbody id="admin-emails-list"></tbody>
                        </table>
                    </div>
                </section>
                <section class="card">
                    <h2> Import (CSV)</h2>
                    <a id="btn-download-csv-template" href="#" class="btn btn-secondary btn-sm" style="width:auto;margin-bottom:15px;" download="round-template.csv"> Template</a>
                    <div class="form-row">
                        <div class="form-group flex-2">
                             <label>User</label><select id="import-player-select"></select>
                        </div>
                        <div class="form-group flex-2">
                             <label>CSV</label><input type="file" id="csv-file-input" accept=".csv">
                        </div>
                    </div>
                    <button id="btn-import-csv" class="btn btn-primary" style="width:auto;">Import</button>
                    <div id="import-msg" style="margin-top:10px;font-size:0.8rem;"></div>
                </section>
                <section class="card" style="border: 2px solid #10b981;">
                    <h2> Bulk Excel Import</h2>
                    <input type="file" id="excel-file-input" accept=".xlsx,.xls">
                    <button id="btn-import-excel" class="btn btn-primary" style="margin-top:10px;background:#10b981;border-color:#10b981;"> Start Auto Import</button>
                    <div id="excel-import-msg" style="margin-top:10px;font-size:0.8rem;white-space:pre-wrap;"></div>
                </section>
            </div>
        `);const e=document.getElementById("tab-btn-admin");e&&(e.addEventListener("click",async()=>{if(window.currentUserIsAdmin){P.adminUsersList.innerHTML="Loading...";try{const t=await Nt(Ye(Ie,"users"));P.adminUsersList.innerHTML="",t.forEach(r=>{const i=r.data(),s=document.createElement("tr");s.innerHTML=`
                    <td>${i.displayName||"N/A"}</td>
                    <td>${i.email}</td>
                    <td>${i.isAdmin?"Admin":i.isCoach?"Coach":"Player"}</td>
                    <td>
                        <label class="toggle-switch">
                            <input type="checkbox" ${i.isApproved?"checked":""} onchange="toggleUserApproval('${r.id}', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </td>
                    <td>
                        <label class="toggle-switch">
                            <input type="checkbox" ${i.isCoach?"checked":""} onchange="toggleCoachRole('${r.id}', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </td>
                `,P.adminUsersList.appendChild(s)})}catch(t){console.error("Admin error:",t)}Ap()}}),P.adminPreapproveForm&&P.adminPreapproveForm.addEventListener("submit",async t=>{if(t.preventDefault(),!window.currentUserIsAdmin)return;const r=P.adminNewEmail.value.toLowerCase().trim();r&&(await ec(pt(Ie,"preapproved_emails",r),{addedAt:new Date().toISOString()}),P.adminNewEmail.value="",Ap())}))}async function Ap(){if(P.adminEmailsList){P.adminEmailsList.innerHTML="Loading...";try{const n=await Nt(Ye(Ie,"preapproved_emails"));P.adminEmailsList.innerHTML="",n.forEach(e=>{const t=document.createElement("li");t.style.display="flex",t.style.justifyContent="space-between",t.style.padding="8px",t.style.borderBottom="1px solid #e2e8f0",t.innerHTML=`
                <span>${e.id}</span>
                <button class="btn btn-danger btn-sm" onclick="removePreapprovedEmail('${e.id}')">Remove</button>
            `,P.adminEmailsList.appendChild(t)})}catch{}}}window.toggleUserApproval=async function(n,e){if(window.currentUserIsAdmin)try{await Pa(pt(Ie,"users",n),{isApproved:e})}catch(t){alert("Failed to update approval status."),console.error(t)}};window.toggleCoachRole=async function(n,e){if(window.currentUserIsAdmin)try{await Pa(pt(Ie,"users",n),{isCoach:e})}catch(t){alert("Failed to update coach role."),console.error(t)}};window.removePreapprovedEmail=async function(n){if(window.currentUserIsAdmin)try{await _u(pt(Ie,"preapproved_emails",n)),Ap()}catch{}};function Fz(){if(!window.currentUserIsAdmin)return;const n=document.getElementById("btn-download-csv-template");if(n){const c=`date,course,holes,adjustedGross,courseRating,slopeRating,isCounting
2024-01-15,Royal Melbourne,18,82,72.3,135,true
2024-01-22,Kingston Heath,18,79,73.1,138,true`,l=new Blob([c],{type:"text/csv"});n.href=URL.createObjectURL(l)}const e=document.getElementById("import-player-select");e&&Nt(Ye(Ie,"users")).then(c=>{e.innerHTML="",c.forEach(l=>{const u=l.data();if(u.isApproved){const h=document.createElement("option");h.value=l.id,h.textContent=u.displayName||u.email,e.appendChild(h)}})});const t=document.getElementById("admin-invite-form"),r=document.getElementById("invite-msg");t&&r&&t.addEventListener("submit",async c=>{if(c.preventDefault(),!window.currentUserIsAdmin)return;const l=document.getElementById("invite-email").value.trim().toLowerCase(),u=document.getElementById("invite-name").value.trim(),h=document.getElementById("invite-role").value,d=t.querySelector('button[type="submit"]');d.disabled=!0,d.textContent="Sending...";try{await ec(pt(Ie,"preapproved_emails",l),{addedAt:new Date().toISOString(),displayName:u,role:h}),await rg(Gi,l),r.textContent=` Invitation sent to ${l}. They'll receive a link to set their password.`,r.style.color="#10b981",t.reset()}catch(p){p.code==="auth/user-not-found"?(r.textContent=` ${l} pre-approved. They can now register and will be auto-approved on first login.`,r.style.color="#10b981",t.reset()):(r.textContent=` Error: ${p.message}`,r.style.color="#ef4444")}r.classList.remove("hidden"),d.disabled=!1,d.textContent="Send Invitation"});const i=document.getElementById("btn-import-csv"),s=document.getElementById("import-msg");i&&i.addEventListener("click",async()=>{const c=document.getElementById("csv-file-input"),l=e?e.value:null;if(!c.files.length||!l){s.textContent=" Please select a user and a CSV file.",s.style.color="#ef4444";return}const d=(await c.files[0].text()).trim().split(`
`),p=d[0].split(",").map(_=>_.trim());let g=0,m=0;s.textContent="Importing...",s.style.color="#64748b";for(let _=1;_<d.length;_++){const E=d[_].split(",").map(y=>y.trim());if(E.length<p.length)continue;const I={};p.forEach((y,w)=>{I[y]=E[w]});let v=parseFloat(I.adjustedGross);const R=parseFloat(I.courseRating),F=parseFloat(I.slopeRating),O=parseInt(I.holes)||18;if(isNaN(v)&&I.stablefordPoints&&I.dailyHandicap){const y=parseInt(I.stablefordPoints),w=parseInt(I.dailyHandicap),T=parseInt(I.par)||72;!isNaN(y)&&!isNaN(w)&&(v=T+w+36-y)}if(!I.date||!I.course||isNaN(v)||isNaN(R)||isNaN(F)){m++;continue}try{await qr(Ye(Ie,"whs_rounds"),{uid:l,course:I.course,rating:R,slope:F,adjustedGross:v,holes:O,notCounting:I.isCounting==="false",date:new Date(I.date),importedAt:wi()}),g++}catch{m++}}s.textContent=` Import complete: ${g} rounds added${m>0?`, ${m} rows skipped (invalid data)`:""}.`,s.style.color=m>0?"#f59e0b":"#10b981"});const a=document.getElementById("btn-import-excel"),o=document.getElementById("excel-import-msg");a&&a.addEventListener("click",async()=>{const c=document.getElementById("excel-file-input");if(!c.files.length){o.textContent=" Please select the myscores.xlsx file.",o.style.color="#ef4444";return}try{const u=await c.files[0].arrayBuffer(),h=bp(u,{type:"array",cellDates:!0});let d=0,p=`Import log:
`;o.textContent="Processing workbook... Please wait...",o.style.color="#64748b";for(const g of h.SheetNames){if(g.toLowerCase()==="legend")continue;const m=g.toLowerCase().trim(),_=an(Ye(Ie,"users"),Qt("email","==",m)),E=await Nt(_);if(E.empty){p+=` Skipped tab '${g}': No registered user found with this email.
`;continue}const I=E.docs[0].id;p+=` Found user for tab '${g}' (UID: ${I}).
`;const v=h.Sheets[g],R=Pz.sheet_to_json(v,{header:1});let F=0,O=0;for(let y=0;y<R.length;y++){const w=R[y];if(!w||w.length<8)continue;const T=w[0],S=w[1],A=parseFloat(w[3]),k=parseFloat(w[4]),D=parseFloat(w[7]);if(!S||isNaN(A)||isNaN(k)||isNaN(D))continue;let oe=T instanceof Date?T:isNaN(parseInt(T))?new Date(T):new Date((parseInt(T)-25569)*86400*1e3);if(!oe||isNaN(oe.getTime()))continue;const ie=Math.round(D*k/113+A);try{await qr(Ye(Ie,"whs_rounds"),{uid:I,course:S,rating:A,slope:k,adjustedGross:ie,holes:18,notCounting:!1,date:oe,importedAt:wi(),isAutoImported:!0,originalGrossDiff:D}),F++,d++}catch{O++}}p+=`   -> Imported ${F} rounds (${O} errors).
`}p+=`
 Finished! Total rounds imported: ${d}`,o.textContent=p,o.style.color="#10b981"}catch{o.textContent=" Failed to process workbook. Ensure SheetJS loaded correctly.",o.style.color="#ef4444"}})}async function Oz(n){const e=document.getElementById("coach-shot-dispersion");if(e){e.innerHTML='<p style="color:#94a3b8;">Analyzing shot history...</p>';try{const t=an(Ye(Ie,"shots"),Qt("uid","==",n),Ti("timestamp","desc"),Bl(500)),r=await Nt(t);if(r.empty){e.innerHTML='<p style="color:#94a3b8;">No detailed shot data available for this athlete.</p>';return}const i={total:0,direction:{Left:0,Straight:0,Right:0},trajectory:{Low:0,Medium:0,High:0},curve:{Draw:0,Straight:0,Fade:0}};r.forEach(a=>{const o=a.data();i.total++,o.line&&i.direction[o.line]!==void 0&&i.direction[o.line]++,o.trajectory&&i.trajectory[o.trajectory]!==void 0&&i.trajectory[o.trajectory]++,o.curve&&i.curve[o.curve]!==void 0&&i.curve[o.curve]++});const s=(a,o)=>o>0?Math.round(a/o*100):0;e.innerHTML=`
            <div class="stat-group">
                <h4 style="font-size:0.85rem; color:#64748b; margin-bottom:10px; text-transform:uppercase;">Start Line</h4>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    ${Object.entries(i.direction).map(([a,o])=>`
                        <div style="font-size:0.9rem;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                <span>${a}</span><span>${s(o,i.total)}%</span>
                            </div>
                            <div style="height:6px; background:#f1f5f9; border-radius:3px; overflow:hidden;">
                                <div style="width:${s(o,i.total)}%; height:100%; background:${a==="Straight"?"#10b981":"#f59e0b"};"></div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>
            <div class="stat-group">
                <h4 style="font-size:0.85rem; color:#64748b; margin-bottom:10px; text-transform:uppercase;">Trajectory</h4>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    ${Object.entries(i.trajectory).map(([a,o])=>`
                        <div style="font-size:0.9rem;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                <span>${a}</span><span>${s(o,i.total)}%</span>
                            </div>
                            <div style="height:6px; background:#f1f5f9; border-radius:3px; overflow:hidden;">
                                <div style="width:${s(o,i.total)}%; height:100%; background:#3867d6;"></div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>
            <div class="stat-group">
                <h4 style="font-size:0.85rem; color:#64748b; margin-bottom:10px; text-transform:uppercase;">Shot Shape</h4>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    ${Object.entries(i.curve).map(([a,o])=>`
                        <div style="font-size:0.9rem;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                <span>${a}</span><span>${s(o,i.total)}%</span>
                            </div>
                            <div style="height:6px; background:#f1f5f9; border-radius:3px; overflow:hidden;">
                                <div style="width:${s(o,i.total)}%; height:100%; background:${a==="Straight"?"#10b981":"#8b5cf6"};"></div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>
        `}catch(t){console.error("Aggregation error:",t),e.innerHTML='<p style="color:#ef4444;">Failed to load analytics.</p>'}}}let ri=null;function Mz(){const n=document.getElementById("btn-manage-coaches"),e=document.getElementById("manage-coaches-container"),t=document.getElementById("btn-close-coaches");n&&e&&n.addEventListener("click",()=>{e.classList.remove("hidden"),Sp()}),t&&e&&t.addEventListener("click",()=>{e.classList.add("hidden")});const r=document.getElementById("add-coach-form");r&&r.addEventListener("submit",async i=>{i.preventDefault();const s=document.getElementById("coach-uid-input").value.trim();if(!(!s||!H.currentUser))try{const a=pt(Ie,"users",H.currentUser.uid),o=await Ri(a);let c=o.exists()?o.data().coaches||[]:[];c.includes(s)||(c.push(s),await Pa(a,{coaches:c})),document.getElementById("coach-uid-input").value="",Sp()}catch(a){console.error("Add coach error",a)}})}async function Sp(){const n=document.getElementById("my-coaches-list");if(!(!n||!H.currentUser)){n.innerHTML="Loading...";try{const e=pt(Ie,"users",H.currentUser.uid),t=await Ri(e),r=t.exists()?t.data().coaches||[]:[];if(r.length===0){n.innerHTML="<li>No coaches added yet.</li>";return}n.innerHTML="",r.forEach(i=>{const s=document.createElement("li");s.style.display="flex",s.style.justifyContent="space-between",s.innerHTML=`<span>Coach UID: ${i}</span> <button class="btn btn-danger btn-sm" onclick="removeCoach('${i}')">Remove</button>`,n.appendChild(s)})}catch{}}}window.removeCoach=async function(n){if(H.currentUser)try{const e=pt(Ie,"users",H.currentUser.uid),t=await Ri(e);let r=t.exists()?t.data().coaches||[]:[];r=r.filter(i=>i!==n),await Pa(e,{coaches:r}),Sp()}catch{}};function Lz(){if(!window.currentUserIsCoach&&!window.currentUserIsAdmin)return;const n=document.getElementById("coach-roster-list"),e=document.getElementById("coach-roster-count"),t=document.getElementById("coach-player-view"),r=n?.parentElement,i=document.getElementById("btn-coach-back");i&&i.addEventListener("click",()=>{t?.classList.add("hidden"),r?.classList.remove("hidden"),ri=null});const s=document.getElementById("btn-coach-ai-plan");s&&s.addEventListener("click",()=>{ri&&Dh(ri,"coach")});const a=document.getElementById("btn-save-coach-note");a&&a.addEventListener("click",async()=>{if(!ri)return;const u=document.getElementById("coach-note-input")?.value.trim();u&&(await qr(Ye(Ie,"users",ri,"coachNotes"),{coachUid:H.currentUser.uid,text:u,createdAt:wi()}),document.getElementById("coach-note-input").value="",jv(ri))});const o=document.getElementById("btn-assign-drill");o&&o.addEventListener("click",async()=>{if(!ri)return;const u=document.getElementById("coach-drill-assign-name")?.value.trim(),h=document.getElementById("coach-drill-assign-notes")?.value.trim();if(!u)return;const d=document.getElementById("assign-drill-msg");try{await qr(Ye(Ie,"users",ri,"assignedDrills"),{drillName:u,notes:h||"",assignedBy:H.currentUser.uid,assignedAt:wi(),completed:!1}),d&&(d.textContent=" Drill assigned!",d.style.color="#10b981"),document.getElementById("coach-drill-assign-name").value="",document.getElementById("coach-drill-assign-notes").value=""}catch(p){d&&(d.textContent=` ${p.message}`,d.style.color="#ef4444")}}),c();async function c(){if(!n)return;const u=H.currentUser.uid;let h=H.allUsersCache;if(!h){const p=await Nt(Ye(Ie,"users"));h=[],p.forEach(g=>h.push({uid:g.id,...g.data()})),H.allUsersCache=h}const d=[];if(h.forEach(p=>{if(!p.isApproved||p.uid===u)return;const g=p.coaches||[];(window.currentUserIsAdmin||g.includes(u))&&d.push(p)}),e&&(e.textContent=`${d.length} athlete${d.length!==1?"s":""}`),!d.length){n.innerHTML='<p style="color:#94a3b8;">No athletes have granted you access yet.</p>';return}n.innerHTML="";for(const p of d){const g=await Nt(an(Ye(Ie,"whs_rounds"),Qt("uid","==",p.uid)));let m=[];g.forEach(I=>{const v=I.data();m.push({diff:113/v.slope*(v.adjustedGross-v.rating),date:v.date?.toDate?.()||new Date})}),m.sort((I,v)=>v.date-I.date);let _="";if(m.length>=4){const I=Math.floor(Math.min(m.length,10)/2),v=m.slice(0,I).reduce((O,y)=>O+y.diff,0)/I,R=m.slice(I,I*2).reduce((O,y)=>O+y.diff,0)/I,F=v-R;F<-.5?_='<span class="status-badge success"> Improving</span>':F>.5?_='<span class="status-badge error"> Declining</span>':_='<span class="status-badge info"> Stable</span>'}const E=document.createElement("div");E.className="coach-roster-card",E.innerHTML=`
                <div class="athlete-info">
                    <div class="avatar">${(p.displayName||"?")[0].toUpperCase()}</div>
                    <div>
                        <div class="name">${p.displayName||p.email}</div>
                        <div class="meta">${_}</div>
                    </div>
                </div>
                <div class="athlete-stat">
                    <div class="value">${p.handicapIndex??"--"}</div>
                    <div class="label">HI</div>
                </div>
            `,E.addEventListener("click",()=>l(p)),n.appendChild(E)}}async function l(u){ri=u.uid,r?.classList.add("hidden"),t?.classList.remove("hidden"),document.getElementById("coach-view-name").textContent=u.displayName||u.email;const h=await Nt(an(Ye(Ie,"whs_rounds"),Qt("uid","==",u.uid),Ti("date","desc"),Bl(10))),d=document.getElementById("coach-whs-tbody");if(d){d.innerHTML="";let m=[],_=[],E=[];h.forEach(v=>{const R=v.data(),F=(113/R.slope*(R.adjustedGross-R.rating)).toFixed(1),O=R.date?.toDate?R.date.toDate().toLocaleDateString("en-AU"):"--";R.stats?.putts&&m.push(R.stats.putts),R.stats?.fwy&&_.push(R.stats.fwy),R.stats?.gir&&E.push(R.stats.gir);const y=document.createElement("tr");y.innerHTML=`<td>${O}</td><td>${R.course}</td><td>${R.adjustedGross}</td><td>${F}</td><td>${R.stats?.putts??"--"}</td><td>${R.stats?.fwy??"--"}</td><td>${R.stats?.gir??"--"}</td>`,d.appendChild(y)});const I=v=>v.length?(v.reduce((R,F)=>R+F,0)/v.length).toFixed(1):"--";document.getElementById("coach-stat-putts").textContent=I(m),document.getElementById("coach-stat-fwy").textContent=_.length?I(_)+"/14":"--",document.getElementById("coach-stat-gir").textContent=E.length?I(E)+"/18":"--",document.getElementById("coach-view-hi").textContent=u.handicapIndex??"--"}const p=await Nt(an(Ye(Ie,"practice_rounds"),Qt("uid","==",u.uid),Ti("date","desc"),Bl(10))),g=document.getElementById("coach-practice-tbody");g&&(g.innerHTML="",p.forEach(m=>{const _=m.data(),E=_.date?.toDate?_.date.toDate().toLocaleDateString("en-AU"):"--",I=document.createElement("tr");I.innerHTML=`<td>${E}</td><td>${_.drillName}</td><td>${_.score}</td>`,g.appendChild(I)})),jv(u.uid),Oz(u.uid)}}async function jv(n){const e=document.getElementById("coach-notes-list");if(!e)return;const t=await Nt(an(Ye(Ie,"users",n,"coachNotes"),Ti("createdAt","desc"),Bl(10)));if(e.innerHTML="",t.empty){e.innerHTML='<p class="empty-msg">No notes yet.</p>';return}t.forEach(r=>{const i=r.data(),s=i.createdAt?.toDate?i.createdAt.toDate().toLocaleDateString("en-AU"):"Just now",a=document.createElement("div");a.className="coach-note-row",a.innerHTML=`<div class="date">${s}</div><div class="text">${i.text}</div>`,e.appendChild(a)})}let pl=!1,Rf=0,kp=null,Cp="READY",dh=null,oi=0,gl=0,Gv=0,ml=0,qv=0;function Nz(){P.tempoPlayBtn&&(P.tempoResetCounter.addEventListener("click",()=>{Rf=0,P.tempoSwingCounter.textContent=Rf}),P.tempoSpeedSlider.addEventListener("input",n=>P.tempoSpeedDisplay.textContent=`${n.target.value}s`),P.tempoDelaySlider.addEventListener("input",n=>P.tempoDelayDisplay.textContent=`${n.target.value}s`),P.tempoLoopToggle.addEventListener("change",n=>{P.tempoDelayContainer.style.opacity=n.target.checked?"1":"0.5",P.tempoDelayContainer.style.pointerEvents=n.target.checked?"auto":"none"}),P.tempoPlayBtn.addEventListener("click",Pf),P.nativeAudioPlayer.addEventListener("ended",()=>{!P.tempoLoopToggle.checked&&pl&&Pf()}))}function Vz(n){const e=n.numberOfChannels,t=n.length*e*2+44,r=new ArrayBuffer(t),i=new DataView(r);let s=0,a=0,o=[],c,l;const u=d=>{i.setUint16(s,d,!0),s+=2},h=d=>{i.setUint32(s,d,!0),s+=4};for(h(1179011410),h(t-8),h(1163280727),h(544501094),h(16),u(1),u(e),h(n.sampleRate),h(n.sampleRate*2*e),u(e*2),u(16),h(1635017060),h(t-s-4),c=0;c<n.numberOfChannels;c++)o.push(n.getChannelData(c));for(;s<t;){for(c=0;c<e;c++)l=Math.max(-1,Math.min(1,o[c][a])),l=(.5+l<0?l*32768:l*32767)|0,i.setInt16(s,l,!0),s+=2;a++}return new Blob([r],{type:"audio/wav"})}function y0(n,e,t,r,i){const s=n.createOscillator(),a=n.createGain();a.connect(n.destination);let o=i===3,c=800,l="sine",u=.1,h=.001;e==="classic"?(c=o?1200:800,l="triangle",u=.08):e==="glock"?(c=o?1500:1e3,l="sine",u=.6,h=.1):e==="marimba"?(c=o?600:400,l="sine",u=.2):e==="bass"&&(c=o?100:65,l="sine",u=.3),s.type=l,s.frequency.setValueAtTime(c,t),s.connect(a),a.gain.setValueAtTime(0,t),a.gain.linearRampToValueAtTime(1,t+.01),a.gain.exponentialRampToValueAtTime(h,t+u),s.start(t),s.stop(t+u)}function v0(n,e){const t=n.createOscillator(),r=n.createGain();t.type="square",t.frequency.setValueAtTime(1e3,e),t.connect(r),r.connect(n.destination),r.gain.setValueAtTime(0,e),r.gain.linearRampToValueAtTime(.1,e+.005),r.gain.exponentialRampToValueAtTime(.001,e+.05),t.start(e),t.stop(e+.05)}async function Bz(){P.tempoPlayBtn.textContent="RENDERING...";const n=parseFloat(P.tempoSpeedSlider.value),e=parseInt(P.tempoSelect.value),t=P.tempoVibeSelect.value,r=P.tempoLoopToggle.checked,i=r?parseInt(P.tempoDelaySlider.value):1;gl=n*(e/(e+1)),Gv=n*(1/(e+1)),oi=i,ml=oi+gl+Gv,qv=ml+1;const s=new OfflineAudioContext(1,44100*qv,44100);i>=3&&(v0(s,i-3),v0(s,i-2),v0(s,i-1)),y0(s,t,oi,0,1),y0(s,t,oi+gl,0,2),y0(s,t,ml,0,3);const a=await s.startRendering();dh&&URL.revokeObjectURL(dh),dh=URL.createObjectURL(Vz(a)),P.nativeAudioPlayer.src=dh,P.nativeAudioPlayer.loop=r}function rA(){if(!pl)return;const n=P.nativeAudioPlayer.currentTime;let e="";n<oi?(e="SETUP",P.tempoSwingState.textContent=`${Math.ceil(oi-n)}s`,P.tempoCoreCircle.style.background="#64748b",P.tempoCoreCircle.style.transform="scale(1)"):n>=oi&&n<oi+gl?(e="BACK",P.tempoSwingState.textContent="BACK",P.tempoCoreCircle.style.background="#a855f7",P.tempoCoreCircle.style.transform="scale(0.8)"):n>=oi+gl&&n<ml?(e="TOP",P.tempoSwingState.textContent="TOP",P.tempoCoreCircle.style.background="#eab308",P.tempoCoreCircle.style.transform="scale(1.2)"):n>=ml&&(e="IMPACT",P.tempoSwingState.textContent="IMPACT!",P.tempoCoreCircle.style.background="#22c55e",P.tempoCoreCircle.style.transform="scale(1)"),Cp!=="IMPACT"&&e==="IMPACT"&&(P.tempoRing.style.display="block",P.tempoRing.style.animation="none",P.tempoRing.offsetWidth,P.tempoRing.style.animation="tempoExpand 0.5s ease-out forwards",Rf++,P.tempoSwingCounter.textContent=Rf),Cp=e,kp=requestAnimationFrame(rA)}async function Pf(){pl?(P.nativeAudioPlayer.pause(),pl=!1,cancelAnimationFrame(kp),P.tempoPlayBtn.textContent="START",P.tempoPlayBtn.style.background="var(--primary-color)",P.tempoSwingState.textContent="READY",P.tempoCoreCircle.style.background="#3b82f6",P.tempoCoreCircle.style.transform="scale(1)",P.tempoRing.style.display="none",P.tempoRing.style.animation="",Cp="READY","mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused")):(await Bz(),P.nativeAudioPlayer.play(),pl=!0,P.tempoPlayBtn.textContent="STOP",P.tempoPlayBtn.style.background="var(--danger)","mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Tempo Loop",artist:"Golf Tracker"}),navigator.mediaSession.setActionHandler("play",Pf),navigator.mediaSession.setActionHandler("pause",Pf),navigator.mediaSession.playbackState="playing"),kp=requestAnimationFrame(rA))}function Uz(){console.log("App Ready: Bootstrapping modules..."),UP(),gI(),F3(),l6(),m6(),Hz(),Dz(),Fz(),Mz(),Lz(),EI(),zz(),p6(),Nz();const n=document.getElementById("tab-btn-feed");n&&n.addEventListener("click",()=>S6(),{once:!0})}k3(Uz);function Hz(){if(P.addRoundForm){let _=function(I){if(d.innerHTML="",!I||!I.pars||I.pars.length===0){d.innerHTML="<em>No hole data available for this course.</em>";return}d.style.gridTemplateColumns=`repeat(${Math.min(9,I.pars.length)}, 1fr)`,I.pars.forEach((v,R)=>{const F=R+1,O=I.strokeIndex?I.strokeIndex[R]:"-",y=document.createElement("div");y.style.textAlign="center",y.innerHTML=`
                    <div style="font-size:0.75rem; color:#64748b; font-weight:bold;">H${F}</div>
                    <div style="font-size:0.7rem; color:#94a3b8; margin-bottom:2px;">P${v} I${O}</div>
                    <input type="number" class="hole-score-input" data-idx="${R}" min="1" max="15" 
                           style="width:100%; padding:8px 4px; text-align:center; box-sizing:border-box;">
                `,d.appendChild(y)}),document.querySelectorAll(".hole-score-input").forEach(v=>{v.addEventListener("input",E)})},E=function(){const I=document.querySelector('input[name="entry-mode"]:checked');if(!I)return;const v=I.value;if(v==="manual-ags")return;const R=parseFloat(a.value),F=parseFloat(o.value);if(isNaN(R)||isNaN(F)){m.value="";return}const O=parseFloat(P.handicapIndexEl.textContent),y=isNaN(O)?0:Math.round(O*(R/113)+(parseFloat(s.value||72)-F));let w=0;if(v==="hole-by-hole"&&t.value!=="Custom"&&t.value!==""){const[S,A]=t.value.split("|"),k=yn[S]&&yn[S][A]?yn[S][A]:null;if(!k||!k.pars||!k.strokeIndex)return;document.querySelectorAll(".hole-score-input").forEach(oe=>{const ie=parseInt(oe.value);if(!isNaN(ie)&&ie>0){const ue=parseInt(oe.dataset.idx),he=k.pars[ue],Oe=k.strokeIndex[ue],K=am(ie,he,Oe,y);w+=K}}),p.textContent=w}else v==="total-stableford"&&(w=parseInt(g.value)||0);const T=om(w,y,F);m.value=Math.max(0,T)};var n=_,e=E;const t=document.getElementById("course-select"),r=document.getElementById("course-name-custom-group"),i=document.getElementById("course-name"),s=document.getElementById("course-rating"),a=document.getElementById("slope-rating"),o=document.getElementById("course-par"),c=document.getElementsByName("entry-mode"),l=document.getElementById("mode-hole-by-hole"),u=document.getElementById("mode-total-stableford"),h=document.getElementById("mode-manual-ags"),d=document.getElementById("hole-grid-container"),p=document.getElementById("calc-stableford-pts"),g=document.getElementById("total-stableford-pts"),m=document.getElementById("score");if(m.readOnly=!0,t&&Object.keys(yn).length>0){Object.keys(yn).forEach(R=>{const F=document.createElement("optgroup");F.label=R,Object.keys(yn[R]).forEach(O=>{const y=document.createElement("option");y.value=`${R}|${O}`,y.text=O,F.appendChild(y)}),t.appendChild(F)});const I=document.createElement("optgroup");I.label="Other";const v=document.createElement("option");v.value="Custom",v.text="Custom Course",I.appendChild(v),t.appendChild(I),t.addEventListener("change",R=>{let F=null;if(R.target.value==="Custom")r.classList.remove("hidden"),i.required=!0,s.value="",a.value="",o.value="",d.innerHTML="<em>Hole-by-hole not available for custom courses. Use Total Stableford or Manual AGS.</em>",document.querySelector('input[value="total-stableford"]').click();else{r.classList.add("hidden"),i.required=!1;const[O,y]=R.target.value.split("|");F=yn[O][y],s.value=F.rating,a.value=F.slope,o.value=F.par||72,_(F)}E()})}c.forEach(I=>I.addEventListener("change",v=>{l.classList.add("hidden"),u.classList.add("hidden"),h.classList.add("hidden"),v.target.value==="hole-by-hole"?(l.classList.remove("hidden"),m.readOnly=!0):v.target.value==="total-stableford"?(u.classList.remove("hidden"),m.readOnly=!0):v.target.value==="manual-ags"&&(h.classList.remove("hidden"),m.readOnly=!1),E()})),g&&g.addEventListener("input",E),P.addRoundForm.addEventListener("submit",async I=>{if(I.preventDefault(),H.viewingPlayerId!==H.currentUser.uid){alert("You can only log rounds for your own account.");return}let v="Unknown Course";if(t.value==="Custom")v=i.value||"Custom Course";else if(t.value!==""){const[D,oe]=t.value.split("|");v=`${D} - ${oe}`}const R=parseFloat(s.value),F=parseFloat(a.value),O=parseInt(m.value);if(isNaN(O)){alert("AGS Score calculation is missing.");return}const y=parseInt(document.getElementById("stat-putts").value)||null,w=parseInt(document.getElementById("stat-fwy").value)||null,T=parseInt(document.getElementById("stat-gir").value)||null,S=y||w||T?{putts:y,fwy:w,gir:T}:null,A=I.target.querySelector('button[type="submit"]');A.disabled=!0,A.textContent="Saving...",document.getElementById("is-counting").checked,await D3(v,R,F,O,S)?(P.addRoundForm.reset(),t.dispatchEvent(new Event("change")),document.querySelector('input[value="hole-by-hole"]').click()):alert("Failed to log round. Ensure fields are filled."),A.disabled=!1,A.textContent="Save Round to Profile"})}P.playerSelect&&P.playerSelect.addEventListener("change",t=>{const r=t.target.value;H.viewingPlayerId=r,r===H.currentUser.uid?(P.addRoundContainer.style.display="block",P.recordPlayerNameEl.textContent="Your",P.readonlyWarningContainer.classList.add("hidden")):(P.addRoundContainer.style.display="none",P.recordPlayerNameEl.textContent=t.target.options[t.target.selectedIndex].text+"'s",P.readonlyWarningContainer.classList.remove("hidden")),P.btnCalculateDaily&&P.btnCalculateDaily.click(),gI()}),P.btnCalculateDaily&&P.btnCalculateDaily.addEventListener("click",()=>{const t=parseFloat(document.getElementById("calc-slope").value),r=parseFloat(document.getElementById("calc-par").value),i=parseFloat(document.getElementById("calc-scratch").value);if(isNaN(t)||isNaN(r)||isNaN(i)){alert("Please fill in valid numbers for all fields");return}const s=P.handicapIndexEl.textContent,a=parseFloat(s);if(isNaN(a)){alert("Player does not have a valid handicap index yet.");return}const o=Math.round(a*(t/113)+(i-r));P.dailyHandicapResult.classList.remove("hidden"),P.dhValue.textContent=o,P.dhPlayerName.textContent=P.playerSelect.options[P.playerSelect.selectedIndex]?.text||"Player"})}async function zz(){if(!P.playerSelect)return;P.playerSelect.innerHTML="";const n=document.createElement("option");if(n.value=H.currentUser.uid,n.textContent=H.currentUser.displayName||H.currentUser.email,n.selected=!0,P.playerSelect.appendChild(n),H.profileUsersMap[H.currentUser.uid]=n.textContent,window.currentUserIsAdmin||H.currentUser.isCoach)try{let e;const t=Ye(Ie,"users");window.currentUserIsAdmin?e=an(t,Qt("isApproved","==",!0)):e=an(t,Qt("coaches","array-contains",H.currentUser.uid)),(await Nt(e)).forEach(i=>{if(i.id!==H.currentUser.uid){const s=i.data(),a=document.createElement("option");a.value=i.id,a.textContent=s.displayName||s.email,P.playerSelect.appendChild(a),H.profileUsersMap[i.id]=a.textContent}})}catch(e){console.error("Error fetching player list: ",e)}P.ocPlayerSelect&&(P.ocPlayerSelect.innerHTML=P.playerSelect.innerHTML)}
